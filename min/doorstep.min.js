parcelRequire=function(a,e,r,t){function s(m,t){function r(t){return s(r.resolve(t))}if(!e[m]){if(!a[m]){var n="function"==typeof parcelRequire&&parcelRequire;if(!t&&n)return n(m,!0);if(d)return d(m,!0);if(o&&"string"==typeof m)return o(m);var i=new Error("Cannot find module '"+m+"'");throw i.code="MODULE_NOT_FOUND",i}r.resolve=function(e){return a[m][1][e]||e},r.cache={};var p=e[m]=new s.Module(m);a[m][0].call(p.exports,r,p,p.exports,this)}return e[m].exports}var d="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require,n;s.isParcelRequire=!0,s.Module=function(t){this.id=t,this.bundle=s,this.exports={}},s.modules=a,s.cache=e,s.parent=d,s.register=function(e,o){a[e]=[function(t,e){e.exports=o},{}]};for(var p=0;p<r.length;p++)try{s(r[p])}catch(t){n||(n=t)}if(r.length){var m=s(r[r.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=m:"function"==typeof define&&define.amd?define(function(){return m}):t&&(this[t]=m)}if(parcelRequire=s,n)throw n;return s}({EgBh:[function(a,o){function n(){this._pieces=[],this._parts=[]}var s={};s.useBlobBuilder=function(){try{return new Blob([]),!1}catch(t){return!0}}(),s.useArrayBufferView=!s.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(t){return!0}}(),o.exports.binaryFeatures=s;var e=o.exports.BlobBuilder;"undefined"!=typeof window&&(e=o.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),n.prototype.append=function(t){"number"==typeof t?this._pieces.push(t):(this.flush(),this._parts.push(t))},n.prototype.flush=function(){if(0<this._pieces.length){var e=new Uint8Array(this._pieces);s.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},n.prototype.getBuffer=function(){if(this.flush(),s.useBlobBuilder){for(var r=new e,t=0,a=this._parts.length;t<a;t++)r.append(this._parts[t]);return r.getBlob()}return new Blob(this._parts)},o.exports.BufferBuilder=n},{}],kdPp:[function(o,i){function s(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function r(){this.bufferBuilder=new a}function n(r){var t=r.charCodeAt(0);return 2047>=t?"00":65535>=t?"000":2097151>=t?"0000":67108863>=t?"00000":"000000"}function d(e){return 600<e.length?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,n).length}var a=o("./bufferbuilder").BufferBuilder,p=o("./bufferbuilder").binaryFeatures;i.exports={unpack:function(e){return new s(e).unpack()},pack:function(a){var t=new r;return t.pack(a),t.getBuffer()}},s.prototype.unpack=function(){var r=this.unpack_uint8(),e;return 128>r?r:32>(224^r)?(224^r)-32:15>=(e=160^r)?this.unpack_raw(e):15>=(e=176^r)?this.unpack_string(e):15>=(e=144^r)?this.unpack_array(e):15>=(e=128^r)?this.unpack_map(e):192===r?null:193===r?void 0:194!==r&&(195===r||(202===r?this.unpack_float():203===r?this.unpack_double():204===r?this.unpack_uint8():205===r?this.unpack_uint16():206===r?this.unpack_uint32():207===r?this.unpack_uint64():208===r?this.unpack_int8():209===r?this.unpack_int16():210===r?this.unpack_int32():211===r?this.unpack_int64():212===r||213===r||214===r||215===r?void 0:216===r?(e=this.unpack_uint16(),this.unpack_string(e)):217===r?(e=this.unpack_uint32(),this.unpack_string(e)):218===r?(e=this.unpack_uint16(),this.unpack_raw(e)):219===r?(e=this.unpack_uint32(),this.unpack_raw(e)):220===r?(e=this.unpack_uint16(),this.unpack_array(e)):221===r?(e=this.unpack_uint32(),this.unpack_array(e)):222===r?(e=this.unpack_uint16(),this.unpack_map(e)):223===r?(e=this.unpack_uint32(),this.unpack_map(e)):void 0))},s.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},s.prototype.unpack_uint16=function(){var r=this.read(2),t=256*(255&r[0])+(255&r[1]);return this.index+=2,t},s.prototype.unpack_uint32=function(){var r=this.read(4),t=256*(256*(256*r[0]+r[1])+r[2])+r[3];return this.index+=4,t},s.prototype.unpack_uint64=function(){var r=this.read(8),t=256*(256*(256*(256*(256*(256*(256*r[0]+r[1])+r[2])+r[3])+r[4])+r[5])+r[6])+r[7];return this.index+=8,t},s.prototype.unpack_int8=function(){var e=this.unpack_uint8();return 128>e?e:e-256},s.prototype.unpack_int16=function(){var e=this.unpack_uint16();return 32768>e?e:e-65536},s.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},s.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},s.prototype.unpack_raw=function(r){if(this.length<this.index+r)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+r+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+r);return this.index+=r,t},s.prototype.unpack_string=function(a){for(var t=this.read(a),r=0,o="",s,d;r<a;)128>(s=t[r])?(o+=String.fromCharCode(s),r++):32>(192^s)?(d=(192^s)<<6|63&t[r+1],o+=String.fromCharCode(d),r+=2):(d=(15&s)<<12|(63&t[r+1])<<6|63&t[r+2],o+=String.fromCharCode(d),r+=3);return this.index+=a,o},s.prototype.unpack_array=function(r){for(var t=Array(r),e=0;e<r;e++)t[e]=this.unpack();return t},s.prototype.unpack_map=function(a){for(var t={},e=0;e<a;e++){var o=this.unpack(),r=this.unpack();t[o]=r}return t},s.prototype.unpack_float=function(){var e=this.unpack_uint32();return(0==e>>31?1:-1)*(8388608|8388607&e)*Math.pow(2,(255&e>>23)-127-23)},s.prototype.unpack_double=function(){var r=this.unpack_uint32(),t=this.unpack_uint32(),e=(2047&r>>20)-1023;return(0==r>>31?1:-1)*((1048576|1048575&r)*Math.pow(2,e-20)+t*Math.pow(2,e-52))},s.prototype.read=function(r){var t=this.index;if(t+r<=this.length)return this.dataView.subarray(t,t+r);throw new Error("BinaryPackFailure: read index out of range")},r.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},r.prototype.pack=function(e){var t=typeof e;if("string"==t)this.pack_string(e);else if("number"===t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"===t)!0===e?this.bufferBuilder.append(195):!1==e&&this.bufferBuilder.append(194);else if("undefined"===t)this.bufferBuilder.append(192);else{if("object"!==t)throw new Error("Type \""+t+"\" not yet supported");if(null===e)this.bufferBuilder.append(192);else{var a=e.constructor;if(a==Array)this.pack_array(e);else if(a==Blob||a==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(a==ArrayBuffer)p.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)p.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(a==Object||a.toString().startsWith("class"))this.pack_object(e);else if(a==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error("Type \""+a.toString()+"\" not yet supported");this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},r.prototype.pack_bin=function(r){var t=r.length||r.byteLength||r.size;if(15>=t)this.pack_uint8(160+t);else if(65535>=t)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(4294967295>=t))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(r)},r.prototype.pack_string=function(r){var t=d(r);if(15>=t)this.pack_uint8(176+t);else if(65535>=t)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(4294967295>=t))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(r)},r.prototype.pack_array=function(r){var t=r.length;if(15>=t)this.pack_uint8(144+t);else if(65535>=t)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(4294967295>=t))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var e=0;e<t;e++)this.pack(r[e])},r.prototype.pack_integer=function(e){if(-32<=e&&127>=e)this.bufferBuilder.append(255&e);else if(0<=e&&255>=e)this.bufferBuilder.append(204),this.pack_uint8(e);else if(-128<=e&&127>=e)this.bufferBuilder.append(208),this.pack_int8(e);else if(0<=e&&65535>=e)this.bufferBuilder.append(205),this.pack_uint16(e);else if(-32768<=e&&32767>=e)this.bufferBuilder.append(209),this.pack_int16(e);else if(0<=e&&4294967295>=e)this.bufferBuilder.append(206),this.pack_uint32(e);else if(-2147483648<=e&&2147483647>=e)this.bufferBuilder.append(210),this.pack_int32(e);else if(-0x8000000000000000<=e&&0x8000000000000000>=e)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(0<=e&&0x10000000000000000>=e))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},r.prototype.pack_double=function(o){var s=0;0>o&&(s=1,o=-o);var d=Math.floor(Math.log(o)/Math.LN2),i=o/Math.pow(2,d)-1,r=Math.floor(i*Math.pow(2,52)),n=Math.pow(2,32),p=s<<31|d+1023<<20|1048575&r/4294967296;this.bufferBuilder.append(203),this.pack_int32(p),this.pack_int32(r%4294967296)},r.prototype.pack_object=function(r){var t=Object.keys(r).length;if(15>=t)this.pack_uint8(128+t);else if(65535>=t)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(4294967295>=t))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var e in r)r.hasOwnProperty(e)&&(this.pack(e),this.pack(r[e]))},r.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},r.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_uint32=function(r){var t=4294967295&r;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},r.prototype.pack_uint64=function(r){var t=r/Math.pow(2,32),e=r%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},r.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_int32=function(e){this.bufferBuilder.append(255&e>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_int64=function(r){var t=Math.floor(r/Math.pow(2,32)),e=r%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)}},{"./bufferbuilder":"EgBh"}],iSxC:[function(m,g,h){"use strict";function y(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(a,e,t){var o=a.match(e);return o&&o.length>=t&&parseInt(o[t],10)}function e(a,s,d){if(a.RTCPeerConnection){var e=a.RTCPeerConnection.prototype,t=e.addEventListener;e.addEventListener=function(a,o){if(a!==s)return t.apply(this,arguments);var e=function(r){var e=d(r);e&&o(e)};return this._eventMap=this._eventMap||{},this._eventMap[o]=e,t.apply(this,[a,e])};var o=e.removeEventListener;e.removeEventListener=function(t,e){if(t!==s||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);var a=this._eventMap[e];return delete this._eventMap[e],o.apply(this,[t,a])},Object.defineProperty(e,"on"+s,{get:function(){return this["_on"+s]},set:function(t){this["_on"+s]&&(this.removeEventListener(s,this["_on"+s]),delete this["_on"+s]),t&&this.addEventListener(s,this["_on"+s]=t)},enumerable:!0,configurable:!0})}}function o(t){return"boolean"==typeof t?(f=t,t?"adapter.js logging disabled":"adapter.js logging enabled"):new Error("Argument type: "+v(t)+". Please use a boolean.")}function i(t){return"boolean"==typeof t?(_=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled")):new Error("Argument type: "+v(t)+". Please use a boolean.")}function a(){if("object"===("undefined"==typeof window?"undefined":v(window))){if(f)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function s(r,e){_&&console.warn(r+" is deprecated, please use "+e+" instead.")}function c(r){var{navigator:e}=r,t={browser:null,version:null};if(void 0===r||!r.navigator)return t.browser="Not a browser.",t;if(e.mozGetUserMedia)t.browser="firefox",t.version=x(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||!1===r.isSecureContext&&r.webkitRTCPeerConnection&&!r.RTCIceGatherer)t.browser="chrome",t.version=x(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=x(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!r.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=x(e.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype}return t}function p(t){return"[object Object]"===Object.prototype.toString.call(t)}function u(e){return p(e)?Object.keys(e).reduce(function(t,a){var r=p(e[a]),o=r?u(e[a]):e[a],n=r&&!Object.keys(o).length;return void 0===o||n?t:Object.assign(t,y({},a,o))},{}):e}function d(a,e,o){e&&!o.has(e.id)&&(o.set(e.id,e),Object.keys(e).forEach(function(t){t.endsWith("Id")?d(a,a.get(e[t]),o):t.endsWith("Ids")&&e[t].forEach(function(e){d(a,a.get(e),o)})}))}function l(a,s,e){var p=e?"outbound-rtp":"inbound-rtp",r=new Map;if(null===s)return r;var t=[];return a.forEach(function(r){"track"===r.type&&r.trackIdentifier===s.id&&t.push(r)}),t.forEach(function(e){a.forEach(function(t){t.type===p&&t.trackId===e.id&&d(a,t,r)})}),r}Object.defineProperty(h,"__esModule",{value:!0}),h.extractVersion=x,h.wrapPeerConnectionEvent=e,h.disableLog=o,h.disableWarnings=i,h.log=a,h.deprecated=s,h.detectBrowser=c,h.compactObject=u,h.walkStats=d,h.filterStats=l;var f=!0,_=!0},{}],s6SN:[function(a,s,d){"use strict";function p(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return p=function(){return t},t}function l(r){if(r&&r.__esModule)return r;if(null===r||"object"!=typeof r&&"function"!=typeof r)return{default:r};var e=p();if(e&&e.has(r))return e.get(r);var t={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var i=o?Object.getOwnPropertyDescriptor(r,n):null;i&&(i.get||i.set)?Object.defineProperty(t,n,i):t[n]=r[n]}return t.default=r,e&&e.set(r,t),t}function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function t(e){var n=e&&e.navigator;if(n.mediaDevices){var t=g.detectBrowser(e),i=function(o){if("object"!==m(o)||o.mandatory||o.optional)return o;var s={};return Object.keys(o).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var t="object"===m(o[r])?o[r]:{ideal:o[r]};void 0!==t.exact&&"number"==typeof t.exact&&(t.min=t.max=t.exact);var n=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==t.ideal){s.optional=s.optional||[];var e={};"number"==typeof t.ideal?(e[n("min",r)]=t.ideal,s.optional.push(e),(e={})[n("max",r)]=t.ideal,s.optional.push(e)):(e[n("",r)]=t.ideal,s.optional.push(e))}void 0!==t.exact&&"number"!=typeof t.exact?(s.mandatory=s.mandatory||{},s.mandatory[n("",r)]=t.exact):["min","max"].forEach(function(a){void 0!==t[a]&&(s.mandatory=s.mandatory||{},s.mandatory[n(a,r)]=t[a])})}}),o.advanced&&(s.optional=(s.optional||[]).concat(o.advanced)),s},a=function(a,p){if(61<=t.version)return p(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"===m(a.audio)){var r=function(a,e,r){e in a&&!(r in a)&&(a[r]=a[e],delete a[e])};r((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),r(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&"object"===m(a.video)){var l=a.video.facingMode;l=l&&("object"===m(l)?l:{ideal:l});var o=66>t.version,s;if(l&&("user"===l.exact||"environment"===l.exact||"user"===l.ideal||"environment"===l.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)&&(delete a.video.facingMode,"environment"===l.exact||"environment"===l.ideal?s=["back","rear"]:"user"!==l.exact&&"user"!==l.ideal||(s=["front"]),s))return n.mediaDevices.enumerateDevices().then(function(e){var r=(e=e.filter(function(t){return"videoinput"===t.kind})).find(function(t){return s.some(function(e){return t.label.toLowerCase().includes(e)})});return!r&&e.length&&s.includes("back")&&(r=e[e.length-1]),r&&(a.video.deviceId=l.exact?{exact:r.deviceId}:{ideal:r.deviceId}),a.video=i(a.video),f("chrome: "+JSON.stringify(a)),p(a)});a.video=i(a.video)}return f("chrome: "+JSON.stringify(a)),p(a)},r=function(r){return 64<=t.version?r:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[r.name]||r.name,message:r.message,constraint:r.constraint||r.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(t,i,s){a(t,function(t){n.webkitGetUserMedia(t,i,function(t){s&&s(r(t))})})}.bind(n),n.mediaDevices.getUserMedia){var o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return a(t,function(t){return o(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(t){t.stop()}),new DOMException("","NotFoundError");return e},function(t){return Promise.reject(r(t))})})}}}}Object.defineProperty(d,"__esModule",{value:!0}),d.shimGetUserMedia=t;var g=l(a("../utils.js")),f=g.log},{"../utils.js":"iSxC"}],VHa8:[function(t,r,a){"use strict";function o(r,e){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&("function"==typeof e?r.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(function(e){var a=n.video&&n.video.width,t=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:o||3}},a&&(n.video.mandatory.maxWidth=a),t&&(n.video.mandatory.maxHeight=t),r.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(a,"__esModule",{value:!0}),a.shimGetDisplayMedia=o},{}],uI5X:[function(a,d,l){"use strict";function m(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return m=function(){return t},t}function u(a){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var e=m();if(e&&e.has(a))return e.get(a);var t={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in a)if(Object.prototype.hasOwnProperty.call(a,n)){var o=r?Object.getOwnPropertyDescriptor(a,n):null;o&&(o.get||o.set)?Object.defineProperty(t,n,o):t[n]=a[n]}return t.default=a,e&&e.set(a,t),t}function i(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(a){if("object"!==g(a)||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)f.wrapPeerConnectionEvent(a,"track",function(t){return t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});var t=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var s=this;return this._ontrackpoly||(this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(t){var r=a.RTCPeerConnection.prototype.getReceivers?s.getReceivers().find(function(r){return r.track&&r.track.id===t.track.id}):{track:t.track};var n=new Event("track");n.track=t.track,n.receiver=r,n.transceiver={receiver:r},n.streams=[e.stream],s.dispatchEvent(n)}),e.stream.getTracks().forEach(function(t){var r=a.RTCPeerConnection.prototype.getReceivers?s.getReceivers().find(function(r){return r.track&&r.track.id===t.id}):{track:t};var n=new Event("track");n.track=t,n.receiver=r,n.transceiver={receiver:r},n.streams=[e.stream],s.dispatchEvent(n)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function c(s){if("object"===g(s)&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){var d=function(r,e){return{track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=r.createDTMFSender(e):this._dtmf=null),this._dtmf},_pc:r}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var t=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(r){var e=t.apply(this,arguments);return e||(e=d(this,r),this._senders.push(e)),e};var r=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);var e=this._senders.indexOf(a);-1!==e&&this._senders.splice(e,1)}}var n=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(t){var a=this;this._senders=this._senders||[],n.apply(this,[t]),t.getTracks().forEach(function(t){a._senders.push(d(a,t))})};var i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(r){var a=this;this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(function(o){var e=a._senders.find(function(e){return e.track===o});e&&a._senders.splice(a._senders.indexOf(e),1)})}}else if("object"===g(s)&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){var o=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){var r=this,e=o.apply(this,[]);return e.forEach(function(e){return e._pc=r}),e},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function p(a){if("object"===g(a)&&a.RTCPeerConnection&&a.RTCRtpSender&&a.RTCRtpReceiver){if(!("getStats"in a.RTCRtpSender.prototype)){var s=a.RTCPeerConnection.prototype.getSenders;s&&(a.RTCPeerConnection.prototype.getSenders=function(){var r=this,e=s.apply(this,[]);return e.forEach(function(e){return e._pc=r}),e});var t=a.RTCPeerConnection.prototype.addTrack;t&&(a.RTCPeerConnection.prototype.addTrack=function(){var r=t.apply(this,arguments);return r._pc=this,r}),a.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return f.filterStats(t,e.track,!0)})}}if(!("getStats"in a.RTCRtpReceiver.prototype)){var r=a.RTCPeerConnection.prototype.getReceivers;r&&(a.RTCPeerConnection.prototype.getReceivers=function(){var a=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=a}),e}),f.wrapPeerConnectionEvent(a,"track",function(t){return t.receiver._pc=t.srcElement,t}),a.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return f.filterStats(t,e.track,!1)})}}if("getStats"in a.RTCRtpSender.prototype&&"getStats"in a.RTCRtpReceiver.prototype){var d=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof a.MediaStreamTrack){var o=arguments[0],i,t,s;return this.getSenders().forEach(function(e){e.track===o&&(i?s=!0:i=e)}),this.getReceivers().forEach(function(r){return r.track===o&&(t?s=!0:t=r),r.track===o}),s||i&&t?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():t?t.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return d.apply(this,arguments)}}}}function h(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var r=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return r._shimmedLocalStreams[e][0]})};var o=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(t,e){if(!e)return o.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=o.apply(this,arguments);return this._shimmedLocalStreams[e.id]?-1===this._shimmedLocalStreams[e.id].indexOf(r)&&this._shimmedLocalStreams[e.id].push(r):this._shimmedLocalStreams[e.id]=[e,r],r};var s=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(r){var a=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},r.getTracks().forEach(function(r){if(a.getSenders().find(function(e){return e.track===r}))throw new DOMException("Track already exists.","InvalidAccessError")});var t=this.getSenders();s.apply(this,arguments);var e=this.getSenders().filter(function(r){return-1===t.indexOf(r)});this._shimmedLocalStreams[r.id]=[r].concat(e)};var t=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[r.id],t.apply(this,arguments)};var r=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(function(t){var r=e._shimmedLocalStreams[t].indexOf(a);-1!==r&&e._shimmedLocalStreams[t].splice(r,1),1===e._shimmedLocalStreams[t].length&&delete e._shimmedLocalStreams[t]}),r.apply(this,arguments)}}Object.defineProperty(l,"__esModule",{value:!0}),l.shimMediaStream=function(t){t.MediaStream=t.MediaStream||t.webkitMediaStream},l.shimOnTrack=o,l.shimGetSendersWithDtmf=c,l.shimGetStats=function(r){if(r.RTCPeerConnection){var a=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){var t=this,[e,r,n]=arguments;if(0<arguments.length&&"function"==typeof e)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof e))return a.apply(this,[]);var i=function(r){var a={};return r.result().forEach(function(o){var e={id:o.id,timestamp:o.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[o.type]||o.type};o.names().forEach(function(r){e[r]=o.stat(r)}),a[e.id]=e}),a},o=function(r){return new Map(Object.keys(r).map(function(e){return[e,r[e]]}))};return 2<=arguments.length?a.apply(this,[function(t){r(o(i(t)))},e]):new Promise(function(s,e){a.apply(t,[function(t){s(o(i(t)))},e])}).then(r,n)}}},l.shimSenderReceiverGetStats=p,l.shimAddTrackRemoveTrackWithNative=h,l.shimAddTrackRemoveTrack=function(o){function d(a,e){var o=e.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(e){var t=a._reverseStreams[e],r=a._streams[t.id];o=o.replace(new RegExp(r.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:o})}if(o.RTCPeerConnection){var e=f.detectBrowser(o);if(o.RTCPeerConnection.prototype.addTrack&&65<=e.version)return h(o);var r=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(function(e){return a._reverseStreams[e.id]})};var t=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(a){var i=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.getTracks().forEach(function(r){if(i.getSenders().find(function(e){return e.track===r}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[a.id]){var r=new o.MediaStream(a.getTracks());this._streams[a.id]=r,this._reverseStreams[r.id]=a,a=r}t.apply(this,[a])};var n=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(t){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[t.id]||t]),delete this._reverseStreams[this._streams[t.id]?this._streams[t.id].id:t.id],delete this._streams[t.id]},o.RTCPeerConnection.prototype.addTrack=function(a,e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(function(e){return e===a}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var n=this._streams[e.id];if(n)n.addTrack(a),Promise.resolve().then(function(){t.dispatchEvent(new Event("negotiationneeded"))});else{var i=new o.MediaStream([a]);this._streams[e.id]=i,this._reverseStreams[i.id]=e,this.addStream(i)}return this.getSenders().find(function(e){return e.track===a})},["createOffer","createAnswer"].forEach(function(t){var a=o.RTCPeerConnection.prototype[t],e=i({},t,function(){var o=this,i=arguments;return arguments.length&&"function"==typeof arguments[0]?a.apply(this,[function(e){var t=d(o,e);i[0].apply(null,[t])},function(t){i[1]&&i[1].apply(null,t)},arguments[2]]):a.apply(this,arguments).then(function(e){return d(o,e)})});o.RTCPeerConnection.prototype[t]=e[t]});var s=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(a=this,o=arguments[0],d=o.sdp,Object.keys(a._reverseStreams||[]).forEach(function(e){var t=a._reverseStreams[e],r=a._streams[t.id];d=d.replace(new RegExp(t.id,"g"),r.id)}),new RTCSessionDescription({type:o.type,sdp:d})),s.apply(this,arguments)):s.apply(this,arguments);var a,o,d};var a=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get:function(){var t=a.get.apply(this);return""===t.type?t:d(this,t)}}),o.RTCPeerConnection.prototype.removeTrack=function(a){var e=this,r;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(t){e._streams[t].getTracks().find(function(e){return a.track===e})&&(r=e._streams[t])}),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(a.track),this.dispatchEvent(new Event("negotiationneeded")))}}},l.shimPeerConnection=function(a){var e=f.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=a.webkitRTCPeerConnection),a.RTCPeerConnection){53>e.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=a.RTCPeerConnection.prototype[t],r=i({},t,function(){return arguments[0]=new("addIceCandidate"===t?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)});a.RTCPeerConnection.prototype[t]=r[t]});var t=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?78>e.version&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},l.fixNegotiationNeeded=function(e){f.wrapPeerConnectionEvent(e,"negotiationneeded",function(t){if("stable"===t.target.signalingState)return t})},Object.defineProperty(l,"shimGetUserMedia",{enumerable:!0,get:function(){return e.shimGetUserMedia}}),Object.defineProperty(l,"shimGetDisplayMedia",{enumerable:!0,get:function(){return t.shimGetDisplayMedia}});var f=u(a("../utils.js")),e=a("./getusermedia"),t=a("./getdisplaymedia")},{"../utils.js":"iSxC","./getusermedia":"s6SN","./getdisplaymedia":"VHa8"}],NZ1C:[function(a,o,i){"use strict";function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function d(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s();if(r&&r.has(e))return r.get(e);var t={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=a?Object.getOwnPropertyDescriptor(e,o):null;n&&(n.get||n.set)?Object.defineProperty(t,o,n):t[o]=e[o]}return t.default=e,r&&r.set(e,t),t}function t(t){var a=!1;return(t=JSON.parse(JSON.stringify(t))).filter(function(r){if(r&&(r.urls||r.url)){var e=r.urls||r.url;r.url&&!r.urls&&p.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof e;return o&&(e=[e]),e=e.filter(function(t){if(0===t.indexOf("stun:"))return!1;var r=t.startsWith("turn")&&!t.startsWith("turn:[")&&t.includes("transport=udp");return r&&!a?(a=!0,!0):r&&!a}),delete r.url,r.urls=o?e[0]:e,!!e.length}})}Object.defineProperty(i,"__esModule",{value:!0}),i.filterIceServers=t;var p=d(a("../utils"))},{"../utils":"iSxC"}],YHvh:[function(e,t){"use strict";var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier(),d.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},d.splitSections=function(e){return e.split("\nm=").map(function(t,r){return(0<r?"m="+t:t).trim()+"\r\n"})},d.getDescription=function(r){var e=d.splitSections(r);return e&&e[0]},d.getMediaSections=function(r){var e=d.splitSections(r);return e.shift(),e},d.matchPrefix=function(r,e){return d.splitLines(r).filter(function(t){return 0===t.indexOf(e)})},d.parseCandidate=function(a){for(var r={foundation:(o=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" "))[0],component:parseInt(o[1],10),protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]},t=8,o;t<o.length;t+=2)switch(o[t]){case"raddr":r.relatedAddress=o[t+1];break;case"rport":r.relatedPort=parseInt(o[t+1],10);break;case"tcptype":r.tcpType=o[t+1];break;case"ufrag":r.ufrag=o[t+1],r.usernameFragment=o[t+1];break;default:r[o[t]]=o[t+1];}return r},d.writeCandidate=function(a){var r=[a.foundation,a.component,a.protocol.toUpperCase(),a.priority,a.address||a.ip,a.port],e=a.type;return r.push("typ"),r.push(e),"host"!==e&&a.relatedAddress&&a.relatedPort&&(r.push("raddr"),r.push(a.relatedAddress),r.push("rport"),r.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(r.push("tcptype"),r.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(r.push("ufrag"),r.push(a.usernameFragment||a.ufrag)),"candidate:"+r.join(" ")},d.parseIceOptions=function(e){return e.substr(14).split(" ")},d.parseRtpMap=function(a){var r=a.substr(9).split(" "),o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=3===r.length?parseInt(r[2],10):1,o.numChannels=o.channels,o},d.writeRtpMap=function(a){var r=a.payloadType;void 0!==a.preferredPayloadType&&(r=a.preferredPayloadType);var o=a.channels||a.numChannels||1;return"a=rtpmap:"+r+" "+a.name+"/"+a.clockRate+(1===o?"":"/"+o)+"\r\n"},d.parseExtmap=function(t){var r=t.substr(9).split(" ");return{id:parseInt(r[0],10),direction:0<r[0].indexOf("/")?r[0].split("/")[1]:"sendrecv",uri:r[1]}},d.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},d.parseFmtp=function(o){for(var r={},t=o.substr(o.indexOf(" ")+1).split(";"),n=0,i;n<t.length;n++)r[(i=t[n].trim().split("="))[0].trim()]=i[1];return r},d.writeFmtp=function(a){var r="",o=a.payloadType;if(void 0!==a.preferredPayloadType&&(o=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var i=[];Object.keys(a.parameters).forEach(function(t){a.parameters[t]?i.push(t+"="+a.parameters[t]):i.push(t)}),r+="a=fmtp:"+o+" "+i.join(";")+"\r\n"}return r},d.parseRtcpFb=function(t){var r=t.substr(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},d.writeRtcpFb=function(a){var o="",n=a.payloadType;return void 0!==a.preferredPayloadType&&(n=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(e){o+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),o},d.parseSsrcMedia=function(a){var r=a.indexOf(" "),e={ssrc:parseInt(a.substr(7,r-7),10)},t=a.indexOf(":",r);return-1<t?(e.attribute=a.substr(r+1,t-r-1),e.value=a.substr(t+1)):e.attribute=a.substr(r+1),e},d.parseSsrcGroup=function(t){var r=t.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(function(e){return parseInt(e,10)})}},d.getMid=function(r){var e=d.matchPrefix(r,"a=mid:")[0];if(e)return e.substr(6)},d.parseFingerprint=function(t){var r=t.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1]}},d.getDtlsParameters=function(r,e){return{role:"auto",fingerprints:d.matchPrefix(r+e,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(a,r){var e="a=setup:"+r+"\r\n";return a.fingerprints.forEach(function(t){e+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"}),e},d.getIceParameters=function(r,e){var t=d.splitLines(r);return{usernameFragment:(t=t.concat(d.splitLines(e))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:t.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},d.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},d.parseRtpParameters=function(r){for(var o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},e=d.splitLines(r)[0].split(" "),t=3;t<e.length;t++){var n=e[t],s=d.matchPrefix(r,"a=rtpmap:"+n+" ")[0];if(s){var i=d.parseRtpMap(s),p=d.matchPrefix(r,"a=fmtp:"+n+" ");switch(i.parameters=p.length?d.parseFmtp(p[0]):{},i.rtcpFeedback=d.matchPrefix(r,"a=rtcp-fb:"+n+" ").map(d.parseRtcpFb),o.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(i.name.toUpperCase());}}}return d.matchPrefix(r,"a=extmap:").forEach(function(t){o.headerExtensions.push(d.parseExtmap(t))}),o},d.writeRtpDescription=function(r,e){var t="";t+="m="+r+" ",t+=0<e.codecs.length?"9":"0",t+=" UDP/TLS/RTP/SAVPF ",t+=e.codecs.map(function(e){return void 0===e.preferredPayloadType?e.payloadType:e.preferredPayloadType}).join(" ")+"\r\n",t+="c=IN IP4 0.0.0.0\r\n",t+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach(function(r){t+=d.writeRtpMap(r),t+=d.writeFmtp(r),t+=d.writeRtcpFb(r)});var o=0;return e.codecs.forEach(function(e){e.maxptime>o&&(o=e.maxptime)}),0<o&&(t+="a=maxptime:"+o+"\r\n"),t+="a=rtcp-mux\r\n",e.headerExtensions&&e.headerExtensions.forEach(function(r){t+=d.writeExtmap(r)}),t},d.parseRtpEncodingParameters=function(r){var l=[],e=d.parseRtpParameters(r),a=-1!==e.fecMechanisms.indexOf("RED"),n=-1!==e.fecMechanisms.indexOf("ULPFEC"),i=d.matchPrefix(r,"a=ssrc:").map(function(t){return d.parseSsrcMedia(t)}).filter(function(e){return"cname"===e.attribute}),s=0<i.length&&i[0].ssrc,p=d.matchPrefix(r,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})}),o;0<p.length&&1<p[0].length&&p[0][0]===s&&(o=p[0][1]),e.codecs.forEach(function(t){if("RTX"===t.name.toUpperCase()&&t.parameters.apt){var r={ssrc:s,codecPayloadType:parseInt(t.parameters.apt,10)};s&&o&&(r.rtx={ssrc:o}),l.push(r),a&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:s,mechanism:n?"red+ulpfec":"red"},l.push(r))}}),0===l.length&&s&&l.push({ssrc:s});var c=d.matchPrefix(r,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?.95*(1e3*parseInt(c[0].substr(5),10))-16e3:void 0,l.forEach(function(e){e.maxBitrate=c})),l},d.parseRtcpParameters=function(r){var e={},t=d.matchPrefix(r,"a=ssrc:").map(function(t){return d.parseSsrcMedia(t)}).filter(function(e){return"cname"===e.attribute})[0];t&&(e.cname=t.value,e.ssrc=t.ssrc);var o=d.matchPrefix(r,"a=rtcp-rsize");e.reducedSize=0<o.length,e.compound=0===o.length;var a=d.matchPrefix(r,"a=rtcp-mux");return e.mux=0<a.length,e},d.parseMsid=function(r){var e=d.matchPrefix(r,"a=msid:"),o;if(1===e.length)return{stream:(o=e[0].substr(7).split(" "))[0],track:o[1]};var n=d.matchPrefix(r,"a=ssrc:").map(function(t){return d.parseSsrcMedia(t)}).filter(function(e){return"msid"===e.attribute});return 0<n.length?{stream:(o=n[0].value.split(" "))[0],track:o[1]}:void 0},d.parseSctpDescription=function(r){var e=d.parseMLine(r),o=d.matchPrefix(r,"a=max-message-size:"),a;0<o.length&&(a=parseInt(o[0].substr(19),10)),isNaN(a)&&(a=65536);var n=d.matchPrefix(r,"a=sctp-port:");if(0<n.length)return{port:parseInt(n[0].substr(12),10),protocol:e.fmt,maxMessageSize:a};if(0<d.matchPrefix(r,"a=sctpmap:").length){var s=d.matchPrefix(r,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:a}}},d.writeSctpDescription=function(a,r){var e=[];return e="DTLS/SCTP"===a.protocol?["m="+a.kind+" 9 "+a.protocol+" "+r.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+r.port+" "+r.protocol+" 65535\r\n"]:["m="+a.kind+" 9 "+a.protocol+" "+r.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+r.port+"\r\n"],void 0!==r.maxMessageSize&&e.push("a=max-message-size:"+r.maxMessageSize+"\r\n"),e.join("")},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(r,e,t){var o=void 0===e?2:e;return"v=0\r\no="+(t||"thisisadapterortc")+" "+(r||d.generateSessionId())+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(r,e,t,o){var a=d.writeRtpDescription(r.kind,e);if(a+=d.writeIceParameters(r.iceGatherer.getLocalParameters()),a+=d.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),"offer"===t?"actpass":"active"),a+="a=mid:"+r.mid+"\r\n",a+=r.direction?"a="+r.direction+"\r\n":r.rtpSender&&r.rtpReceiver?"a=sendrecv\r\n":r.rtpSender?"a=sendonly\r\n":r.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",r.rtpSender){var n="msid:"+o.id+" "+r.rtpSender.track.id+"\r\n";a+="a="+n,a+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+n,r.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+n,a+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",r.rtpSender&&r.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),a},d.getDirection=function(r,e){for(var t=d.splitLines(r),o=0;o<t.length;o++)switch(t[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return t[o].substr(2);}return e?d.getDirection(e):"sendrecv"},d.getKind=function(t){return d.splitLines(t)[0].split(" ")[0].substr(2)},d.isRejected=function(e){return"0"===e.split(" ",2)[1]},d.parseMLine=function(r){var e=d.splitLines(r)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},d.parseOLine=function(r){var e=d.matchPrefix(r,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},d.isValidSDP=function(r){if("string"!=typeof r||0===r.length)return!1;for(var e=d.splitLines(r),t=0;t<e.length;t++)if(2>e[t].length||"="!==e[t].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=d)},{}],NJ2u:[function(d,p){"use strict";function l(t){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type}function m(e,t,r,n,a){var i=B.writeRtpDescription(e.kind,t);if(i+=B.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=B.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":a||"active"),i+="a=mid:"+e.mid+"\r\n",i+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var d=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=d;var o="msid:"+(n?n.id:"-")+" "+d+"\r\n";i+="a="+o,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+B.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+B.localCName+"\r\n"),i}function u(a,o){var t=!1;return(a=JSON.parse(JSON.stringify(a))).filter(function(r){if(r&&(r.urls||r.url)){var e=r.urls||r.url;r.url&&!r.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof e;return i&&(e=[e]),e=e.filter(function(r){return 0!==r.indexOf("turn:")||-1===r.indexOf("transport=udp")||-1!==r.indexOf("turn:[")||t?0===r.indexOf("stun:")&&14393<=o&&-1===r.indexOf("?transport=udp"):(t=!0,!0)}),delete r.url,r.urls=i?e[0]:e,!!e.length}})}function y(o,d){var e={codecs:[],headerExtensions:[],fecMechanisms:[]},p=function(a,o){a=parseInt(a,10);for(var t=0;t<o.length;t++)if(o[t].payloadType===a||o[t].preferredPayloadType===a)return o[t]},t=function(o,e,t,r){var a=p(o.parameters.apt,t),n=p(e.parameters.apt,r);return a&&n&&a.name.toLowerCase()===n.name.toLowerCase()};return o.codecs.forEach(function(r){for(var a=0,n;a<d.codecs.length;a++)if(n=d.codecs[a],r.name.toLowerCase()===n.name.toLowerCase()&&r.clockRate===n.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&n.parameters.apt&&!t(r,n,o.codecs,d.codecs))continue;(n=JSON.parse(JSON.stringify(n))).numChannels=Math.min(r.numChannels,n.numChannels),e.codecs.push(n),n.rtcpFeedback=n.rtcpFeedback.filter(function(a){for(var e=0;e<r.rtcpFeedback.length;e++)if(r.rtcpFeedback[e].type===a.type&&r.rtcpFeedback[e].parameter===a.parameter)return!0;return!1});break}}),o.headerExtensions.forEach(function(t){for(var r=0,o;r<d.headerExtensions.length;r++)if(o=d.headerExtensions[r],t.uri===o.uri){e.headerExtensions.push(o);break}}),e}function a(a,e,t){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][a].indexOf(t)}function g(a,o){var e=a.getRemoteCandidates().find(function(t){return o.foundation===t.foundation&&o.ip===t.ip&&o.port===t.port&&o.priority===t.priority&&o.protocol===t.protocol&&o.type===t.type});return e||a.addRemoteCandidate(o),!e}function x(a,e){var t=new Error(e);return t.name=a,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[a],t}var B=d("sdp");p.exports=function(z,h){function e(r,e){e.addTrack(r),e.dispatchEvent(new z.MediaStreamTrackEvent("addtrack",{track:r}))}function o(o,e,t,r){var n=new Event("track");n.track=e,n.receiver=t,n.transceiver={receiver:t},n.streams=r,z.setTimeout(function(){o._dispatchEvent("track",n)})}var r=function(e){var o=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(t){o[t]=r[t].bind(r)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw x("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all";}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced";}if(e.iceServers=u(e.iceServers||[],h),this._iceGatherers=[],e.iceCandidatePoolSize)for(var a=e.iceCandidatePoolSize;0<a;a--)this._iceGatherers.push(new z.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=B.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(r,e){this._isClosed||(this.dispatchEvent(e),"function"==typeof this["on"+r]&&this["on"+r](e))},r.prototype._emitGatheringStateChange=function(){var t=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",t)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(o,e){var t=0<this.transceivers.length,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:o,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&t)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();r.iceTransport=n.iceTransport,r.dtlsTransport=n.dtlsTransport}return e||this.transceivers.push(r),r},r.prototype.addTrack=function(a,e){if(this._isClosed)throw x("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var t;if(this.transceivers.find(function(e){return e.track===a}))throw x("InvalidAccessError","Track already exists.");for(var o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==a.kind||(t=this.transceivers[o]);return t||(t=this._createTransceiver(a.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(e)&&this.localStreams.push(e),t.track=a,t.stream=e,t.rtpSender=new z.RTCRtpSender(a,t.dtlsTransport),t.rtpSender},r.prototype.addStream=function(a){var o=this;if(15025<=h)a.getTracks().forEach(function(e){o.addTrack(e,a)});else{var i=a.clone();a.getTracks().forEach(function(r,e){var t=i.getTracks()[e];r.addEventListener("enabled",function(r){t.enabled=r.enabled})}),i.getTracks().forEach(function(t){o.addTrack(t,i)})}},r.prototype.removeTrack=function(a){if(this._isClosed)throw x("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(a instanceof z.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find(function(e){return e.rtpSender===a});if(!e)throw x("InvalidAccessError","Sender was not created by this connection.");var t=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null,-1===this.transceivers.map(function(t){return t.stream}).indexOf(t)&&-1<this.localStreams.indexOf(t)&&this.localStreams.splice(this.localStreams.indexOf(t),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(r){var a=this;r.getTracks().forEach(function(o){var e=a.getSenders().find(function(e){return e.track===o});e&&a.removeTrack(e)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},r.prototype._createIceGatherer=function(o,e){var i=this;if(e&&0<o)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new z.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[o].bufferedCandidateEvents=[],this.transceivers[o].bufferCandidates=function(e){var t=!e.candidate||0===Object.keys(e.candidate).length;r.state=t?"completed":"gathering",null!==i.transceivers[o].bufferedCandidateEvents&&i.transceivers[o].bufferedCandidateEvents.push(e)},r.addEventListener("localcandidate",this.transceivers[o].bufferCandidates),r},r.prototype._gather=function(e,t){var r=this,n=this.transceivers[t].iceGatherer;if(!n.onlocalcandidate){var a=this.transceivers[t].bufferedCandidateEvents;this.transceivers[t].bufferedCandidateEvents=null,n.removeEventListener("localcandidate",this.transceivers[t].bufferCandidates),n.onlocalcandidate=function(a){if(!(r.usingBundle&&0<t)){var i=new Event("icecandidate");i.candidate={sdpMid:e,sdpMLineIndex:t};var s=a.candidate,o=!s||0===Object.keys(s).length;if(o)"new"!==n.state&&"gathering"!==n.state||(n.state="completed");else{"new"===n.state&&(n.state="gathering"),s.component=1,s.ufrag=n.getLocalParameters().usernameFragment;var c=B.writeCandidate(s);i.candidate=Object.assign(i.candidate,B.parseCandidate(c)),i.candidate.candidate=c,i.candidate.toJSON=function(){return{candidate:i.candidate.candidate,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex,usernameFragment:i.candidate.usernameFragment}}}var d=B.getMediaSections(r._localDescription.sdp);d[i.candidate.sdpMLineIndex]+=o?"a=end-of-candidates\r\n":"a="+i.candidate.candidate+"\r\n",r._localDescription.sdp=B.getDescription(r._localDescription.sdp)+d.join("");var p=r.transceivers.every(function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),o||r._dispatchEvent("icecandidate",i),p&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},z.setTimeout(function(){a.forEach(function(t){n.onlocalcandidate(t)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var a=this,e=new z.RTCIceTransport(null);e.onicestatechange=function(){a._updateIceConnectionState(),a._updateConnectionState()};var t=new z.RTCDtlsTransport(e);return t.ondtlsstatechange=function(){a._updateConnectionState()},t.onerror=function(){Object.defineProperty(t,"state",{value:"failed",writable:!0}),a._updateConnectionState()},{iceTransport:e,dtlsTransport:t}},r.prototype._disposeIceAndDtlsTransports=function(a){var e=this.transceivers[a].iceGatherer;e&&(delete e.onlocalcandidate,delete this.transceivers[a].iceGatherer);var t=this.transceivers[a].iceTransport;t&&(delete t.onicestatechange,delete this.transceivers[a].iceTransport);var r=this.transceivers[a].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[a].dtlsTransport)},r.prototype._transceive=function(e,t,r){var a=y(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:B.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),r&&e.rtpReceiver&&0<a.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&15019>h&&e.recvEncodingParameters.forEach(function(t){delete t.rtx}),a.encodings=e.recvEncodingParameters.length?e.recvEncodingParameters:[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},r.prototype.setLocalDescription=function(e){var m=this,t,s;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(x("TypeError","Unsupported type \""+e.type+"\""));if(!a("setLocalDescription",e.type,m.signalingState)||m._isClosed)return Promise.reject(x("InvalidStateError","Can not set local "+e.type+" in state "+m.signalingState));if("offer"===e.type)t=B.splitSections(e.sdp),s=t.shift(),t.forEach(function(e,t){var r=B.parseRtpParameters(e);m.transceivers[t].localCapabilities=r}),m.transceivers.forEach(function(r,e){m._gather(r.mid,e)});else if("answer"===e.type){t=B.splitSections(m._remoteDescription.sdp),s=t.shift();var g=0<B.matchPrefix(s,"a=ice-lite").length;t.forEach(function(e,t){var r=m.transceivers[t],a=r.iceGatherer,o=r.iceTransport,n=r.dtlsTransport,i=r.localCapabilities,d=r.remoteCapabilities;if(!(B.isRejected(e)&&0===B.matchPrefix(e,"a=bundle-only").length)&&!r.rejected){var p=B.getIceParameters(e,s),l=B.getDtlsParameters(e,s);g&&(l.role="server"),m.usingBundle&&0!==t||(m._gather(r.mid,t),"new"===o.state&&o.start(a,p,g?"controlling":"controlled"),"new"===n.state&&n.start(l));var c=y(i,d);m._transceive(r,0<c.codecs.length,!1)}})}return m._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?m._updateSignalingState("have-local-offer"):m._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(s){var d=this;if(-1===["offer","answer"].indexOf(s.type))return Promise.reject(x("TypeError","Unsupported type \""+s.type+"\""));if(!a("setRemoteDescription",s.type,d.signalingState)||d._isClosed)return Promise.reject(x("InvalidStateError","Can not set remote "+s.type+" in state "+d.signalingState));var r={};d.remoteStreams.forEach(function(t){r[t.id]=t});var n=[],t=B.splitSections(s.sdp),p=t.shift(),l=0<B.matchPrefix(p,"a=ice-lite").length,c=0<B.matchPrefix(p,"a=group:BUNDLE ").length;d.usingBundle=c;var i=B.matchPrefix(p,"a=ice-options:")[0];return d.canTrickleIceCandidates=!!i&&0<=i.substr(14).split(" ").indexOf("trickle"),t.forEach(function(t,a){var o=B.splitLines(t),i=B.getKind(t),m=B.isRejected(t)&&0===B.matchPrefix(t,"a=bundle-only").length,u=o[0].substr(2).split(" ")[2],f=B.getDirection(t,p),v=B.parseMsid(t),T=B.getMid(t)||B.generateIdentifier();if(m||"application"===i&&("DTLS/SCTP"===u||"UDP/DTLS/SCTP"===u))d.transceivers[a]={mid:T,kind:i,protocol:u,rejected:!0};else{var S,E,U,F,H,V,W,q,X;!m&&d.transceivers[a]&&d.transceivers[a].rejected&&(d.transceivers[a]=d._createTransceiver(i,!0));var Y=B.parseRtpParameters(t),M,Z;m||(M=B.getIceParameters(t,p),(Z=B.getDtlsParameters(t,p)).role="client"),W=B.parseRtpEncodingParameters(t);var J=B.parseRtcpParameters(t),O=0<B.matchPrefix(t,"a=end-of-candidates",p).length,G=B.matchPrefix(t,"a=candidate:").map(function(e){return B.parseCandidate(e)}).filter(function(t){return 1===t.component});if(("offer"===s.type||"answer"===s.type)&&!m&&c&&0<a&&d.transceivers[a]&&(d._disposeIceAndDtlsTransports(a),d.transceivers[a].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[a].iceTransport=d.transceivers[0].iceTransport,d.transceivers[a].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[a].rtpSender&&d.transceivers[a].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[a].rtpReceiver&&d.transceivers[a].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==s.type||m)"answer"!==s.type||m||(E=(S=d.transceivers[a]).iceGatherer,U=S.iceTransport,F=S.dtlsTransport,H=S.rtpReceiver,V=S.sendEncodingParameters,q=S.localCapabilities,d.transceivers[a].recvEncodingParameters=W,d.transceivers[a].remoteCapabilities=Y,d.transceivers[a].rtcpParameters=J,G.length&&"new"===U.state&&((l||O)&&(!c||0===a)?U.setRemoteCandidates(G):G.forEach(function(t){g(S.iceTransport,t)})),c&&0!==a||("new"===U.state&&U.start(E,M,"controlling"),"new"===F.state&&F.start(Z)),!y(S.localCapabilities,S.remoteCapabilities).codecs.filter(function(t){return"rtx"===t.name.toLowerCase()}).length&&S.sendEncodingParameters[0].rtx&&delete S.sendEncodingParameters[0].rtx,d._transceive(S,"sendrecv"===f||"recvonly"===f,"sendrecv"===f||"sendonly"===f),H&&("sendrecv"===f||"sendonly"===f)?(X=H.track,v?(r[v.stream]||(r[v.stream]=new z.MediaStream),e(X,r[v.stream]),n.push([X,H,r[v.stream]])):(r.default||(r.default=new z.MediaStream),e(X,r.default),n.push([X,H,r.default]))):delete S.rtpReceiver);else{(S=d.transceivers[a]||d._createTransceiver(i)).mid=T,S.iceGatherer||(S.iceGatherer=d._createIceGatherer(a,c)),G.length&&"new"===S.iceTransport.state&&(!O||c&&0!==a?G.forEach(function(t){g(S.iceTransport,t)}):S.iceTransport.setRemoteCandidates(G)),q=z.RTCRtpReceiver.getCapabilities(i),15019>h&&(q.codecs=q.codecs.filter(function(t){return"rtx"!==t.name})),V=S.sendEncodingParameters||[{ssrc:1001*(2*a+2)}];var j=!1,Q;"sendrecv"===f||"sendonly"===f?(j=!S.rtpReceiver,H=S.rtpReceiver||new z.RTCRtpReceiver(S.dtlsTransport,i),j)&&(X=H.track,v&&"-"===v.stream||(v?(r[v.stream]||(r[v.stream]=new z.MediaStream,Object.defineProperty(r[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(X,"id",{get:function(){return v.track}}),Q=r[v.stream]):(r.default||(r.default=new z.MediaStream),Q=r.default)),Q&&(e(X,Q),S.associatedRemoteMediaStreams.push(Q)),n.push([X,H,Q])):S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach(function(a){var e=a.getTracks().find(function(t){return t.id===S.rtpReceiver.track.id}),o,n;e&&(o=e,(n=a).removeTrack(o),n.dispatchEvent(new z.MediaStreamTrackEvent("removetrack",{track:o})))}),S.associatedRemoteMediaStreams=[]),S.localCapabilities=q,S.remoteCapabilities=Y,S.rtpReceiver=H,S.rtcpParameters=J,S.sendEncodingParameters=V,S.recvEncodingParameters=W,d._transceive(d.transceivers[a],!1,j)}}}),void 0===d._dtlsRole&&(d._dtlsRole="offer"===s.type?"active":"passive"),d._remoteDescription={type:s.type,sdp:s.sdp},"offer"===s.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable"),Object.keys(r).forEach(function(i){var s=r[i];if(s.getTracks().length){if(-1===d.remoteStreams.indexOf(s)){d.remoteStreams.push(s);var e=new Event("addstream");e.stream=s,z.setTimeout(function(){d._dispatchEvent("addstream",e)})}n.forEach(function(t){var e=t[0],r=t[1];s.id===t[2].id&&o(d,e,r,[s])})}}),n.forEach(function(t){t[2]||o(d,t[0],t[1],[])}),z.setTimeout(function(){d&&d.transceivers&&d.transceivers.forEach(function(t){t.iceTransport&&"new"===t.iceTransport.state&&0<t.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),t.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(r){this.signalingState=r;var e=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",e)},r.prototype._maybeFireNegotiationNeeded=function(){var r=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,z.setTimeout(function(){if(r.needNegotiation){r.needNegotiation=!1;var e=new Event("negotiationneeded");r._dispatchEvent("negotiationneeded",e)}},0))},r.prototype._updateIceConnectionState=function(){var a={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0},t;if(this.transceivers.forEach(function(t){t.iceTransport&&!t.rejected&&a[t.iceTransport.state]++}),t="new",0<a.failed?t="failed":0<a.checking?t="checking":0<a.disconnected?t="disconnected":0<a.new?t="new":0<a.connected?t="connected":0<a.completed&&(t="completed"),t!==this.iceConnectionState){this.iceConnectionState=t;var o=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",o)}},r.prototype._updateConnectionState=function(){var a={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0},t;if(this.transceivers.forEach(function(t){t.iceTransport&&t.dtlsTransport&&!t.rejected&&(a[t.iceTransport.state]++,a[t.dtlsTransport.state]++)}),a.connected+=a.completed,t="new",0<a.failed?t="failed":0<a.connecting?t="connecting":0<a.disconnected?t="disconnected":0<a.new?t="new":0<a.connected&&(t="connected"),t!==this.connectionState){this.connectionState=t;var o=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",o)}},r.prototype.createOffer=function(){var e=this;if(e._isClosed)return Promise.reject(x("InvalidStateError","Can not call createOffer after close"));var t=e.transceivers.filter(function(t){return"audio"===t.kind}).length,r=e.transceivers.filter(function(t){return"video"===t.kind}).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(t=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(r=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(e.transceivers.forEach(function(a){"audio"===a.kind?0>--t&&(a.wantReceive=!1):"video"===a.kind&&0>--r&&(a.wantReceive=!1)});0<t||0<r;)0<t&&(e._createTransceiver("audio"),t--),0<r&&(e._createTransceiver("video"),r--);var i=B.writeSessionBoilerplate(e._sdpSessionId,e._sdpSessionVersion++);e.transceivers.forEach(function(t,r){var n=t.track,a=t.kind,i=t.mid||B.generateIdentifier();t.mid=i,t.iceGatherer||(t.iceGatherer=e._createIceGatherer(r,e.usingBundle));var s=z.RTCRtpSender.getCapabilities(a);15019>h&&(s.codecs=s.codecs.filter(function(t){return"rtx"!==t.name})),s.codecs.forEach(function(r){"H264"===r.name&&void 0===r.parameters["level-asymmetry-allowed"]&&(r.parameters["level-asymmetry-allowed"]="1"),t.remoteCapabilities&&t.remoteCapabilities.codecs&&t.remoteCapabilities.codecs.forEach(function(e){r.name.toLowerCase()===e.name.toLowerCase()&&r.clockRate===e.clockRate&&(r.preferredPayloadType=e.payloadType)})}),s.headerExtensions.forEach(function(r){(t.remoteCapabilities&&t.remoteCapabilities.headerExtensions||[]).forEach(function(e){r.uri===e.uri&&(r.id=e.id)})});var o=t.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];n&&15019<=h&&"video"===a&&!o[0].rtx&&(o[0].rtx={ssrc:o[0].ssrc+1}),t.wantReceive&&(t.rtpReceiver=new z.RTCRtpReceiver(t.dtlsTransport,a)),t.localCapabilities=s,t.sendEncodingParameters=o}),"max-compat"!==e._config.bundlePolicy&&(i+="a=group:BUNDLE "+e.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n",e.transceivers.forEach(function(t,r){i+=m(t,t.localCapabilities,"offer",t.stream,e._dtlsRole),i+="a=rtcp-rsize\r\n",!t.iceGatherer||"new"===e.iceGatheringState||0!==r&&e.usingBundle||(t.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,i+="a="+B.writeCandidate(e)+"\r\n"}),"completed"===t.iceGatherer.state&&(i+="a=end-of-candidates\r\n"))});var d=new z.RTCSessionDescription({type:"offer",sdp:i});return Promise.resolve(d)},r.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(x("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(x("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var t=B.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(t+="a=group:BUNDLE "+r.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"),t+="a=ice-options:trickle\r\n";var a=B.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(n,e){if(!(e+1>a)){if(n.rejected)return"application"===n.kind?"DTLS/SCTP"===n.protocol?t+="m=application 0 DTLS/SCTP 5000\r\n":t+="m=application 0 "+n.protocol+" webrtc-datachannel\r\n":"audio"===n.kind?t+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===n.kind&&(t+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(t+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+n.mid+"\r\n");var i;n.stream&&("audio"===n.kind?i=n.stream.getAudioTracks()[0]:"video"===n.kind&&(i=n.stream.getVideoTracks()[0]),i&&15019<=h&&"video"===n.kind&&!n.sendEncodingParameters[0].rtx&&(n.sendEncodingParameters[0].rtx={ssrc:n.sendEncodingParameters[0].ssrc+1}));var s=y(n.localCapabilities,n.remoteCapabilities);!s.codecs.filter(function(t){return"rtx"===t.name.toLowerCase()}).length&&n.sendEncodingParameters[0].rtx&&delete n.sendEncodingParameters[0].rtx,t+=m(n,s,"answer",n.stream,r._dtlsRole),n.rtcpParameters&&n.rtcpParameters.reducedSize&&(t+="a=rtcp-rsize\r\n")}});var e=new z.RTCSessionDescription({type:"answer",sdp:t});return Promise.resolve(e)},r.prototype.addIceCandidate=function(e){var t=this,o;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(r,a){if(!t._remoteDescription)return a(x("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var n=e.sdpMLineIndex;if(e.sdpMid)for(var i=0;i<t.transceivers.length;i++)if(t.transceivers[i].mid===e.sdpMid){n=i;break}var s=t.transceivers[n];if(!s)return a(x("OperationError","Can not add ICE candidate"));if(s.rejected)return r();var p=0<Object.keys(e.candidate).length?B.parseCandidate(e.candidate):{};if("tcp"===p.protocol&&(0===p.port||9===p.port))return r();if(p.component&&1!==p.component)return r();if((0===n||0<n&&s.iceTransport!==t.transceivers[0].iceTransport)&&!g(s.iceTransport,p))return a(x("OperationError","Can not add ICE candidate"));var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),(o=B.getMediaSections(t._remoteDescription.sdp))[n]+="a="+(p.type?l:"end-of-candidates")+"\r\n",t._remoteDescription.sdp=B.getDescription(t._remoteDescription.sdp)+o.join("")}else for(var m=0;m<t.transceivers.length&&(t.transceivers[m].rejected||(t.transceivers[m].iceTransport.addRemoteCandidate({}),(o=B.getMediaSections(t._remoteDescription.sdp))[m]+="a=end-of-candidates\r\n",t._remoteDescription.sdp=B.getDescription(t._remoteDescription.sdp)+o.join(""),!t.usingBundle));m++);r()})},r.prototype.getStats=function(a){if(a&&a instanceof z.MediaStreamTrack){var e=null;if(this.transceivers.forEach(function(t){t.rtpSender&&t.rtpSender.track===a?e=t.rtpSender:t.rtpReceiver&&t.rtpReceiver.track===a&&(e=t.rtpReceiver)}),!e)throw x("InvalidAccessError","Invalid selector.");return e.getStats()}var o=[];return this.transceivers.forEach(function(r){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){r[e]&&o.push(r[e].getStats())})}),Promise.all(o).then(function(r){var a=new Map;return r.forEach(function(t){t.forEach(function(t){a.set(t.id,t)})}),a})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var e=z[t];if(e&&e.prototype&&e.prototype.getStats){var r=e.prototype.getStats;e.prototype.getStats=function(){return r.apply(this).then(function(t){var e=new Map;return Object.keys(t).forEach(function(r){t[r].type=l(t[r]),e.set(r,t[r])}),e})}}});var t=["createOffer","createAnswer"];return t.forEach(function(a){var o=r.prototype[a];r.prototype[a]=function(){var r=arguments;return"function"==typeof r[0]||"function"==typeof r[1]?o.apply(this,[arguments[2]]).then(function(e){"function"==typeof r[0]&&r[0].apply(null,[e])},function(e){"function"==typeof r[1]&&r[1].apply(null,[e])}):o.apply(this,arguments)}}),(t=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(a){var o=r.prototype[a];r.prototype[a]=function(){var r=arguments;return"function"==typeof r[1]||"function"==typeof r[2]?o.apply(this,arguments).then(function(){"function"==typeof r[1]&&r[1].apply(null)},function(e){"function"==typeof r[2]&&r[2].apply(null,[e])}):o.apply(this,arguments)}}),["getStats"].forEach(function(a){var o=r.prototype[a];r.prototype[a]=function(){var t=arguments;return"function"==typeof t[1]?o.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)}):o.apply(this,arguments)}}),r}},{sdp:"YHvh"}],YdKx:[function(t,r,a){"use strict";function o(a){var e=a&&a.navigator,r=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(t){return r(t).catch(function(t){return Promise.reject(function(t){return{name:{PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}}}(t))})}}Object.defineProperty(a,"__esModule",{value:!0}),a.shimGetUserMedia=o},{}],P3bV:[function(t,r,a){"use strict";function o(t){"getDisplayMedia"in t.navigator&&t.navigator.mediaDevices&&(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=t.navigator.getDisplayMedia.bind(t.navigator)))}Object.defineProperty(a,"__esModule",{value:!0}),a.shimGetDisplayMedia=o},{}],XRic:[function(o,d,l){"use strict";function m(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return m=function(){return t},t}function u(a){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var e=m();if(e&&e.has(a))return e.get(a);var t={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in a)if(Object.prototype.hasOwnProperty.call(a,n)){var i=r?Object.getOwnPropertyDescriptor(a,n):null;i&&(i.get||i.set)?Object.defineProperty(t,n,i):t[n]=a[n]}return t.default=a,e&&e.set(a,t),t}function s(r){var a=p.detectBrowser(r);if(r.RTCIceGatherer&&(r.RTCIceCandidate||(r.RTCIceCandidate=function(t){return t}),r.RTCSessionDescription||(r.RTCSessionDescription=function(t){return t}),15025>a.version)){var n=Object.getOwnPropertyDescriptor(r.MediaStreamTrack.prototype,"enabled");Object.defineProperty(r.MediaStreamTrack.prototype,"enabled",{set:function(r){n.set.call(this,r);var e=new Event("enabled");e.enabled=r,this.dispatchEvent(e)}})}!r.RTCRtpSender||"dtmf"in r.RTCRtpSender.prototype||Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new r.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),r.RTCDtmfSender&&!r.RTCDTMFSender&&(r.RTCDTMFSender=r.RTCDtmfSender);var o=(0,t.default)(r,a.version);r.RTCPeerConnection=function(t){return t&&t.iceServers&&(t.iceServers=(0,e.filterIceServers)(t.iceServers,a.version),p.log("ICE servers after filtering:",t.iceServers)),new o(t)},r.RTCPeerConnection.prototype=o.prototype}function a(t){!t.RTCRtpSender||"replaceTrack"in t.RTCRtpSender.prototype||(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}Object.defineProperty(l,"__esModule",{value:!0}),l.shimPeerConnection=s,l.shimReplaceTrack=a,Object.defineProperty(l,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}}),Object.defineProperty(l,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}});var p=u(o("../utils")),e=o("./filtericeservers"),t=function(t){return t&&t.__esModule?t:{default:t}}(o("rtcpeerconnection-shim")),r=o("./getusermedia"),n=o("./getdisplaymedia")},{"../utils":"iSxC","./filtericeservers":"NZ1C","rtcpeerconnection-shim":"NJ2u","./getusermedia":"YdKx","./getdisplaymedia":"P3bV"}],GzSv:[function(a,i,s){"use strict";function d(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return d=function(){return t},t}function p(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=d();if(e&&e.has(t))return e.get(t);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=r?Object.getOwnPropertyDescriptor(t,n):null;i&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=t[n]}return o.default=t,e&&e.set(t,o),o}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(e){var t=c.detectBrowser(e),d=e&&e.navigator,r=e&&e.MediaStreamTrack;if(d.getUserMedia=function(e,t,a){c.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),d.mediaDevices.getUserMedia(e).then(t,a)},!(55<t.version&&"autoGainControl"in d.mediaDevices.getSupportedConstraints())){var n=function(r,e,t){e in r&&!(t in r)&&(r[t]=r[e],delete r[e])},a=d.mediaDevices.getUserMedia.bind(d.mediaDevices);if(d.mediaDevices.getUserMedia=function(t){return"object"===o(t)&&"object"===o(t.audio)&&(t=JSON.parse(JSON.stringify(t)),n(t.audio,"autoGainControl","mozAutoGainControl"),n(t.audio,"noiseSuppression","mozNoiseSuppression")),a(t)},r&&r.prototype.getSettings){var i=r.prototype.getSettings;r.prototype.getSettings=function(){var t=i.apply(this,arguments);return n(t,"mozAutoGainControl","autoGainControl"),n(t,"mozNoiseSuppression","noiseSuppression"),t}}if(r&&r.prototype.applyConstraints){var s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(t){return"audio"===this.kind&&"object"===o(t)&&(t=JSON.parse(JSON.stringify(t)),n(t,"autoGainControl","mozAutoGainControl"),n(t,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[t])}}}}Object.defineProperty(s,"__esModule",{value:!0}),s.shimGetUserMedia=l;var c=p(a("../utils"))},{"../utils":"iSxC"}],UuGU:[function(t,r,a){"use strict";function o(r,e){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(o){if(!o||!o.video){var a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return!0===o.video?o.video={mediaSource:e}:o.video.mediaSource=e,r.navigator.mediaDevices.getUserMedia(o)})}Object.defineProperty(a,"__esModule",{value:!0}),a.shimGetDisplayMedia=o},{}],Fzdr:[function(m,g,h){"use strict";function v(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return v=function(){return t},t}function x(n){if(n&&n.__esModule)return n;if(null===n||"object"!=typeof n&&"function"!=typeof n)return{default:n};var e=v();if(e&&e.has(n))return e.get(n);var t={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var i=r?Object.getOwnPropertyDescriptor(n,o):null;i&&(i.get||i.set)?Object.defineProperty(t,o,i):t[o]=n[o]}return t.default=n,e&&e.set(n,t),t}function o(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t){"object"===i(t)&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function c(a){var s=l.detectBrowser(a);if("object"===i(a)&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){if(!a.RTCPeerConnection&&a.mozRTCPeerConnection&&(a.RTCPeerConnection=a.mozRTCPeerConnection),53>s.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=a.RTCPeerConnection.prototype[t],r=o({},t,function(){return arguments[0]=new("addIceCandidate"===t?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)});a.RTCPeerConnection.prototype[t]=r[t]}),68>s.version){var e=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){var[a,o,e]=arguments;return r.apply(this,[a||null]).then(function(a){if(53>s.version&&!o)try{a.forEach(function(t){t.type=n[t.type]||t.type})}catch(e){if("TypeError"!==e.name)throw e;a.forEach(function(e,t){a.set(t,Object.assign({},e,{type:n[e.type]||e.type}))})}return a}).then(o,e)}}}function s(a){if("object"===i(a)&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)){var o=a.RTCPeerConnection.prototype.getSenders;o&&(a.RTCPeerConnection.prototype.getSenders=function(){var a=this,e=o.apply(this,[]);return e.forEach(function(e){return e._pc=a}),e});var t=a.RTCPeerConnection.prototype.addTrack;t&&(a.RTCPeerConnection.prototype.addTrack=function(){var r=t.apply(this,arguments);return r._pc=this,r}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function p(e){if("object"===i(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var a=e.RTCPeerConnection.prototype.getReceivers;a&&(e.RTCPeerConnection.prototype.getReceivers=function(){var r=this,e=a.apply(this,[]);return e.forEach(function(e){return e._pc=r}),e}),l.wrapPeerConnectionEvent(e,"track",function(t){return t.receiver._pc=t.srcElement,t}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function u(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(a){var t=this;l.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&a.getTracks().includes(r.track)&&t.removeTrack(r)})})}function f(r){if("object"===i(r)&&r.RTCPeerConnection){var a=r.RTCPeerConnection.prototype.addTransceiver;a&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var t=arguments[1],e=t&&"sendEncodings"in t;e&&t.sendEncodings.forEach(function(t){if("rid"in t&&!/^[a-z0-9]{0,16}$/i.test(t.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in t&&!(1<=parseFloat(t.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in t&&!(0<=parseFloat(t.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")});var r=a.apply(this,arguments);if(e){var{sender:n}=r,o=n.getParameters();"encodings"in o||(o.encodings=t.sendEncodings,this.setParametersPromises.push(n.setParameters(o).catch(function(){})))}return r})}}function d(r){if("object"===i(r)&&r.RTCPeerConnection){var a=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){var t=arguments,e=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return a.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):a.apply(this,arguments)}}}function y(r){if("object"===i(r)&&r.RTCPeerConnection){var a=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){var t=arguments,e=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return a.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):a.apply(this,arguments)}}}Object.defineProperty(h,"__esModule",{value:!0}),h.shimOnTrack=_,h.shimPeerConnection=c,h.shimSenderGetStats=s,h.shimReceiverGetStats=p,h.shimRemoveStream=u,h.shimRTCDataChannel=function(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)},h.shimAddTransceiver=f,h.shimCreateOffer=d,h.shimCreateAnswer=y,Object.defineProperty(h,"shimGetUserMedia",{enumerable:!0,get:function(){return e.shimGetUserMedia}}),Object.defineProperty(h,"shimGetDisplayMedia",{enumerable:!0,get:function(){return t.shimGetDisplayMedia}});var l=x(m("../utils")),e=m("./getusermedia"),t=m("./getdisplaymedia")},{"../utils":"iSxC","./getusermedia":"GzSv","./getdisplaymedia":"UuGU"}],t1lL:[function(p,l,m){"use strict";function u(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return u=function(){return t},t}function g(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=u();if(e&&e.has(t))return e.get(t);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=o?Object.getOwnPropertyDescriptor(t,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(r){if("object"===h(r)&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){var a=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(t){var e=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(function(r){return a.call(e,r,t)}),t.getVideoTracks().forEach(function(r){return a.call(e,r,t)})},r.RTCPeerConnection.prototype.addTrack=function(){var e=arguments[1];return e&&(this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]),a.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(a){var n=this;this._localStreams||(this._localStreams=[]);var e=this._localStreams.indexOf(a);if(-1!==e){this._localStreams.splice(e,1);var t=a.getTracks();this.getSenders().forEach(function(r){t.includes(r.track)&&n.removeTrack(r)})}})}}function n(r){if("object"===h(r)&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(r){var a=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(a._remoteStreams||(a._remoteStreams=[]),!a._remoteStreams.includes(t)){a._remoteStreams.push(t);var e=new Event("addstream");e.stream=t,a.dispatchEvent(e)}})})}});var a=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){var o=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(o._remoteStreams||(o._remoteStreams=[]),!(0<=o._remoteStreams.indexOf(e))){o._remoteStreams.push(e);var t=new Event("addstream");t.stream=e,o.dispatchEvent(t)}})}),a.apply(o,arguments)}}}function i(o){if("object"===h(o)&&o.RTCPeerConnection){var e=o.RTCPeerConnection.prototype,d=e.createOffer,p=e.createAnswer,n=e.setLocalDescription,i=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(r,e){var t=2<=arguments.length?arguments[2]:arguments[0],a=d.apply(this,[t]);return e?(a.then(r,e),Promise.resolve()):a},e.createAnswer=function(a,e){var t=2<=arguments.length?arguments[2]:arguments[0],r=p.apply(this,[t]);return e?(r.then(a,e),Promise.resolve()):r};var t=function(a,e,t){var r=n.apply(this,[a]);return t?(r.then(e,t),Promise.resolve()):r};e.setLocalDescription=t,t=function(a,e,t){var r=i.apply(this,[a]);return t?(r.then(e,t),Promise.resolve()):r},e.setRemoteDescription=t,t=function(n,e,t){var r=a.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r},e.addIceCandidate=t}}function a(a){var n=a&&a.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){var e=n.mediaDevices,t=e.getUserMedia.bind(e);n.mediaDevices.getUserMedia=function(r){return t(s(r))}}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(t,e,r){n.mediaDevices.getUserMedia(t).then(e,r)}.bind(n))}function s(e){return e&&void 0!==e.video?Object.assign({},e,{video:f.compactObject(e.video)}):e}function c(e){var s=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],o=0,n;o<e.iceServers.length;o++)n=e.iceServers[o],!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(f.deprecated("RTCIceServer.url","RTCIceServer.urls"),(n=JSON.parse(JSON.stringify(n))).urls=n.url,delete n.url,r.push(n)):r.push(e.iceServers[o]);e.iceServers=r}return new s(e,t)},e.RTCPeerConnection.prototype=s.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return s.generateCertificate}})}function d(t){"object"===h(t)&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}Object.defineProperty(m,"__esModule",{value:!0}),m.shimLocalStreamsAPI=r,m.shimRemoteStreamsAPI=n,m.shimCallbacksAPI=i,m.shimGetUserMedia=a,m.shimConstraints=s,m.shimRTCIceServerUrls=c,m.shimTrackEventTransceiver=d,m.shimCreateOfferLegacy=function(r){var a=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(t){if(t){void 0!==t.offerToReceiveAudio&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);var e=this.getTransceivers().find(function(t){return"audio"===t.receiver.track.kind});!1===t.offerToReceiveAudio&&e?"sendrecv"===e.direction?e.setDirection?e.setDirection("sendonly"):e.direction="sendonly":"recvonly"===e.direction&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive"):!0!==t.offerToReceiveAudio||e||this.addTransceiver("audio"),void 0!==t.offerToReceiveVideo&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);var r=this.getTransceivers().find(function(t){return"video"===t.receiver.track.kind});!1===t.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==t.offerToReceiveVideo||r||this.addTransceiver("video")}return a.apply(this,arguments)}};var f=g(p("../utils"))},{"../utils":"iSxC"}],GOQK:[function(r,d,l){"use strict";function m(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return m=function(){return t},t}function g(n){if(n&&n.__esModule)return n;if(null===n||"object"!=typeof n&&"function"!=typeof n)return{default:n};var e=m();if(e&&e.has(n))return e.get(n);var t={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var i=o?Object.getOwnPropertyDescriptor(n,r):null;i&&(i.get||i.set)?Object.defineProperty(t,r,i):t[r]=n[r]}return t.default=n,e&&e.set(n,t),t}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){if(t.RTCIceCandidate&&!(t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)){var e=t.RTCIceCandidate;t.RTCIceCandidate=function(o){if("object"===f(o)&&o.candidate&&0===o.candidate.indexOf("a=")&&((o=JSON.parse(JSON.stringify(o))).candidate=o.candidate.substr(2)),o.candidate&&o.candidate.length){var i=new e(o),n=u.default.parseCandidate(o.candidate),r=Object.assign(i,n);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(o)},t.RTCIceCandidate.prototype=e.prototype,h.wrapPeerConnectionEvent(t,"icecandidate",function(r){return r.candidate&&Object.defineProperty(r,"candidate",{value:new t.RTCIceCandidate(r.candidate),writable:"false"}),r})}}function a(e){if(e.RTCPeerConnection){var d=h.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===d.browser&&76<=d.version){var{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;var t=u.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=u.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){var t=function(r){var e=r.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||2>e.length)return-1;var t=parseInt(e[1],10);return t==t?t:-1}(arguments[0]),r=(s=t,c=65536,"firefox"===d.browser&&(c=57>d.version?-1===s?16384:2147483637:60>d.version?57===d.version?65535:65536:2147483637),c),a=function(e,t){var a=65536;"firefox"===d.browser&&57===d.version&&(a=65535);var o=u.default.matchPrefix(e.sdp,"a=max-message-size:");return 0<o.length?a=parseInt(o[0].substr(19),10):"firefox"===d.browser&&-1!==t&&(a=2147483637),a}(arguments[0],t),i;i=0===r&&0===a?Number.POSITIVE_INFINITY:0===r||0===a?Math.max(r,a):Math.min(r,a);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return i}}),this._sctp=l}var s,c;return o.apply(this,arguments)}}}function c(t){function r(a,e){var t=a.send;a.send=function(){var n=arguments[0],o=n.length||n.size||n.byteLength;if("open"===a.readyState&&e.sctp&&o>e.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+e.sctp.maxMessageSize+" bytes)");return t.apply(a,arguments)}}if(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype){var a=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){var t=a.apply(this,arguments);return r(t,this),t},h.wrapPeerConnectionEvent(t,"datachannel",function(t){return r(t.channel,t.target),t})}}function s(r){if(r.RTCPeerConnection&&!("connectionState"in r.RTCPeerConnection.prototype)){var a=r.RTCPeerConnection.prototype;Object.defineProperty(a,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(a,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(t){var e=a[t];a[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(r){var e=r.target;if(e._lastConnectionState!==e.connectionState){e._lastConnectionState=e.connectionState;var t=new Event("connectionstatechange",r);e.dispatchEvent(t)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}}function p(t){if(t.RTCPeerConnection){var e=h.detectBrowser(t);if(!("chrome"===e.browser&&71<=e.version)){var r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(t){return t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")&&(t.sdp=t.sdp.split("\n").filter(function(t){return"a=extmap-allow-mixed"!==t.trim()}).join("\n")),r.apply(this,arguments)}}}}Object.defineProperty(l,"__esModule",{value:!0}),l.shimRTCIceCandidate=o,l.shimMaxMessageSize=a,l.shimSendThrowTypeError=c,l.shimConnectionState=s,l.removeAllowExtmapMixed=p;var u=function(t){return t&&t.__esModule?t:{default:t}}(r("sdp")),h=g(r("./utils"))},{sdp:"YHvh","./utils":"iSxC"}],KtlG:[function(d,p,l){"use strict";function c(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return c=function(){return t},t}function u(o){if(o&&o.__esModule)return o;if(null===o||"object"!=typeof o&&"function"!=typeof o)return{default:o};var e=c();if(e&&e.has(o))return e.get(o);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in o)if(Object.prototype.hasOwnProperty.call(o,i)){var t=n?Object.getOwnPropertyDescriptor(o,i):null;t&&(t.get||t.set)?Object.defineProperty(r,i,t):r[i]=o[i]}return r.default=o,e&&e.set(o,r),r}function o(){var{window:a}=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},o=g.log,p=g.detectBrowser(a),l={browserDetails:p,commonShim:t,extractVersion:g.extractVersion,disableLog:g.disableLog,disableWarnings:g.disableWarnings};switch(p.browser){case"chrome":if(!e||!e.shimPeerConnection||!n.shimChrome)return o("Chrome shim is not included in this adapter release."),l;o("adapter.js shimming chrome."),l.browserShim=e,e.shimGetUserMedia(a),e.shimMediaStream(a),e.shimPeerConnection(a),e.shimOnTrack(a),e.shimAddTrackRemoveTrack(a),e.shimGetSendersWithDtmf(a),e.shimGetStats(a),e.shimSenderReceiverGetStats(a),e.fixNegotiationNeeded(a),t.shimRTCIceCandidate(a),t.shimConnectionState(a),t.shimMaxMessageSize(a),t.shimSendThrowTypeError(a),t.removeAllowExtmapMixed(a);break;case"firefox":if(!i||!i.shimPeerConnection||!n.shimFirefox)return o("Firefox shim is not included in this adapter release."),l;o("adapter.js shimming firefox."),l.browserShim=i,i.shimGetUserMedia(a),i.shimPeerConnection(a),i.shimOnTrack(a),i.shimRemoveStream(a),i.shimSenderGetStats(a),i.shimReceiverGetStats(a),i.shimRTCDataChannel(a),i.shimAddTransceiver(a),i.shimCreateOffer(a),i.shimCreateAnswer(a),t.shimRTCIceCandidate(a),t.shimConnectionState(a),t.shimMaxMessageSize(a),t.shimSendThrowTypeError(a);break;case"edge":if(!r||!r.shimPeerConnection||!n.shimEdge)return o("MS edge shim is not included in this adapter release."),l;o("adapter.js shimming edge."),l.browserShim=r,r.shimGetUserMedia(a),r.shimGetDisplayMedia(a),r.shimPeerConnection(a),r.shimReplaceTrack(a),t.shimMaxMessageSize(a),t.shimSendThrowTypeError(a);break;case"safari":if(!s||!n.shimSafari)return o("Safari shim is not included in this adapter release."),l;o("adapter.js shimming safari."),l.browserShim=s,s.shimRTCIceServerUrls(a),s.shimCreateOfferLegacy(a),s.shimCallbacksAPI(a),s.shimLocalStreamsAPI(a),s.shimRemoteStreamsAPI(a),s.shimTrackEventTransceiver(a),s.shimGetUserMedia(a),t.shimRTCIceCandidate(a),t.shimMaxMessageSize(a),t.shimSendThrowTypeError(a),t.removeAllowExtmapMixed(a);break;default:o("Unsupported browser!");}return l}Object.defineProperty(l,"__esModule",{value:!0}),l.adapterFactory=o;var g=u(d("./utils")),e=u(d("./chrome/chrome_shim")),r=u(d("./edge/edge_shim")),i=u(d("./firefox/firefox_shim")),s=u(d("./safari/safari_shim")),t=u(d("./common_shim"))},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL","./common_shim":"GOQK"}],tI1X:[function(t,a,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=t("./adapter_factory.js"),e=(0,n.adapterFactory)({window:window});o.default=e},{"./adapter_factory.js":"KtlG"}],sXtV:[function(r,a,o){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0});var e=n(r("webrtc-adapter"));o.webRTCAdapter=e.default},{"webrtc-adapter":"tI1X"}],I31f:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./adapter");a.Supports=new(function(){function t(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return t.prototype.isWebRTCSupported=function(){return"undefined"!=typeof RTCPeerConnection},t.prototype.isBrowserSupported=function(){var t=this.getBrowser(),r=this.getVersion();return!!this.supportedBrowsers.includes(t)&&("chrome"===t?r>=this.minChromeVersion:"firefox"===t?r>=this.minFirefoxVersion:"safari"===t&&!this.isIOS&&r>=this.minSafariVersion)},t.prototype.getBrowser=function(){return n.webRTCAdapter.browserDetails.browser},t.prototype.getVersion=function(){return n.webRTCAdapter.browserDetails.version||0},t.prototype.isUnifiedPlanSupported=function(){var r=this.getBrowser(),a=n.webRTCAdapter.browserDetails.version||0,t;if("chrome"===r&&72>a)return!1;if("firefox"===r&&59<=a)return!0;if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;var i=!1;try{(t=new RTCPeerConnection).addTransceiver("audio"),i=!0}catch(e){}finally{t&&t.close()}return i},t.prototype.toString=function(){return"Supports: \n    browser:"+this.getBrowser()+" \n    version:"+this.getVersion()+" \n    isIOS:"+this.isIOS+" \n    isWebRTCSupported:"+this.isWebRTCSupported()+" \n    isBrowserSupported:"+this.isBrowserSupported()+" \n    isUnifiedPlanSupported:"+this.isUnifiedPlanSupported()},t}())},{"./adapter":"sXtV"}],BHXf:[function(a,n,d){"use strict";var p=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var r={};if(null!=a)for(var t in a)Object.hasOwnProperty.call(a,t)&&(r[t]=a[t]);return r.default=a,r};Object.defineProperty(d,"__esModule",{value:!0});var r=p(a("peerjs-js-binarypack")),i=a("./supports"),e={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};d.util=new(function(){function t(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=e,this.browser=i.Supports.getBrowser(),this.browserVersion=i.Supports.getVersion(),this.supports=function(){var a={browser:i.Supports.isBrowserSupported(),webRTC:i.Supports.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1},t;if(!a.webRTC)return a;try{t=new RTCPeerConnection(e),a.audioVideo=!0;var o;try{o=t.createDataChannel("_PEERJSTEST",{ordered:!0}),a.data=!0,a.reliable=!!o.ordered;try{o.binaryType="blob",a.binaryBlob=!i.Supports.isIOS}catch(e){}}catch(e){}finally{o&&o.close()}}catch(e){}finally{t&&t.close()}return a}(),this.pack=r.pack,this.unpack=r.unpack,this._dataCount=1}return t.prototype.noop=function(){},t.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},t.prototype.chunk=function(p){for(var r=[],t=p.size,e=Math.ceil(t/d.util.chunkedMTU),o=0,l=0;l<t;){var c=Math.min(t,l+d.util.chunkedMTU),i=p.slice(l,c),s={__peerData:this._dataCount,n:o,data:i,total:e};r.push(s),l=c,o++}return this._dataCount++,r},t.prototype.blobToArrayBuffer=function(a,o){var t=new FileReader;return t.onload=function(e){e.target&&o(e.target.result)},t.readAsArrayBuffer(a),t},t.prototype.binaryStringToArrayBuffer=function(a){for(var r=new Uint8Array(a.length),t=0;t<a.length;t++)r[t]=255&a.charCodeAt(t);return r.buffer},t.prototype.randomToken=function(){return Math.random().toString(36).substr(2)},t.prototype.isSecure=function(){return"https:"===location.protocol},t}())},{"peerjs-js-binarypack":"kdPp","./supports":"I31f"}],JJlS:[function(a,d){"use strict";function p(){}function l(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function r(t,e,r,a,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var n=new l(r,a||t,o),i=g?g+e:e;return t._events[i]?t._events[i].fn?t._events[i]=[t._events[i],n]:t._events[i].push(n):(t._events[i]=n,t._eventsCount++),t}function m(r,e){0==--r._eventsCount?r._events=new p:delete r._events[e]}function o(){this._events=new p,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,g="~";Object.create&&(p.prototype=Object.create(null),new p().__proto__||(g=!1)),o.prototype.eventNames=function(){var e=[],t,a;if(0===this._eventsCount)return e;for(a in t=this._events)i.call(t,a)&&e.push(g?a.slice(1):a);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e},o.prototype.listeners=function(t){var e=g?g+t:t,a=this._events[e];if(!a)return[];if(a.fn)return[a.fn];for(var r=0,n=a.length,s=Array(n);r<n;r++)s[r]=a[r].fn;return s},o.prototype.listenerCount=function(t){var e=g?g+t:t,a=this._events[e];return a?a.fn?1:a.length:0},o.prototype.emit=function(t,e,n,r,o,s){var i=g?g+t:t;if(!this._events[i])return!1;var d=this._events[i],a=arguments.length,p,l;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),a){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,n),!0;case 4:return d.fn.call(d.context,e,n,r),!0;case 5:return d.fn.call(d.context,e,n,r,o),!0;case 6:return d.fn.call(d.context,e,n,r,o,s),!0;}for(l=1,p=Array(a-1);l<a;l++)p[l-1]=arguments[l];d.fn.apply(d.context,p)}else{var c=d.length,m;for(l=0;l<c;l++)switch(d[l].once&&this.removeListener(t,d[l].fn,void 0,!0),a){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,e);break;case 3:d[l].fn.call(d[l].context,e,n);break;case 4:d[l].fn.call(d[l].context,e,n,r);break;default:if(!p)for(m=1,p=Array(a-1);m<a;m++)p[m-1]=arguments[m];d[l].fn.apply(d[l].context,p);}}return!0},o.prototype.on=function(a,e,t){return r(this,a,e,t,!1)},o.prototype.once=function(a,e,t){return r(this,a,e,t,!0)},o.prototype.removeListener=function(t,e,n,r){var o=g?g+t:t;if(!this._events[o])return this;if(!e)return m(this,o),this;var i=this._events[o];if(i.fn)i.fn!==e||r&&!i.once||n&&i.context!==n||m(this,o);else{for(var s=0,d=[],p=i.length;s<p;s++)(i[s].fn!==e||r&&!i[s].once||n&&i[s].context!==n)&&d.push(i[s]);d.length?this._events[o]=1===d.length?d[0]:d:m(this,o)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=g?g+t:t,this._events[e]&&m(this,e)):(this._events=new p,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=g,o.EventEmitter=o,"undefined"!=typeof d&&(d.exports=o)},{}],WOs9:[function(t,a,i){"use strict";var s=this&&this.__read||function(a,r){var s="function"==typeof Symbol&&a[Symbol.iterator];if(!s)return a;var d=s.call(a),p=[],i,l;try{for(;(void 0===r||0<r--)&&!(i=d.next()).done;)p.push(i.value)}catch(e){l={error:e}}finally{try{i&&!i.done&&(s=d.return)&&s.call(d)}finally{if(l)throw l.error}}return p},d=this&&this.__spread||function(){for(var t=[],r=0;r<arguments.length;r++)t=t.concat(s(arguments[r]));return t};Object.defineProperty(i,"__esModule",{value:!0});var e;!function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"}(e=i.LogLevel||(i.LogLevel={}));var r=function(){function t(){this._logLevel=e.Disabled}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!0,configurable:!0}),t.prototype.log=function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];this._logLevel>=e.All&&this._print.apply(this,d([e.All],a))},t.prototype.warn=function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];this._logLevel>=e.Warnings&&this._print.apply(this,d([e.Warnings],a))},t.prototype.error=function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];this._logLevel>=e.Errors&&this._print.apply(this,d([e.Errors],a))},t.prototype.setLogFunction=function(e){this._print=e},t.prototype._print=function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var o=d(["PeerJS: "],r);for(var n in o)o[n]instanceof Error&&(o[n]="("+o[n].name+") "+o[n].message);t>=e.All?console.log.apply(console,d(o)):t>=e.Warnings?console.warn.apply(console,d(["WARNING"],o)):t>=e.Errors&&console.error.apply(console,d(["ERROR"],o))},t}();i.default=new r},{}],ZRYf:[function(s,d,p){"use strict";var l,c,m,u,g,f,h;Object.defineProperty(p,"__esModule",{value:!0}),function(t){t.Open="open",t.Stream="stream",t.Data="data",t.Close="close",t.Error="error",t.IceStateChanged="iceStateChanged"}(l=p.ConnectionEventType||(p.ConnectionEventType={})),function(t){t.Data="data",t.Media="media"}(c=p.ConnectionType||(p.ConnectionType={})),function(t){t.Open="open",t.Close="close",t.Connection="connection",t.Call="call",t.Disconnected="disconnected",t.Error="error"}(m=p.PeerEventType||(p.PeerEventType={})),function(t){t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc"}(u=p.PeerErrorType||(p.PeerErrorType={})),function(t){t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json"}(g=p.SerializationType||(p.SerializationType={})),function(t){t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close"}(f=p.SocketEventType||(p.SocketEventType={})),function(t){t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE"}(h=p.ServerMessageType||(p.ServerMessageType={}))},{}],wJlv:[function(d,p,l){"use strict";var m=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(e,t)};return function(e,t){function a(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}(),u=this&&this.__read||function(a,e){var d="function"==typeof Symbol&&a[Symbol.iterator];if(!d)return a;var p=d.call(a),r=[],i,l;try{for(;(void 0===e||0<e--)&&!(i=p.next()).done;)r.push(i.value)}catch(e){l={error:e}}finally{try{i&&!i.done&&(d=p.return)&&d.call(p)}finally{if(l)throw l.error}}return r},g=this&&this.__spread||function(){for(var t=[],r=0;r<arguments.length;r++)t=t.concat(u(arguments[r]));return t},e=this&&this.__values||function(r){var a="function"==typeof Symbol&&Symbol.iterator,t=a&&r[a],o=0;if(t)return t.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&o>=r.length&&(r=void 0),{value:r&&r[o++],done:!r}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")},t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(l,"__esModule",{value:!0});var o=d("eventemitter3"),r=t(d("./logger")),i=d("./enums"),n=function(d){function t(t,e,n,s,o,r){void 0===r&&(r=5e3);var p=d.call(this)||this;p.pingInterval=r,p._disconnected=!0,p._messagesQueue=[];var l=t?"wss://":"ws://";return p._baseUrl=l+e+":"+n+s+"peerjs?key="+o,p}return m(t,d),t.prototype.start=function(a,e){var o=this;this._id=a;var t=this._baseUrl+"&id="+a+"&token="+e;!this._socket&&this._disconnected&&(this._socket=new WebSocket(t),this._disconnected=!1,this._socket.onmessage=function(a){var e;try{e=JSON.parse(a.data),r.default.log("Server message received:",e)}catch(e){return void r.default.log("Invalid server message",a.data)}o.emit(i.SocketEventType.Message,e)},this._socket.onclose=function(t){o._disconnected||(r.default.log("Socket closed.",t),o._cleanup(),o._disconnected=!0,o.emit(i.SocketEventType.Disconnected))},this._socket.onopen=function(){o._disconnected||(o._sendQueuedMessages(),r.default.log("Socket open"),o._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},t.prototype._sendHeartbeat=function(){if(this._wsOpen()){var t=JSON.stringify({type:i.ServerMessageType.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()}else r.default.log("Cannot send heartbeat, because socket closed")},t.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},t.prototype._sendQueuedMessages=function(){var a=g(this._messagesQueue),o,n;this._messagesQueue=[];try{for(var s=e(a),r=s.next(),d;!r.done;r=s.next())d=r.value,this.send(d)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}},t.prototype.send=function(r){if(!this._disconnected)if(!this._id)this._messagesQueue.push(r);else if(!r.type)this.emit(i.SocketEventType.Error,"Invalid message");else if(this._wsOpen()){var e=JSON.stringify(r);this._socket.send(e)}},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(o.EventEmitter);l.Socket=n},{eventemitter3:"JJlS","./logger":"WOs9","./enums":"ZRYf"}],HCdX:[function(s,d,p){"use strict";var m=this&&this.__assign||function(){return(m=Object.assign||function(r){for(var e=1,a=arguments.length,o;e<a;e++)for(var s in o=arguments[e])Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s]);return r}).apply(this,arguments)},l=this&&this.__awaiter||function(d,e,r,n){return new(r||(r=Promise))(function(t,o){function i(t){try{a(n.next(t))}catch(e){o(e)}}function p(t){try{a(n.throw(t))}catch(e){o(e)}}function a(a){var o;a.done?t(a.value):(o=a.value,o instanceof r?o:new r(function(t){t(o)})).then(i,p)}a((n=n.apply(d,e||[])).next())})},g=this&&this.__generator||function(s,e){function n(t){return function(r){return function(t){if(d)throw new TypeError("Generator is already executing.");for(;a;)try{if(d=1,p&&(l=2&t[0]?p.return:t[0]?p.throw||((l=p.return)&&l.call(p),0):p.next)&&!(l=l.call(p,t[1])).done)return l;switch(p=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,p=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){a.label=t[1];break}if(6===t[0]&&a.label<l[1]){a.label=l[1],l=t;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(t);break}l[2]&&a.ops.pop(),a.trys.pop();continue;}t=e.call(s,a)}catch(e){t=[6,e],p=0}finally{d=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,r])}}var a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},d,p,l,m;return m={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(m[Symbol.iterator]=function(){return this}),m},t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(p,"__esModule",{value:!0});var f=s("./util"),h=t(s("./logger")),r=s("./enums"),o=function(){function e(t){this.connection=t}return e.prototype.startConnection=function(a){var e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===r.ConnectionType.Media&&a._stream&&this._addTracksToConnection(a._stream,e),a.originator){if(this.connection.type===r.ConnectionType.Data){var n=this.connection,t={ordered:!!a.reliable},o=e.createDataChannel(n.label,t);n.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",a.sdp)},e.prototype._startPeerConnection=function(){h.default.log("Creating RTCPeerConnection.");var t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t},e.prototype._setupListeners=function(i){var e=this,d=this.connection.peer,t=this.connection.connectionId,o=this.connection.type,p=this.connection.provider;h.default.log("Listening for ICE candidates."),i.onicecandidate=function(a){a.candidate&&a.candidate.candidate&&(h.default.log("Received ICE candidates for "+d+":",a.candidate),p.socket.send({type:r.ServerMessageType.Candidate,payload:{candidate:a.candidate,type:o,connectionId:t},dst:d}))},i.oniceconnectionstatechange=function(){switch(i.iceConnectionState){case"failed":h.default.log("iceConnectionState is failed, closing connections to "+d),e.connection.emit(r.ConnectionEventType.Error,new Error("Negotiation of connection to "+d+" failed.")),e.connection.close();break;case"closed":h.default.log("iceConnectionState is closed, closing connections to "+d),e.connection.emit(r.ConnectionEventType.Error,new Error("Connection to "+d+" closed.")),e.connection.close();break;case"disconnected":h.default.log("iceConnectionState changed to disconnected on the connection with "+d);break;case"completed":i.onicecandidate=f.util.noop;}e.connection.emit(r.ConnectionEventType.IceStateChanged,i.iceConnectionState)},h.default.log("Listening for data channel"),i.ondatachannel=function(r){h.default.log("Received data channel");var e=r.channel;p.getConnection(d,t).initialize(e)},h.default.log("Listening for remote stream"),i.ontrack=function(o){h.default.log("Received remote stream");var n=o.streams[0],i=p.getConnection(d,t);if(i.type===r.ConnectionType.Media){e._addStreamToMediaConnection(n,i)}}},e.prototype.cleanup=function(){h.default.log("Cleaning up PeerConnection to "+this.connection.peer);var a=this.connection.peerConnection;if(a){this.connection.peerConnection=null,a.onicecandidate=a.oniceconnectionstatechange=a.ondatachannel=a.ontrack=function(){};var e="closed"!==a.signalingState,n=!1;if(this.connection.type===r.ConnectionType.Data){var i=this.connection.dataChannel;i&&(n=!!i.readyState&&"closed"!==i.readyState)}(e||n)&&a.close()}},e.prototype._makeOffer=function(){return l(this,void 0,Promise,function(){var e,i,p,c,y,v,x;return g(this,function(a){switch(a.label){case 0:e=this.connection.peerConnection,i=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:p=a.sent(),h.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(p.sdp=this.connection.options.sdpTransform(p.sdp)||p.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,e.setLocalDescription(p)];case 4:return a.sent(),h.default.log("Set localDescription:",p,"for:"+this.connection.peer),c={sdp:p,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:f.util.browser},this.connection.type===r.ConnectionType.Data&&(y=this.connection,c=m(m({},c),{label:y.label,reliable:y.reliable,serialization:y.serialization})),i.socket.send({type:r.ServerMessageType.Offer,payload:c,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(v=a.sent())&&(i.emitError(r.PeerErrorType.WebRTC,v),h.default.log("Failed to setLocalDescription, ",v)),[3,6];case 6:return[3,8];case 7:return x=a.sent(),i.emitError(r.PeerErrorType.WebRTC,x),h.default.log("Failed to createOffer, ",x),[3,8];case 8:return[2];}})})},e.prototype._makeAnswer=function(){return l(this,void 0,Promise,function(){var i,d,p,l,c;return g(this,function(e){switch(e.label){case 0:i=this.connection.peerConnection,d=this.connection.provider,e.label=1;case 1:return e.trys.push([1,7,,8]),[4,i.createAnswer()];case 2:p=e.sent(),h.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(p.sdp=this.connection.options.sdpTransform(p.sdp)||p.sdp),e.label=3;case 3:return e.trys.push([3,5,,6]),[4,i.setLocalDescription(p)];case 4:return e.sent(),h.default.log("Set localDescription:",p,"for:"+this.connection.peer),d.socket.send({type:r.ServerMessageType.Answer,payload:{sdp:p,type:this.connection.type,connectionId:this.connection.connectionId,browser:f.util.browser},dst:this.connection.peer}),[3,6];case 5:return l=e.sent(),d.emitError(r.PeerErrorType.WebRTC,l),h.default.log("Failed to setLocalDescription, ",l),[3,6];case 6:return[3,8];case 7:return c=e.sent(),d.emitError(r.PeerErrorType.WebRTC,c),h.default.log("Failed to create answer, ",c),[3,8];case 8:return[2];}})})},e.prototype.handleSDP=function(d,e){return l(this,void 0,Promise,function(){var o,p,l,c;return g(this,function(a){switch(a.label){case 0:e=new RTCSessionDescription(e),o=this.connection.peerConnection,p=this.connection.provider,h.default.log("Setting remote description",e),l=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,o.setRemoteDescription(e)];case 2:return a.sent(),h.default.log("Set remoteDescription:"+d+" for:"+this.connection.peer),"OFFER"===d?[4,l._makeAnswer()]:[3,4];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return c=a.sent(),p.emitError(r.PeerErrorType.WebRTC,c),h.default.log("Failed to setRemoteDescription, ",c),[3,6];case 6:return[2];}})})},e.prototype.handleCandidate=function(p){return l(this,void 0,Promise,function(){var e,l,c,m,u,f;return g(this,function(a){switch(a.label){case 0:h.default.log("handleCandidate:",p),e=p.candidate,l=p.sdpMLineIndex,c=p.sdpMid,m=this.connection.peerConnection,u=this.connection.provider,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,m.addIceCandidate(new RTCIceCandidate({sdpMid:c,sdpMLineIndex:l,candidate:e}))];case 2:return a.sent(),h.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return f=a.sent(),u.emitError(r.PeerErrorType.WebRTC,f),h.default.log("Failed to handleCandidate, ",f),[3,4];case 4:return[2];}})})},e.prototype._addTracksToConnection=function(r,e){return(h.default.log("add tracks from stream "+r.id+" to peer connection"),!e.addTrack)?h.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored."):void r.getTracks().forEach(function(a){e.addTrack(a,r)})},e.prototype._addStreamToMediaConnection=function(t,e){h.default.log("add stream "+t.id+" to media connection "+e.connectionId),e.addStream(t)},e}();p.Negotiator=o},{"./util":"BHXf","./logger":"WOs9","./enums":"ZRYf"}],tQFK:[function(a,o,n){"use strict";var i=this&&this.__extends||function(){var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(a,t){for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e])})(t,e)};return function(t,e){function r(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var t=a("eventemitter3"),e=function(a){function e(e,t,r){var n=a.call(this)||this;return n.peer=e,n.provider=t,n.options=r,n._open=!1,n.metadata=r.metadata,n}return i(e,a),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),e}(t.EventEmitter);n.BaseConnection=e},{eventemitter3:"JJlS"}],dbHP:[function(d,p,m){"use strict";var u=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(e,t)};return function(e,t){function o(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),g=this&&this.__assign||function(){return(g=Object.assign||function(a){for(var e=1,i=arguments.length,r;e<i;e++)for(var s in r=arguments[e])Object.prototype.hasOwnProperty.call(r,s)&&(a[s]=r[s]);return a}).apply(this,arguments)},e=this&&this.__values||function(a){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&a[n],o=0;if(t)return t.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&o>=a.length&&(a=void 0),{value:a&&a[o++],done:!a}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(m,"__esModule",{value:!0});var f=d("./util"),h=o(d("./logger")),n=d("./negotiator"),a=d("./enums"),r=d("./baseconnection"),i=function(s){function r(a,e,t){var o=s.call(this,a,e,t)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||r.ID_PREFIX+f.util.randomToken(),o._negotiator=new n.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return u(r,s),Object.defineProperty(r.prototype,"type",{get:function(){return a.ConnectionType.Media},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"localStream",{get:function(){return this._localStream},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!0,configurable:!0}),r.prototype.addStream=function(t){h.default.log("Receiving stream",t),this._remoteStream=t,s.prototype.emit.call(this,a.ConnectionEventType.Stream,t)},r.prototype.handleMessage=function(r){var e=r.type,t=r.payload;switch(r.type){case a.ServerMessageType.Answer:this._negotiator.handleSDP(e,t.sdp),this._open=!0;break;case a.ServerMessageType.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:h.default.warn("Unrecognized message type:"+e+" from peer:"+this.peer);}},r.prototype.answer=function(t,o){var i,d;if(void 0===o&&(o={}),this._localStream)h.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=t,o&&o.sdpTransform&&(this.options.sdpTransform=o.sdpTransform),this._negotiator.startConnection(g(g({},this.options._payload),{_stream:t}));var m=this.provider._getMessages(this.connectionId);try{for(var s=e(m),l=s.next(),u;!l.done;l=s.next())u=l.value,this.handleMessage(u)}catch(e){i={error:e}}finally{try{l&&!l.done&&(d=s.return)&&d.call(s)}finally{if(i)throw i.error}}this._open=!0}},r.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,s.prototype.emit.call(this,a.ConnectionEventType.Close))},r.ID_PREFIX="mc_",r}(r.BaseConnection);m.MediaConnection=i},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK"}],GGp6:[function(a,i,s){"use strict";var d=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(a,e){for(var t in e)e.hasOwnProperty(t)&&(a[t]=e[t])})(e,t)};return function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});var t=a("eventemitter3"),r=e(a("./logger")),o=function(a){function e(){var o=a.call(this)||this;return o.fileReader=new FileReader,o._queue=[],o._processing=!1,o.fileReader.onload=function(e){o._processing=!1,e.target&&o.emit("done",e.target.result),o.doNextTask()},o.fileReader.onerror=function(e){r.default.error("EncodingQueue error:",e),o._processing=!1,o.destroy(),o.emit("error",e)},o}return d(e,a),Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!0,configurable:!0}),e.prototype.enque=function(t){this.queue.push(t),this.processing||this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(t.EventEmitter);s.EncodingQueue=o},{eventemitter3:"JJlS","./logger":"WOs9"}],GBTQ:[function(d,p,c){"use strict";var m=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(e,t)};return function(e,t){function a(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}(),e=this&&this.__values||function(r){var a="function"==typeof Symbol&&Symbol.iterator,t=a&&r[a],o=0;if(t)return t.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&o>=r.length&&(r=void 0),{value:r&&r[o++],done:!r}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")},t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(c,"__esModule",{value:!0});var g=d("./util"),i=t(d("./logger")),o=d("./negotiator"),h=d("./enums"),r=d("./baseconnection"),a=d("./encodingQueue"),n=function(d){function r(n,e,t){var s=d.call(this,n,e,t)||this;return s.stringify=JSON.stringify,s.parse=JSON.parse,s._buffer=[],s._bufferSize=0,s._buffering=!1,s._chunkedData={},s._encodingQueue=new a.EncodingQueue,s.connectionId=s.options.connectionId||r.ID_PREFIX+g.util.randomToken(),s.label=s.options.label||s.connectionId,s.serialization=s.options.serialization||h.SerializationType.Binary,s.reliable=!!s.options.reliable,s._encodingQueue.on("done",function(t){s._bufferedSend(t)}),s._encodingQueue.on("error",function(){i.default.error("DC#"+s.connectionId+": Error occured in encoding from blob to arraybuffer, close DC"),s.close()}),s._negotiator=new o.Negotiator(s),s._negotiator.startConnection(s.options._payload||{originator:!0}),s}return m(r,d),Object.defineProperty(r.prototype,"type",{get:function(){return h.ConnectionType.Data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!0,configurable:!0}),r.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},r.prototype._configureDataChannel=function(){var r=this;g.util.supports.binaryBlob&&!g.util.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){i.default.log("DC#"+r.connectionId+" dc connection success"),r._open=!0,r.emit(h.ConnectionEventType.Open)},this.dataChannel.onmessage=function(e){i.default.log("DC#"+r.connectionId+" dc onmessage:",e.data),r._handleDataMessage(e)},this.dataChannel.onclose=function(){i.default.log("DC#"+r.connectionId+" dc closed for:",r.peer),r.close()}},r.prototype._handleDataMessage=function(a){var i=this,e=a.data,t=e.constructor,r=e;if(this.serialization===h.SerializationType.Binary||this.serialization===h.SerializationType.BinaryUTF8){if(t===Blob)return void g.util.blobToArrayBuffer(e,function(t){var e=g.util.unpack(t);i.emit(h.ConnectionEventType.Data,e)});if(t===ArrayBuffer)r=g.util.unpack(e);else if(t===String){var o=g.util.binaryStringToArrayBuffer(e);r=g.util.unpack(o)}}else this.serialization===h.SerializationType.JSON&&(r=this.parse(e));r.__peerData?this._handleChunk(r):d.prototype.emit.call(this,h.ConnectionEventType.Data,r)},r.prototype._handleChunk=function(r){var e=r.__peerData,t=this._chunkedData[e]||{data:[],count:0,total:r.total};if(t.data[r.n]=r.data,t.count++,this._chunkedData[e]=t,t.total===t.count){delete this._chunkedData[e];var a=new Blob(t.data);this._handleDataMessage({data:a})}},r.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,d.prototype.emit.call(this,h.ConnectionEventType.Close))},r.prototype.send=function(r,e){if(!this.open)d.prototype.emit.call(this,h.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."));else if(this.serialization===h.SerializationType.JSON)this._bufferedSend(this.stringify(r));else if(this.serialization===h.SerializationType.Binary||this.serialization===h.SerializationType.BinaryUTF8){var t=g.util.pack(r);if(!e&&t.size>g.util.chunkedMTU)return void this._sendChunks(t);g.util.supports.binaryBlob?this._bufferedSend(t):this._encodingQueue.enque(t)}else this._bufferedSend(r)},r.prototype._bufferedSend=function(t){!this._buffering&&this._trySend(t)||(this._buffer.push(t),this._bufferSize=this._buffer.length)},r.prototype._trySend=function(a){var e=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>r.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){e._buffering=!1,e._tryBuffer()},50),!1;try{this.dataChannel.send(a)}catch(e){return i.default.error("DC#:"+this.connectionId+" Error when sending:",e),this._buffering=!0,this.close(),!1}return!0},r.prototype._tryBuffer=function(){if(this.open&&0!==this._buffer.length){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},r.prototype._sendChunks=function(t){var o=g.util.chunk(t),a,d;i.default.log("DC#"+this.connectionId+" Try to send "+o.length+" chunks...");try{for(var p=e(o),s=p.next(),c;!s.done;s=p.next())c=s.value,this.send(c,!0)}catch(e){a={error:e}}finally{try{s&&!s.done&&(d=p.return)&&d.call(p)}finally{if(a)throw a.error}}},r.prototype.handleMessage=function(r){var e=r.payload;switch(r.type){case h.ServerMessageType.Answer:this._negotiator.handleSDP(r.type,e.sdp);break;case h.ServerMessageType.Candidate:this._negotiator.handleCandidate(e.candidate);break;default:i.default.warn("Unrecognized message type:",r.type,"from peer:",this.peer);}},r.ID_PREFIX="dc_",r.MAX_BUFFERED_AMOUNT=8388608,r}(r.BaseConnection);c.DataConnection=n},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK","./encodingQueue":"GGp6"}],in7L:[function(a,i,d){"use strict";var p=this&&this.__awaiter||function(d,t,a,e){return new(a||(a=Promise))(function(r,o){function n(r){try{s(e.next(r))}catch(t){o(t)}}function i(r){try{s(e.throw(r))}catch(t){o(t)}}function s(o){var s;o.done?r(o.value):(s=o.value,s instanceof a?s:new a(function(e){e(s)})).then(n,i)}s((e=e.apply(d,t||[])).next())})},l=this&&this.__generator||function(a,t){function e(e){return function(r){return function(e){if(p)throw new TypeError("Generator is already executing.");for(;d;)try{if(p=1,l&&(c=2&e[0]?l.return:e[0]?l.throw||((c=l.return)&&c.call(l),0):l.next)&&!(c=c.call(l,e[1])).done)return c;switch(l=0,c&&(e=[2&e[0],c.value]),e[0]){case 0:case 1:c=e;break;case 4:return d.label++,{value:e[1],done:!1};case 5:d.label++,l=e[1],e=[0];continue;case 7:e=d.ops.pop(),d.trys.pop();continue;default:if(!(c=0<(c=d.trys).length&&c[c.length-1])&&(6===e[0]||2===e[0])){d=0;continue}if(3===e[0]&&(!c||e[1]>c[0]&&e[1]<c[3])){d.label=e[1];break}if(6===e[0]&&d.label<c[1]){d.label=c[1],c=e;break}if(c&&d.label<c[2]){d.label=c[2],d.ops.push(e);break}c[2]&&d.ops.pop(),d.trys.pop();continue;}e=t.call(a,d)}catch(t){e=[6,t],l=0}finally{p=c=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,r])}}var d={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},p,l,c,m;return m={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(m[Symbol.iterator]=function(){return this}),m},e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(d,"__esModule",{value:!0});var c=a("./util"),o=e(a("./logger")),t=function(){function e(e){this._options=e}return e.prototype._buildUrl=function(r){var t=(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+r;return t+="?ts="+new Date().getTime()+Math.random()},e.prototype.retrieveId=function(){return p(this,void 0,Promise,function(){var a,n,d,p;return l(this,function(t){switch(t.label){case 0:a=this._buildUrl("id"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(a)];case 2:if(200!==(n=t.sent()).status)throw new Error("Error. Status:"+n.status);return[2,n.text()];case 3:throw d=t.sent(),o.default.error("Error retrieving ID",d),p="","/"===this._options.path&&this._options.host!==c.util.CLOUD_HOST&&(p=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+p);case 4:return[2];}})})},e.prototype.listAllPeers=function(){return p(this,void 0,Promise,function(){var a,n,e,d;return l(this,function(t){switch(t.label){case 0:a=this._buildUrl("peers"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(a)];case 2:if(200!==(n=t.sent()).status){if(401===n.status)throw e="",e=this._options.host===c.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e);throw new Error("Error. Status:"+n.status)}return[2,n.json()];case 3:throw d=t.sent(),o.default.error("Error retrieving list peers",d),new Error("Could not get list peers from the server."+d);case 4:return[2];}})})},e}();d.API=t},{"./util":"BHXf","./logger":"WOs9"}],Hxpd:[function(m,g,y){"use strict";var v=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(e,t)};return function(e,t){function o(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(a){for(var e=1,i=arguments.length,r;e<i;e++)for(var s in r=arguments[e])Object.prototype.hasOwnProperty.call(r,s)&&(a[s]=r[s]);return a}).apply(this,arguments)},e=this&&this.__values||function(a){var o="function"==typeof Symbol&&Symbol.iterator,t=o&&a[o],n=0;if(t)return t.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&n>=a.length&&(a=void 0),{value:a&&a[n++],done:!a}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")},n=this&&this.__read||function(a,e){var d="function"==typeof Symbol&&a[Symbol.iterator];if(!d)return a;var p=d.call(a),i=[],s,l;try{for(;(void 0===e||0<e--)&&!(s=p.next()).done;)i.push(s.value)}catch(e){l={error:e}}finally{try{s&&!s.done&&(d=p.return)&&d.call(p)}finally{if(l)throw l.error}}return i},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(y,"__esModule",{value:!0});var o=m("eventemitter3"),_=m("./util"),b=r(m("./logger")),a=m("./socket"),T=m("./mediaconnection"),l=m("./dataconnection"),d=m("./enums"),s=m("./api"),i=function(){return function(){}}(),p=function(t){function o(a,e){var i=t.call(this)||this,p;return i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map,a&&a.constructor==Object?e=a:a&&(p=a.toString()),e=x({debug:0,host:_.util.CLOUD_HOST,port:_.util.CLOUD_PORT,path:"/",key:o.DEFAULT_KEY,token:_.util.randomToken(),config:_.util.defaultConfig},e),i._options=e,"/"===i._options.host&&(i._options.host=window.location.hostname),i._options.path&&("/"!==i._options.path[0]&&(i._options.path="/"+i._options.path),"/"!==i._options.path[i._options.path.length-1]&&(i._options.path+="/")),void 0===i._options.secure&&i._options.host!==_.util.CLOUD_HOST?i._options.secure=_.util.isSecure():i._options.host==_.util.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&b.default.setLogFunction(i._options.logFunction),b.default.logLevel=i._options.debug||0,i._api=new s.API(e),i._socket=i._createServerConnection(),_.util.supports.audioVideo||_.util.supports.data?p&&!_.util.validateId(p)?(i._delayedAbort(d.PeerErrorType.InvalidID,"ID \""+p+"\" is invalid"),i):(p?i._initialize(p):i._api.retrieveId().then(function(t){return i._initialize(t)}).catch(function(t){return i._abort(d.PeerErrorType.ServerError,t)}),i):(i._delayedAbort(d.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),i)}return v(o,t),Object.defineProperty(o.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"socket",{get:function(){return this._socket},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"connections",{get:function(){var r=Object.create(null),o,d;try{for(var p=e(this._connections),i=p.next();!i.done;i=p.next()){var m=n(i.value,2),a=m[0],c=m[1];r[a]=c}}catch(e){o={error:e}}finally{try{i&&!i.done&&(d=p.return)&&d.call(p)}finally{if(o)throw o.error}}return r},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!0,configurable:!0}),o.prototype._createServerConnection=function(){var r=this,e=new a.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(d.SocketEventType.Message,function(e){r._handleMessage(e)}),e.on(d.SocketEventType.Error,function(e){r._abort(d.PeerErrorType.SocketError,e)}),e.on(d.SocketEventType.Disconnected,function(){r.disconnected||(r.emitError(d.PeerErrorType.Network,"Lost connection to server."),r.disconnect())}),e.on(d.SocketEventType.Close,function(){r.disconnected||r._abort(d.PeerErrorType.SocketClosed,"Underlying socket is already closed.")}),e},o.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},o.prototype._handleMessage=function(a){var n=a.type,o=a.payload,i=a.src,s,m;switch(n){case d.ServerMessageType.Open:this._lastServerId=this.id,this._open=!0,this.emit(d.PeerEventType.Open,this.id);break;case d.ServerMessageType.Error:this._abort(d.PeerErrorType.ServerError,o.msg);break;case d.ServerMessageType.IdTaken:this._abort(d.PeerErrorType.UnavailableID,"ID \""+this.id+"\" is taken");break;case d.ServerMessageType.InvalidKey:this._abort(d.PeerErrorType.InvalidKey,"API KEY \""+this._options.key+"\" is invalid");break;case d.ServerMessageType.Leave:b.default.log("Received leave message from "+i),this._cleanupPeer(i),this._connections.delete(i);break;case d.ServerMessageType.Expire:this.emitError(d.PeerErrorType.PeerUnavailable,"Could not connect to peer "+i);break;case d.ServerMessageType.Offer:var u=o.connectionId;if((x=this.getConnection(i,u))&&(x.close(),b.default.warn("Offer received for existing Connection ID:"+u)),o.type===d.ConnectionType.Media)x=new T.MediaConnection(i,this,{connectionId:u,_payload:o,metadata:o.metadata}),this._addConnection(i,x),this.emit(d.PeerEventType.Call,x);else{if(o.type!==d.ConnectionType.Data)return void b.default.warn("Received malformed connection type:"+o.type);x=new l.DataConnection(i,this,{connectionId:u,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable}),this._addConnection(i,x),this.emit(d.PeerEventType.Connection,x)}var g=this._getMessages(u);try{for(var p=e(g),h=p.next(),v;!h.done;h=p.next())v=h.value,x.handleMessage(v)}catch(e){s={error:e}}finally{try{h&&!h.done&&(m=p.return)&&m.call(p)}finally{if(s)throw s.error}}break;default:if(!o)return void b.default.warn("You received a malformed message from "+i+" of type "+n);var x;u=o.connectionId,(x=this.getConnection(i,u))&&x.peerConnection?x.handleMessage(a):u?this._storeMessage(u,a):b.default.warn("You received an unrecognized message:",a);}},o.prototype._storeMessage=function(r,e){this._lostMessages.has(r)||this._lostMessages.set(r,[]),this._lostMessages.get(r).push(e)},o.prototype._getMessages=function(r){var e=this._lostMessages.get(r);return e?(this._lostMessages.delete(r),e):[]},o.prototype.connect=function(r,e){if(void 0===e&&(e={}),this.disconnected)return b.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(d.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var a=new l.DataConnection(r,this,e);return this._addConnection(r,a),a},o.prototype.call=function(a,e,t){if(void 0===t&&(t={}),this.disconnected)return b.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(d.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(e){t._stream=e;var o=new T.MediaConnection(a,this,t);return this._addConnection(a,o),o}b.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},o.prototype._addConnection=function(r,e){b.default.log("add connection "+e.type+":"+e.connectionId+" to peerId:"+r),this._connections.has(r)||this._connections.set(r,[]),this._connections.get(r).push(e)},o.prototype._removeConnection=function(r){var e=this._connections.get(r.peer);if(e){var t=e.indexOf(r);-1!==t&&e.splice(t,1)}this._lostMessages.delete(r.connectionId)},o.prototype.getConnection=function(n,d){var t=this._connections.get(n),i,p;if(!t)return null;try{for(var l=e(t),s=l.next(),m;!s.done;s=l.next())if(m=s.value,m.connectionId===d)return m}catch(e){i={error:e}}finally{try{s&&!s.done&&(p=l.return)&&p.call(l)}finally{if(i)throw i.error}}return null},o.prototype._delayedAbort=function(r,e){var t=this;setTimeout(function(){t._abort(r,e)},0)},o.prototype._abort=function(r,e){b.default.error("Aborting!"),this.emitError(r,e),this._lastServerId?this.disconnect():this.destroy()},o.prototype.emitError=function(r,e){var t;b.default.error("Error:",e),(t="string"==typeof e?new Error(e):e).type=r,this.emit(d.PeerEventType.Error,t)},o.prototype.destroy=function(){this.destroyed||(b.default.log("Destroy peer with ID:"+this.id),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(d.PeerEventType.Close))},o.prototype._cleanup=function(){var a,n;try{for(var s=e(this._connections.keys()),r=s.next(),d;!r.done;r=s.next())d=r.value,this._cleanupPeer(d),this._connections.delete(d)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}this.socket.removeAllListeners()},o.prototype._cleanupPeer=function(a){var n=this._connections.get(a),o,d;if(n)try{for(var p=e(n),i=p.next();!i.done;i=p.next())i.value.close()}catch(e){o={error:e}}finally{try{i&&!i.done&&(d=p.return)&&d.call(p)}finally{if(o)throw o.error}}},o.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;b.default.log("Disconnect peer with ID:"+t),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit(d.PeerEventType.Disconnected,t)}},o.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)b.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");b.default.error("In a hurry? We're still trying to make the initial connection!")}},o.prototype.listAllPeers=function(r){var a=this;void 0===r&&(r=function(){}),this._api.listAllPeers().then(function(e){return r(e)}).catch(function(t){return a._abort(d.PeerErrorType.ServerError,t)})},o.DEFAULT_KEY="peerjs",o}(o.EventEmitter);y.Peer=p},{eventemitter3:"JJlS","./util":"BHXf","./logger":"WOs9","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"ZRYf","./api":"in7L"}],iTK6:[function(t,a,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=t("./util"),e=t("./peer");o.peerjs={Peer:e.Peer,util:n.util},o.default=e.Peer,window.peerjs=o.peerjs,window.Peer=e.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"],null)(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e=e||self,t(e.COCO={}))})(this,function(e){function t(){}function o(e,t){this.x=e||0,this.y=t||0}function i(e,t,r,a){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0===a?1:a}function s(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function r(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("COCO.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function n(t,a,i,s,d,e,p,l,c,u){Object.defineProperty(this,"id",{value:Vn++}),this.uuid=Ze.generateUUID(),this.name="",this.image=void 0===t?n.DEFAULT_IMAGE:t,this.mipmaps=[],this.mapping=void 0===a?n.DEFAULT_MAPPING:a,this.wrapS=void 0===i?1001:i,this.wrapT=void 0===s?1001:s,this.magFilter=void 0===d?1006:d,this.minFilter=void 0===e?1008:e,this.anisotropy=void 0===c?1:c,this.format=void 0===p?1023:p,this.type=void 0===l?1009:l,this.offset=new o(0,0),this.repeat=new o(1,1),this.center=new o(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new r,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0===u?3E3:u,this.version=0,this.onUpdate=null}function u(e,t,r,a){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0===a?1:a}function p(e,t,r){this.width=e,this.height=t,this.scissor=new u(0,0,e,t),this.scissorTest=!1,this.viewport=new u(0,0,e,t),r=r||{},this.texture=new n(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0===r.minFilter?1006:r.minFilter,this.depthBuffer=!(void 0!==r.depthBuffer)||r.depthBuffer,this.stencilBuffer=!(void 0!==r.stencilBuffer)||r.stencilBuffer,this.depthTexture=void 0===r.depthTexture?null:r.depthTexture}function a(e,t,r){p.call(this,e,t,r),this.samples=4}function _(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("COCO.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function l(e,t,r,a){this._x=e||0,this._y=t||0,this._z=r||0,this._order=a||l.DefaultOrder}function m(){this.mask=1}function y(){Object.defineProperty(this,"id",{value:Xn++}),this.uuid=Ze.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=y.DefaultUp.clone();var e=new s,t=new l,a=new i,o=new s(1,1,1);t._onChange(function(){a.setFromEuler(t,!1)}),a._onChange(function(){t.setFromQuaternion(a,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new _},normalMatrix:{value:new r}}),this.matrix=new _,this.matrixWorld=new _,this.matrixAutoUpdate=y.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new m,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function h(){y.call(this),this.type="Scene",this.overrideMaterial=this.fog=this.background=null,this.autoUpdate=!0,"undefined"!=typeof __COCO_DEVTOOLS__&&__COCO_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function g(e,t){this.min=void 0===e?new s(1/0,1/0,1/0):e,this.max=void 0===t?new s(-Infinity,-Infinity,-Infinity):t}function T(e,t){this.center=void 0===e?new s:e,this.radius=void 0===t?0:t}function L(e,t){this.origin=void 0===e?new s:e,this.direction=void 0===t?new s:t}function D(e,t,r){this.a=void 0===e?new s:e,this.b=void 0===t?new s:t,this.c=void 0===r?new s:r}function v(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function d(e,t,r){return 0>r&&(r+=1),1<r&&--r,r<1/6?e+6*(t-e)*r:.5>r?t:r<2/3?e+6*(t-e)*(2/3-r):e}function c(e){return .04045>e?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function f(e){return .0031308>e?12.92*e:1.055*Math.pow(e,.41666)-.055}function V(t,r,a,o,n,e){this.a=t,this.b=r,this.c=a,this.normal=o&&o.isVector3?o:new s,this.vertexNormals=Array.isArray(o)?o:[],this.color=n&&n.isColor?n:new v,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0===e?0:e}function x(){Object.defineProperty(this,"id",{value:Jn++}),this.uuid=Ze.generateUUID(),this.name="",this.type="Material",this.lights=this.fog=!0,this.blending=1,this.side=0,this.vertexTangents=this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.stencilFunc=519,this.stencilRef=0,this.stencilMask=255,this.stencilZPass=this.stencilZFail=this.stencilFail=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function S(e){x.call(this),this.type="MeshBasicMaterial",this.color=new v(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.lights=this.morphTargets=this.skinning=!1,this.setValues(e)}function C(e,t,r){if(Array.isArray(e))throw new TypeError("COCO.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0===e?0:e.length/t,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function M(e,t,r){C.call(this,new Int8Array(e),t,r)}function w(e,t,r){C.call(this,new Uint8Array(e),t,r)}function A(e,t,r){C.call(this,new Uint8ClampedArray(e),t,r)}function z(e,t,r){C.call(this,new Int16Array(e),t,r)}function k(e,t,r){C.call(this,new Uint16Array(e),t,r)}function G(e,t,r){C.call(this,new Int32Array(e),t,r)}function F(e,t,r){C.call(this,new Uint32Array(e),t,r)}function j(e,t,r){C.call(this,new Float32Array(e),t,r)}function E(e,t,r){C.call(this,new Float64Array(e),t,r)}function b(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function H(e){if(0===e.length)return-Infinity;for(var t=e[0],r=1,a=e.length;r<a;++r)e[r]>t&&(t=e[r]);return t}function Y(){Object.defineProperty(this,"id",{value:Qn+=2}),this.uuid=Ze.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0},this.userData={}}function B(e,t){y.call(this),this.type="Mesh",this.geometry=void 0===e?new Y:e,this.material=void 0===t?new S({color:16777215*Math.random()}):t,this.drawMode=0,this.updateMorphTargets()}function q(){Object.defineProperty(this,"id",{value:Kn+=2}),this.uuid=Ze.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function N(t,r,a,o,n,e){q.call(this),this.type="BoxGeometry",this.parameters={width:t,height:r,depth:a,widthSegments:o,heightSegments:n,depthSegments:e},this.fromBufferGeometry(new Z(t,r,a,o,n,e)),this.mergeVertices()}function Z(t,o,n,i,y,v){function x(o,n,i,l,d,e,u,M,t,C,P){var R=e/t,L=u/C,v=e/2,x=u/2;u=t+1;var y=e=0,A=new s,D,I;for(I=0;I<C+1;I++){var B=I*L-x;for(D=0;D<u;D++)A[o]=(D*R-v)*l,A[n]=B*d,A[i]=M/2,S.push(A.x,A.y,A.z),A[o]=0,A[n]=0,A[i]=0<M?1:-1,m.push(A.x,A.y,A.z),r.push(D/t),r.push(1-I/C),e+=1}for(I=0;I<C;I++)for(D=0;D<t;D++)o=p+D+u*(I+1),n=p+(D+1)+u*(I+1),i=p+(D+1)+u*I,h.push(p+D+u*I,o,i),h.push(o,n,i),y+=6;_.addGroup(E,y,P),E+=y,p+=e}Y.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:o,depth:n,widthSegments:i,heightSegments:y,depthSegments:v};var _=this;t=t||1,o=o||1,n=n||1,i=Math.floor(i)||1,y=Math.floor(y)||1,v=Math.floor(v)||1;var h=[],S=[],m=[],r=[],p=0,E=0;x("z","y","x",-1,-1,n,o,t,v,y,0),x("z","y","x",1,-1,n,o,-t,v,y,1),x("x","z","y",1,1,t,n,o,i,v,2),x("x","z","y",1,-1,t,n,-o,i,v,3),x("x","y","z",1,-1,t,o,n,i,y,4),x("x","y","z",-1,-1,t,o,-n,i,y,5),this.setIndex(h),this.addAttribute("position",new j(S,3)),this.addAttribute("normal",new j(m,3)),this.addAttribute("uv",new j(r,2))}function Q(t){var r={},a;for(a in t)for(var o in r[a]={},t[a]){var n=t[a][o];r[a][o]=n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?n.clone():Array.isArray(n)?n.slice():n}return r}function K(t){for(var r={},a=0;a<t.length;a++){var o=Q(t[a]),n;for(n in o)r[n]=o[n]}return r}function $(e){x.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("COCO.ShaderMaterial: attributes should now be defined in COCO.BufferGeometry instead."),this.setValues(e))}function re(){y.call(this),this.type="Camera",this.matrixWorldInverse=new _,this.projectionMatrix=new _,this.projectionMatrixInverse=new _}function oe(e,t,r,a){re.call(this),this.type="PerspectiveCamera",this.fov=void 0===e?50:e,this.zoom=1,this.near=void 0===r?.1:r,this.far=void 0===a?2E3:a,this.focus=10,this.aspect=void 0===t?1:t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function ne(t,r,a,o){y.call(this),this.type="CubeCamera";var n=new oe(90,1,t,r);n.up.set(0,-1,0),n.lookAt(new s(1,0,0)),this.add(n);var e=new oe(90,1,t,r);e.up.set(0,-1,0),e.lookAt(new s(-1,0,0)),this.add(e);var i=new oe(90,1,t,r);i.up.set(0,0,1),i.lookAt(new s(0,1,0)),this.add(i);var p=new oe(90,1,t,r);p.up.set(0,0,-1),p.lookAt(new s(0,-1,0)),this.add(p);var l=new oe(90,1,t,r);l.up.set(0,-1,0),l.lookAt(new s(0,0,1)),this.add(l);var u=new oe(90,1,t,r);u.up.set(0,-1,0),u.lookAt(new s(0,0,-1)),this.add(u),o=o||{format:1022,magFilter:1006,minFilter:1006},this.renderTarget=new pe(a,a,o),this.renderTarget.texture.name="CubeCamera",this.update=function(t,a){null===this.parent&&this.updateMatrixWorld();var o=t.getRenderTarget(),s=this.renderTarget,d=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,t.setRenderTarget(s,0),t.render(a,n),t.setRenderTarget(s,1),t.render(a,e),t.setRenderTarget(s,2),t.render(a,i),t.setRenderTarget(s,3),t.render(a,p),t.setRenderTarget(s,4),t.render(a,l),s.texture.generateMipmaps=d,t.setRenderTarget(s,5),t.render(a,u),t.setRenderTarget(o)},this.clear=function(t,r,a,o){for(var n=t.getRenderTarget(),e=this.renderTarget,i=0;6>i;i++)t.setRenderTarget(e,i),t.clear(r,a,o);t.setRenderTarget(n)}}function pe(e,t,r){p.call(this,e,t,r)}function _e(t,a,o,i,s,e,d,l,c,u,m,r){n.call(this,null,e,d,l,c,u,i,s,m,r),this.image={data:t,width:a,height:o},this.magFilter=void 0===c?1003:c,this.minFilter=void 0===u?1003:u,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1}function qe(e,t){this.normal=void 0===e?new s(1,0,0):e,this.constant=void 0===t?0:t}function et(t,r,a,o,n,e){this.planes=[void 0===t?new qe:t,void 0===r?new qe:r,void 0===a?new qe:a,void 0===o?new qe:o,void 0===n?new qe:n,void 0===e?new qe:e]}function tt(){function t(n,e){!1!==a&&(o(n,e),r.requestAnimationFrame(t))}var r=null,a=!1,o=null;return{start:function(){!0!==a&&null!==o&&(r.requestAnimationFrame(t),a=!0)},stop:function(){a=!1},setAnimationLoop:function(e){o=e},setContext:function(e){r=e}}}function se(t){function r(r,a){var o=r.array,n=r.dynamic?35048:35044,e=t.createBuffer();return t.bindBuffer(a,e),t.bufferData(a,o,n),r.onUploadCallback(),a=5126,o instanceof Float32Array?a=5126:o instanceof Float64Array?console.warn("COCO.WebGLAttributes: Unsupported data buffer format: Float64Array."):o instanceof Uint16Array?a=5123:o instanceof Int16Array?a=5122:o instanceof Uint32Array?a=5125:o instanceof Int32Array?a=5124:o instanceof Int8Array?a=5120:o instanceof Uint8Array&&(a=5121),{buffer:e,type:a,bytesPerElement:o.BYTES_PER_ELEMENT,version:r.version}}var o=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),o.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var r=o.get(e);r&&(t.deleteBuffer(r.buffer),o.delete(e))},update:function(a,n){a.isInterleavedBufferAttribute&&(a=a.data);var e=o.get(a);if(void 0===e)o.set(a,r(a,n));else if(e.version<a.version){var i=a,s=i.array,p=i.updateRange;t.bindBuffer(n,e.buffer),!1===i.dynamic?t.bufferData(n,s,35044):-1===p.count?t.bufferSubData(n,0,s):0===p.count?console.error("COCO.WebGLObjects.updateBuffer: dynamic COCO.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(n,p.offset*s.BYTES_PER_ELEMENT,s.subarray(p.offset,p.offset+p.count)),p.count=-1),e.version=a.version}}}}function rt(e,t,r,a){q.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:a},this.fromBufferGeometry(new at(e,t,r,a)),this.mergeVertices()}function at(t,o,n,i){Y.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:o,widthSegments:n,heightSegments:i},t=t||1,o=o||1;var s=t/2,y=o/2;n=Math.floor(n)||1,i=Math.floor(i)||1;var v=n+1,g=i+1,x=t/n,_=o/i,m=[],r=[],p=[],u=[];for(t=0;t<g;t++){var l=t*_-y;for(o=0;o<v;o++)r.push(o*x-s,-l,0),p.push(0,0,1),u.push(o/n),u.push(1-t/i)}for(t=0;t<i;t++)for(o=0;o<n;o++)s=o+v*(t+1),y=o+1+v*(t+1),g=o+1+v*t,m.push(o+v*t,s,g),m.push(s,y,g);this.setIndex(m),this.addAttribute("position",new j(r,3)),this.addAttribute("normal",new j(p,3)),this.addAttribute("uv",new j(u,2))}function ot(t,o,a,n){function i(e,t){o.buffers.color.setClear(e.r,e.g,e.b,t,n)}var e=new v(0),s=0,p=null,c=0,u,f;return{getClearColor:function(){return e},setClearColor:function(t,r){e.set(t),s=void 0===r?1:r,i(e,s)},getClearAlpha:function(){return s},setClearAlpha:function(t){s=t,i(e,s)},render:function(r,o,n,m){o=o.background,n=t.vr,(n=n.getSession&&n.getSession())&&"additive"===n.environmentBlendMode&&(o=null),null===o?(i(e,s),p=null,c=0):o&&o.isColor&&(i(o,1),m=!0,p=null,c=0),(t.autoClear||m)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),o&&(o.isCubeTexture||o.isWebGLRenderTargetCube)?(void 0===f&&(f=new B(new Z(1,1,1),new $({type:"BackgroundCubeMaterial",uniforms:Q(I.cube.uniforms),vertexShader:I.cube.vertexShader,fragmentShader:I.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.removeAttribute("normal"),f.geometry.removeAttribute("uv"),f.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(f.material,"map",{get:function(){return this.uniforms.tCube.value}}),a.update(f)),m=o.isWebGLRenderTargetCube?o.texture:o,f.material.uniforms.tCube.value=m,f.material.uniforms.tFlip.value=o.isWebGLRenderTargetCube?1:-1,(p!==o||c!==m.version)&&(f.material.needsUpdate=!0,p=o,c=m.version),r.unshift(f,f.geometry,f.material,0,0,null)):o&&o.isTexture&&(void 0===u&&(u=new B(new at(2,2),new $({type:"BackgroundMaterial",uniforms:Q(I.background.uniforms),vertexShader:I.background.vertexShader,fragmentShader:I.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.removeAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(u)),u.material.uniforms.t2D.value=o,!0===o.matrixAutoUpdate&&o.updateMatrix(),u.material.uniforms.uvTransform.value.copy(o.matrix),(p!==o||c!==o.version)&&(u.material.needsUpdate=!0,p=o,c=o.version),r.unshift(u,u.geometry,u.material,0,0,null))}}}function nt(t,r,a,o){var n;this.setMode=function(e){n=e},this.render=function(e,r){t.drawArrays(n,e,r),a.update(r,n)},this.renderInstances=function(e,i,s){if(o.isWebGL2)var d=t;else if(d=r.get("ANGLE_instanced_arrays"),null===d)return void console.error("COCO.WebGLBufferRenderer: using COCO.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[o.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](n,i,s,e.maxInstancedCount),a.update(s,n,e.maxInstancedCount)}}function it(t,a,o){function i(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,d=void 0===o.precision?"highp":o.precision,f=i(d),y;f!==d&&(console.warn("COCO.WebGLRenderer:",d,"not supported, using",f,"instead."),d=f),o=!0===o.logarithmicDepthBuffer,f=t.getParameter(34930);var x=t.getParameter(35660),_=t.getParameter(3379),m=t.getParameter(34076),r=t.getParameter(34921),p=t.getParameter(36347),u=t.getParameter(36348),l=t.getParameter(36349),b=0<x,v=s||!!a.get("OES_texture_float"),n=s?t.getParameter(36183):0;return{isWebGL2:s,getMaxAnisotropy:function(){if(void 0!==y)return y;var e=a.get("EXT_texture_filter_anisotropic");return y=null===e?0:t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)},getMaxPrecision:i,precision:d,logarithmicDepthBuffer:o,maxTextures:f,maxVertexTextures:x,maxTextureSize:_,maxCubemapSize:m,maxAttributes:r,maxVertexUniforms:p,maxVaryings:u,maxFragmentUniforms:l,vertexTextures:b,floatFragmentTextures:v,floatVertexTextures:b&&v,maxSamples:n}}function st(){function t(){h.value!==i&&(h.value=i,h.needsUpdate=0<s),n.numPlanes=s,n.numIntersection=0}function o(t,r,a,o){var i=null===t?0:t.length,s=null;if(0!==i){if(s=h.value,!0!==o||null===s)for(o=a+4*i,r=r.matrixWorldInverse,l.getNormalMatrix(r),(null===s||s.length<o)&&(s=new Float32Array(o)),o=0;o!==i;++o,a+=4)p.copy(t[o]).applyMatrix4(r,l),p.normal.toArray(s,a),s[a+3]=p.constant;h.value=s,h.needsUpdate=!0}return n.numPlanes=i,s}var n=this,i=null,s=0,u=!1,a=!1,p=new qe,l=new r,h={value:null,needsUpdate:!1};this.uniform=h,this.numIntersection=this.numPlanes=0,this.init=function(e,t,r){var a=0!==e.length||t||0!==s||u;return u=t,i=o(e,r,0),s=e.length,a},this.beginShadows=function(){a=!0,o(null)},this.endShadows=function(){a=!1,t()},this.setState=function(e,n,d,m,l,g){if(!u||null===e||0===e.length||a&&!d)a?o(null):t();else{d=a?0:s;var f=4*d,r=l.clippingState||null;for(h.value=r,r=o(e,m,f,g),e=0;e!==f;++e)r[e]=i[e];l.clippingState=r,this.numIntersection=n?this.numPlanes:0,this.numPlanes+=d}}}function dt(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];switch(r){case"WEBGL_depth_texture":var a=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=e.getExtension(r);}return null===a&&console.warn("COCO.WebGLRenderer: "+r+" extension not supported."),t[r]=a}}}function pt(t,r,o){function n(t){var i=t.target;for(var e in t=s[i.id],null!==t.index&&r.remove(t.index),t.attributes)r.remove(t.attributes[e]);i.removeEventListener("dispose",n),delete s[i.id],(e=p[t.id])&&(r.remove(e),delete p[t.id]),o.memory.geometries--}function i(t){var a=[],o=t.index,n=t.attributes.position;if(null!==o){var i=o.array;o=o.version,n=0;for(var s=i.length;n<s;n+=3){var m=i[n+0],u=i[n+1],g=i[n+2];a.push(m,u,u,g,g,m)}}else for(i=n.array,o=n.version,n=0,s=i.length/3-1;n<s;n+=3)m=n+0,u=n+1,g=n+2,a.push(m,u,u,g,g,m);a=new(65535<H(a)?F:k)(a,1),a.version=o,r.update(a,34963),(i=p[t.id])&&r.remove(i),p[t.id]=a}var s={},p={};return{get:function(t,r){var a=s[r.id];return a?a:(r.addEventListener("dispose",n),r.isBufferGeometry?a=r:r.isGeometry&&(void 0===r._bufferGeometry&&(r._bufferGeometry=new Y().setFromObject(t)),a=r._bufferGeometry),s[r.id]=a,o.memory.geometries++,a)},update:function(t){var o=t.index,n=t.attributes;for(var i in null!==o&&r.update(o,34963),n)r.update(n[i],34962);for(i in t=t.morphAttributes,t){o=t[i],n=0;for(var s=o.length;n<s;n++)r.update(o[n],34962)}},getWireframeAttribute:function(e){var t=p[e.id];if(t){var r=e.index;null!==r&&t.version<r.version&&i(e)}else i(e);return p[e.id]}}}function lt(t,a,o,n){var i,s,p;this.setMode=function(e){i=e},this.setIndex=function(e){s=e.type,p=e.bytesPerElement},this.render=function(e,r){t.drawElements(i,r,s,e*p),o.update(r,i)},this.renderInstances=function(e,d,l){if(n.isWebGL2)var c=t;else if(c=a.get("ANGLE_instanced_arrays"),null===c)return void console.error("COCO.WebGLIndexedBufferRenderer: using COCO.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[n.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](i,l,s,d*p,e.maxInstancedCount),o.update(l,i,e.maxInstancedCount)}}function ct(){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(r,a,o){o=o||1,t.calls++;4===a?t.triangles+=r/3*o:5===a||6===a?t.triangles+=o*(r-2):1===a?t.lines+=r/2*o:3===a?t.lines+=o*(r-1):2===a?t.lines+=o*r:0===a?t.points+=o*r:console.error("COCO.WebGLInfo: Unknown draw mode:",a)}}}function mt(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ut(t){var a={},o=new Float32Array(8);return{update:function(n,i,e,s){var l=n.morphTargetInfluences,c=l.length;if(n=a[i.id],void 0===n){n=[];for(var u=0;u<c;u++)n[u]=[u,0];a[i.id]=n}var g=e.morphTargets&&i.morphAttributes.position;for(e=e.morphNormals&&i.morphAttributes.normal,u=0;u<c;u++){var r=n[u];0!==r[1]&&(g&&i.removeAttribute("morphTarget"+u),e&&i.removeAttribute("morphNormal"+u))}for(u=0;u<c;u++)r=n[u],r[0]=u,r[1]=l[u];for(n.sort(mt),u=0;8>u;u++){if((r=n[u])&&(l=r[0],c=r[1])){g&&i.addAttribute("morphTarget"+u,g[l]),e&&i.addAttribute("morphNormal"+u,e[l]),o[u]=c;continue}o[u]=0}s.getUniforms().setValue(t,"morphTargetInfluences",o)}}}function gt(t,r){var a={};return{update:function(o){var n=r.render.frame,e=o.geometry,i=t.get(o,e);return a[i.id]!==n&&(e.isGeometry&&i.updateFromObject(o),t.update(i),a[i.id]=n),i},dispose:function(){a={}}}}function ft(t,r,o,i,s,e,d,p,l,c){t=void 0===t?[]:t,n.call(this,t,void 0===r?301:r,o,i,s,e,void 0===d?1022:d,p,l,c),this.flipY=!1}function ht(e,t,r,a){n.call(this,null),this.image={data:e,width:t,height:r,depth:a},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1}function yt(e,t,r,a){n.call(this,null),this.image={data:e,width:t,height:r,depth:a},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1}function vt(t,r,a){var o=t[0];if(0>=o||0<o)return t;var n=r*a,i=ai[n];if(void 0===i&&(i=new Float32Array(n),ai[n]=i),0!==r)for(o.toArray(i,0),o=1,n=0;o!==r;++o)n+=a,t[o].toArray(i,n);return i}function xt(e,t){if(e.length!==t.length)return!1;for(var r=0,a=e.length;r<a;r++)if(e[r]!==t[r])return!1;return!0}function _t(e,t){for(var r=0,a=t.length;r<a;r++)e[r]=t[r]}function bt(e,t){var r=oi[t];void 0===r&&(r=new Int32Array(t),oi[t]=r);for(var a=0;a!==t;++a)r[a]=e.allocateTextureUnit();return r}function Tt(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function St(e,t){var r=this.cache;void 0===t.x?xt(r,t)||(e.uniform2fv(this.addr,t),_t(r,t)):(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y)}function Et(e,t){var r=this.cache;void 0===t.x?void 0===t.r?xt(r,t)||(e.uniform3fv(this.addr,t),_t(r,t)):(r[0]!==t.r||r[1]!==t.g||r[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b):(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z)}function Mt(e,t){var r=this.cache;void 0===t.x?xt(r,t)||(e.uniform4fv(this.addr,t),_t(r,t)):(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w)}function Ct(e,t){var r=this.cache,a=t.elements;void 0===a?xt(r,t)||(e.uniformMatrix2fv(this.addr,!1,t),_t(r,t)):xt(r,a)||(si.set(a),e.uniformMatrix2fv(this.addr,!1,si),_t(r,a))}function wt(e,t){var r=this.cache,a=t.elements;void 0===a?xt(r,t)||(e.uniformMatrix3fv(this.addr,!1,t),_t(r,t)):xt(r,a)||(ii.set(a),e.uniformMatrix3fv(this.addr,!1,ii),_t(r,a))}function Pt(e,t){var r=this.cache,a=t.elements;void 0===a?xt(r,t)||(e.uniformMatrix4fv(this.addr,!1,t),_t(r,t)):xt(r,a)||(ni.set(a),e.uniformMatrix4fv(this.addr,!1,ni),_t(r,a))}function Rt(t,r,a){var o=this.cache,n=a.allocateTextureUnit();o[0]!==n&&(t.uniform1i(this.addr,n),o[0]=n),a.safeSetTexture2D(r||Za,n)}function Lt(t,r,a){var o=this.cache,n=a.allocateTextureUnit();o[0]!==n&&(t.uniform1i(this.addr,n),o[0]=n),a.setTexture2DArray(r||ei,n)}function At(t,r,a){var o=this.cache,n=a.allocateTextureUnit();o[0]!==n&&(t.uniform1i(this.addr,n),o[0]=n),a.setTexture3D(r||ti,n)}function Dt(t,r,a){var o=this.cache,n=a.allocateTextureUnit();o[0]!==n&&(t.uniform1i(this.addr,n),o[0]=n),a.safeSetTextureCube(r||ri,n)}function It(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function Bt(e,t){var r=this.cache;xt(r,t)||(e.uniform2iv(this.addr,t),_t(r,t))}function zt(e,t){var r=this.cache;xt(r,t)||(e.uniform3iv(this.addr,t),_t(r,t))}function Nt(e,t){var r=this.cache;xt(r,t)||(e.uniform4iv(this.addr,t),_t(r,t))}function Ot(e){return 5126===e?Tt:35664===e?St:35665===e?Et:35666===e?Mt:35674===e?Ct:35675===e?wt:35676===e?Pt:35678===e||36198===e?Rt:35679===e?At:35680===e?Dt:36289===e?Lt:5124===e||35670===e?It:35667===e||35671===e?Bt:35668===e||35672===e?zt:35669===e||35673===e?Nt:void 0}function kt(e,t){e.uniform1fv(this.addr,t)}function Ut(e,t){e.uniform1iv(this.addr,t)}function Gt(e,t){e.uniform2iv(this.addr,t)}function Ft(e,t){e.uniform3iv(this.addr,t)}function Ht(e,t){e.uniform4iv(this.addr,t)}function Vt(e,t){t=vt(t,this.size,2),e.uniform2fv(this.addr,t)}function Wt(e,t){t=vt(t,this.size,3),e.uniform3fv(this.addr,t)}function jt(e,t){t=vt(t,this.size,4),e.uniform4fv(this.addr,t)}function qt(e,t){t=vt(t,this.size,4),e.uniformMatrix2fv(this.addr,!1,t)}function Xt(e,t){t=vt(t,this.size,9),e.uniformMatrix3fv(this.addr,!1,t)}function Yt(e,t){t=vt(t,this.size,16),e.uniformMatrix4fv(this.addr,!1,t)}function Zt(t,r,o){var n=r.length,i=bt(o,n);for(t.uniform1iv(this.addr,i),t=0;t!==n;++t)o.safeSetTexture2D(r[t]||Za,i[t])}function Jt(t,r,o){var n=r.length,i=bt(o,n);for(t.uniform1iv(this.addr,i),t=0;t!==n;++t)o.safeSetTextureCube(r[t]||ri,i[t])}function Qt(e){return 5126===e?kt:35664===e?Vt:35665===e?Wt:35666===e?jt:35674===e?qt:35675===e?Xt:35676===e?Yt:35678===e?Zt:35680===e?Jt:5124===e||35670===e?Ut:35667===e||35671===e?Gt:35668===e||35672===e?Ft:35669===e||35673===e?Ht:void 0}function Kt(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=Ot(t.type)}function $t(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=Qt(t.type)}function er(e){this.id=e,this.seq=[],this.map={}}function tr(t,a){this.seq=[],this.map={};for(var o=t.getProgramParameter(a,35718),n=0;n<o;++n){var i=t.getActiveUniform(a,n),s=t.getUniformLocation(a,i.name),l=this,c=i.name,f=c.length;for(di.lastIndex=0;;){var y=di.exec(c),m=di.lastIndex,r=y[1],v=y[3];if("]"===y[2]&&(r|=0),void 0===v||"["===v&&m+2===f){c=l,i=void 0===v?new Kt(r,i,s):new $t(r,i,s),c.seq.push(i),c.map[i.id]=i;break}else v=l.map[r],void 0===v&&(v=new er(r),r=l,l=v,r.seq.push(l),r.map[l.id]=l),l=v}}}function rr(e,t,r){return t=e.createShader(t),e.shaderSource(t,r),e.compileShader(t),t}function ar(e){switch(e){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+e);}}function or(t,r,o){var n=t.getShaderParameter(r,35713),i=t.getShaderInfoLog(r).trim();if(n&&""===i)return"";for(t=t.getShaderSource(r).split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t=t.join("\n"),"COCO.WebGLShader: gl.getShaderInfoLog() "+o+"\n"+i+t}function nr(e,t){return t=ar(t),"vec4 "+e+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function ir(e,t){return t=ar(t),"vec4 "+e+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function sr(e,t){switch(t){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="Uncharted2";break;case 4:t="OptimizedCineon";break;case 5:t="ACESFilmic";break;default:throw Error("unsupported toneMapping: "+t);}return"vec3 "+e+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function dr(e,t,r){return e=e||{},[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(lr).join("\n")}function pr(e){var t=[],r;for(r in e){var a=e[r];!1!==a&&t.push("#define "+r+" "+a)}return t.join("\n")}function lr(e){return""!==e}function cr(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function mr(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function ur(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){if(e=$n[t],void 0===e)throw Error("Can not resolve #include <"+t+">");return ur(e)})}function ue(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,r,o,n){for(t="",r=parseInt(r);r<parseInt(o);r++)t+=n.replace(/\[ i \]/g,"[ "+r+" ]");return t})}function gr(t,o,i,s,d,e,c){var x=t.getContext(),h=s.defines,_=d.vertexShader,T=d.fragmentShader,S="SHADOWMAP_TYPE_BASIC";1===e.shadowMapType?S="SHADOWMAP_TYPE_PCF":2===e.shadowMapType&&(S="SHADOWMAP_TYPE_PCF_SOFT");var E="ENVMAP_TYPE_CUBE",M="ENVMAP_MODE_REFLECTION",C="ENVMAP_BLENDING_MULTIPLY";if(e.envMap){switch(s.envMap.mapping){case 301:case 302:E="ENVMAP_TYPE_CUBE";break;case 306:case 307:E="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:E="ENVMAP_TYPE_EQUIREC";break;case 305:E="ENVMAP_TYPE_SPHERE";}switch(s.envMap.mapping){case 302:case 304:M="ENVMAP_MODE_REFRACTION";}switch(s.combine){case 0:C="ENVMAP_BLENDING_MULTIPLY";break;case 1:C="ENVMAP_BLENDING_MIX";break;case 2:C="ENVMAP_BLENDING_ADD";}}var P=0<t.gammaFactor?t.gammaFactor:1,v=c.isWebGL2?"":dr(s.extensions,e,o),n=pr(h),R=x.createProgram();s.isRawShaderMaterial?(h=[n].filter(lr).join("\n"),0<h.length&&(h+="\n"),o=[v,n].filter(lr).join("\n"),0<o.length&&(o+="\n")):(h=["precision "+e.precision+" float;","precision "+e.precision+" int;","#define SHADER_NAME "+d.name,n,e.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+P,"#define MAX_BONES "+e.maxBones,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+M:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.useVertexTexture?"#define BONE_TEXTURE":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&!1===e.flatShading?"#define USE_MORPHNORMALS":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+S:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&(c.isWebGL2||o.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(lr).join("\n"),o=[v,"precision "+e.precision+" float;","precision "+e.precision+" int;","#define SHADER_NAME "+d.name,n,e.alphaTest?"#define ALPHATEST "+e.alphaTest+(e.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+P,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+E:"",e.envMap?"#define "+M:"",e.envMap?"#define "+C:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+S:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&(c.isWebGL2||o.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",e.envMap&&(c.isWebGL2||o.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0===e.toneMapping?"":"#define TONE_MAPPING",0===e.toneMapping?"":$n.tonemapping_pars_fragment,0===e.toneMapping?"":sr("toneMapping",e.toneMapping),e.dithering?"#define DITHERING":"",e.outputEncoding||e.mapEncoding||e.matcapEncoding||e.envMapEncoding||e.emissiveMapEncoding?$n.encodings_pars_fragment:"",e.mapEncoding?nr("mapTexelToLinear",e.mapEncoding):"",e.matcapEncoding?nr("matcapTexelToLinear",e.matcapEncoding):"",e.envMapEncoding?nr("envMapTexelToLinear",e.envMapEncoding):"",e.emissiveMapEncoding?nr("emissiveMapTexelToLinear",e.emissiveMapEncoding):"",e.outputEncoding?ir("linearToOutputTexel",e.outputEncoding):"",e.depthPacking?"#define DEPTH_PACKING "+s.depthPacking:"","\n"].filter(lr).join("\n")),_=ur(_),_=cr(_,e),_=mr(_,e),T=ur(T),T=cr(T,e),T=mr(T,e),_=ue(_),T=ue(T),c.isWebGL2&&!s.isRawShaderMaterial&&(c=!1,S=/^\s*#version\s+300\s+es\s*\n/,s.isShaderMaterial&&null!==_.match(S)&&null!==T.match(S)&&(c=!0,_=_.replace(S,""),T=T.replace(S,"")),h="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+h,o=["#version 300 es\n\n#define varying in",c?"":"out highp vec4 pc_fragColor;",c?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+o),T=o+T,_=rr(x,35633,h+_),T=rr(x,35632,T),x.attachShader(R,_),x.attachShader(R,T),void 0===s.index0AttributeName?!0===e.morphTargets&&x.bindAttribLocation(R,0,"position"):x.bindAttribLocation(R,0,s.index0AttributeName),x.linkProgram(R),t.debug.checkShaderErrors&&(t=x.getProgramInfoLog(R).trim(),e=x.getShaderInfoLog(_).trim(),c=x.getShaderInfoLog(T).trim(),E=S=!0,!1===x.getProgramParameter(R,35714)?(S=!1,M=or(x,_,"vertex"),C=or(x,T,"fragment"),console.error("COCO.WebGLProgram: shader error: ",x.getError(),"35715",x.getProgramParameter(R,35715),"gl.getProgramInfoLog",t,M,C)):""===t?(""===e||""===c)&&(E=!1):console.warn("COCO.WebGLProgram: gl.getProgramInfoLog()",t),E&&(this.diagnostics={runnable:S,material:s,programLog:t,vertexShader:{log:e,prefix:h},fragmentShader:{log:c,prefix:o}})),x.deleteShader(_),x.deleteShader(T);var w;this.getUniforms=function(){return void 0===w&&(w=new tr(x,R)),w};var L;return this.getAttributes=function(){if(void 0===L){for(var e={},t=x.getProgramParameter(R,35721),r=0,a;r<t;r++)a=x.getActiveAttrib(R,r).name,e[a]=x.getAttribLocation(R,a);L=e}return L},this.destroy=function(){x.deleteProgram(R),this.program=void 0},this.name=d.name,this.id=te++,this.code=i,this.usedTimes=1,this.program=R,this.vertexShader=_,this.fragmentShader=T,this}function fr(o,t,a){function n(e,t){if(e)e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("COCO.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding);else var r=3E3;return 3E3===r&&t&&(r=3007),r}var i=[],s={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},r=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(i,d,e,c,r,p,u){var l=s[i.type];if(u.isSkinnedMesh){var g=u.skeleton.bones;if(a.floatVertexTextures)g=1024;else{var f=Math.min(Math.floor((a.maxVertexUniforms-20)/4),g.length);f<g.length?(console.warn("COCO.WebGLRenderer: Skeleton has "+g.length+" bones. This GPU supports "+f+"."),g=0):g=f}}else g=0;f=a.precision,null!==i.precision&&(f=a.getMaxPrecision(i.precision),f!==i.precision&&console.warn("COCO.WebGLProgram.getParameters:",i.precision,"not supported, using",f,"instead."));var h=o.getRenderTarget();return{shaderID:l,precision:f,supportsVertexTextures:a.vertexTextures,outputEncoding:n(h?h.texture:null,o.gammaOutput),map:!!i.map,mapEncoding:n(i.map,o.gammaInput),matcap:!!i.matcap,matcapEncoding:n(i.matcap,o.gammaInput),envMap:!!i.envMap,envMapMode:i.envMap&&i.envMap.mapping,envMapEncoding:n(i.envMap,o.gammaInput),envMapCubeUV:!!i.envMap&&(306===i.envMap.mapping||307===i.envMap.mapping),lightMap:!!i.lightMap,aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:n(i.emissiveMap,o.gammaInput),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,fog:!!c,useFog:i.fog,fogExp:c&&c.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:a.logarithmicDepthBuffer,skinning:i.skinning&&0<g,maxBones:g,useVertexTexture:a.floatVertexTextures,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:o.maxMorphTargets,maxMorphNormals:o.maxMorphNormals,numDirLights:d.directional.length,numPointLights:d.point.length,numSpotLights:d.spot.length,numRectAreaLights:d.rectArea.length,numHemiLights:d.hemi.length,numClippingPlanes:r,numClipIntersection:p,dithering:i.dithering,shadowMapEnabled:o.shadowMap.enabled&&u.receiveShadow&&0<e.length,shadowMapType:o.shadowMap.type,toneMapping:o.toneMapping,physicallyCorrectLights:o.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking}},this.getProgramCode=function(t,a){var n=[];if(a.shaderID?n.push(a.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);for(i=0;i<r.length;i++)n.push(a[r[i]]);return n.push(t.onBeforeCompile.toString()),n.push(o.gammaOutput),n.push(o.gammaFactor),n.join()},this.acquireProgram=function(e,n,s,d){for(var r=0,p=i.length,c,m;r<p;r++)if(m=i[r],m.code===d){c=m,++c.usedTimes;break}return void 0===c&&(c=new gr(o,t,d,e,n,s,a),i.push(c)),c},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=i.indexOf(e);i[t]=i[i.length-1],i.pop(),e.destroy()}},this.programs=i}function hr(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,a){e.get(t)[r]=a},dispose:function(){e=new WeakMap}}}function yr(e,t){return e.groupOrder===t.groupOrder?e.renderOrder===t.renderOrder?e.program===t.program?e.material.id===t.material.id?e.z===t.z?e.id-t.id:e.z-t.z:e.material.id-t.material.id:e.program.id-t.program.id:e.renderOrder-t.renderOrder:e.groupOrder-t.groupOrder}function vr(e,t){return e.groupOrder===t.groupOrder?e.renderOrder===t.renderOrder?e.z===t.z?e.id-t.id:t.z-e.z:e.renderOrder-t.renderOrder:e.groupOrder-t.groupOrder}function xr(){function t(t,a,i,e,d,r){var p=o[n];return void 0===p?(p={id:t.id,object:t,geometry:a,material:i,program:i.program||s,groupOrder:e,renderOrder:t.renderOrder,z:d,group:r},o[n]=p):(p.id=t.id,p.object=t,p.geometry=a,p.material=i,p.program=i.program||s,p.groupOrder=e,p.renderOrder=t.renderOrder,p.z=d,p.group=r),n++,p}var o=[],n=0,a=[],i=[],s={id:-1};return{opaque:a,transparent:i,init:function(){n=0,a.length=0,i.length=0},push:function(e,o,n,s,d,r){e=t(e,o,n,s,d,r),(!0===n.transparent?i:a).push(e)},unshift:function(e,o,n,s,d,r){e=t(e,o,n,s,d,r),(!0===n.transparent?i:a).unshift(e)},sort:function(){1<a.length&&a.sort(yr),1<i.length&&i.sort(vr)}}}function _r(){function e(r){r=r.target,r.removeEventListener("dispose",e),delete t[r.id]}var t={};return{get:function(r,a){var o=t[r.id];if(void 0===o){var n=new xr;t[r.id]={},t[r.id][a.id]=n,r.addEventListener("dispose",e)}else n=o[a.id],void 0===n&&(n=new xr,o[a.id]=n);return n},dispose:function(){t={}}}}function br(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":var r={direction:new s,color:new v,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new o};break;case"SpotLight":r={position:new s,direction:new s,color:new v,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new o};break;case"PointLight":r={position:new s,color:new v,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new o,shadowCameraNear:1,shadowCameraFar:1E3};break;case"HemisphereLight":r={direction:new s,skyColor:new v,groundColor:new v};break;case"RectAreaLight":r={color:new v,position:new s,halfWidth:new s,halfHeight:new s};}return e[t.id]=r}}}function Tr(){for(var t=new br,a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=0;9>r;r++)a.probe.push(new s);var o=new s,i=new _,e=new _;return{setup:function(s,d,m){for(var f=0,h=0,x=0,_=0;9>_;_++)a.probe[_].set(0,0,0);var b=0,T=0,S=0,E=0,M=0;m=m.matrixWorldInverse,_=0;for(var C=s.length;_<C;_++){var w=s[_],y=w.color,P=w.intensity,R=w.distance,L=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)f+=y.r*P,h+=y.g*P,x+=y.b*P;else if(w.isLightProbe)for(L=0;9>L;L++)a.probe[L].addScaledVector(w.sh.coefficients[L],P);else if(w.isDirectionalLight){var D=t.get(w);D.color.copy(w.color).multiplyScalar(w.intensity),D.direction.setFromMatrixPosition(w.matrixWorld),o.setFromMatrixPosition(w.target.matrixWorld),D.direction.sub(o),D.direction.transformDirection(m),(D.shadow=w.castShadow)&&(P=w.shadow,D.shadowBias=P.bias,D.shadowRadius=P.radius,D.shadowMapSize=P.mapSize),a.directionalShadowMap[b]=L,a.directionalShadowMatrix[b]=w.shadow.matrix,a.directional[b]=D,b++}else w.isSpotLight?(D=t.get(w),D.position.setFromMatrixPosition(w.matrixWorld),D.position.applyMatrix4(m),D.color.copy(y).multiplyScalar(P),D.distance=R,D.direction.setFromMatrixPosition(w.matrixWorld),o.setFromMatrixPosition(w.target.matrixWorld),D.direction.sub(o),D.direction.transformDirection(m),D.coneCos=Math.cos(w.angle),D.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),D.decay=w.decay,(D.shadow=w.castShadow)&&(P=w.shadow,D.shadowBias=P.bias,D.shadowRadius=P.radius,D.shadowMapSize=P.mapSize),a.spotShadowMap[S]=L,a.spotShadowMatrix[S]=w.shadow.matrix,a.spot[S]=D,S++):w.isRectAreaLight?(D=t.get(w),D.color.copy(y).multiplyScalar(P),D.position.setFromMatrixPosition(w.matrixWorld),D.position.applyMatrix4(m),e.identity(),i.copy(w.matrixWorld),i.premultiply(m),e.extractRotation(i),D.halfWidth.set(.5*w.width,0,0),D.halfHeight.set(0,.5*w.height,0),D.halfWidth.applyMatrix4(e),D.halfHeight.applyMatrix4(e),a.rectArea[E]=D,E++):w.isPointLight?(D=t.get(w),D.position.setFromMatrixPosition(w.matrixWorld),D.position.applyMatrix4(m),D.color.copy(w.color).multiplyScalar(w.intensity),D.distance=w.distance,D.decay=w.decay,(D.shadow=w.castShadow)&&(P=w.shadow,D.shadowBias=P.bias,D.shadowRadius=P.radius,D.shadowMapSize=P.mapSize,D.shadowCameraNear=P.camera.near,D.shadowCameraFar=P.camera.far),a.pointShadowMap[T]=L,a.pointShadowMatrix[T]=w.shadow.matrix,a.point[T]=D,T++):w.isHemisphereLight&&(D=t.get(w),D.direction.setFromMatrixPosition(w.matrixWorld),D.direction.transformDirection(m),D.direction.normalize(),D.skyColor.copy(w.color).multiplyScalar(P),D.groundColor.copy(w.groundColor).multiplyScalar(P),a.hemi[M]=D,M++)}a.ambient[0]=f,a.ambient[1]=h,a.ambient[2]=x,s=a.hash,(s.directionalLength!==b||s.pointLength!==T||s.spotLength!==S||s.rectAreaLength!==E||s.hemiLength!==M||s.shadowsLength!==d.length)&&(a.directional.length=b,a.spot.length=S,a.rectArea.length=E,a.point.length=T,a.hemi.length=M,s.directionalLength=b,s.pointLength=T,s.spotLength=S,s.rectAreaLength=E,s.hemiLength=M,s.shadowsLength=d.length,a.version=pi++)},state:a}}function Sr(){var e=new Tr,t=[],r=[];return{init:function(){t.length=0,r.length=0},state:{lightsArray:t,shadowsArray:r,lights:e},setupLights:function(a){e.setup(t,r,a)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function Er(){function t(e){e=e.target,e.removeEventListener("dispose",t),delete r[e.id]}var r={};return{get:function(a,o){if(void 0===r[a.id]){var n=new Sr;r[a.id]={},r[a.id][o.id]=n,a.addEventListener("dispose",t)}else void 0===r[a.id][o.id]?(n=new Sr,r[a.id][o.id]=n):n=r[a.id][o.id];return n},dispose:function(){r={}}}}function Mr(e){x.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.setValues(e)}function Cr(e){x.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new s,this.nearDistance=1,this.farDistance=1E3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.lights=this.fog=!1,this.setValues(e)}function wr(i,a,n){function b(a,o,n,s,e,d){var p=a.geometry,c=r,u=a.customDepthMaterial;return n&&(c=T,u=a.customDistanceMaterial),u?c=u:(u=!1,o.morphTargets&&(p&&p.isBufferGeometry?u=p.morphAttributes&&p.morphAttributes.position&&0<p.morphAttributes.position.length:p&&p.isGeometry&&(u=p.morphTargets&&0<p.morphTargets.length)),a.isSkinnedMesh&&!1===o.skinning&&console.warn("COCO.WebGLShadowMap: COCO.SkinnedMesh with material.skinning set to false:",a),a=a.isSkinnedMesh&&o.skinning,p=0,u&&(p|=1),a&&(p|=2),c=c[p]),i.localClippingEnabled&&!0===o.clipShadows&&0!==o.clippingPlanes.length&&(p=c.uuid,u=o.uuid,a=l[p],void 0===a&&(a={},l[p]=a),p=a[u],void 0===p&&(p=c.clone(),a[u]=p),c=p),c.visible=o.visible,c.wireframe=o.wireframe,c.side=null==o.shadowSide?t[o.side]:o.shadowSide,c.clipShadows=o.clipShadows,c.clippingPlanes=o.clippingPlanes,c.clipIntersection=o.clipIntersection,c.wireframeLinewidth=o.wireframeLinewidth,c.linewidth=o.linewidth,n&&c.isMeshDistanceMaterial&&(c.referencePosition.copy(s),c.nearDistance=e,c.farDistance=d),c}function S(r,o,n,s){if(!1!==r.visible){if(r.layers.test(o.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||e.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,r.matrixWorld);var d=a.update(r),g=r.material;if(Array.isArray(g))for(var f=d.groups,l=0,h=f.length;l<h;l++){var t=f[l],y=g[t.materialIndex];y&&y.visible&&(y=b(r,y,s,M,n.near,n.far),i.renderBufferDirect(n,null,d,y,r,t))}else g.visible&&(y=b(r,g,s,M,n.near,n.far),i.renderBufferDirect(n,null,d,y,r,null))}for(r=r.children,d=0,g=r.length;d<g;d++)S(r[d],o,n,s)}}var e=new et,f=new _,g=new o,h=new o(n,n),E=new s,M=new s,r=[,,,,],T=[,,,,],l={},t={0:1,1:0,2:2},m=[new s(1,0,0),new s(-1,0,0),new s(0,0,1),new s(0,0,-1),new s(0,1,0),new s(0,-1,0)],v=[new s(0,1,0),new s(0,1,0),new s(0,1,0),new s(0,1,0),new s(0,0,1),new s(0,0,-1)],x=[new u,new u,new u,new u,new u,new u];for(n=0;4!==n;++n){var d=0!=(1&n),C=0!=(2&n),y=new Mr({depthPacking:3201,morphTargets:d,skinning:C});r[n]=y,d=new Cr({morphTargets:d,skinning:C}),T[n]=d}var P=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(r,a,o){if(!1!==P.enabled&&(!1!==P.autoUpdate||!1!==P.needsUpdate)&&0!==r.length){var s=i.getRenderTarget(),d=i.getActiveCubeFace(),l=i.getActiveMipmapLevel(),c=i.state;c.setBlending(0),c.buffers.color.setClear(1,1,1,1),c.buffers.depth.setTest(!0),c.setScissorTest(!1);for(var u=0,_=r.length,b,C;u<_;u++){C=r[u],b=C.shadow;var R=C&&C.isPointLight;if(void 0===b)console.warn("COCO.WebGLShadowMap:",C,"has no shadow.");else{var y=b.camera;if(g.copy(b.mapSize),g.min(h),R){var w=g.x,L=g.y;x[0].set(2*w,L,w,L),x[1].set(0,L,w,L),x[2].set(3*w,L,w,L),x[3].set(w,L,w,L),x[4].set(3*w,0,w,L),x[5].set(w,0,w,L),g.x*=4,g.y*=2}for(null===b.map&&(b.map=new p(g.x,g.y,{minFilter:1003,magFilter:1003,format:1023}),b.map.texture.name=C.name+".shadowMap",y.updateProjectionMatrix()),b.isSpotLightShadow&&b.update(C),w=b.map,L=b.matrix,M.setFromMatrixPosition(C.matrixWorld),y.position.copy(M),R?(b=6,L.makeTranslation(-M.x,-M.y,-M.z)):(b=1,E.setFromMatrixPosition(C.target.matrixWorld),y.lookAt(E),y.updateMatrixWorld(),L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),L.multiply(y.projectionMatrix),L.multiply(y.matrixWorldInverse)),i.setRenderTarget(w),i.clear(),C=0;C<b;C++)R&&(E.copy(y.position),E.add(m[C]),y.up.copy(v[C]),y.lookAt(E),y.updateMatrixWorld(),c.viewport(x[C])),f.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),e.setFromMatrix(f),S(a,o,y,R)}}P.needsUpdate=!1,i.setRenderTarget(s,d,l)}}}function Pr(o,a,i,s){function d(t,r,a){var n=new Uint8Array(4),e=o.createTexture();for(o.bindTexture(t,e),o.texParameteri(t,10241,9728),o.texParameteri(t,10240,9728),t=0;t<a;t++)o.texImage2D(r+t,0,6408,1,1,0,6408,5121,n);return e}function e(t,r){_[t]=1,0===S[t]&&(o.enableVertexAttribArray(t),S[t]=1),b[t]!==r&&((s.isWebGL2?o:a.get("ANGLE_instanced_arrays"))[s.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](t,r),b[t]=r)}function x(e){!0!==y[e]&&(o.enable(e),y[e]=!0)}function g(e){!1!==y[e]&&(o.disable(e),y[e]=!1)}function f(t,a,n,e,s,d,l,c){0===t?P&&(g(3042),P=!1):(P||(x(3042),P=!0),5!==t)?(t!==R||c!==j)&&((100!==L||100!==U)&&(o.blendEquation(32774),U=L=100),c?1===t?o.blendFuncSeparate(1,771,1,771):2===t?o.blendFunc(1,1):3===t?o.blendFuncSeparate(0,0,769,771):4===t?o.blendFuncSeparate(0,768,0,770):console.error("COCO.WebGLState: Invalid blending: ",t):1===t?o.blendFuncSeparate(770,771,1,771):2===t?o.blendFunc(770,1):3===t?o.blendFunc(0,769):4===t?o.blendFunc(0,768):console.error("COCO.WebGLState: Invalid blending: ",t),W=V=O=A=null,R=t,j=c):(s=s||a,d=d||n,l=l||e,(a!==L||s!==U)&&(o.blendEquationSeparate(i.convert(a),i.convert(s)),L=a,U=s),(n!==A||e!==O||d!==V||l!==W)&&(o.blendFuncSeparate(i.convert(n),i.convert(e),i.convert(d),i.convert(l)),A=n,O=e,V=d,W=l),R=t,j=null)}function h(e){k!==e&&(e?o.frontFace(2304):o.frontFace(2305),k=e)}function c(e){0===e?g(2884):(x(2884),e!==q&&(1===e?o.cullFace(1029):2===e?o.cullFace(1028):o.cullFace(1032))),q=e}function r(e,t,r){e?(x(32823),Y!==t||$!==r)&&(o.polygonOffset(t,r),Y=t,$=r):g(32823)}function p(e){void 0===e&&(e=33984+ee-1),te!==e&&(o.activeTexture(e),te=e)}var l=new function(){var t=!1,r=new u,a=null,n=new u(0,0,0,0);return{setMask:function(e){a===e||t||(o.colorMask(e,e,e,e),a=e)},setLocked:function(e){t=e},setClear:function(e,t,a,i,s){!0===s&&(e*=i,t*=i,a*=i),r.set(e,t,a,i),!1===n.equals(r)&&(o.clearColor(e,t,a,i),n.copy(r))},reset:function(){t=!1,a=null,n.set(-1,0,0,0)}}},t=new function(){var t=!1,r=null,a=null,n=null;return{setTest:function(e){e?x(2929):g(2929)},setMask:function(e){r===e||t||(o.depthMask(e),r=e)},setFunc:function(e){a!==e&&(e?0===e?o.depthFunc(512):1===e?o.depthFunc(519):2===e?o.depthFunc(513):3===e?o.depthFunc(515):4===e?o.depthFunc(514):5===e?o.depthFunc(518):6===e?o.depthFunc(516):7===e?o.depthFunc(517):o.depthFunc(515):o.depthFunc(515),a=e)},setLocked:function(e){t=e},setClear:function(e){n!==e&&(o.clearDepth(e),n=e)},reset:function(){t=!1,n=a=r=null}}},m=new function(){var t=!1,a=null,n=null,i=null,s=null,l=null,u=null,h=null,y=null;return{setTest:function(e){e?x(2960):g(2960)},setMask:function(e){a===e||t||(o.stencilMask(e),a=e)},setFunc:function(e,t,r){(n!==e||i!==t||s!==r)&&(o.stencilFunc(e,t,r),n=e,i=t,s=r)},setOp:function(e,t,r){(l!==e||u!==t||h!==r)&&(o.stencilOp(e,t,r),l=e,u=t,h=r)},setLocked:function(e){t=e},setClear:function(e){y!==e&&(o.clearStencil(e),y=e)},reset:function(){t=!1,y=h=u=l=s=i=n=a=null}}},v=o.getParameter(34921),_=new Uint8Array(v),S=new Uint8Array(v),b=new Uint8Array(v),y={},M=null,w=null,P=null,R=null,L=null,A=null,O=null,U=null,V=null,W=null,j=!1,k=null,q=null,X=null,Y=null,$=null,ee=o.getParameter(35661),B=!1;v=0,v=o.getParameter(7938),-1===v.indexOf("WebGL")?-1!==v.indexOf("OpenGL ES")&&(v=parseFloat(/^OpenGL ES ([0-9])/.exec(v)[1]),B=2<=v):(v=parseFloat(/^WebGL ([0-9])/.exec(v)[1]),B=1<=v);var te=null,re={},ae=new u,Q=new u,N={};return N[3553]=d(3553,3553,1),N[34067]=d(34067,34069,6),l.setClear(0,0,0,1),t.setClear(1),m.setClear(0),x(2929),t.setFunc(3),h(!1),c(1),x(2884),f(0),{buffers:{color:l,depth:t,stencil:m},initAttributes:function(){for(var e=0,t=_.length;e<t;e++)_[e]=0},enableAttribute:function(t){e(t,0)},enableAttributeAndDivisor:e,disableUnusedAttributes:function(){for(var e=0,t=S.length;e!==t;++e)S[e]!==_[e]&&(o.disableVertexAttribArray(e),S[e]=0)},enable:x,disable:g,getCompressedTextureFormats:function(){if(null===M&&(M=[],a.get("WEBGL_compressed_texture_pvrtc")||a.get("WEBGL_compressed_texture_s3tc")||a.get("WEBGL_compressed_texture_etc1")||a.get("WEBGL_compressed_texture_astc")))for(var e=o.getParameter(34467),t=0;t<e.length;t++)M.push(e[t]);return M},useProgram:function(e){return w!==e&&(o.useProgram(e),w=e,!0)},setBlending:f,setMaterial:function(e,a){2===e.side?g(2884):x(2884);var o=1===e.side;a&&(o=!o),h(o),1===e.blending&&!1===e.transparent?f(0):f(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),t.setFunc(e.depthFunc),t.setTest(e.depthTest),t.setMask(e.depthWrite),l.setMask(e.colorWrite),a=e.stencilWrite,m.setTest(a),a&&(m.setFunc(e.stencilFunc,e.stencilRef,e.stencilMask),m.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),r(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:h,setCullFace:c,setLineWidth:function(e){e!==X&&(B&&o.lineWidth(e),X=e)},setPolygonOffset:r,setScissorTest:function(e){e?x(3089):g(3089)},activeTexture:p,bindTexture:function(e,t){null===te&&p();var r=re[te];void 0===r&&(r={type:void 0,texture:void 0},re[te]=r),(r.type!==e||r.texture!==t)&&(o.bindTexture(e,t||N[e]),r.type=e,r.texture=t)},compressedTexImage2D:function(){try{o.compressedTexImage2D.apply(o,arguments)}catch(e){console.error("COCO.WebGLState:",e)}},texImage2D:function(){try{o.texImage2D.apply(o,arguments)}catch(e){console.error("COCO.WebGLState:",e)}},texImage3D:function(){try{o.texImage3D.apply(o,arguments)}catch(e){console.error("COCO.WebGLState:",e)}},scissor:function(e){!1===ae.equals(e)&&(o.scissor(e.x,e.y,e.z,e.w),ae.copy(e))},viewport:function(e){!1===Q.equals(e)&&(o.viewport(e.x,e.y,e.z,e.w),Q.copy(e))},reset:function(){for(var e=0;e<S.length;e++)1===S[e]&&(o.disableVertexAttribArray(e),S[e]=0);y={},te=M=null,re={},q=k=R=w=null,l.reset(),t.reset(),m.reset()}}}function Rr(o,i,s,_,S,a,d){function u(e,t){return P?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function e(t,r,a,o){var n=1;if((t.width>o||t.height>o)&&(n=o/Math.max(t.width,t.height)),1>n||!0===r){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap)return o=r?Ze.floorPowerOfTwo:Math.floor,r=o(n*t.width),n=o(n*t.height),void 0===A&&(A=u(r,n)),a=a?u(r,n):A,a.width=r,a.height=n,a.getContext("2d").drawImage(t,0,0,r,n),console.warn("COCO.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+r+"x"+n+")."),a;"data"in t&&console.warn("COCO.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+").")}return t}function c(e){return Ze.isPowerOfTwo(e.width)&&Ze.isPowerOfTwo(e.height)}function m(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function r(t,r,a,e){o.generateMipmap(t),_.get(r).__maxMipLevel=Math.log(Math.max(a,e))*Math.LOG2E}function f(e,t){if(!S.isWebGL2)return e;var r=e;return 6403===e&&(5126===t&&(r=33326),5131===t&&(r=33325),5121===t&&(r=33321)),6407===e&&(5126===t&&(r=34837),5131===t&&(r=34843),5121===t&&(r=32849)),6408===e&&(5126===t&&(r=34836),5131===t&&(r=34842),5121===t&&(r=32856)),33325===r||33326===r||34842===r||34836===r?i.get("EXT_color_buffer_float"):(34843===r||34837===r)&&console.warn("COCO.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),r}function p(e){return 1003===e||1004===e||1005===e?9728:9729}function t(e){e=e.target,e.removeEventListener("dispose",t);var r=_.get(e);void 0!==r.__webglInit&&(o.deleteTexture(r.__webglTexture),_.remove(e)),e.isVideoTexture&&delete x[e.id],d.memory.textures--}function l(t){t=t.target,t.removeEventListener("dispose",l);var r=_.get(t),a=_.get(t.texture);if(t){if(void 0!==a.__webglTexture&&o.deleteTexture(a.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(a=0;6>a;a++)o.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&o.deleteRenderbuffer(r.__webglDepthbuffer[a]);else o.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&o.deleteRenderbuffer(r.__webglDepthbuffer);_.remove(t.texture),_.remove(t)}d.memory.textures--}function g(t,r){var a=_.get(t);if(t.isVideoTexture){var e=t.id,o=d.render.frame;x[e]!==o&&(x[e]=o,t.update())}if(0<t.version&&a.__version!==t.version)if(e=t.image,void 0===e)console.warn("COCO.WebGLRenderer: Texture marked for update but image is undefined");else if(!1===e.complete)console.warn("COCO.WebGLRenderer: Texture marked for update but image is incomplete");else return void v(a,t,r);s.activeTexture(33984+r),s.bindTexture(3553,a.__webglTexture)}function n(i,d){var p=_.get(i);if(6===i.image.length)if(0<i.version&&p.__version!==i.version){y(p,i),s.activeTexture(33984+d),s.bindTexture(34067,p.__webglTexture),o.pixelStorei(37440,i.flipY),d=i&&i.isCompressedTexture;for(var l=i.image[0]&&i.image[0].isDataTexture,u=[],t=0;6>t;t++)u[t]=d||l?l?i.image[t].image:i.image[t]:e(i.image[t],!1,!0,S.maxCubemapSize);var h=u[0],v=c(h)||S.isWebGL2,n=a.convert(i.format),x=a.convert(i.type),b=f(n,x);for(M(34067,i,v),t=0;6>t;t++)if(d)for(var T=u[t].mipmaps,E=0,C=T.length,w;E<C;E++)w=T[E],1023!==i.format&&1022!==i.format?-1<s.getCompressedTextureFormats().indexOf(n)?s.compressedTexImage2D(34069+t,E,b,w.width,w.height,0,w.data):console.warn("COCO.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):s.texImage2D(34069+t,E,b,w.width,w.height,0,n,x,w.data);else l?s.texImage2D(34069+t,0,b,u[t].width,u[t].height,0,n,x,u[t].data):s.texImage2D(34069+t,0,b,n,x,u[t]);p.__maxMipLevel=d?T.length-1:0,m(i,v)&&r(34067,i,h.width,h.height),p.__version=i.version,i.onUpdate&&i.onUpdate(i)}else s.activeTexture(33984+d),s.bindTexture(34067,p.__webglTexture)}function h(e,t){s.activeTexture(33984+t),s.bindTexture(34067,_.get(e).__webglTexture)}function M(e,t,r){r?(o.texParameteri(e,10242,a.convert(t.wrapS)),o.texParameteri(e,10243,a.convert(t.wrapT)),32879!==e&&35866!==e||o.texParameteri(e,32882,a.convert(t.wrapR)),o.texParameteri(e,10240,a.convert(t.magFilter)),o.texParameteri(e,10241,a.convert(t.minFilter))):(o.texParameteri(e,10242,33071),o.texParameteri(e,10243,33071),32879!==e&&35866!==e||o.texParameteri(e,32882,33071),1001===t.wrapS&&1001===t.wrapT||console.warn("COCO.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to COCO.ClampToEdgeWrapping."),o.texParameteri(e,10240,p(t.magFilter)),o.texParameteri(e,10241,p(t.minFilter)),1003!==t.minFilter&&1006!==t.minFilter&&console.warn("COCO.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to COCO.NearestFilter or COCO.LinearFilter.")),(r=i.get("EXT_texture_filter_anisotropic"))&&(1015!==t.type||null!==i.get("OES_texture_float_linear"))&&(1016!==t.type||null!==(S.isWebGL2||i.get("OES_texture_half_float_linear")))&&(1<t.anisotropy||_.get(t).__currentAnisotropy)&&(o.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,S.getMaxAnisotropy())),_.get(t).__currentAnisotropy=t.anisotropy)}function y(e,r){void 0===e.__webglInit&&(e.__webglInit=!0,r.addEventListener("dispose",t),e.__webglTexture=o.createTexture(),d.memory.textures++)}function v(i,p,d){var l=3553;p.isDataTexture2DArray&&(l=35866),p.isDataTexture3D&&(l=32879),y(i,p),s.activeTexture(33984+d),s.bindTexture(l,i.__webglTexture),o.pixelStorei(37440,p.flipY),o.pixelStorei(37441,p.premultiplyAlpha),o.pixelStorei(3317,p.unpackAlignment),d=!S.isWebGL2&&(1001!==p.wrapS||1001!==p.wrapT||1003!==p.minFilter&&1006!==p.minFilter),d=d&&!1===c(p.image),d=e(p.image,d,!1,S.maxTextureSize);var _=c(d)||S.isWebGL2,u=a.convert(p.format),b=a.convert(p.type),T=f(u,b);M(l,p,_);var E=p.mipmaps;if(p.isDepthTexture){if(T=6402,1015===p.type){if(!S.isWebGL2)throw Error("Float Depth Texture only supported in WebGL2.0");T=36012}else S.isWebGL2&&(T=33189);1026===p.format&&6402===T&&1012!==p.type&&1014!==p.type&&(console.warn("COCO.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),p.type=1012,b=a.convert(p.type)),1027===p.format&&(T=34041,1020!==p.type&&(console.warn("COCO.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),p.type=1020,b=a.convert(p.type))),s.texImage2D(3553,0,T,d.width,d.height,0,u,b,null)}else if(p.isDataTexture){if(0<E.length&&_){for(var n=0,C=E.length;n<C;n++)l=E[n],s.texImage2D(3553,n,T,l.width,l.height,0,u,b,l.data);p.generateMipmaps=!1,i.__maxMipLevel=E.length-1}else s.texImage2D(3553,0,T,d.width,d.height,0,u,b,d.data),i.__maxMipLevel=0;}else if(p.isCompressedTexture){for(n=0,C=E.length;n<C;n++)l=E[n],1023!==p.format&&1022!==p.format?-1<s.getCompressedTextureFormats().indexOf(u)?s.compressedTexImage2D(3553,n,T,l.width,l.height,0,l.data):console.warn("COCO.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):s.texImage2D(3553,n,T,l.width,l.height,0,u,b,l.data);i.__maxMipLevel=E.length-1}else if(p.isDataTexture2DArray)s.texImage3D(35866,0,T,d.width,d.height,d.depth,0,u,b,d.data),i.__maxMipLevel=0;else if(p.isDataTexture3D)s.texImage3D(32879,0,T,d.width,d.height,d.depth,0,u,b,d.data),i.__maxMipLevel=0;else if(0<E.length&&_){for(n=0,C=E.length;n<C;n++)l=E[n],s.texImage2D(3553,n,T,u,b,l);p.generateMipmaps=!1,i.__maxMipLevel=E.length-1}else s.texImage2D(3553,0,T,u,b,d),i.__maxMipLevel=0;m(p,_)&&r(3553,p,d.width,d.height),i.__version=p.version,p.onUpdate&&p.onUpdate(p)}function T(t,r,e,n){var i=a.convert(r.texture.format),d=a.convert(r.texture.type),l=f(i,d);s.texImage2D(n,0,l,r.width,r.height,0,i,d,null),o.bindFramebuffer(36160,t),o.framebufferTexture2D(36160,e,n,_.get(r.texture).__webglTexture,0),o.bindFramebuffer(36160,null)}function C(t,r,n){if(o.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer)n?(n=w(r),o.renderbufferStorageMultisample(36161,n,33189,r.width,r.height)):o.renderbufferStorage(36161,33189,r.width,r.height),o.framebufferRenderbuffer(36160,36096,36161,t);else if(r.depthBuffer&&r.stencilBuffer)n?(n=w(r),o.renderbufferStorageMultisample(36161,n,35056,r.width,r.height)):o.renderbufferStorage(36161,34041,r.width,r.height),o.framebufferRenderbuffer(36160,33306,36161,t);else{t=a.convert(r.texture.format);var i=a.convert(r.texture.type);t=f(t,i),n?(n=w(r),o.renderbufferStorageMultisample(36161,n,t,r.width,r.height)):o.renderbufferStorage(36161,t,r.width,r.height)}o.bindRenderbuffer(36161,null)}function w(e){return S.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(S.maxSamples,e.samples):0}var x={},P="undefined"!=typeof OffscreenCanvas,b=0,R=!1,L=!1,A;this.allocateTextureUnit=function(){var e=b;return e>=S.maxTextures&&console.warn("COCO.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+S.maxTextures),b+=1,e},this.resetTextureUnits=function(){b=0},this.setTexture2D=g,this.setTexture2DArray=function(t,r){var a=_.get(t);0<t.version&&a.__version!==t.version?v(a,t,r):(s.activeTexture(33984+r),s.bindTexture(35866,a.__webglTexture))},this.setTexture3D=function(t,r){var a=_.get(t);0<t.version&&a.__version!==t.version?v(a,t,r):(s.activeTexture(33984+r),s.bindTexture(32879,a.__webglTexture))},this.setTextureCube=n,this.setTextureCubeDynamic=h,this.setupRenderTarget=function(e){var n=_.get(e),i=_.get(e.texture);e.addEventListener("dispose",l),i.__webglTexture=o.createTexture(),d.memory.textures++;var p=!0===e.isWebGLRenderTargetCube,u=!0===e.isWebGLMultisampleRenderTarget,y=c(e)||S.isWebGL2;if(p)for(n.__webglFramebuffer=[],u=0;6>u;u++)n.__webglFramebuffer[u]=o.createFramebuffer();else if(n.__webglFramebuffer=o.createFramebuffer(),u)if(S.isWebGL2){n.__webglMultisampledFramebuffer=o.createFramebuffer(),n.__webglColorRenderbuffer=o.createRenderbuffer(),o.bindRenderbuffer(36161,n.__webglColorRenderbuffer),u=a.convert(e.texture.format);var t=a.convert(e.texture.type);u=f(u,t),t=w(e),o.renderbufferStorageMultisample(36161,t,u,e.width,e.height),o.bindFramebuffer(36160,n.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064,36161,n.__webglColorRenderbuffer),o.bindRenderbuffer(36161,null),e.depthBuffer&&(n.__webglDepthRenderbuffer=o.createRenderbuffer(),C(n.__webglDepthRenderbuffer,e,!0)),o.bindFramebuffer(36160,null)}else console.warn("COCO.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(p){for(s.bindTexture(34067,i.__webglTexture),M(34067,e.texture,y),u=0;6>u;u++)T(n.__webglFramebuffer[u],e,36064,34069+u);m(e.texture,y)&&r(34067,e.texture,e.width,e.height),s.bindTexture(34067,null)}else s.bindTexture(3553,i.__webglTexture),M(3553,e.texture,y),T(n.__webglFramebuffer,e,36064,3553),m(e.texture,y)&&r(3553,e.texture,e.width,e.height),s.bindTexture(3553,null);if(e.depthBuffer){if(n=_.get(e),i=!0===e.isWebGLRenderTargetCube,e.depthTexture){if(i)throw Error("target.depthTexture not supported in Cube render targets");if(e&&e.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported");if(o.bindFramebuffer(36160,n.__webglFramebuffer),!e.depthTexture||!e.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of COCO.DepthTexture");if(_.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0),g(e.depthTexture,0),n=_.get(e.depthTexture).__webglTexture,1026===e.depthTexture.format)o.framebufferTexture2D(36160,36096,3553,n,0);else if(1027===e.depthTexture.format)o.framebufferTexture2D(36160,33306,3553,n,0);else throw Error("Unknown depthTexture format")}else if(i)for(n.__webglDepthbuffer=[],i=0;6>i;i++)o.bindFramebuffer(36160,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=o.createRenderbuffer(),C(n.__webglDepthbuffer[i],e);else o.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=o.createRenderbuffer(),C(n.__webglDepthbuffer,e);o.bindFramebuffer(36160,null)}},this.updateRenderTargetMipmap=function(e){var t=e.texture,a=c(e)||S.isWebGL2;if(m(t,a)){a=e.isWebGLRenderTargetCube?34067:3553;var o=_.get(t).__webglTexture;s.bindTexture(a,o),r(a,t,e.width,e.height),s.bindTexture(a,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(S.isWebGL2){var t=_.get(e);o.bindFramebuffer(36008,t.__webglMultisampledFramebuffer),o.bindFramebuffer(36009,t.__webglFramebuffer),t=e.width;var r=e.height,a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),o.blitFramebuffer(0,0,t,r,0,0,t,r,a,9728)}else console.warn("COCO.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===R&&(console.warn("COCO.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),R=!0),e=e.texture),g(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===L&&(console.warn("COCO.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),L=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?n(e,t):h(e,t)}}function Lr(e,t,r){return{convert:function(e){if(1E3===e)return 10497;if(1001===e)return 33071;if(1002===e)return 33648;if(1003===e)return 9728;if(1004===e)return 9984;if(1005===e)return 9986;if(1006===e)return 9729;if(1007===e)return 9985;if(1008===e)return 9987;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e){if(r.isWebGL2)return 5131;var a=t.get("OES_texture_half_float");if(null!==a)return a.HALF_FLOAT_OES}if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(100===e)return 32774;if(101===e)return 32778;if(102===e)return 32779;if(200===e)return 0;if(201===e)return 1;if(202===e)return 768;if(203===e)return 769;if(204===e)return 770;if(205===e)return 771;if(206===e)return 772;if(207===e)return 773;if(208===e)return 774;if(209===e)return 775;if(210===e)return 776;if((33776===e||33777===e||33778===e||33779===e)&&(a=t.get("WEBGL_compressed_texture_s3tc"),null!==a)){if(33776===e)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===e||35841===e||35842===e||35843===e)&&(a=t.get("WEBGL_compressed_texture_pvrtc"),null!==a)){if(35840===e)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e&&(a=t.get("WEBGL_compressed_texture_etc1"),null!==a))return a.COMPRESSED_RGB_ETC1_WEBGL;if((37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e)&&(a=t.get("WEBGL_compressed_texture_astc"),null!==a))return e;if(103===e||104===e){if(r.isWebGL2){if(103===e)return 32775;if(104===e)return 32776}if(a=t.get("EXT_blend_minmax"),null!==a){if(103===e)return a.MIN_EXT;if(104===e)return a.MAX_EXT}}if(1020===e){if(r.isWebGL2)return 34042;if(a=t.get("WEBGL_depth_texture"),null!==a)return a.UNSIGNED_INT_24_8_WEBGL}return 0}}}function Ar(){y.call(this),this.type="Group"}function Dr(e){oe.call(this),this.cameras=e||[]}function Ir(t,a,o){li.setFromMatrixPosition(a.matrixWorld),ci.setFromMatrixPosition(o.matrixWorld);var n=li.distanceTo(ci),i=a.projectionMatrix.elements,s=o.projectionMatrix.elements,d=i[14]/(i[10]-1);o=i[14]/(i[10]+1);var p=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(s[8]+1)/s[0];i=d*u,s=d*h,h=n/(-u+h),u=h*-u,a.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(u),t.translateZ(h),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld),a=d+h,d=o+h,t.projectionMatrix.makePerspective(i-u,s+(n-u),p*o/d*a,l*o/d*a,a,d)}function Br(n){function T(){return null!==S&&!0===S.isPresenting}function a(){if(T()){var e=S.getEyeParameters("left");g=2*e.renderWidth*l,R=e.renderHeight*l,B=n.getPixelRatio(),n.getSize(D),n.setDrawingBufferSize(g,R,1),A.viewport.set(0,0,g/2,R),w.viewport.set(g/2,0,g/2,R),z.start(),d.dispatchEvent({type:"sessionstart"})}else d.enabled&&n.setDrawingBufferSize(D.width,D.height,B),z.stop(),d.dispatchEvent({type:"sessionend"})}function b(e,t){null!==t&&4===t.length&&e.set(t[0]*g,t[1]*R,t[2]*g,t[3]*R)}var d=this,S=null,E=null,M=null,C=[],r=new _,p=new _,l=1,P="local-floor",g,R;"undefined"!=typeof window&&"VRFrameData"in window&&(E=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",a,!1));var L=new _,v=new i,x=new s,A=new oe;A.viewport=new u,A.layers.enable(1);var w=new oe;w.viewport=new u,w.layers.enable(2);var y=new Dr([A,w]);y.layers.enable(1),y.layers.enable(2);var D=new o,I=[],B;this.enabled=!1,this.getController=function(e){var t=C[e];return void 0===t&&(t=new Ar,t.matrixAutoUpdate=!1,t.visible=!1,C[e]=t),t},this.getDevice=function(){return S},this.setDevice=function(e){void 0!==e&&(S=e),z.setContext(e)},this.setFramebufferScaleFactor=function(e){l=e},this.setReferenceSpaceType=function(e){P=e},this.setPoseTarget=function(e){void 0!==e&&(M=e)},this.getCamera=function(o){var i="local-floor"===P?1.6:0;if(!1===T())return o.position.set(0,i,0),o.rotation.set(0,0,0),o;if(S.depthNear=o.near,S.depthFar=o.far,S.getFrameData(E),"local-floor"===P){var s=S.stageParameters;s?r.fromArray(s.sittingToStandingTransform):r.makeTranslation(0,i,0)}i=E.pose,s=null===M?o:M,s.matrix.copy(r),s.matrix.decompose(s.position,s.quaternion,s.scale),null!==i.orientation&&(v.fromArray(i.orientation),s.quaternion.multiply(v)),null!==i.position&&(v.setFromRotationMatrix(r),x.fromArray(i.position),x.applyQuaternion(v),s.position.add(x)),s.updateMatrixWorld(),A.near=o.near,w.near=o.near,A.far=o.far,w.far=o.far,A.matrixWorldInverse.fromArray(E.leftViewMatrix),w.matrixWorldInverse.fromArray(E.rightViewMatrix),p.getInverse(r),"local-floor"===P&&(A.matrixWorldInverse.multiply(p),w.matrixWorldInverse.multiply(p)),o=s.parent,null!==o&&(L.getInverse(o.matrixWorld),A.matrixWorldInverse.multiply(L),w.matrixWorldInverse.multiply(L)),A.matrixWorld.getInverse(A.matrixWorldInverse),w.matrixWorld.getInverse(w.matrixWorldInverse),A.projectionMatrix.fromArray(E.leftProjectionMatrix),w.projectionMatrix.fromArray(E.rightProjectionMatrix),Ir(y,A,w),o=S.getLayers(),o.length&&(o=o[0],b(A.viewport,o.leftBounds),b(w.viewport,o.rightBounds));a:for(o=0;o<C.length;o++){i=C[o];b:{s=o;for(var d=navigator.getGamepads&&navigator.getGamepads(),l=0,m=0,h=d.length,t;l<h;l++)if(t=d[l],t&&("Daydream Controller"===t.id||"Gear VR Controller"===t.id||"Oculus Go Controller"===t.id||"OpenVR Gamepad"===t.id||t.id.startsWith("Oculus Touch")||t.id.startsWith("HTC Vive Focus")||t.id.startsWith("Spatial Controller"))){if(m===s){s=t;break b}m++}s=void 0}if(void 0!==s&&void 0!==s.pose){if(null===s.pose)break a;d=s.pose,!1===d.hasPosition&&i.position.set(.2,-.6,-.05),null!==d.position&&i.position.fromArray(d.position),null!==d.orientation&&i.quaternion.fromArray(d.orientation),i.matrix.compose(i.position,i.quaternion,i.scale),i.matrix.premultiply(r),i.matrix.decompose(i.position,i.quaternion,i.scale),i.matrixWorldNeedsUpdate=!0,i.visible=!0,d="Daydream Controller"===s.id?0:1,void 0===I[o]&&(I[o]=!1),I[o]!==s.buttons[d].pressed&&(I[o]=s.buttons[d].pressed,!0===I[o]?i.dispatchEvent({type:"selectstart"}):(i.dispatchEvent({type:"selectend"}),i.dispatchEvent({type:"select"})))}else i.visible=!1}return y},this.getStandingMatrix=function(){return r},this.isPresenting=T;var z=new tt;this.setAnimationLoop=function(e){z.setAnimationLoop(e),T()&&z.start()},this.submitFrame=function(){T()&&S.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",a)},this.setFrameOfReferenceType=function(){console.warn("COCO.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function ve(o,i){function s(){return null!==y&&null!==x}function c(e){for(var t=0;t<T.length;t++)l[t]===e.inputSource&&T[t].dispatchEvent({type:e.type})}function d(){o.setFramebuffer(null),o.setRenderTarget(o.getRenderTarget()),b.stop(),g.dispatchEvent({type:"sessionend"})}function e(e){x=e,b.setContext(y),b.start(),g.dispatchEvent({type:"sessionstart"})}function f(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}var g=this,y=null,x=null,h="local-floor",a=null,T=[],l=[],S=new oe;S.layers.enable(1),S.viewport=new u;var E=new oe;E.layers.enable(2),E.viewport=new u;var v=new Dr([S,E]);v.layers.enable(1),v.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=T[e];return void 0===t&&(t=new Ar,t.matrixAutoUpdate=!1,t.visible=!1,T[e]=t),t},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){h=e},this.getSession=function(){return y},this.setSession=function(t){y=t,null!==y&&(y.addEventListener("select",c),y.addEventListener("selectstart",c),y.addEventListener("selectend",c),y.addEventListener("end",d),y.updateRenderState({baseLayer:new XRWebGLLayer(y,i)}),y.requestReferenceSpace(h).then(e),l=y.inputSources,y.addEventListener("inputsourceschange",function(){l=y.inputSources,console.log(l);for(var e=0;e<T.length;e++)T[e].userData.inputSource=l[e]}))},this.getCamera=function(t){if(s()){var r=t.parent,o=v.cameras;f(v,r);for(var n=0;n<o.length;n++)f(o[n],r);for(t.matrixWorld.copy(v.matrixWorld),t=t.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(!0);return Ir(v,S,E),v}return t},this.isPresenting=s;var n=null,b=new tt;b.setAnimationLoop(function(t,i){if(a=i.getViewerPose(x),null!==a){var s=a.views,p=y.renderState.baseLayer;o.setFramebuffer(p.framebuffer);for(var c=0;c<s.length;c++){var m=s[c],u=p.getViewport(m),g=v.cameras[c];g.matrix.fromArray(m.transform.inverse.matrix).getInverse(g.matrix),g.projectionMatrix.fromArray(m.projectionMatrix),g.viewport.set(u.x,u.y,u.width,u.height),0==c&&v.matrix.copy(g.matrix)}}for(c=0;c<T.length;c++){if(s=T[c],(p=l[c])&&(p=i.getPose(p.targetRaySpace,x),null!==p)){s.matrix.fromArray(p.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.visible=!0;continue}s.visible=!1}n&&n(t)}),this.setAnimationLoop=function(e){n=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("COCO.WebXRManager: getStandingMatrix() is no longer needed."),new _},this.getDevice=function(){console.warn("COCO.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("COCO.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("COCO.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function zr(n){function i(){L=new dt(Re),Le=new it(Re,L,n),Le.isWebGL2||(L.get("WEBGL_depth_texture"),L.get("OES_texture_float"),L.get("OES_texture_half_float"),L.get("OES_texture_half_float_linear"),L.get("OES_standard_derivatives"),L.get("OES_element_index_uint"),L.get("ANGLE_instanced_arrays")),L.get("OES_texture_float_linear"),je=new Lr(Re,L,Le),Ae=new Pr(Re,L,je,Le),Ae.scissor(R.copy(be).multiplyScalar(ye).floor()),Ae.viewport(ue.copy(xe).multiplyScalar(ye).floor()),De=new ct(Re),Ie=new hr,Be=new Rr(Re,L,Ae,Ie,Le,je,De),ze=new se(Re),Ne=new pt(Re,ze,De),Oe=new gt(Ne,De),He=new ut(Re),ke=new fr(H,L,Le),Ue=new _r,Ge=new Er,Fe=new ot(H,Ae,Oe,A),Ve=new nt(Re,L,De,Le),We=new lt(Re,L,De,Le),De.programs=ke.programs,H.capabilities=Le,H.extensions=L,H.properties=Ie,H.renderLists=Ue,H.state=Ae,H.info=De}function c(e){e.preventDefault(),console.log("COCO.WebGLRenderer: Context Lost."),te=!0}function d(){console.log("COCO.WebGLRenderer: Context Restored."),te=!1,i()}function D(e){e=e.target,e.removeEventListener("dispose",D),f(e),Ie.remove(e)}function f(e){var t=Ie.get(e).program;e.program=void 0,void 0!==t&&ke.releaseProgram(t)}function e(e,t){e.render(function(e){H.renderBufferImmediate(e,t)})}function O(t,o,n,i){if(!1!==t.visible){if(t.layers.test(o.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(o);else if(t.isLight)F.pushLight(t),t.castShadow&&F.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Se.intersectsSprite(t)){i&&Pe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(we);var s=Oe.update(t),d=t.material;d.visible&&G.push(t,s,d,n,Pe.z,null)}}else if(t.isImmediateRenderObject)i&&Pe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(we),G.push(t,null,t.material,n,Pe.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||Se.intersectsObject(t)))if(i&&Pe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(we),s=Oe.update(t),d=t.material,Array.isArray(d))for(var l=s.groups,u=0,g=l.length;u<g;u++){var y=l[u],p=d[y.materialIndex];p&&p.visible&&G.push(t,s,p,n,Pe.z,y)}else d.visible&&G.push(t,s,d,n,Pe.z,null);for(t=t.children,u=0,g=t.length;u<g;u++)O(t[u],o,n,i)}}function h(t,r,a,o){for(var n=0,i=t.length;n<i;n++){var s=t[n],d=s.object,c=s.geometry,f=void 0===o?s.material:o;if(s=s.group,a.isArrayCamera){me=a;for(var m=a.cameras,p=0,h=m.length,u;p<h;p++)u=m[p],d.layers.test(u.layers)&&(Ae.viewport(ue.copy(u.viewport)),F.setupLights(u),j(d,r,u,c,f,s))}else me=null,j(d,r,a,c,f,s)}}function j(t,r,a,o,n,i){if(t.onBeforeRender(H,r,a,o,n,i),F=Ge.get(r,me||a),t.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){Ae.setMaterial(n);var s=ee(a,r.fog,n,t);pe=l=null,le=!1,e(t,s)}else H.renderBufferDirect(a,r.fog,o,n,t,i);t.onAfterRender(H,r,a,o,n,i),F=Ge.get(r,me||a)}function $(t,r,o){var n=Ie.get(t),i=F.state.lights,e=i.state.version;o=ke.getParameters(t,i.state,F.state.shadowsArray,r,Ee.numPlanes,Ee.numIntersection,o);var s=ke.getProgramCode(t,o),d=n.program,l=!0;if(void 0===d)t.addEventListener("dispose",D);else if(d.code!==s)f(t);else{if(n.lightsStateVersion!==e)n.lightsStateVersion=e;else if(void 0!==o.shaderID)return;l=!1}if(l&&(o.shaderID?(s=I[o.shaderID],n.shader={name:t.type,uniforms:Q(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}):n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader},t.onBeforeCompile(n.shader,H),s=ke.getProgramCode(t,o),d=ke.acquireProgram(t,n.shader,o,s),n.program=d,t.program=d),o=d.getAttributes(),t.morphTargets)for(s=t.numSupportedMorphTargets=0;s<H.maxMorphTargets;s++)0<=o["morphTarget"+s]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(s=t.numSupportedMorphNormals=0;s<H.maxMorphNormals;s++)0<=o["morphNormal"+s]&&t.numSupportedMorphNormals++;o=n.shader.uniforms,(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=Ee.numPlanes,n.numIntersection=Ee.numIntersection,o.clippingPlanes=Ee.uniform),n.fog=r,n.lightsStateVersion=e,t.lights&&(o.ambientLightColor.value=i.state.ambient,o.lightProbe.value=i.state.probe,o.directionalLights.value=i.state.directional,o.spotLights.value=i.state.spot,o.rectAreaLights.value=i.state.rectArea,o.pointLights.value=i.state.point,o.hemisphereLights.value=i.state.hemi,o.directionalShadowMap.value=i.state.directionalShadowMap,o.directionalShadowMatrix.value=i.state.directionalShadowMatrix,o.spotShadowMap.value=i.state.spotShadowMap,o.spotShadowMatrix.value=i.state.spotShadowMatrix,o.pointShadowMap.value=i.state.pointShadowMap,o.pointShadowMatrix.value=i.state.pointShadowMatrix),t=n.program.getUniforms(),t=tr.seqWithValue(t.seq,o),n.uniformsList=t}function ee(o,n,i,s){Be.resetTextureUnits();var d=Ie.get(i),e=F.state.lights;Me&&(Ce||o!==ce)&&Ee.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,o,d,o===ce&&i.id===de),!1===i.needsUpdate&&(void 0===d.program?i.needsUpdate=!0:i.fog&&d.fog!==n?i.needsUpdate=!0:i.lights&&d.lightsStateVersion!==e.state.version?i.needsUpdate=!0:void 0===d.numClippingPlanes||d.numClippingPlanes===Ee.numPlanes&&d.numIntersection===Ee.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&($(i,n,s),i.needsUpdate=!1);var c=!1,y=!1,v=!1;e=d.program;var x=e.getUniforms(),m=d.shader.uniforms;if(Ae.useProgram(e.program)&&(v=y=c=!0),i.id!==de&&(de=i.id,y=!0),(c||ce!==o)&&(x.setValue(Re,"projectionMatrix",o.projectionMatrix),Le.logarithmicDepthBuffer&&x.setValue(Re,"logDepthBufFC",2/(Math.log(o.far+1)/Math.LN2)),ce!==o&&(ce=o,v=y=!0),(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap)&&(c=x.map.cameraPosition,void 0!==c&&c.setValue(Re,Pe.setFromMatrixPosition(o.matrixWorld))),(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&x.setValue(Re,"viewMatrix",o.matrixWorldInverse)),i.skinning&&(x.setOptional(Re,s,"bindMatrix"),x.setOptional(Re,s,"bindMatrixInverse"),o=s.skeleton))if(c=o.bones,Le.floatVertexTextures){if(void 0===o.boneTexture){c=Math.sqrt(4*c.length),c=Ze.ceilPowerOfTwo(c),c=Math.max(c,4);var r=new Float32Array(4*(c*c));r.set(o.boneMatrices);var l=new _e(r,c,c,1023,1015);l.needsUpdate=!0,o.boneMatrices=r,o.boneTexture=l,o.boneTextureSize=c}x.setValue(Re,"boneTexture",o.boneTexture,Be),x.setValue(Re,"boneTextureSize",o.boneTextureSize)}else x.setOptional(Re,o,"boneMatrices");return y&&(x.setValue(Re,"toneMappingExposure",H.toneMappingExposure),x.setValue(Re,"toneMappingWhitePoint",H.toneMappingWhitePoint),i.lights&&(y=v,m.ambientLightColor.needsUpdate=y,m.lightProbe.needsUpdate=y,m.directionalLights.needsUpdate=y,m.pointLights.needsUpdate=y,m.spotLights.needsUpdate=y,m.rectAreaLights.needsUpdate=y,m.hemisphereLights.needsUpdate=y),n&&i.fog&&(m.fogColor.value.copy(n.color),n.isFog?(m.fogNear.value=n.near,m.fogFar.value=n.far):n.isFogExp2&&(m.fogDensity.value=n.density)),i.isMeshBasicMaterial?p(m,i):i.isMeshLambertMaterial?(p(m,i),i.emissiveMap&&(m.emissiveMap.value=i.emissiveMap)):i.isMeshPhongMaterial?(p(m,i),i.isMeshToonMaterial?(t(m,i),i.gradientMap&&(m.gradientMap.value=i.gradientMap)):t(m,i)):i.isMeshStandardMaterial?(p(m,i),i.isMeshPhysicalMaterial?(q(m,i),m.reflectivity.value=i.reflectivity,m.clearCoat.value=i.clearCoat,m.clearCoatRoughness.value=i.clearCoatRoughness):q(m,i)):i.isMeshMatcapMaterial?(p(m,i),i.matcap&&(m.matcap.value=i.matcap),i.bumpMap&&(m.bumpMap.value=i.bumpMap,m.bumpScale.value=i.bumpScale,1===i.side&&(m.bumpScale.value*=-1)),i.normalMap&&(m.normalMap.value=i.normalMap,m.normalScale.value.copy(i.normalScale),1===i.side&&m.normalScale.value.negate()),i.displacementMap&&(m.displacementMap.value=i.displacementMap,m.displacementScale.value=i.displacementScale,m.displacementBias.value=i.displacementBias)):i.isMeshDepthMaterial?(p(m,i),i.displacementMap&&(m.displacementMap.value=i.displacementMap,m.displacementScale.value=i.displacementScale,m.displacementBias.value=i.displacementBias)):i.isMeshDistanceMaterial?(p(m,i),i.displacementMap&&(m.displacementMap.value=i.displacementMap,m.displacementScale.value=i.displacementScale,m.displacementBias.value=i.displacementBias),m.referencePosition.value.copy(i.referencePosition),m.nearDistance.value=i.nearDistance,m.farDistance.value=i.farDistance):i.isMeshNormalMaterial?(p(m,i),i.bumpMap&&(m.bumpMap.value=i.bumpMap,m.bumpScale.value=i.bumpScale,1===i.side&&(m.bumpScale.value*=-1)),i.normalMap&&(m.normalMap.value=i.normalMap,m.normalScale.value.copy(i.normalScale),1===i.side&&m.normalScale.value.negate()),i.displacementMap&&(m.displacementMap.value=i.displacementMap,m.displacementScale.value=i.displacementScale,m.displacementBias.value=i.displacementBias)):i.isLineBasicMaterial?(m.diffuse.value.copy(i.color),m.opacity.value=i.opacity,i.isLineDashedMaterial&&(m.dashSize.value=i.dashSize,m.totalSize.value=i.dashSize+i.gapSize,m.scale.value=i.scale)):i.isPointsMaterial?(m.diffuse.value.copy(i.color),m.opacity.value=i.opacity,m.size.value=i.size*ye,m.scale.value=.5*he,m.map.value=i.map,null!==i.map&&(!0===i.map.matrixAutoUpdate&&i.map.updateMatrix(),m.uvTransform.value.copy(i.map.matrix))):i.isSpriteMaterial?(m.diffuse.value.copy(i.color),m.opacity.value=i.opacity,m.rotation.value=i.rotation,m.map.value=i.map,null!==i.map&&(!0===i.map.matrixAutoUpdate&&i.map.updateMatrix(),m.uvTransform.value.copy(i.map.matrix))):i.isShadowMaterial&&(m.color.value.copy(i.color),m.opacity.value=i.opacity),void 0!==m.ltc_1&&(m.ltc_1.value=P.LTC_1),void 0!==m.ltc_2&&(m.ltc_2.value=P.LTC_2),tr.upload(Re,d.uniformsList,m,Be)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(tr.upload(Re,d.uniformsList,m,Be),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&x.setValue(Re,"center",s.center),x.setValue(Re,"modelViewMatrix",s.modelViewMatrix),x.setValue(Re,"normalMatrix",s.normalMatrix),x.setValue(Re,"modelMatrix",s.matrixWorld),e}function p(e,t){if(e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=Ie.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map)var r=t.map;else t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap);void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function t(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1E-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function q(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}var l;console.log("COCO.WebGLRenderer","107"),n=n||{};var r=void 0===n.canvas?document.createElementNS("http://www.w3.org/1999/xhtml","canvas"):n.canvas,m=void 0===n.context?null:n.context,g=void 0!==n.alpha&&n.alpha,v=!(void 0!==n.depth)||n.depth,y=!(void 0!==n.stencil)||n.stencil,x=void 0!==n.antialias&&n.antialias,A=!(void 0!==n.premultipliedAlpha)||n.premultipliedAlpha,z=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,E=void 0===n.powerPreference?"default":n.powerPreference,k=void 0!==n.failIfMajorPerformanceCaveat&&n.failIfMajorPerformanceCaveat,G=null,F=null;this.domElement=r,this.debug={checkShaderErrors:!0},this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1,this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var H=this,te=!1,re=null,ae=0,oe=0,ne=null,ie=null,de=-1,pe=l=null,le=!1,ce=null,me=null,ue=new u,R=new u,ge=null,fe=r.width,he=r.height,ye=1,xe=new u(0,0,fe,he),be=new u(0,0,fe,he),Te=!1,Se=new et,Ee=new st,Me=!1,Ce=!1,we=new _,Pe=new s;try{g={alpha:g,depth:v,stencil:y,antialias:x,premultipliedAlpha:A,preserveDrawingBuffer:z,powerPreference:E,failIfMajorPerformanceCaveat:k,xrCompatible:!0},r.addEventListener("webglcontextlost",c,!1),r.addEventListener("webglcontextrestored",d,!1);var Re=m||r.getContext("webgl",g)||r.getContext("experimental-webgl",g);if(null===Re){if(null!==r.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===Re.getShaderPrecisionFormat&&(Re.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("COCO.WebGLRenderer: "+e.message),e}var L,Le,Ae,De,Ie,Be,ze,Ne,Oe,ke,Ue,Ge,Fe,He,Ve,We,je;i();var qe="undefined"!=typeof navigator&&"xr"in navigator&&"supportsSession"in navigator.xr?new ve(H,Re):new Br(H);this.vr=qe;var Xe=new wr(H,Oe,Le.maxTextureSize);this.shadowMap=Xe,this.getContext=function(){return Re},this.getContextAttributes=function(){return Re.getContextAttributes()},this.forceContextLoss=function(){var e=L.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=L.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return ye},this.setPixelRatio=function(e){void 0!==e&&(ye=e,this.setSize(fe,he,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new o),e.set(fe,he)},this.setSize=function(e,t,a){qe.isPresenting()?console.warn("COCO.WebGLRenderer: Can't change size while VR device is presenting."):(fe=e,he=t,r.width=Math.floor(e*ye),r.height=Math.floor(t*ye),!1!==a&&(r.style.width=e+"px",r.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new o),e.set(fe*ye,he*ye).floor()},this.setDrawingBufferSize=function(e,t,a){fe=e,he=t,ye=a,r.width=Math.floor(e*a),r.height=Math.floor(t*a),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new u),e.copy(ue)},this.getViewport=function(e){return e.copy(xe)},this.setViewport=function(e,t,r,a){e.isVector4?xe.set(e.x,e.y,e.z,e.w):xe.set(e,t,r,a),Ae.viewport(ue.copy(xe).multiplyScalar(ye).floor())},this.getScissor=function(e){return e.copy(be)},this.setScissor=function(e,t,r,a){e.isVector4?be.set(e.x,e.y,e.z,e.w):be.set(e,t,r,a),Ae.scissor(R.copy(be).multiplyScalar(ye).floor())},this.getScissorTest=function(){return Te},this.setScissorTest=function(e){Ae.setScissorTest(Te=e)},this.getClearColor=function(){return Fe.getClearColor()},this.setClearColor=function(){Fe.setClearColor.apply(Fe,arguments)},this.getClearAlpha=function(){return Fe.getClearAlpha()},this.setClearAlpha=function(){Fe.setClearAlpha.apply(Fe,arguments)},this.clear=function(e,t,r){var a=0;(void 0===e||e)&&(a|=16384),(void 0===t||t)&&(a|=256),(void 0===r||r)&&(a|=1024),Re.clear(a)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",c,!1),r.removeEventListener("webglcontextrestored",d,!1),Ue.dispose(),Ge.dispose(),Ie.dispose(),Oe.dispose(),qe.dispose(),Je.stop()},this.renderBufferImmediate=function(e,t){Ae.initAttributes();var r=Ie.get(e);e.hasPositions&&!r.position&&(r.position=Re.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=Re.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=Re.createBuffer()),e.hasColors&&!r.color&&(r.color=Re.createBuffer()),t=t.getAttributes(),e.hasPositions&&(Re.bindBuffer(34962,r.position),Re.bufferData(34962,e.positionArray,35048),Ae.enableAttribute(t.position),Re.vertexAttribPointer(t.position,3,5126,!1,0,0)),e.hasNormals&&(Re.bindBuffer(34962,r.normal),Re.bufferData(34962,e.normalArray,35048),Ae.enableAttribute(t.normal),Re.vertexAttribPointer(t.normal,3,5126,!1,0,0)),e.hasUvs&&(Re.bindBuffer(34962,r.uv),Re.bufferData(34962,e.uvArray,35048),Ae.enableAttribute(t.uv),Re.vertexAttribPointer(t.uv,2,5126,!1,0,0)),e.hasColors&&(Re.bindBuffer(34962,r.color),Re.bufferData(34962,e.colorArray,35048),Ae.enableAttribute(t.color),Re.vertexAttribPointer(t.color,3,5126,!1,0,0)),Ae.disableUnusedAttributes(),Re.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(o,i,s,d,_,f){var b=_.isMesh&&0>_.matrixWorld.determinant();Ae.setMaterial(d,b);var T=ee(o,i,d,_),S=!1;(l!==s.id||pe!==T.id||le!==(!0===d.wireframe))&&(l=s.id,pe=T.id,le=!0===d.wireframe,S=!0),_.morphTargetInfluences&&(He.update(_,s,d,T),S=!0),b=s.index;var E=s.attributes.position;if(i=1,!0===d.wireframe&&(b=Ne.getWireframeAttribute(s),i=2),o=Ve,null!==b){var M=ze.get(b);o=We,o.setIndex(M)}if(S){if(s&&s.isInstancedBufferGeometry&&!Le.isWebGL2&&null===L.get("ANGLE_instanced_arrays"))console.error("COCO.WebGLRenderer.setupVertexAttributes: using COCO.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{Ae.initAttributes(),S=s.attributes,T=T.getAttributes();var C=d.defaultAttributeValues;for(B in T){var u=T[B];if(0<=u){var P=S[B];if(void 0!==P){var R=P.normalized,D=P.itemSize,v=ze.get(P);if(void 0!==v){var I=v.buffer,w=v.type;if(v=v.bytesPerElement,P.isInterleavedBufferAttribute){var y=P.data,A=y.stride;P=P.offset,y&&y.isInstancedInterleavedBuffer?(Ae.enableAttributeAndDivisor(u,y.meshPerAttribute),void 0===s.maxInstancedCount&&(s.maxInstancedCount=y.meshPerAttribute*y.count)):Ae.enableAttribute(u),Re.bindBuffer(34962,I),Re.vertexAttribPointer(u,D,w,R,A*v,P*v)}else P.isInstancedBufferAttribute?(Ae.enableAttributeAndDivisor(u,P.meshPerAttribute),void 0===s.maxInstancedCount&&(s.maxInstancedCount=P.meshPerAttribute*P.count)):Ae.enableAttribute(u),Re.bindBuffer(34962,I),Re.vertexAttribPointer(u,D,w,R,0,0)}}else if(void 0!==C&&(R=C[B],void 0!==R))switch(R.length){case 2:Re.vertexAttrib2fv(u,R);break;case 3:Re.vertexAttrib3fv(u,R);break;case 4:Re.vertexAttrib4fv(u,R);break;default:Re.vertexAttrib1fv(u,R);}}}Ae.disableUnusedAttributes()}null!==b&&Re.bindBuffer(34963,M.buffer)}M=1/0,null===b?void 0!==E&&(M=E.count):M=b.count,b=s.drawRange.start*i,E=null===f?0:f.start*i;var B=Math.max(b,E);if(f=Math.max(0,Math.min(M,b+s.drawRange.count*i,E+(null===f?1/0:f.count*i))-1-B+1),0!==f){if(!_.isMesh)_.isLine?(d=d.linewidth,void 0===d&&(d=1),Ae.setLineWidth(d*(null===ne?ye:1)),_.isLineSegments?o.setMode(1):_.isLineLoop?o.setMode(2):o.setMode(3)):_.isPoints?o.setMode(0):_.isSprite&&o.setMode(4);else if(!0===d.wireframe)Ae.setLineWidth(d.wireframeLinewidth*(null===ne?ye:1)),o.setMode(1);else switch(_.drawMode){case 0:o.setMode(4);break;case 1:o.setMode(5);break;case 2:o.setMode(6);}s&&s.isInstancedBufferGeometry?0<s.maxInstancedCount&&o.renderInstances(s,B,f):o.render(B,f)}},this.compile=function(e,t){F=Ge.get(e,t),F.init(),e.traverse(function(e){e.isLight&&(F.pushLight(e),e.castShadow&&F.pushShadow(e))}),F.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)$(t.material[r],e.fog,t);else $(t.material,e.fog,t)})};var Ye=null,Je=new tt;Je.setAnimationLoop(function(e){qe.isPresenting()||Ye&&Ye(e)}),"undefined"!=typeof window&&Je.setContext(window),this.setAnimationLoop=function(e){Ye=e,qe.setAnimationLoop(e),Je.start()},this.render=function(t,r,a,o){if(void 0!==a){console.warn("COCO.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead.");var n=a}if(void 0!==o){console.warn("COCO.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead.");var i=o}r&&r.isCamera?te||(pe=l=null,le=!1,de=-1,ce=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),qe.enabled&&(r=qe.getCamera(r)),F=Ge.get(t,r),F.init(),t.onBeforeRender(H,t,r,n||ne),we.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Se.setFromMatrix(we),Ce=this.localClippingEnabled,Me=Ee.init(this.clippingPlanes,Ce,r),G=Ue.get(t,r),G.init(),O(t,r,0,H.sortObjects),!0===H.sortObjects&&G.sort(),Me&&Ee.beginShadows(),Xe.render(F.state.shadowsArray,t,r),F.setupLights(r),Me&&Ee.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),Fe.render(G,t,r,i),a=G.opaque,o=G.transparent,t.overrideMaterial?(n=t.overrideMaterial,a.length&&h(a,t,r,n),o.length&&h(o,t,r,n)):(a.length&&h(a,t,r),o.length&&h(o,t,r)),t.onAfterRender(H,t,r),null!==ne&&(Be.updateRenderTargetMipmap(ne),Be.updateMultisampleRenderTarget(ne)),Ae.buffers.depth.setTest(!0),Ae.buffers.depth.setMask(!0),Ae.buffers.color.setMask(!0),Ae.setPolygonOffset(!1),qe.enabled&&qe.submitFrame(),F=G=null):console.error("COCO.WebGLRenderer.render: camera is not an instance of COCO.Camera.")},this.setFramebuffer=function(e){re!==e&&Re.bindFramebuffer(36160,e),re=e},this.getActiveCubeFace=function(){return ae},this.getActiveMipmapLevel=function(){return oe},this.getRenderTarget=function(){return ne},this.setRenderTarget=function(t,r,o){ne=t,ae=r,oe=o,t&&void 0===Ie.get(t).__webglFramebuffer&&Be.setupRenderTarget(t);var n=re,i=!1;t?(n=Ie.get(t).__webglFramebuffer,t.isWebGLRenderTargetCube?(n=n[r||0],i=!0):n=t.isWebGLMultisampleRenderTarget?Ie.get(t).__webglMultisampledFramebuffer:n,ue.copy(t.viewport),R.copy(t.scissor),ge=t.scissorTest):(ue.copy(xe).multiplyScalar(ye).floor(),R.copy(be).multiplyScalar(ye).floor(),ge=Te),ie!==n&&(Re.bindFramebuffer(36160,n),ie=n),Ae.viewport(ue),Ae.scissor(R),Ae.setScissorTest(ge),i&&(t=Ie.get(t.texture),Re.framebufferTexture2D(36160,36064,34069+(r||0),t.__webglTexture,o||0))},this.readRenderTargetPixels=function(t,a,o,n,i,e,s){if(t&&t.isWebGLRenderTarget){var d=Ie.get(t).__webglFramebuffer;if(t.isWebGLRenderTargetCube&&void 0!==s&&(d=d[s]),d){s=!1,d!==ie&&(Re.bindFramebuffer(36160,d),s=!0);try{var p=t.texture,l=p.format,c=p.type;1023!==l&&je.convert(l)!==Re.getParameter(35739)?console.error("COCO.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===c||je.convert(c)===Re.getParameter(35738)||1015===c&&(Le.isWebGL2||L.get("OES_texture_float")||L.get("WEBGL_color_buffer_float"))||1016===c&&(Le.isWebGL2?L.get("EXT_color_buffer_float"):L.get("EXT_color_buffer_half_float"))?36053===Re.checkFramebufferStatus(36160)?0<=a&&a<=t.width-n&&0<=o&&o<=t.height-i&&Re.readPixels(a,o,n,i,je.convert(l),je.convert(c),e):console.error("COCO.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("COCO.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{s&&Re.bindFramebuffer(36160,ie)}}}else console.error("COCO.WebGLRenderer.readRenderTargetPixels: renderTarget is not COCO.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,r,a){var o=r.image.width,n=r.image.height,e=je.convert(r.format);Be.setTexture2D(r,0),Re.copyTexImage2D(3553,a||0,e,t.x,t.y,o,n,0)},this.copyTextureToTexture=function(t,r,a,o){var n=r.image.width,e=r.image.height,i=je.convert(a.format),s=je.convert(a.type);Be.setTexture2D(a,0),r.isDataTexture?Re.texSubImage2D(3553,o||0,t.x,t.y,n,e,i,s,r.image.data):Re.texSubImage2D(3553,o||0,t.x,t.y,i,s,r.image)},"undefined"!=typeof __COCO_DEVTOOLS__&&__COCO_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function we(e,t){this.name="",this.color=new v(e),this.density=void 0===t?25e-5:t}function Nr(e,t,r){this.name="",this.color=new v(e),this.near=void 0===t?1:t,this.far=void 0===r?1E3:r}function Or(e,t){this.array=e,this.stride=t,this.count=void 0===e?0:e.length/t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function kr(e,t,r,a){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===a}function Ur(e){x.call(this),this.type="SpriteMaterial",this.color=new v(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function Gr(e){if(y.call(this),this.type="Sprite",void 0===mi){mi=new Y;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);t=new Or(t,5),mi.setIndex([0,1,2,0,2,3]),mi.addAttribute("position",new kr(t,3,0,!1)),mi.addAttribute("uv",new kr(t,2,3,!1))}this.geometry=mi,this.material=void 0===e?new Ur:e,this.center=new o(.5,.5)}function Fr(){y.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Hr(e,t){e&&e.isGeometry&&console.error("COCO.SkinnedMesh no longer supports COCO.Geometry. Use COCO.BufferGeometry instead."),B.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new _,this.bindMatrixInverse=new _}function Vr(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else for(console.warn("COCO.Skeleton boneInverses is the wrong length."),this.boneInverses=[],e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new _)}function Wr(){y.call(this),this.type="Bone"}function xe(e){x.call(this),this.type="LineBasicMaterial",this.color=new v(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.lights=!1,this.setValues(e)}function W(e,t,r){1===r&&console.error("COCO.Line: parameter COCO.LinePieces no longer supported. Use COCO.LineSegments instead."),y.call(this),this.type="Line",this.geometry=void 0===e?new Y:e,this.material=void 0===t?new xe({color:16777215*Math.random()}):t}function X(e,t){W.call(this,e,t),this.type="LineSegments"}function U(e,t){W.call(this,e,t),this.type="LineLoop"}function jr(e){x.call(this),this.type="PointsMaterial",this.color=new v(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=this.morphTargets=!1,this.setValues(e)}function qr(e,t){y.call(this),this.type="Points",this.geometry=void 0===e?new Y:e,this.material=void 0===t?new jr({color:16777215*Math.random()}):t,this.updateMorphTargets()}function Xr(t,r,a,o,i,e,s,d,p){n.call(this,t,r,a,o,i,e,s,d,p),this.format=void 0===s?1022:s,this.minFilter=void 0===e?1006:e,this.magFilter=void 0===i?1006:i,this.generateMipmaps=!1}function ye(t,a,o,i,s,e,d,l,c,u,m,r){n.call(this,null,e,d,l,c,u,i,s,m,r),this.image={width:a,height:o},this.mipmaps=t,this.generateMipmaps=this.flipY=!1}function Yr(t,r,a,o,i,e,s,d,p){n.call(this,t,r,a,o,i,e,s,d,p),this.needsUpdate=!0}function Zr(t,r,a,o,i,e,s,d,p,l){if(l=void 0===l?1026:l,1026!==l&&1027!==l)throw Error("DepthTexture format must be either COCO.DepthFormat or COCO.DepthStencilFormat");void 0===a&&1026===l&&(a=1012),void 0===a&&1027===l&&(a=1020),n.call(this,null,o,i,e,s,d,l,a,p),this.image={width:t,height:r},this.magFilter=void 0===s?1003:s,this.minFilter=void 0===d?1003:d,this.generateMipmaps=this.flipY=!1}function Jr(o){Y.call(this),this.type="WireframeGeometry";var n=[],i=[0,0],u={},f=["a","b","c"],y,v,x;if(o&&o.isGeometry){var _=o.faces,b=0;for(v=_.length;b<v;b++){var T=_[b];for(y=0;3>y;y++){var S=T[f[y]],E=T[f[(y+1)%3]];i[0]=Math.min(S,E),i[1]=Math.max(S,E),S=i[0]+","+i[1],void 0===u[S]&&(u[S]={index1:i[0],index2:i[1]})}}for(S in u)b=u[S],f=o.vertices[b.index1],n.push(f.x,f.y,f.z),f=o.vertices[b.index2],n.push(f.x,f.y,f.z)}else if(o&&o.isBufferGeometry)if(f=new s,null!==o.index){_=o.attributes.position,T=o.index;var M=o.groups;for(0===M.length&&(M=[{start:0,count:T.count,materialIndex:0}]),o=0,x=M.length;o<x;++o)for(b=M[o],y=b.start,v=b.count,b=y,v=y+v;b<v;b+=3)for(y=0;3>y;y++)S=T.getX(b+y),E=T.getX(b+(y+1)%3),i[0]=Math.min(S,E),i[1]=Math.max(S,E),S=i[0]+","+i[1],void 0===u[S]&&(u[S]={index1:i[0],index2:i[1]});for(S in u)b=u[S],f.fromBufferAttribute(_,b.index1),n.push(f.x,f.y,f.z),f.fromBufferAttribute(_,b.index2),n.push(f.x,f.y,f.z)}else for(_=o.attributes.position,b=0,v=_.count/3;b<v;b++)for(y=0;3>y;y++)u=3*b+y,f.fromBufferAttribute(_,u),n.push(f.x,f.y,f.z),u=3*b+(y+1)%3,f.fromBufferAttribute(_,u),n.push(f.x,f.y,f.z);this.addAttribute("position",new j(n,3))}function Qr(e,t,r){q.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new Kr(e,t,r)),this.mergeVertices()}function Kr(o,n,i){Y.call(this),this.type="ParametricBufferGeometry",this.parameters={func:o,slices:n,stacks:i};var c=[],d=[],e=[],u=[],g=new s,f=new s,y=new s,m=new s,r=new s,p,_;3>o.length&&console.error("COCO.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var b=n+1;for(p=0;p<=i;p++){var T=p/i;for(_=0;_<=n;_++){var v=_/n;o(v,T,f),d.push(f.x,f.y,f.z),0<=v-1E-5?(o(v-1E-5,T,y),m.subVectors(f,y)):(o(v+1E-5,T,y),m.subVectors(y,f)),0<=T-1E-5?(o(v,T-1E-5,y),r.subVectors(f,y)):(o(v,T+1E-5,y),r.subVectors(y,f)),g.crossVectors(m,r).normalize(),e.push(g.x,g.y,g.z),u.push(v,T)}}for(p=0;p<i;p++)for(_=0;_<n;_++)o=p*b+_+1,g=(p+1)*b+_+1,f=(p+1)*b+_,c.push(p*b+_,o,f),c.push(o,g,f);this.setIndex(c),this.addAttribute("position",new j(d,3)),this.addAttribute("normal",new j(e,3)),this.addAttribute("uv",new j(u,2))}function $r(e,t,r,a){q.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:a},this.fromBufferGeometry(new ea(e,t,r,a)),this.mergeVertices()}function ea(t,r,a,n){function i(e){m.push(e.x,e.y,e.z)}function e(e,r){e*=3,r.x=t[e+0],r.y=t[e+1],r.z=t[e+2]}function p(e,t,r,a){0>a&&1===e.x&&(u[t]=e.x-1),0===r.x&&0===r.z&&(u[t]=a/2/Math.PI+.5)}Y.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:r,radius:a,detail:n},a=a||1,n=n||0;var m=[],u=[];(function(t){for(var a=new s,o=new s,n=new s,d=0;d<r.length;d+=3){e(r[d+0],a),e(r[d+1],o),e(r[d+2],n);var p=a,c=n,u=Math.pow(2,t),g=[],f,y;for(y=0;y<=u;y++){g[y]=[];var v=p.clone().lerp(c,y/u),x=o.clone().lerp(c,y/u),_=u-y;for(f=0;f<=_;f++)g[y][f]=0===f&&y===u?v:v.clone().lerp(x,f/_)}for(y=0;y<u;y++)for(f=0;f<2*(u-y)-1;f++)p=Math.floor(f/2),0==f%2?(i(g[y][p+1]),i(g[y+1][p]),i(g[y][p])):(i(g[y][p+1]),i(g[y+1][p+1]),i(g[y+1][p]))}})(n),function(e){for(var t=new s,r=0;r<m.length;r+=3)t.x=m[r+0],t.y=m[r+1],t.z=m[r+2],t.normalize().multiplyScalar(e),m[r+0]=t.x,m[r+1]=t.y,m[r+2]=t.z}(a),function(){for(var t=new s,r=0;r<m.length;r+=3)t.x=m[r+0],t.y=m[r+1],t.z=m[r+2],u.push(Math.atan2(t.z,-t.x)/2/Math.PI+.5,1-(Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5));t=new s,r=new s;for(var n=new s,i=new s,g=new o,h=new o,f=new o,l=0,y=0;l<m.length;l+=9,y+=6){t.set(m[l+0],m[l+1],m[l+2]),r.set(m[l+3],m[l+4],m[l+5]),n.set(m[l+6],m[l+7],m[l+8]),g.set(u[y+0],u[y+1]),h.set(u[y+2],u[y+3]),f.set(u[y+4],u[y+5]),i.copy(t).add(r).add(n).divideScalar(3);var v=Math.atan2(i.z,-i.x);p(g,y+0,t,v),p(h,y+2,r,v),p(f,y+4,n,v)}for(t=0;t<u.length;t+=6)r=u[t+0],n=u[t+2],i=u[t+4],g=Math.min(r,n,i),.9<Math.max(r,n,i)&&.1>g&&(.2>r&&(u[t+0]+=1),.2>n&&(u[t+2]+=1),.2>i&&(u[t+4]+=1))}(),this.addAttribute("position",new j(m,3)),this.addAttribute("normal",new j(m.slice(),3)),this.addAttribute("uv",new j(u,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function ra(e,t){q.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new oa(e,t)),this.mergeVertices()}function oa(e,t){ea.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function na(e,t){q.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ia(e,t)),this.mergeVertices()}function ia(e,t){ea.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function sa(e,t){q.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new da(e,t)),this.mergeVertices()}function da(e,t){var r=(1+Math.sqrt(5))/2;ea.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function pa(e,t){q.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new la(e,t)),this.mergeVertices()}function la(e,t){var r=(1+Math.sqrt(5))/2,a=1/r;ea.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-r,0,-a,r,0,a,-r,0,a,r,-a,-r,0,-a,r,0,a,-r,0,a,r,0,-r,0,-a,r,0,-a,-r,0,a,r,0,a],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ca(t,r,o,n,i,e){q.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:r,radius:o,radialSegments:n,closed:i},void 0!==e&&console.warn("COCO.TubeGeometry: taper has been removed."),t=new ma(t,r,o,n,i),this.tangents=t.tangents,this.normals=t.normals,this.binormals=t.binormals,this.fromBufferGeometry(t),this.mergeVertices()}function ma(n,i,a,u,y){function _(r){S=n.getPointAt(r/i,S);var o=T.normals[r];for(r=T.binormals[r],M=0;M<=u;M++){var s=2*(M/u*Math.PI),d=Math.sin(s);s=-Math.cos(s),h.x=s*o.x+d*r.x,h.y=s*o.y+d*r.y,h.z=s*o.z+d*r.z,h.normalize(),t.push(h.x,h.y,h.z),g.x=S.x+a*h.x,g.y=S.y+a*h.y,g.z=S.z+a*h.z,E.push(g.x,g.y,g.z)}}Y.call(this),this.type="TubeBufferGeometry",this.parameters={path:n,tubularSegments:i,radius:a,radialSegments:u,closed:y},i=i||64,a=a||1,u=u||8,y=y||!1;var T=n.computeFrenetFrames(i,y);this.tangents=T.tangents,this.normals=T.normals,this.binormals=T.binormals;var g=new s,h=new s,f=new o,S=new s,E=[],t=[],m=[],v=[],x,M;for(x=0;x<i;x++)_(x);for(_(!1===y?i:0),x=0;x<=i;x++)for(M=0;M<=u;M++)f.x=x/i,f.y=M/u,m.push(f.x,f.y);(function(){for(M=1;M<=i;M++)for(x=1;x<=u;x++){var t=(u+1)*M+(x-1),r=(u+1)*M+x,a=(u+1)*(M-1)+x;v.push((u+1)*(M-1)+(x-1),t,a),v.push(t,r,a)}})(),this.setIndex(v),this.addAttribute("position",new j(E,3)),this.addAttribute("normal",new j(t,3)),this.addAttribute("uv",new j(m,2))}function ga(t,r,a,o,n,e,i){q.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:r,tubularSegments:a,radialSegments:o,p:n,q:e},void 0!==i&&console.warn("COCO.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new ha(t,r,a,o,n,e)),this.mergeVertices()}function ha(o,n,i,u,_,T){function S(t,r,a,o,n){var e=Math.sin(t);r=a/r*t,a=Math.cos(r),n.x=.5*(o*(2+a))*Math.cos(t),n.y=.5*(o*(2+a)*e),n.z=.5*(o*Math.sin(r))}Y.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:o,tube:n,tubularSegments:i,radialSegments:u,p:_,q:T},o=o||1,n=n||.4,i=Math.floor(i)||64,u=Math.floor(u)||8,_=_||2,T=T||3;var g=[],h=[],E=[],m=[],r=new s,l=new s,t=new s,M=new s,v=new s,x=new s,C=new s,w;for(w=0;w<=i;++w){var P=2*(w/i*_*Math.PI);for(S(P,_,T,o,t),S(P+.01,_,T,o,M),x.subVectors(M,t),C.addVectors(M,t),v.crossVectors(x,C),C.crossVectors(v,x),v.normalize(),C.normalize(),P=0;P<=u;++P){var R=2*(P/u*Math.PI),L=-n*Math.cos(R);R=n*Math.sin(R),r.x=t.x+(L*C.x+R*v.x),r.y=t.y+(L*C.y+R*v.y),r.z=t.z+(L*C.z+R*v.z),h.push(r.x,r.y,r.z),l.subVectors(r,t).normalize(),E.push(l.x,l.y,l.z),m.push(w/i),m.push(P/u)}}for(P=1;P<=i;P++)for(w=1;w<=u;w++)o=(u+1)*P+(w-1),n=(u+1)*P+w,_=(u+1)*(P-1)+w,g.push((u+1)*(P-1)+(w-1),o,_),g.push(o,n,_);this.setIndex(g),this.addAttribute("position",new j(h,3)),this.addAttribute("normal",new j(E,3)),this.addAttribute("uv",new j(m,2))}function ya(t,r,a,o,n){q.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:r,radialSegments:a,tubularSegments:o,arc:n},this.fromBufferGeometry(new va(t,r,a,o,n)),this.mergeVertices()}function va(o,n,i,u,y){Y.call(this),this.type="TorusBufferGeometry",this.parameters={radius:o,tube:n,radialSegments:i,tubularSegments:u,arc:y},o=o||1,n=n||.4,i=Math.floor(i)||8,u=Math.floor(u)||6,y=y||2*Math.PI;var x=[],f=[],g=[],h=[],_=new s,m=new s,r=new s,p,T;for(p=0;p<=i;p++)for(T=0;T<=u;T++){var S=T/u*y,E=2*(p/i*Math.PI);m.x=(o+n*Math.cos(E))*Math.cos(S),m.y=(o+n*Math.cos(E))*Math.sin(S),m.z=n*Math.sin(E),f.push(m.x,m.y,m.z),_.x=o*Math.cos(S),_.y=o*Math.sin(S),r.subVectors(m,_).normalize(),g.push(r.x,r.y,r.z),h.push(T/u),h.push(p/i)}for(p=1;p<=i;p++)for(T=1;T<=u;T++)o=(u+1)*(p-1)+T-1,n=(u+1)*(p-1)+T,y=(u+1)*p+T,x.push((u+1)*p+T-1,o,y),x.push(o,n,y);this.setIndex(x),this.addAttribute("position",new j(f,3)),this.addAttribute("normal",new j(g,3)),this.addAttribute("uv",new j(h,2))}function xa(t,r,a,o,n){for(var i=0,s=r,d=a-o,p;s<a;s+=o)i+=(t[d]-t[s])*(t[s+1]+t[d+1]),d=s;if(n===0<i)for(n=r;n<a;n+=o)p=ja(n,t[n],t[n+1],p);else for(n=a-o;n>=r;n-=o)p=ja(n,t[n],t[n+1],p);return p&&fa(p,p.next)&&(Xa(p),p=p.next),p}function _a(e,t){if(!e)return e;t||(t=e);do{var r=!1;if(e.steiner||!fa(e,e.next)&&0!==Fa(e.prev,e,e.next))e=e.next;else{if(Xa(e),e=t=e.prev,e===e.next)break;r=!0}}while(r||e!==t);return t}function ba(o,i,s,c,d,e,u){if(o){if(!u&&e){var f=o,y=f;do null===y.z&&(y.z=ka(y.x,y.y,c,d,e)),y.prevZ=y.prev,y=y.nextZ=y.next;while(y!==f);y.prevZ.nextZ=null,y.prevZ=null,f=y;var v=1,x,_,b,T;do{y=f;var S=f=null;for(_=0;y;){_++;var E=y;for(x=b=0;x<v&&(b++,E=E.nextZ,E);x++);for(T=v;0<b||0<T&&E;)0!==b&&(0===T||!E||y.z<=E.z)?(x=y,y=y.nextZ,b--):(x=E,E=E.nextZ,T--),S?S.nextZ=x:f=x,x.prevZ=S,S=x;y=E}S.nextZ=null,v*=2}while(1<_)}for(f=o;o.prev!==o.next;){if(y=o.prev,E=o.next,e)S=La(o,c,d,e);else a:if(S=o,_=S.prev,b=S,v=S.next,0<=Fa(_,b,v))S=!1;else{for(x=S.next.next;x!==S.prev;){if(Ga(_.x,_.y,b.x,b.y,v.x,v.y,x.x,x.y)&&0<=Fa(x.prev,x,x.next)){S=!1;break a}x=x.next}S=!0}if(S)i.push(y.i/s),i.push(o.i/s),i.push(E.i/s),Xa(o),f=o=E.next;else if(o=E,o===f){if(!u)ba(_a(o),i,s,c,d,e,1);else if(1===u){u=i,f=s,y=o;do E=y.prev,S=y.next.next,!fa(E,S)&&Ha(E,y,y.next,S)&&Va(E,S)&&Va(S,E)&&(u.push(E.i/f),u.push(y.i/f),u.push(S.i/f),Xa(y),Xa(y.next),y=o=S),y=y.next;while(y!==o);o=y,ba(o,i,s,c,d,e,2)}else if(2===u)a:{u=o;do{for(f=u.next.next;f!==u.prev;){if(y=u.i!==f.i){if(y=u,E=f,S=y.next.i!==E.i&&y.prev.i!==E.i){b:{S=y;do{if(S.i!==y.i&&S.next.i!==y.i&&S.i!==E.i&&S.next.i!==E.i&&Ha(S,S.next,y,E)){S=!0;break b}S=S.next}while(S!==y);S=!1}S=!S}if(S=S&&Va(y,E)&&Va(E,y)){S=y,_=!1,b=(y.x+E.x)/2,E=(y.y+E.y)/2;do S.y>E!=S.next.y>E&&S.next.y!==S.y&&b<(S.next.x-S.x)*(E-S.y)/(S.next.y-S.y)+S.x&&(_=!_),S=S.next;while(S!==y);S=_}y=S}if(y){o=Wa(u,f),u=_a(u,u.next),o=_a(o,o.next),ba(u,i,s,c,d,e),ba(o,i,s,c,d,e);break a}f=f.next}u=u.next}while(u!==o)}break}}}}function La(t,r,a,o){var n=t.prev,e=t.next;if(0<=Fa(n,t,e))return!1;var i=n.x>t.x?n.x>e.x?n.x:e.x:t.x>e.x?t.x:e.x,s=n.y>t.y?n.y>e.y?n.y:e.y:t.y>e.y?t.y:e.y,p=ka(n.x<t.x?n.x<e.x?n.x:e.x:t.x<e.x?t.x:e.x,n.y<t.y?n.y<e.y?n.y:e.y:t.y<e.y?t.y:e.y,r,a,o);for(r=ka(i,s,r,a,o),a=t.prevZ,o=t.nextZ;a&&a.z>=p&&o&&o.z<=r;){if(a!==t.prev&&a!==t.next&&Ga(n.x,n.y,t.x,t.y,e.x,e.y,a.x,a.y)&&0<=Fa(a.prev,a,a.next))return!1;if(a=a.prevZ,o!==t.prev&&o!==t.next&&Ga(n.x,n.y,t.x,t.y,e.x,e.y,o.x,o.y)&&0<=Fa(o.prev,o,o.next))return!1;o=o.nextZ}for(;a&&a.z>=p;){if(a!==t.prev&&a!==t.next&&Ga(n.x,n.y,t.x,t.y,e.x,e.y,a.x,a.y)&&0<=Fa(a.prev,a,a.next))return!1;a=a.prevZ}for(;o&&o.z<=r;){if(o!==t.prev&&o!==t.next&&Ga(n.x,n.y,t.x,t.y,e.x,e.y,o.x,o.y)&&0<=Fa(o.prev,o,o.next))return!1;o=o.nextZ}return!0}function Aa(e,t){return e.x-t.x}function za(t,a){var o=a,n=t.x,i=t.y,e=-Infinity;do{if(i<=o.y&&i>=o.next.y&&o.next.y!==o.y){var s=o.x+(i-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(s<=n&&s>e){if(e=s,s===n){if(i===o.y)return o;if(i===o.next.y)return o.next}var d=o.x<o.next.x?o:o.next}}o=o.next}while(o!==a);if(!d)return null;if(n===e)return d.prev;a=d,s=d.x;var p=d.y,l=1/0;for(o=d.next;o!==a;){if(n>=o.x&&o.x>=s&&n!==o.x&&Ga(i<p?n:e,i,s,p,i<p?e:n,i,o.x,o.y)){var u=Math.abs(i-o.y)/(n-o.x);(u<l||u===l&&o.x>d.x)&&Va(o,t)&&(d=o,l=u)}o=o.next}return d}function ka(t,r,o,n,i){return t=32767*(t-o)*i,r=32767*(r-n)*i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),1431655765&(t|t<<1)|(1431655765&(r|r<<1))<<1}function ze(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Ga(t,r,a,o,n,e,i,s){return 0<=(n-i)*(r-s)-(t-i)*(e-s)&&0<=(t-i)*(o-s)-(a-i)*(r-s)&&0<=(a-i)*(e-s)-(n-i)*(o-s)}function Fa(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function fa(e,t){return e.x===t.x&&e.y===t.y}function Ha(e,t,r,a){return!!(fa(e,r)&&fa(t,a)||fa(e,a)&&fa(r,t))||0<Fa(e,t,r)!=0<Fa(e,t,a)&&0<Fa(r,a,e)!=0<Fa(r,a,t)}function Va(e,t){return 0>Fa(e.prev,e,e.next)?0<=Fa(e,t,e.next)&&0<=Fa(e,e.prev,t):0>Fa(e,t,e.prev)||0>Fa(e,e.next,t)}function Wa(t,r){var a=new Ya(t.i,t.x,t.y),o=new Ya(r.i,r.x,r.y),n=t.next,e=r.prev;return t.next=r,r.prev=t,a.next=n,n.prev=a,o.next=a,a.prev=o,e.next=o,o.prev=e,o}function ja(e,t,r,o){return e=new Ya(e,t,r),o?(e.next=o.next,e.prev=o,o.next.prev=e,o.next=e):(e.prev=e,e.next=e),e}function Xa(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ya(e,t,r){this.i=e,this.x=t,this.y=r,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function Ae(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function Ja(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function Ka(e,t){q.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new eo(e,t)),this.mergeVertices()}function eo(t,r){function n(t){function n(e,t,r){return t||console.error("COCO.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}function p(t,r,n){var i=t.x-r.x,s=t.y-r.y,p=n.x-t.x,l=n.y-t.y,c=i*i+s*s;if(Math.abs(i*l-s*p)>Number.EPSILON){var u=Math.sqrt(c),y=Math.sqrt(p*p+l*l);if(c=r.x-s/u,r=r.y+i/u,l=((n.x-l/y-c)*l-(n.y+p/y-r)*p)/(i*l-s*p),p=c+i*l-t.x,i=r+s*l-t.y,s=p*p+i*i,2>=s)return new o(p,i);s=Math.sqrt(s/2)}else t=!1,i>Number.EPSILON?p>Number.EPSILON&&(t=!0):i<-Number.EPSILON?p<-Number.EPSILON&&(t=!0):Math.sign(s)===Math.sign(l)&&(t=!0),t?(p=-s,s=Math.sqrt(c)):(p=i,i=s,s=Math.sqrt(c/2));return new o(p/s,i/s)}function c(e,t){for(oe=e.length;0<=--oe;){var a=oe,o=oe-1;0>o&&(o=e.length-1);var n=v+2*D,s;for(s=0;s<n;s++){var p=W*s,c=W*(s+1),u=t+o+p,r=t+o+c;c=t+a+c,h(t+a+p),h(u),h(c),h(u),h(r),h(c),p=d.length/3,p=j.generateSideWallUV(i,d,p-6,p-3,p-2,p-1),_(p[0]),_(p[1]),_(p[3]),_(p[1]),_(p[2]),_(p[3])}}}function m(e,t,r){l.push(e),l.push(t),l.push(r)}function u(e,t,r){h(e),h(t),h(r),e=d.length/3,e=j.generateTopUV(i,d,e-3,e-2,e-1),_(e[0]),_(e[1]),_(e[2])}function h(e){d.push(l[3*e]),d.push(l[3*e+1]),d.push(l[3*e+2])}function _(t){e.push(t.x),e.push(t.y)}var l=[],g=void 0===r.curveSegments?12:r.curveSegments,v=void 0===r.steps?1:r.steps,f=void 0===r.depth?100:r.depth,x=!(void 0!==r.bevelEnabled)||r.bevelEnabled,b=void 0===r.bevelThickness?6:r.bevelThickness,w=void 0===r.bevelSize?b-2:r.bevelSize,L=void 0===r.bevelOffset?0:r.bevelOffset,D=void 0===r.bevelSegments?3:r.bevelSegments,k=r.extrudePath,j=void 0===r.UVGenerator?fi:r.UVGenerator;void 0!==r.amount&&(console.warn("COCO.ExtrudeBufferGeometry: amount has been renamed to depth."),f=r.amount);var G=!1;if(k){var q=k.getSpacedPoints(v);G=!0,x=!1;var J=k.computeFrenetFrames(v,!1),N=new s,Q=new s,S=new s}x||(L=w=b=D=0);var T;g=t.extractPoints(g),t=g.shape;var $=g.holes;if(!gi.isClockWise(t)){t=t.reverse();var O=0;for(T=$.length;O<T;O++){var ee=$[O];gi.isClockWise(ee)&&($[O]=ee.reverse())}}var te=gi.triangulateShape(t,$),Y=t;for(O=0,T=$.length;O<T;O++)ee=$[O],t=t.concat(ee);var W=t.length,X=te.length,re,ae;g=[];var oe=0,ne=Y.length,ie=ne-1;for(re=oe+1;oe<ne;oe++,ie++,re++)ie===ne&&(ie=0),re===ne&&(re=0),g[oe]=p(Y[oe],Y[ie],Y[re]);k=[];var se=g.concat();for(O=0,T=$.length;O<T;O++){ee=$[O];var de=[];for(oe=0,ne=ee.length,ie=ne-1,re=oe+1;oe<ne;oe++,ie++,re++)ie===ne&&(ie=0),re===ne&&(re=0),de[oe]=p(ee[oe],ee[ie],ee[re]);k.push(de),se=se.concat(de)}for(ie=0;ie<D;ie++){ne=ie/D;var pe=b*Math.cos(ne*Math.PI/2);for(re=w*Math.sin(ne*Math.PI/2)+L,oe=0,ne=Y.length;oe<ne;oe++){var le=n(Y[oe],g[oe],re);m(le.x,le.y,-pe)}for(O=0,T=$.length;O<T;O++)for(ee=$[O],de=k[O],oe=0,ne=ee.length;oe<ne;oe++)le=n(ee[oe],de[oe],re),m(le.x,le.y,-pe)}for(re=w+L,oe=0;oe<W;oe++)le=x?n(t[oe],se[oe],re):t[oe],G?(Q.copy(J.normals[0]).multiplyScalar(le.x),N.copy(J.binormals[0]).multiplyScalar(le.y),S.copy(q[0]).add(Q).add(N),m(S.x,S.y,S.z)):m(le.x,le.y,0);for(ne=1;ne<=v;ne++)for(oe=0;oe<W;oe++)le=x?n(t[oe],se[oe],re):t[oe],G?(Q.copy(J.normals[ne]).multiplyScalar(le.x),N.copy(J.binormals[ne]).multiplyScalar(le.y),S.copy(q[ne]).add(Q).add(N),m(S.x,S.y,S.z)):m(le.x,le.y,f/v*ne);for(ie=D-1;0<=ie;ie--){for(ne=ie/D,pe=b*Math.cos(ne*Math.PI/2),re=w*Math.sin(ne*Math.PI/2)+L,oe=0,ne=Y.length;oe<ne;oe++)le=n(Y[oe],g[oe],re),m(le.x,le.y,f+pe);for(O=0,T=$.length;O<T;O++)for(ee=$[O],de=k[O],oe=0,ne=ee.length;oe<ne;oe++)le=n(ee[oe],de[oe],re),G?m(le.x,le.y+q[v-1].y,q[v-1].x+pe):m(le.x,le.y,f+pe)}(function(){var e=d.length/3;if(x){var t=0*W;for(oe=0;oe<X;oe++)ae=te[oe],u(ae[2]+t,ae[1]+t,ae[0]+t);for(t=W*(v+2*D),oe=0;oe<X;oe++)ae=te[oe],u(ae[0]+t,ae[1]+t,ae[2]+t)}else{for(oe=0;oe<X;oe++)ae=te[oe],u(ae[2],ae[1],ae[0]);for(oe=0;oe<X;oe++)ae=te[oe],u(ae[0]+W*v,ae[1]+W*v,ae[2]+W*v)}i.addGroup(e,d.length/3-e,0)})(),function(){var e=d.length/3,t=0;for(c(Y,t),t+=Y.length,O=0,T=$.length;O<T;O++)ee=$[O],c(ee,t),t+=ee.length;i.addGroup(e,d.length/3-e,1)}()}Y.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:r},t=Array.isArray(t)?t:[t];for(var i=this,d=[],e=[],p=0,l=t.length;p<l;p++)n(t[p]);this.addAttribute("position",new j(d,3)),this.addAttribute("uv",new j(e,2)),this.computeVertexNormals()}function $a(t,r,a){if(a.shapes=[],Array.isArray(t))for(var o=0,n=t.length;o<n;o++)a.shapes.push(t[o].uuid);else a.shapes.push(t.uuid);return void 0!==r.extrudePath&&(a.options.extrudePath=r.extrudePath.toJSON()),a}function to(e,t){q.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new ro(e,t)),this.mergeVertices()}function ro(e,t){t=t||{};var r=t.font;return r&&r.isFont?void(e=r.generateShapes(e,t.size),t.depth=void 0===t.height?50:t.height,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),eo.call(this,e,t),this.type="TextBufferGeometry"):(console.error("COCO.TextGeometry: font parameter is not an instance of COCO.Font."),new q)}function ao(t,r,a,o,n,e,i){q.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:r,heightSegments:a,phiStart:o,phiLength:n,thetaStart:e,thetaLength:i},this.fromBufferGeometry(new oo(t,r,a,o,n,e,i)),this.mergeVertices()}function oo(o,n,i,p,_,T,S){Y.call(this),this.type="SphereBufferGeometry",this.parameters={radius:o,widthSegments:n,heightSegments:i,phiStart:p,phiLength:_,thetaStart:T,thetaLength:S},o=o||1,n=Math.max(3,Math.floor(n)||8),i=Math.max(2,Math.floor(i)||6),p=void 0===p?0:p,_=void 0===_?2*Math.PI:_,T=void 0===T?0:T,S=void 0===S?Math.PI:S;var E=Math.min(T+S,Math.PI),h=0,M=[],l=new s,u=new s,t=[],C=[],v=[],x=[],P,R;for(R=0;R<=i;R++){var L=[],w=R/i,y=0;for(0==R&&0==T?y=.5/n:R==i&&E==Math.PI&&(y=-.5/n),P=0;P<=n;P++){var A=P/n;l.x=-o*Math.cos(p+A*_)*Math.sin(T+w*S),l.y=o*Math.cos(T+w*S),l.z=o*Math.sin(p+A*_)*Math.sin(T+w*S),C.push(l.x,l.y,l.z),u.copy(l).normalize(),v.push(u.x,u.y,u.z),x.push(A+y,1-w),L.push(h++)}M.push(L)}for(R=0;R<i;R++)for(P=0;P<n;P++)o=M[R][P+1],p=M[R][P],_=M[R+1][P],S=M[R+1][P+1],(0!==R||0<T)&&t.push(o,p,S),(R!==i-1||E<Math.PI)&&t.push(p,_,S);this.setIndex(t),this.addAttribute("position",new j(C,3)),this.addAttribute("normal",new j(v,3)),this.addAttribute("uv",new j(x,2))}function no(t,r,a,o,n,e){q.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:r,thetaSegments:a,phiSegments:o,thetaStart:n,thetaLength:e},this.fromBufferGeometry(new io(t,r,a,o,n,e)),this.mergeVertices()}function io(n,i,p,y,x,_){Y.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:n,outerRadius:i,thetaSegments:p,phiSegments:y,thetaStart:x,thetaLength:_},n=n||.5,i=i||1,x=void 0===x?0:x,_=void 0===_?2*Math.PI:_,p=void 0===p?8:Math.max(3,p),y=void 0===y?1:Math.max(1,y);var T=[],g=[],h=[],S=[],m=n,E=(i-n)/y,l=new s,u=new o,t,M;for(t=0;t<=y;t++){for(M=0;M<=p;M++)n=x+M/p*_,l.x=m*Math.cos(n),l.y=m*Math.sin(n),g.push(l.x,l.y,l.z),h.push(0,0,1),u.x=(l.x/i+1)/2,u.y=(l.y/i+1)/2,S.push(u.x,u.y);m+=E}for(t=0;t<y;t++)for(i=t*(p+1),M=0;M<p;M++)n=M+i,x=n+p+1,_=n+p+2,m=n+1,T.push(n,x,m),T.push(x,_,m);this.setIndex(T),this.addAttribute("position",new j(g,3)),this.addAttribute("normal",new j(h,3)),this.addAttribute("uv",new j(S,2))}function so(e,t,r,a){q.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:a},this.fromBufferGeometry(new po(e,t,r,a)),this.mergeVertices()}function po(n,a,i,p){Y.call(this),this.type="LatheBufferGeometry",this.parameters={points:n,segments:a,phiStart:i,phiLength:p},a=Math.floor(a)||12,i=i||0,p=p||2*Math.PI,p=Ze.clamp(p,0,2*Math.PI);var y=[],v=[],x=[],_=1/a,T=new s,S=new o,E;for(E=0;E<=a;E++){var M=i+E*_*p,C=Math.sin(M),u=Math.cos(M);for(M=0;M<=n.length-1;M++)T.x=n[M].x*C,T.y=n[M].y,T.z=n[M].x*u,v.push(T.x,T.y,T.z),S.x=E/a,S.y=M/(n.length-1),x.push(S.x,S.y)}for(E=0;E<a;E++)for(M=0;M<n.length-1;M++)i=M+E*n.length,_=i+n.length,T=i+n.length+1,S=i+1,y.push(i,_,S),y.push(_,T,S);if(this.setIndex(y),this.addAttribute("position",new j(v,3)),this.addAttribute("uv",new j(x,2)),this.computeVertexNormals(),p===2*Math.PI)for(p=this.attributes.normal.array,y=new s,v=new s,x=new s,i=3*(a*n.length),M=E=0;E<n.length;E++,M+=3)y.x=p[M+0],y.y=p[M+1],y.z=p[M+2],v.x=p[i+M+0],v.y=p[i+M+1],v.z=p[i+M+2],x.addVectors(y,v).normalize(),p[M+0]=p[i+M+0]=x.x,p[M+1]=p[i+M+1]=x.y,p[M+2]=p[i+M+2]=x.z}function lo(e,t){q.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("COCO.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new co(e,t)),this.mergeVertices()}function co(t,o){function r(t){var p=s.length/3,u;t=t.extractPoints(o);var g=t.shape,f=t.holes;for(!1===gi.isClockWise(g)&&(g=g.reverse()),t=0,u=f.length;t<u;t++){var l=f[t];!0===gi.isClockWise(l)&&(f[t]=l.reverse())}var h=gi.triangulateShape(g,f);for(t=0,u=f.length;t<u;t++)l=f[t],g=g.concat(l);for(t=0,u=g.length;t<u;t++)l=g[t],s.push(l.x,l.y,0),e.push(0,0,1),n.push(l.x,l.y);for(t=0,u=h.length;t<u;t++)g=h[t],i.push(g[0]+p,g[1]+p,g[2]+p),d+=3}Y.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:o},o=o||12;var i=[],s=[],e=[],n=[],a=0,d=0;if(!1===Array.isArray(t))r(t);else for(var p=0;p<t.length;p++)r(t[p]),this.addGroup(a,d,p),a+=d,d=0;this.setIndex(i),this.addAttribute("position",new j(s,3)),this.addAttribute("normal",new j(e,3)),this.addAttribute("uv",new j(n,2))}function mo(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,a=e.length;r<a;r++)t.shapes.push(e[r].uuid);else t.shapes.push(e.uuid);return t}function uo(t,r){Y.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:r};var o=[];r=Math.cos(Ze.DEG2RAD*(void 0===r?1:r));var i=[0,0],s={},e=["a","b","c"];if(t.isBufferGeometry){var c=new q;c.fromBufferGeometry(t)}else c=t.clone();c.mergeVertices(),c.computeFaceNormals(),t=c.vertices,c=c.faces;for(var u=0,y=c.length;u<y;u++)for(var v=c[u],m=0;3>m;m++){var x=v[e[m]],_=v[e[(m+1)%3]];i[0]=Math.min(x,_),i[1]=Math.max(x,_),x=i[0]+","+i[1],void 0===s[x]?s[x]={index1:i[0],index2:i[1],face1:u,face2:void 0}:s[x].face2=u}for(x in s)(i=s[x],void 0===i.face2||c[i.face1].normal.dot(c[i.face2].normal)<=r)&&(e=t[i.index1],o.push(e.x,e.y,e.z),e=t[i.index2],o.push(e.x,e.y,e.z));this.addAttribute("position",new j(o,3))}function go(t,r,a,o,n,e,i,s){q.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:r,height:a,radialSegments:o,heightSegments:n,openEnded:e,thetaStart:i,thetaLength:s},this.fromBufferGeometry(new fo(t,r,a,o,n,e,i,s)),this.mergeVertices()}function fo(n,i,y,_,T,r,S,M){function E(a){var d=new o,c=new s,g=0,h=!0===a?n:i,y=!0===a?1:-1,v=t,b;for(b=1;b<=_;b++)l.push(0,R*y,0),p.push(0,y,0),u.push(.5,.5),t++;var T=t;for(b=0;b<=_;b++){var E=b/_*M+S,C=Math.cos(E);E=Math.sin(E),c.x=h*E,c.y=R*y,c.z=h*C,l.push(c.x,c.y,c.z),p.push(0,y,0),d.x=.5*C+.5,d.y=.5*E*y+.5,u.push(d.x,d.y),t++}for(b=0;b<_;b++)d=v+b,c=T+b,!0===a?m.push(c,c+1,d):m.push(c+1,c,d),g+=3;P.addGroup(x,g,!0===a?1:2),x+=g}Y.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:n,radiusBottom:i,height:y,radialSegments:_,heightSegments:T,openEnded:r,thetaStart:S,thetaLength:M};var P=this;n=void 0===n?1:n,i=void 0===i?1:i,y=y||1,_=Math.floor(_)||8,T=Math.floor(T)||1,r=void 0!==r&&r,S=void 0===S?0:S,M=void 0===M?2*Math.PI:M;var m=[],l=[],p=[],u=[],t=0,w=[],R=y/2,x=0;(function(){var e=new s,a=new s,o=0,d=(i-n)/y,c,g;for(g=0;g<=T;g++){var h=[],v=g/T,b=v*(i-n)+n;for(c=0;c<=_;c++){var E=c/_,C=E*M+S,L=Math.sin(C);C=Math.cos(C),a.x=b*L,a.y=-v*y+R,a.z=b*C,l.push(a.x,a.y,a.z),e.set(L,d,C).normalize(),p.push(e.x,e.y,e.z),u.push(E,1-v),h.push(t++)}w.push(h)}for(c=0;c<_;c++)for(g=0;g<T;g++)e=w[g+1][c],a=w[g+1][c+1],d=w[g][c+1],m.push(w[g][c],e,d),m.push(e,a,d),o+=6;P.addGroup(x,o,0),x+=o})(),!1===r&&(0<n&&E(!0),0<i&&E(!1)),this.setIndex(m),this.addAttribute("position",new j(l,3)),this.addAttribute("normal",new j(p,3)),this.addAttribute("uv",new j(u,2))}function ho(t,r,a,o,n,e,i){go.call(this,0,t,r,a,o,n,e,i),this.type="ConeGeometry",this.parameters={radius:t,height:r,radialSegments:a,heightSegments:o,openEnded:n,thetaStart:e,thetaLength:i}}function yo(t,r,a,o,n,e,i){fo.call(this,0,t,r,a,o,n,e,i),this.type="ConeBufferGeometry",this.parameters={radius:t,height:r,radialSegments:a,heightSegments:o,openEnded:n,thetaStart:e,thetaLength:i}}function vo(e,t,r,a){q.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:a},this.fromBufferGeometry(new xo(e,t,r,a)),this.mergeVertices()}function xo(t,r,n,i){Y.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:r,thetaStart:n,thetaLength:i},t=t||1,r=void 0===r?8:Math.max(3,r),n=void 0===n?0:n,i=void 0===i?2*Math.PI:i;var y=[],e=[],f=[],g=[],h=new s,m=new o,l;e.push(0,0,0),f.push(0,0,1),g.push(.5,.5);var v=0;for(l=3;v<=r;v++,l+=3){var x=n+v/r*i;h.x=t*Math.cos(x),h.y=t*Math.sin(x),e.push(h.x,h.y,h.z),f.push(0,0,1),m.x=(e[l]/t+1)/2,m.y=(e[l+1]/t+1)/2,g.push(m.x,m.y)}for(l=1;l<=r;l++)y.push(l,l+1,0);this.setIndex(y),this.addAttribute("position",new j(e,3)),this.addAttribute("normal",new j(f,3)),this.addAttribute("uv",new j(g,2))}function _o(e){x.call(this),this.type="ShadowMaterial",this.color=new v(0),this.transparent=!0,this.setValues(e)}function bo(e){$.call(this,e),this.type="RawShaderMaterial"}function To(e){x.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new v(16777215),this.metalness=this.roughness=.5,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new v(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function So(e){To.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoatRoughness=this.clearCoat=0,this.setValues(e)}function Eo(e){x.call(this),this.type="MeshPhongMaterial",this.color=new v(16777215),this.specular=new v(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new v(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Ma(e){Eo.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Mo(e){x.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1,this.setValues(e)}function Co(e){x.call(this),this.type="MeshLambertMaterial",this.color=new v(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new v(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function wo(e){x.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new v(16777215),this.bumpMap=this.map=this.matcap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.lights=this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Po(e){xe.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function Ro(e,t,r,a){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0===a?new t.constructor(r):a,this.sampleValues=t,this.valueSize=r}function Ea(e,t,r,a){Ro.call(this,e,t,r,a),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function Lo(e,t,r,a){Ro.call(this,e,t,r,a)}function Ao(e,t,r,a){Ro.call(this,e,t,r,a)}function Do(e,t,r,a){if(void 0===e)throw Error("COCO.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("COCO.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=yi.convertArray(t,this.TimeBufferType),this.values=yi.convertArray(r,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}function ta(e,t,r){Do.call(this,e,t,r)}function Io(e,t,r,a){Do.call(this,e,t,r,a)}function Bo(e,t,r,a){Do.call(this,e,t,r,a)}function zo(e,t,r,a){Ro.call(this,e,t,r,a)}function No(e,t,r,a){Do.call(this,e,t,r,a)}function Oo(e,t,r,a){Do.call(this,e,t,r,a)}function ko(e,t,r,a){Do.call(this,e,t,r,a)}function Uo(e,t,r){this.name=e,this.tracks=r,this.duration=void 0===t?-1:t,this.uuid=Ze.generateUUID(),0>this.duration&&this.resetDuration()}function Ia(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Bo;case"vector":case"vector2":case"vector3":case"vector4":return ko;case"color":return Io;case"quaternion":return No;case"bool":case"boolean":return ta;case"string":return Oo;}throw Error("COCO.KeyframeTrack: Unsupported typeName: "+e)}function Go(e){if(void 0===e.type)throw Error("COCO.KeyframeTrack: track type undefined, can not parse");var t=Ia(e.type);if(void 0===e.times){var r=[],a=[];yi.flattenJSON(e.keys,r,a,"value"),e.times=r,e.values=a}return void 0===t.parse?new t(e.name,e.times,e.values,e.interpolation):t.parse(e)}function Fo(t,r,a){var o=this,n=!1,i=0,s=0,d;this.onStart=void 0,this.onLoad=t,this.onProgress=r,this.onError=a,this.itemStart=function(e){s++,!1===n&&void 0!==o.onStart&&o.onStart(e,i,s),n=!0},this.itemEnd=function(e){i++,void 0!==o.onProgress&&o.onProgress(e,i,s),i===s&&(n=!1,void 0!==o.onLoad)&&o.onLoad()},this.itemError=function(e){void 0!==o.onError&&o.onError(e)},this.resolveURL=function(e){return d?d(e):e},this.setURLModifier=function(e){return d=e,this}}function Be(e){this.manager=void 0===e?vi:e}function Na(e){this.manager=void 0===e?vi:e}function Ho(e){this.manager=void 0===e?vi:e,this._parser=null}function Vo(e){this.manager=void 0===e?vi:e,this._parser=null}function Ce(e){this.manager=void 0===e?vi:e}function Wo(e){this.manager=void 0===e?vi:e}function De(e){this.manager=void 0===e?vi:e}function jo(){this.type="Curve",this.arcLengthDivisions=200}function J(t,r,a,o,n,e,i,s){jo.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=r||0,this.xRadius=a||1,this.yRadius=o||1,this.aStartAngle=n||0,this.aEndAngle=e||2*Math.PI,this.aClockwise=i||!1,this.aRotation=s||0}function Ca(t,r,a,o,n,e){J.call(this,t,r,a,a,o,n,e),this.type="ArcCurve"}function qo(){var t=0,r=0,o=0,n=0;return{initCatmullRom:function(a,i,s,d,p){a=p*(s-a),d=p*(d-i),t=i,r=a,o=-3*i+3*s-2*a-d,n=2*i-2*s+a+d},initNonuniformCatmullRom:function(a,i,s,d,p,c,m){a=((i-a)/p-(s-a)/(p+c)+(s-i)/c)*c,d=((s-i)/c-(d-i)/(c+m)+(d-s)/m)*c,t=i,r=a,o=-3*i+3*s-2*a-d,n=2*i-2*s+a+d},calc:function(a){var e=a*a;return t+r*a+o*e+n*e*a}}}function Ee(e,t,r,a){jo.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=a||.5}function wa(t,r,a,o,n){r=.5*(o-r),n=.5*(n-a);var i=t*t;return(2*a-2*o+r+n)*t*i+(-3*a+3*o-2*r-n)*i+r*t+a}function Xo(t,r,a,o){var n=1-t;return n*n*r+2*(1-t)*t*a+t*t*o}function Yo(t,r,a,o,n){var e=1-t,i=1-t;return e*e*e*r+3*i*i*t*a+3*(1-t)*t*t*o+t*t*t*n}function Zo(e,t,r,a){jo.call(this),this.type="CubicBezierCurve",this.v0=e||new o,this.v1=t||new o,this.v2=r||new o,this.v3=a||new o}function Oa(e,t,r,a){jo.call(this),this.type="CubicBezierCurve3",this.v0=e||new s,this.v1=t||new s,this.v2=r||new s,this.v3=a||new s}function Jo(e,t){jo.call(this),this.type="LineCurve",this.v1=e||new o,this.v2=t||new o}function Da(e,t){jo.call(this),this.type="LineCurve3",this.v1=e||new s,this.v2=t||new s}function Pa(e,t,r){jo.call(this),this.type="QuadraticBezierCurve",this.v0=e||new o,this.v1=t||new o,this.v2=r||new o}function Qa(e,t,r){jo.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new s,this.v1=t||new s,this.v2=r||new s}function Qo(e){jo.call(this),this.type="SplineCurve",this.points=e||[]}function Ra(){jo.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ko(e){Ra.call(this),this.type="Path",this.currentPoint=new o,e&&this.setFromPoints(e)}function Sa(e){Ko.call(this,e),this.uuid=Ze.generateUUID(),this.type="Shape",this.holes=[]}function $o(e,t){y.call(this),this.type="Light",this.color=new v(e),this.intensity=void 0===t?1:t,this.receiveShadow=void 0}function R(e,t,r){$o.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(y.DefaultUp),this.updateMatrix(),this.groundColor=new v(t)}function en(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new o(512,512),this.map=null,this.matrix=new _}function tn(){en.call(this,new oe(50,1,.5,500))}function rn(t,r,a,o,n,e){$o.call(this,t,r),this.type="SpotLight",this.position.copy(y.DefaultUp),this.updateMatrix(),this.target=new y,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0===a?0:a,this.angle=void 0===o?Math.PI/3:o,this.penumbra=void 0===n?0:n,this.decay=void 0===e?1:e,this.shadow=new tn}function an(e,t,r,a){$o.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0===r?0:r,this.decay=void 0===a?1:a,this.shadow=new en(new oe(90,1,.5,500))}function on(t,r,a,o,n,e){re.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0===t?-1:t,this.right=void 0===r?1:r,this.top=void 0===a?1:a,this.bottom=void 0===o?-1:o,this.near=void 0===n?.1:n,this.far=void 0===e?2E3:e,this.updateProjectionMatrix()}function nn(){en.call(this,new on(-5,5,5,-5,.5,500))}function sn(e,t){$o.call(this,e,t),this.type="DirectionalLight",this.position.copy(y.DefaultUp),this.updateMatrix(),this.target=new y,this.shadow=new nn}function dn(e,t){$o.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function pn(e,t,r,a){$o.call(this,e,t),this.type="RectAreaLight",this.width=void 0===r?10:r,this.height=void 0===a?10:a}function ln(e){this.manager=void 0===e?vi:e,this.textures={}}function ae(){Y.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function be(e,t,r,a){"number"==typeof r&&(a=r,r=!1,console.error("COCO.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),C.call(this,e,t,r),this.meshPerAttribute=a||1}function ce(e){this.manager=void 0===e?vi:e}function Fe(e){this.manager=void 0===e?vi:e,this.resourcePath=""}function Ge(e){"undefined"==typeof createImageBitmap&&console.warn("COCO.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("COCO.ImageBitmapLoader: fetch() not supported."),this.manager=void 0===e?vi:e,this.options=void 0}function He(){this.type="ShapePath",this.color=new v,this.subPaths=[],this.currentPath=null}function Ie(e){this.type="Font",this.data=e}function Je(e){this.manager=void 0===e?vi:e}function cn(){}function mn(e){this.manager=void 0===e?vi:e}function Ke(){this.coefficients=[];for(var e=0;9>e;e++)this.coefficients.push(new s)}function de(e,t){$o.call(this,void 0,t),this.sh=void 0===e?new Ke:e}function Ta(e,t,r){de.call(this,void 0,r),e=new v().set(e),r=new v().set(t),t=new s(e.r,e.g,e.b),e=new s(r.r,r.g,r.b),r=Math.sqrt(Math.PI);var o=r*Math.sqrt(.75);this.sh.coefficients[0].copy(t).add(e).multiplyScalar(r),this.sh.coefficients[1].copy(t).sub(e).multiplyScalar(o)}function Le(e,t){de.call(this,void 0,t),e=new v().set(e),this.sh.coefficients[0].set(e.r,e.g,e.b).multiplyScalar(2*Math.sqrt(Math.PI))}function Me(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new oe,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new oe,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function un(e){this.autoStart=!(void 0!==e)||e,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function Ne(){y.call(this),this.type="AudioListener",this.context=wi.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function Oe(e){y.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.offset=this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function gn(e){Oe.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Qe(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0===t?2048:t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Re(e,t,r){this.binding=e,this.valueSize=r,e=Float64Array;"quaternion"===t?t=this._slerp:"string"===t||"bool"===t?(e=Array,t=this._select):t=this._lerp;this.buffer=new e(4*r),this._mixBufferRegion=t,this.referenceCount=this.useCount=this.cumulativeWeight=0}function Se(e,t,r){r=r||fn.parseTrackName(t),this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function fn(e,t,r){this.path=t,this.parsedPath=r||fn.parseTrackName(t),this.node=fn.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function qa(){this.uuid=Ze.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}}function hn(t,r,o){this._mixer=t,this._clip=r,this._localRoot=o||null,t=r.tracks,r=t.length,o=Array(r);for(var n={endingStart:2400,endingEnd:2400},i=0,s;i!==r;++i)s=t[i].createInterpolant(null),o[i]=s,s.settings=n;this._interpolantSettings=n,this._interpolants=o,this._propertyBindings=Array(r),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function yn(e){this._root=e,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function Te(e,t){"string"==typeof e&&(console.warn("COCO.Uniform: Type parameter is no longer needed."),e=t),this.value=e}function ee(e,t,r){Or.call(this,e,t),this.meshPerAttribute=r||1}function Ue(e,t,r,a){this.ray=new L(e,t),this.near=r||0,this.far=a||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("COCO.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function vn(e,t){return e.distance-t.distance}function xn(t,r,o,n){if(!1!==t.visible&&(t.raycast(r,o),!0===n)){t=t.children,n=0;for(var i=t.length;n<i;n++)xn(t[n],r,o,!0)}}function Ve(e,t,r){return this.radius=void 0===e?1:e,this.phi=void 0===t?0:t,this.theta=void 0===r?0:r,this}function _n(e,t,r){return this.radius=void 0===e?1:e,this.theta=void 0===t?0:t,this.y=void 0===r?0:r,this}function bn(e,t){this.min=void 0===e?new o(1/0,1/0):e,this.max=void 0===t?new o(-Infinity,-Infinity):t}function We(e,t){this.start=void 0===e?new s:e,this.end=void 0===t?new s:t}function Xe(e){y.call(this),this.material=e,this.render=function(){}}function Tn(e,t,r,o){this.object=e,this.size=void 0===t?1:t,e=void 0===r?16711680:r,o=void 0===o?1:o,t=0,(r=this.object.geometry)&&r.isGeometry?t=3*r.faces.length:r&&r.isBufferGeometry&&(t=r.attributes.normal.count),r=new Y,t=new j(6*t,3),r.addAttribute("position",t),X.call(this,r,new xe({color:e,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Sn(t,r){y.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,t=new Y,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var o=0,n=1;32>o;o++,n++){var i=2*(o/32*Math.PI),e=2*(n/32*Math.PI);r.push(Math.cos(i),Math.sin(i),1,Math.cos(e),Math.sin(e),1)}t.addAttribute("position",new j(r,3)),r=new xe({fog:!1}),this.cone=new X(t,r),this.add(this.cone),this.update()}function En(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,En(e.children[r]));return t}function Mn(t){for(var r=En(t),a=new Y,o=[],n=[],e=new v(0,0,1),i=new v(0,1,0),s=0,p;s<r.length;s++)p=r[s],p.parent&&p.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),n.push(e.r,e.g,e.b),n.push(i.r,i.g,i.b));a.addAttribute("position",new j(o,3)),a.addAttribute("color",new j(n,3)),o=new xe({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0}),X.call(this,a,o),this.root=t,this.bones=r,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Cn(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r,e=new oo(t,4,2),t=new S({wireframe:!0,fog:!1}),B.call(this,e,t),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function wn(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t,e=new Y,e.addAttribute("position",new j([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),e.computeBoundingSphere(),t=new xe({fog:!1}),W.call(this,e,t),e=new Y,e.addAttribute("position",new j([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),e.computeBoundingSphere(),this.add(new B(e,new S({side:1,fog:!1}))),this.update()}function Pn(e,t,r){y.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,e=new ia(t),e.rotateY(.5*Math.PI),this.material=new S({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2),t=e.getAttribute("position"),t=new Float32Array(3*t.count),e.addAttribute("color",new C(t,3)),this.add(new B(e,this.material)),this.update()}function Rn(e,t){this.lightProbe=e,this.size=t,e=new $({defines:{GAMMA_OUTPUT:""},uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:"varying vec3 vNormal;\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define RECIPROCAL_PI 0.318309886\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\t// matrix is assumed to be orthogonal\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 linearToOutput( in vec3 a ) {\n\t#ifdef GAMMA_OUTPUT\n\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\t#else\n\t\treturn a;\n\t#endif\n}\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\t// normal is assumed to have unit length\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nuniform vec3 sh[ 9 ]; // sh coefficients\nuniform float intensity; // light probe intensity\nvarying vec3 vNormal;\nvoid main() {\n\tvec3 normal = normalize( vNormal );\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );\n\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;\n\toutgoingLight = linearToOutput( outgoingLight );\n\tgl_FragColor = vec4( outgoingLight, 1.0 );\n}"}),t=new oo(1,32,16),B.call(this,t,e),this.onBeforeRender()}function Ln(t,r,o,n){t=t||10,r=r||10,o=new v(void 0===o?4473924:o),n=new v(void 0===n?8947848:n);var i=r/2,e=t/r,s=t/2;t=[];for(var u=[],g=0,f=0,h=-s;g<=r;g++,h+=e){t.push(-s,0,h,s,0,h),t.push(h,0,-s,h,0,s);var y=g===i?o:n;y.toArray(u,f),f+=3,y.toArray(u,f),f+=3,y.toArray(u,f),f+=3,y.toArray(u,f),f+=3}r=new Y,r.addAttribute("position",new j(t,3)),r.addAttribute("color",new j(u,3)),o=new xe({vertexColors:2}),X.call(this,r,o)}function fe(t,r,o,i,s,u){t=t||10,r=r||16,o=o||8,i=i||64,s=new v(void 0===s?4473924:s),u=new v(void 0===u?8947848:u);var y=[],x=[],h;for(h=0;h<=r;h++){var _=2*(h/r)*Math.PI,T=Math.sin(_)*t;_=Math.cos(_)*t,y.push(0,0,0),y.push(T,0,_);var S=1&h?s:u;x.push(S.r,S.g,S.b),x.push(S.r,S.g,S.b)}for(h=0;h<=o;h++){S=1&h?s:u;var E=t-t/o*h;for(r=0;r<i;r++)_=2*(r/i)*Math.PI,T=Math.sin(_)*E,_=Math.cos(_)*E,y.push(T,0,_),x.push(S.r,S.g,S.b),_=2*((r+1)/i)*Math.PI,T=Math.sin(_)*E,_=Math.cos(_)*E,y.push(T,0,_),x.push(S.r,S.g,S.b)}t=new Y,t.addAttribute("position",new j(y,3)),t.addAttribute("color",new j(x,3)),y=new xe({vertexColors:2}),X.call(this,t,y)}function ge(e,t,r,o){this.audio=e,this.range=t||1,this.divisionsInnerAngle=r||16,this.divisionsOuterAngle=o||2,e=new Y,t=new Float32Array(3*(3*(this.divisionsInnerAngle+2*this.divisionsOuterAngle)+3)),e.addAttribute("position",new C(t,3)),t=new xe({color:65280}),r=new xe({color:16776960}),W.call(this,e,[r,t]),this.update()}function An(e,t,r,o){this.object=e,this.size=void 0===t?1:t,e=void 0===r?16776960:r,o=void 0===o?1:o,t=0,(r=this.object.geometry)&&r.isGeometry?t=r.faces.length:console.warn("COCO.FaceNormalsHelper: only COCO.Geometry is supported. Use COCO.VertexNormalsHelper, instead."),r=new Y,t=new j(6*t,3),r.addAttribute("position",t),X.call(this,r,new xe({color:e,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Dn(e,t,r){y.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1),e=new Y,e.addAttribute("position",new j([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3)),t=new xe({fog:!1}),this.lightPlane=new W(e,t),this.add(this.lightPlane),e=new Y,e.addAttribute("position",new j([0,0,0,0,0,1],3)),this.targetLine=new W(e,t),this.add(this.targetLine),this.update()}function In(t){function r(e,t,r){o(e,r),o(t,r)}function o(t,r){e.push(0,0,0),s.push(r.r,r.g,r.b),void 0===d[t]&&(d[t]=[]),d[t].push(e.length/3-1)}var a=new Y,i=new xe({color:16777215,vertexColors:1}),e=[],s=[],d={},c=new v(16755200),u=new v(16711680),m=new v(43775),l=new v(16777215),p=new v(3355443);r("n1","n2",c),r("n2","n4",c),r("n4","n3",c),r("n3","n1",c),r("f1","f2",c),r("f2","f4",c),r("f4","f3",c),r("f3","f1",c),r("n1","f1",c),r("n2","f2",c),r("n3","f3",c),r("n4","f4",c),r("p","n1",u),r("p","n2",u),r("p","n3",u),r("p","n4",u),r("u1","u2",m),r("u2","u3",m),r("u3","u1",m),r("c","t",l),r("p","c",p),r("cn1","cn2",p),r("cn3","cn4",p),r("cf1","cf2",p),r("cf3","cf4",p),a.addAttribute("position",new j(e,3)),a.addAttribute("color",new j(s,3)),X.call(this,a,i),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=d,this.update()}function Bn(e,t){this.object=e,void 0===t&&(t=16776960),e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new Float32Array(24),o=new Y;o.setIndex(new C(e,1)),o.addAttribute("position",new C(r,3)),X.call(this,o,new xe({color:t})),this.matrixAutoUpdate=!1,this.update()}function zn(e,t){this.type="Box3Helper",this.box=e,t=t||16776960,e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new Y;r.setIndex(new C(e,1)),r.addAttribute("position",new j([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),X.call(this,r,new xe({color:t})),this.geometry.computeBoundingSphere()}function Nn(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t,e=void 0===r?16776960:r,t=new Y,t.addAttribute("position",new j([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),t.computeBoundingSphere(),W.call(this,t,new xe({color:e})),t=new Y,t.addAttribute("position",new j([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),t.computeBoundingSphere(),this.add(new B(t,new S({color:e,opacity:.2,transparent:!0,depthWrite:!1})))}function On(t,r,o,n,i,p){y.call(this),void 0===t&&(t=new s(0,0,1)),void 0===r&&(r=new s(0,0,0)),void 0===o&&(o=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*o),void 0===p&&(p=.2*i),void 0===Li&&(Li=new Y,Li.addAttribute("position",new j([0,0,0,0,1,0],3)),Ai=new fo(0,.5,1,5,1),Ai.translate(0,-.5,0)),this.position.copy(r),this.line=new W(Li,new xe({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new B(Ai,new S({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(o,i,p)}function kn(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e];e=new Y,e.addAttribute("position",new j(t,3)),e.addAttribute("color",new j([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),t=new xe({vertexColors:2}),X.call(this,e,t)}function Un(e){console.warn("COCO.ClosedSplineCurve3 has been deprecated. Use COCO.CatmullRomCurve3 instead."),Ee.call(this,e),this.type="catmullrom",this.closed=!0}function Gn(e){console.warn("COCO.SplineCurve3 has been deprecated. Use COCO.CatmullRomCurve3 instead."),Ee.call(this,e),this.type="catmullrom"}function Fn(e){console.warn("COCO.Spline has been removed. Use COCO.CatmullRomCurve3 instead."),Ee.call(this,e),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:0<e?1:+e}),!1=="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&function(){Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),a=1,o;a<arguments.length;a++)if(o=arguments[a],void 0!==o&&null!==o)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(r[n]=o[n]);return r}}(),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){void 0!==this._listeners&&(e=this._listeners[e],void 0!==e&&(t=e.indexOf(t),-1!==t&&e.splice(t,1)))},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this,t=t.slice(0);for(var r=0,a=t.length;r<a;r++)t[r].call(this,e)}}}});var Ze={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;256>e;e++)t[e]=(16>e?"0":"")+e.toString(16);return function(){var r=0|4294967295*Math.random(),a=0|4294967295*Math.random(),o=0|4294967295*Math.random(),e=0|4294967295*Math.random();return(t[255&r]+t[255&r>>8]+t[255&r>>16]+t[255&r>>24]+"-"+t[255&a]+t[255&a>>8]+"-"+t[64|15&a>>16]+t[255&a>>24]+"-"+t[128|63&o]+t[255&o>>8]+"-"+t[255&o>>16]+t[255&o>>24]+t[255&e]+t[255&e>>8]+t[255&e>>16]+t[255&e>>24]).toUpperCase()}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(t,r,a,o,n){return o+(t-r)*(n-o)/(a-r)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Ze.DEG2RAD},radToDeg:function(e){return e*Ze.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};Object.defineProperties(o.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(o.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this):(console.warn("COCO.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this):(console.warn("COCO.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y;return e=e.elements,this.x=e[0]*t+e[3]*r+e[6],this.y=e[1]*t+e[4]*r+e[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return 0>e&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return e=this.y-e.y,t*t+e*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("COCO.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(t,r){var a=Math.cos(r);r=Math.sin(r);var o=this.x-t.x,n=this.y-t.y;return this.x=o*a-n*r+t.x,this.y=o*r+n*a+t.y,this}}),Object.assign(i,{slerp:function(e,t,r,a){return r.copy(e).slerp(t,a)},slerpFlat:function(r,a,o,i,s,u,y){var v=o[i+0],x=o[i+1],_=o[i+2];o=o[i+3],i=s[u+0];var b=s[u+1],l=s[u+2];if(s=s[u+3],o!==s||v!==i||x!==b||_!==l){u=1-y;var p=v*i+x*b+_*l+o*s,T=0<=p?1:-1,S=1-p*p;S>Number.EPSILON&&(S=Math.sqrt(S),p=Math.atan2(S,p*T),u=Math.sin(u*p)/S,y=Math.sin(y*p)/S),T*=y,v=v*u+i*T,x=x*u+b*T,_=_*u+l*T,o=o*u+s*T,u===1-y&&(y=1/Math.sqrt(v*v+x*x+_*_+o*o),v*=y,x*=y,_*=y,o*=y)}r[a]=v,r[a+1]=x,r[a+2]=_,r[a+3]=o}}),Object.defineProperties(i.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(i.prototype,{isQuaternion:!0,set:function(e,t,r,a){return this._x=e,this._y=t,this._z=r,this._w=a,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(t,r){if(!t||!t.isEuler)throw Error("COCO.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var o=t._x,n=t._y,i=t._z;t=t.order;var s=Math.cos,p=Math.sin,l=s(o/2),m=s(n/2);return s=s(i/2),o=p(o/2),n=p(n/2),i=p(i/2),"XYZ"===t?(this._x=o*m*s+l*n*i,this._y=l*n*s-o*m*i,this._z=l*m*i+o*n*s,this._w=l*m*s-o*n*i):"YXZ"===t?(this._x=o*m*s+l*n*i,this._y=l*n*s-o*m*i,this._z=l*m*i-o*n*s,this._w=l*m*s+o*n*i):"ZXY"===t?(this._x=o*m*s-l*n*i,this._y=l*n*s+o*m*i,this._z=l*m*i+o*n*s,this._w=l*m*s-o*n*i):"ZYX"===t?(this._x=o*m*s-l*n*i,this._y=l*n*s+o*m*i,this._z=l*m*i-o*n*s,this._w=l*m*s+o*n*i):"YZX"===t?(this._x=o*m*s+l*n*i,this._y=l*n*s+o*m*i,this._z=l*m*i-o*n*s,this._w=l*m*s-o*n*i):"XZY"===t&&(this._x=o*m*s-l*n*i,this._y=l*n*s-o*m*i,this._z=l*m*i+o*n*s,this._w=l*m*s+o*n*i),!1!==r&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){t/=2;var r=Math.sin(t);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(t),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var r=t.elements,o=r[0];t=r[4];var n=r[8],i=r[1],e=r[5],s=r[9],d=r[2],p=r[6];r=r[10];var l=o+e+r;return 0<l?(o=.5/Math.sqrt(l+1),this._w=.25/o,this._x=(p-s)*o,this._y=(n-d)*o,this._z=(i-t)*o):o>e&&o>r?(o=2*Math.sqrt(1+o-e-r),this._w=(p-s)/o,this._x=.25*o,this._y=(t+i)/o,this._z=(n+d)/o):e>r?(o=2*Math.sqrt(1+e-o-r),this._w=(n-d)/o,this._x=(t+i)/o,this._y=.25*o,this._z=(s+p)/o):(o=2*Math.sqrt(1+r-o-e),this._w=(i-t)/o,this._x=(n+d)/o,this._y=(s+p)/o,this._z=.25*o),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=e.dot(t)+1;return 1E-6>r?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=r,this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Ze.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);return 0===r?this:(this.slerp(e,Math.min(1,t/r)),this)},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this._onChangeCallback(),this},multiply:function(e,t){return void 0===t?this.multiplyQuaternions(this,e):(console.warn("COCO.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t))},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(t,r){var o=t._x,n=t._y,i=t._z;t=t._w;var e=r._x,s=r._y,d=r._z;return r=r._w,this._x=o*r+t*e+n*d-i*s,this._y=n*r+t*s+i*e-o*d,this._z=i*r+t*d+o*s-n*e,this._w=t*r-o*e-n*s-i*d,this._onChangeCallback(),this},slerp:function(t,r){if(0===r)return this;if(1===r)return this.copy(t);var o=this._x,n=this._y,i=this._z,e=this._w,s=e*t._w+o*t._x+n*t._y+i*t._z;if(0>s?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),1<=s)return this._w=e,this._x=o,this._y=n,this._z=i,this;if(t=1-s*s,t<=Number.EPSILON)return s=1-r,this._w=s*e+r*this._w,this._x=s*o+r*this._x,this._y=s*n+r*this._y,this._z=s*i+r*this._z,this.normalize(),this._onChangeCallback(),this;t=Math.sqrt(t);var d=Math.atan2(t,s);return s=Math.sin((1-r)*d)/t,r=Math.sin(r*d)/t,this._w=e*s+this._w*r,this._x=o*s+this._x*r,this._y=n*s+this._y*r,this._z=i*s+this._z*r,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(s.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this.z+=e.z,this):(console.warn("COCO.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this.z-=e.z,this):(console.warn("COCO.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0===t?(this.x*=e.x,this.y*=e.y,this.z*=e.z,this):(console.warn("COCO.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t))},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new i;return function(t){return t&&t.isEuler||console.error("COCO.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new i;return function(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,o=this.z;return e=e.elements,this.x=e[0]*t+e[3]*r+e[6]*o,this.y=e[1]*t+e[4]*r+e[7]*o,this.z=e[2]*t+e[5]*r+e[8]*o,this},applyMatrix4:function(t){var r=this.x,o=this.y,n=this.z;t=t.elements;var i=1/(t[3]*r+t[7]*o+t[11]*n+t[15]);return this.x=(t[0]*r+t[4]*o+t[8]*n+t[12])*i,this.y=(t[1]*r+t[5]*o+t[9]*n+t[13])*i,this.z=(t[2]*r+t[6]*o+t[10]*n+t[14])*i,this},applyQuaternion:function(t){var r=this.x,o=this.y,n=this.z,i=t.x,e=t.y,s=t.z;t=t.w;var d=t*r+e*n-s*o,p=t*o+s*r-i*n,l=t*n+i*o-e*r;return r=-i*r-e*o-s*n,this.x=d*t+r*-i+p*-s-l*-e,this.y=p*t+r*-e+l*-i-d*-s,this.z=l*t+r*-s+d*-e-p*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,o=this.z;return e=e.elements,this.x=e[0]*t+e[4]*r+e[8]*o,this.y=e[1]*t+e[5]*r+e[9]*o,this.z=e[2]*t+e[6]*r+e[10]*o,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0===t?this.crossVectors(this,e):(console.warn("COCO.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t))},crossVectors:function(t,r){var o=t.x,n=t.y;t=t.z;var i=r.x,e=r.y;return r=r.z,this.x=n*r-t*e,this.y=t*i-o*r,this.z=o*e-n*i,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new s;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new s;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){return e=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq()),Math.acos(Ze.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return e=this.z-e.z,t*t+r*r+e*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var a=Math.sin(t)*e;return this.x=a*Math.sin(r),this.y=Math.cos(t)*e,this.z=a*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){return e=e.elements,this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length();return e=this.setFromMatrixColumn(e,2).length(),this.x=t,this.y=r,this.z=e,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("COCO.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var O;Object.assign(r.prototype,{isMatrix3:!0,set:function(t,r,a,o,n,e,i,s,d){var p=this.elements;return p[0]=t,p[1]=o,p[2]=i,p[3]=r,p[4]=n,p[5]=s,p[6]=a,p[7]=e,p[8]=d,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements;return e=e.elements,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},setFromMatrix4:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(e){void 0===O&&(O=new s);for(var t=0,r=e.count;t<r;t++)O.x=e.getX(t),O.y=e.getY(t),O.z=e.getZ(t),O.applyMatrix3(this),e.setXYZ(t,O.x,O.y,O.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(r,o){var i=r.elements,s=o.elements;o=this.elements,r=i[0];var u=i[3],e=i[6],f=i[1],g=i[4],h=i[7],y=i[2],m=i[5];i=i[8];var l=s[0],p=s[3],n=s[6],t=s[1],_=s[4],v=s[7],x=s[2],T=s[5];return s=s[8],o[0]=r*l+u*t+e*x,o[3]=r*p+u*_+e*T,o[6]=r*n+u*v+e*s,o[1]=f*l+g*t+h*x,o[4]=f*p+g*_+h*T,o[7]=f*n+g*v+h*s,o[2]=y*l+m*t+i*x,o[5]=y*p+m*_+i*T,o[8]=y*n+m*v+i*s,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var t=this.elements,r=t[0],o=t[1],n=t[2],i=t[3],e=t[4],s=t[5],d=t[6],p=t[7];return t=t[8],r*e*t-r*s*p-o*i*t+o*s*d+n*i*p-n*e*d},getInverse:function(r,o){r&&r.isMatrix4&&console.error("COCO.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=r.elements;r=this.elements;var s=i[0],d=i[1],e=i[2],u=i[3],g=i[4],f=i[5],h=i[6],m=i[7];i=i[8];var l=i*g-f*m,p=f*h-i*u,n=m*u-g*h,t=s*l+d*p+e*n;if(0==t){if(!0===o)throw Error("COCO.Matrix3: .getInverse() can't invert matrix, determinant is 0");return console.warn("COCO.Matrix3: .getInverse() can't invert matrix, determinant is 0"),this.identity()}return o=1/t,r[0]=l*o,r[1]=(e*m-i*d)*o,r[2]=(f*d-e*g)*o,r[3]=p*o,r[4]=(i*s-e*h)*o,r[5]=(e*u-f*s)*o,r[6]=n*o,r[7]=(d*h-m*s)*o,r[8]=(g*s-d*u)*o,this},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(t,r,a,o,n,i,s){var d=Math.cos(n);n=Math.sin(n),this.set(a*d,a*n,-a*(d*i+n*s)+i+t,-o*n,o*d,-o*(-n*i+d*s)+s+r,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(t){var r=Math.cos(t);t=Math.sin(t);var o=this.elements,n=o[0],i=o[3],e=o[6],s=o[1],d=o[4],p=o[7];return o[0]=r*n+t*s,o[3]=r*i+t*d,o[6]=r*e+t*p,o[1]=-t*n+r*s,o[4]=-t*i+r*d,o[7]=-t*e+r*p,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){var t=this.elements;e=e.elements;for(var r=0;9>r;r++)if(t[r]!==e[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;9>r;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var Hn={getDataURL:function(e){if("undefined"==typeof HTMLCanvasElement)return e.src;if(!(e instanceof HTMLCanvasElement)){void 0===Wn&&(Wn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Wn.width=e.width,Wn.height=e.height;var t=Wn.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),e=Wn}return 2048<e.width||2048<e.height?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},Vn=0,Wn;n.DEFAULT_IMAGE=void 0,n.DEFAULT_MAPPING=300,n.prototype=Object.assign(Object.create(t.prototype),{constructor:n,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(t){var r=void 0===t||"string"==typeof t;if(!r&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var a={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var o=this.image;if(void 0===o.uuid&&(o.uuid=Ze.generateUUID()),!r&&void 0===t.images[o.uuid]){if(Array.isArray(o))for(var n=[],i=0,s=o.length;i<s;i++)n.push(Hn.getDataURL(o[i]));else n=Hn.getDataURL(o);t.images[o.uuid]={uuid:o.uuid,url:n}}a.image=o.uuid}return r||(t.textures[this.uuid]=a),a},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),0>e.x||1<e.x)switch(this.wrapS){case 1E3:e.x-=Math.floor(e.x);break;case 1001:e.x=0>e.x?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x);}if(0>e.y||1<e.y)switch(this.wrapT){case 1E3:e.y-=Math.floor(e.y);break;case 1001:e.y=0>e.y?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y);}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(n.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(u.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(u.prototype,{isVector4:!0,set:function(e,t,r,a){return this.x=e,this.y=t,this.z=r,this.w=a,this},setScalar:function(e){return this.w=this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0===e.w?1:e.w,this},add:function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this):(console.warn("COCO.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this):(console.warn("COCO.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(t){var r=this.x,o=this.y,n=this.z,i=this.w;return t=t.elements,this.x=t[0]*r+t[4]*o+t[8]*n+t[12]*i,this.y=t[1]*r+t[5]*o+t[9]*n+t[13]*i,this.z=t[2]*r+t[6]*o+t[10]*n+t[14]*i,this.w=t[3]*r+t[7]*o+t[11]*n+t[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1E-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(t){t=t.elements;var r=t[0],o=t[4],n=t[8],i=t[1],e=t[5],s=t[9],p=t[2],l=t[6],u=t[10];return .01>Math.abs(o-i)&&.01>Math.abs(n-p)&&.01>Math.abs(s-l)?.1>Math.abs(o+i)&&.1>Math.abs(n+p)&&.1>Math.abs(s+l)&&.1>Math.abs(r+e+u-3)?(this.set(1,0,0,0),this):(t=Math.PI,r=(r+1)/2,e=(e+1)/2,u=(u+1)/2,o=(o+i)/4,n=(n+p)/4,s=(s+l)/4,r>e&&r>u?.01>r?(l=0,o=p=.707106781):(l=Math.sqrt(r),p=o/l,o=n/l):e>u?.01>e?(l=.707106781,p=0,o=.707106781):(p=Math.sqrt(e),l=o/p,o=s/p):.01>u?(p=l=.707106781,o=0):(o=Math.sqrt(u),l=n/o,p=s/o),this.set(l,p,o,t),this):(t=Math.sqrt((l-s)*(l-s)+(n-p)*(n-p)+(i-o)*(i-o)),.001>Math.abs(t)&&(t=1),this.x=(l-s)/t,this.y=(n-p)/t,this.z=(i-o)/t,this.w=Math.acos((r+e+u-1)/2),this)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("COCO.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),p.prototype=Object.assign(Object.create(t.prototype),{constructor:p,isWebGLRenderTarget:!0,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),a.prototype=Object.assign(Object.create(p.prototype),{constructor:a,isWebGLMultisampleRenderTarget:!0,copy:function(e){return p.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(_.prototype,{isMatrix4:!0,set:function(o,a,i,s,d,e,c,u,g,f,m,l,p,n,t,h){var y=this.elements;return y[0]=o,y[4]=a,y[8]=i,y[12]=s,y[1]=d,y[5]=e,y[9]=c,y[13]=u,y[2]=g,y[6]=f,y[10]=m,y[14]=l,y[3]=p,y[7]=n,y[11]=t,y[15]=h,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new _().fromArray(this.elements)},copy:function(e){var t=this.elements;return e=e.elements,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},copyPosition:function(e){var t=this.elements;return e=e.elements,t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t=new s;return function(r){var a=this.elements,o=r.elements,n=1/t.setFromMatrixColumn(r,0).length(),e=1/t.setFromMatrixColumn(r,1).length();return r=1/t.setFromMatrixColumn(r,2).length(),a[0]=o[0]*n,a[1]=o[1]*n,a[2]=o[2]*n,a[3]=0,a[4]=o[4]*e,a[5]=o[5]*e,a[6]=o[6]*e,a[7]=0,a[8]=o[8]*r,a[9]=o[9]*r,a[10]=o[10]*r,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("COCO.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=this.elements,o=t.x,n=t.y,i=t.z,s=Math.cos(o);o=Math.sin(o);var p=Math.cos(n);n=Math.sin(n);var u=Math.cos(i);if(i=Math.sin(i),"XYZ"===t.order){t=s*u;var g=s*i,f=o*u,h=o*i;r[0]=p*u,r[4]=-p*i,r[8]=n,r[1]=g+f*n,r[5]=t-h*n,r[9]=-o*p,r[2]=h-t*n,r[6]=f+g*n,r[10]=s*p}else"YXZ"===t.order?(t=p*u,g=p*i,f=n*u,h=n*i,r[0]=t+h*o,r[4]=f*o-g,r[8]=s*n,r[1]=s*i,r[5]=s*u,r[9]=-o,r[2]=g*o-f,r[6]=h+t*o,r[10]=s*p):"ZXY"===t.order?(t=p*u,g=p*i,f=n*u,h=n*i,r[0]=t-h*o,r[4]=-s*i,r[8]=f+g*o,r[1]=g+f*o,r[5]=s*u,r[9]=h-t*o,r[2]=-s*n,r[6]=o,r[10]=s*p):"ZYX"===t.order?(t=s*u,g=s*i,f=o*u,h=o*i,r[0]=p*u,r[4]=f*n-g,r[8]=t*n+h,r[1]=p*i,r[5]=h*n+t,r[9]=g*n-f,r[2]=-n,r[6]=o*p,r[10]=s*p):"YZX"===t.order?(t=s*p,g=s*n,f=o*p,h=o*n,r[0]=p*u,r[4]=h-t*i,r[8]=f*i+g,r[1]=i,r[5]=s*u,r[9]=-o*u,r[2]=-n*u,r[6]=g*i+f,r[10]=t-h*i):"XZY"===t.order&&(t=s*p,g=s*n,f=o*p,h=o*n,r[0]=p*u,r[4]=-i,r[8]=n*u,r[1]=t*i+h,r[5]=s*u,r[9]=g*i-f,r[2]=f*i-g,r[6]=o*u,r[10]=h*i+t);return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},makeRotationFromQuaternion:function(){var e=new s(0,0,0),t=new s(1,1,1);return function(r){return this.compose(e,r,t)}}(),lookAt:function(){var t=new s,r=new s,a=new s;return function(o,n,e){var i=this.elements;return a.subVectors(o,n),0===a.lengthSq()&&(a.z=1),a.normalize(),t.crossVectors(e,a),0===t.lengthSq()&&(1===Math.abs(e.z)?a.x+=1E-4:a.z+=1E-4,a.normalize(),t.crossVectors(e,a)),t.normalize(),r.crossVectors(a,t),i[0]=t.x,i[4]=r.x,i[8]=a.x,i[1]=t.y,i[5]=r.y,i[9]=a.y,i[2]=t.z,i[6]=r.z,i[10]=a.z,this}}(),multiply:function(e,t){return void 0===t?this.multiplyMatrices(this,e):(console.warn("COCO.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t))},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(r,o){var i=r.elements,s=o.elements;o=this.elements,r=i[0];var u=i[4],e=i[8],f=i[12],g=i[1],h=i[5],_=i[9],m=i[13],l=i[2],p=i[6],n=i[10],t=i[14],S=i[3],v=i[7],x=i[11];i=i[15];var P=s[0],w=s[4],y=s[8],R=s[12],L=s[1],A=s[5],D=s[9],B=s[13],E=s[2],C=s[6],z=s[10],I=s[14],O=s[3],M=s[7],N=s[11];return s=s[15],o[0]=r*P+u*L+e*E+f*O,o[4]=r*w+u*A+e*C+f*M,o[8]=r*y+u*D+e*z+f*N,o[12]=r*R+u*B+e*I+f*s,o[1]=g*P+h*L+_*E+m*O,o[5]=g*w+h*A+_*C+m*M,o[9]=g*y+h*D+_*z+m*N,o[13]=g*R+h*B+_*I+m*s,o[2]=l*P+p*L+n*E+t*O,o[6]=l*w+p*A+n*C+t*M,o[10]=l*y+p*D+n*z+t*N,o[14]=l*R+p*B+n*I+t*s,o[3]=S*P+v*L+x*E+i*O,o[7]=S*w+v*A+x*C+i*M,o[11]=S*y+v*D+x*z+i*N,o[15]=S*R+v*B+x*I+i*s,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new s;return function(t){for(var r=0,a=t.count;r<a;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var t=this.elements,r=t[0],a=t[4],o=t[8],i=t[12],e=t[1],s=t[5],d=t[9],c=t[13],u=t[2],m=t[6],l=t[10],p=t[14];return t[3]*(+i*d*m-o*c*m-i*s*l+a*c*l+o*s*p-a*d*p)+t[7]*(+r*d*p-r*c*l+i*e*l-o*e*p+o*c*u-i*d*u)+t[11]*(+r*c*m-r*s*p-i*e*m+a*e*p+i*s*u-a*c*u)+t[15]*(-o*s*u-r*d*m+r*s*l+o*e*m-a*e*l+a*d*u)},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e,t,r){var a=this.elements;return e.isVector3?(a[12]=e.x,a[13]=e.y,a[14]=e.z):(a[12]=e,a[13]=t,a[14]=r),this},getInverse:function(r,o){var i=this.elements,s=r.elements;r=s[0];var c=s[1],e=s[2],u=s[3],g=s[4],f=s[5],h=s[6],m=s[7],l=s[8],p=s[9],n=s[10],t=s[11],_=s[12],v=s[13],x=s[14];s=s[15];var T=p*x*m-v*n*m+v*h*t-f*x*t-p*h*s+f*n*s,S=_*n*m-l*x*m-_*h*t+g*x*t+l*h*s-g*n*s,y=l*v*m-_*p*m+_*f*t-g*v*t-l*f*s+g*p*s,E=_*p*h-l*v*h-_*f*n+g*v*n+l*f*x-g*p*x,M=r*T+c*S+e*y+u*E;if(0==M){if(!0===o)throw Error("COCO.Matrix4: .getInverse() can't invert matrix, determinant is 0");return console.warn("COCO.Matrix4: .getInverse() can't invert matrix, determinant is 0"),this.identity()}return o=1/M,i[0]=T*o,i[1]=(v*n*u-p*x*u-v*e*t+c*x*t+p*e*s-c*n*s)*o,i[2]=(f*x*u-v*h*u+v*e*m-c*x*m-f*e*s+c*h*s)*o,i[3]=(p*h*u-f*n*u-p*e*m+c*n*m+f*e*t-c*h*t)*o,i[4]=S*o,i[5]=(l*x*u-_*n*u+_*e*t-r*x*t-l*e*s+r*n*s)*o,i[6]=(_*h*u-g*x*u-_*e*m+r*x*m+g*e*s-r*h*s)*o,i[7]=(g*n*u-l*h*u+l*e*m-r*n*m-g*e*t+r*h*t)*o,i[8]=y*o,i[9]=(_*p*u-l*v*u-_*c*t+r*v*t+l*c*s-r*p*s)*o,i[10]=(g*v*u-_*f*u+_*c*m-r*v*m-g*c*s+r*f*s)*o,i[11]=(l*f*u-g*p*u-l*c*m+r*p*m+g*c*t-r*f*t)*o,i[12]=E*o,i[13]=(l*v*e-_*p*e+_*c*n-r*v*n-l*c*x+r*p*x)*o,i[14]=(_*f*e-g*v*e-_*c*h+r*v*h+g*c*x-r*f*x)*o,i[15]=(g*p*e-l*f*e+l*c*h-r*p*h-g*c*n+r*f*n)*o,this},scale:function(e){var t=this.elements,r=e.x,o=e.y;return e=e.z,t[0]*=r,t[4]*=o,t[8]*=e,t[1]*=r,t[5]*=o,t[9]*=e,t[2]*=r,t[6]*=o,t[10]*=e,t[3]*=r,t[7]*=o,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,r){var o=Math.cos(r);r=Math.sin(r);var n=1-o,i=t.x,e=t.y;t=t.z;var s=n*i,d=n*e;return this.set(s*i+o,s*e-r*t,s*t+r*e,0,s*e+r*t,d*e+o,d*t-r*i,0,s*t-r*e,d*t+r*i,n*t*t+o,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(r,a,o){var i=this.elements,s=a._x,d=a._y,u=a._z,y=a._w,v=s+s,x=d+d,_=u+u;a=s*v;var T=s*x;s*=_;var p=d*x;d*=_,u*=_,v*=y,x*=y,y*=_,_=o.x;var n=o.y;return o=o.z,i[0]=(1-(p+u))*_,i[1]=(T+y)*_,i[2]=(s-x)*_,i[3]=0,i[4]=(T-y)*n,i[5]=(1-(a+u))*n,i[6]=(d+v)*n,i[7]=0,i[8]=(s+x)*o,i[9]=(d-v)*o,i[10]=(1-(a+p))*o,i[11]=0,i[12]=r.x,i[13]=r.y,i[14]=r.z,i[15]=1,this},decompose:function(){var t=new s,r=new _;return function(a,o,n){var e=this.elements,i=t.set(e[0],e[1],e[2]).length(),s=t.set(e[4],e[5],e[6]).length(),d=t.set(e[8],e[9],e[10]).length();0>this.determinant()&&(i=-i),a.x=e[12],a.y=e[13],a.z=e[14],r.copy(this),a=1/i,e=1/s;var p=1/d;return r.elements[0]*=a,r.elements[1]*=a,r.elements[2]*=a,r.elements[4]*=e,r.elements[5]*=e,r.elements[6]*=e,r.elements[8]*=p,r.elements[9]*=p,r.elements[10]*=p,o.setFromRotationMatrix(r),n.x=i,n.y=s,n.z=d,this}}(),makePerspective:function(t,r,a,o,n,e){void 0===e&&console.warn("COCO.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var i=this.elements;return i[0]=2*n/(r-t),i[4]=0,i[8]=(r+t)/(r-t),i[12]=0,i[1]=0,i[5]=2*n/(a-o),i[9]=(a+o)/(a-o),i[13]=0,i[2]=0,i[6]=0,i[10]=-(e+n)/(e-n),i[14]=-2*e*n/(e-n),i[3]=0,i[7]=0,i[11]=-1,i[15]=0,this},makeOrthographic:function(t,r,a,o,n,e){var i=this.elements,s=1/(r-t),d=1/(a-o),p=1/(e-n);return i[0]=2*s,i[4]=0,i[8]=0,i[12]=-((r+t)*s),i[1]=0,i[5]=2*d,i[9]=0,i[13]=-((a+o)*d),i[2]=0,i[6]=0,i[10]=-2*p,i[14]=-((e+n)*p),i[3]=0,i[7]=0,i[11]=0,i[15]=1,this},equals:function(e){var t=this.elements;e=e.elements;for(var r=0;16>r;r++)if(t[r]!==e[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;16>r;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}});var jn,qn;l.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],l.DefaultOrder="XYZ",Object.defineProperties(l.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(l.prototype,{isEuler:!0,set:function(e,t,r,a){return this._x=e,this._y=t,this._z=r,this._order=a||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,r,o){var n=Ze.clamp,i=t.elements;t=i[0];var s=i[4],d=i[8],c=i[1],u=i[5],g=i[9],m=i[2],l=i[6];return i=i[10],r=r||this._order,"XYZ"===r?(this._y=Math.asin(n(d,-1,1)),.99999>Math.abs(d)?(this._x=Math.atan2(-g,i),this._z=Math.atan2(-s,t)):(this._x=Math.atan2(l,u),this._z=0)):"YXZ"===r?(this._x=Math.asin(-n(g,-1,1)),.99999>Math.abs(g)?(this._y=Math.atan2(d,i),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-m,t),this._z=0)):"ZXY"===r?(this._x=Math.asin(n(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(-m,i),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(c,t))):"ZYX"===r?(this._y=Math.asin(-n(m,-1,1)),.99999>Math.abs(m)?(this._x=Math.atan2(l,i),this._z=Math.atan2(c,t)):(this._x=0,this._z=Math.atan2(-s,u))):"YZX"===r?(this._z=Math.asin(n(c,-1,1)),.99999>Math.abs(c)?(this._x=Math.atan2(-g,u),this._y=Math.atan2(-m,t)):(this._x=0,this._y=Math.atan2(d,i))):"XZY"===r?(this._z=Math.asin(-n(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(l,u),this._y=Math.atan2(d,t)):(this._x=Math.atan2(-g,i),this._y=0)):console.warn("COCO.Euler: .setFromRotationMatrix() given unsupported order: "+r),this._order=r,!1!==o&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,r){return void 0===jn&&(jn=new _),jn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(jn,t,r)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return void 0===qn&&(qn=new i),qn.setFromEuler(this),this.setFromQuaternion(qn,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new s(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(m.prototype,{set:function(e){this.mask=0|1<<e},enable:function(e){this.mask=0|(this.mask|1<<e)},toggle:function(e){this.mask^=0|1<<e},disable:function(e){this.mask&=~(0|1<<e)},test:function(e){return 0!=(this.mask&e.mask)}});var Xn=0;y.DefaultUp=new s(0,1,0),y.DefaultMatrixAutoUpdate=!0,y.prototype=Object.assign(Object.create(t.prototype),{constructor:y,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new i;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new i;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new s(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new s(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new s(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new s;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new s(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new s(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new s(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new _;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new i,r=new _,a=new s,o=new s;return function(n,i,s){n.isVector3?a.copy(n):a.set(n,i,s),n=this.parent,this.updateWorldMatrix(!0,!1),o.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?r.lookAt(o,a,this.up):r.lookAt(a,o,this.up),this.quaternion.setFromRotationMatrix(r),n&&(r.extractRotation(n.matrixWorld),t.setFromRotationMatrix(r),this.quaternion.premultiply(t.inverse()))}}(),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("COCO.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})):console.error("COCO.Object3D.add: object not an instance of COCO.Object3D.",e),this)},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}return t=this.children.indexOf(e),-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent({type:"removed"})),this},attach:function(){var e=new _;return function(t){return this.updateWorldMatrix(!0,!1),e.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),e.multiply(t.parent.matrixWorld)),t.applyMatrix(e),t.updateWorldMatrix(!1,!1),this.add(t),this}}(),getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(t,r){if(this[t]===r)return this;for(var a=0,o=this.children.length,n;a<o;a++)if(n=this.children[a].getObjectByProperty(t,r),void 0!==n)return n},getWorldPosition:function(e){return void 0===e&&(console.warn("COCO.Object3D: .getWorldPosition() target is now required"),e=new s),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new s,t=new s;return function(r){return void 0===r&&(console.warn("COCO.Object3D: .getWorldQuaternion() target is now required"),r=new i),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldScale:function(){var e=new s,t=new i;return function(r){return void 0===r&&(console.warn("COCO.Object3D: .getWorldScale() target is now required"),r=new s),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(e){void 0===e&&(console.warn("COCO.Object3D: .getWorldDirection() target is now required"),e=new s),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,a=t.length;r<a;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,a=t.length;r<a;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,o=t.length;r<o;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(e=this.children,t=0,r=e.length;t<r;t++)e[t].updateWorldMatrix(!1,!0)},toJSON:function(t){function r(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}function o(e){var t=[],r;for(r in e){var a=e[r];delete a.metadata,t.push(a)}return t}var n=void 0===t||"string"==typeof t,i={};n&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var e={};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),!0===this.castShadow&&(e.castShadow=!0),!0===this.receiveShadow&&(e.receiveShadow=!0),!1===this.visible&&(e.visible=!1),!1===this.frustumCulled&&(e.frustumCulled=!1),0!==this.renderOrder&&(e.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.layers=this.layers.mask,e.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(e.matrixAutoUpdate=!1),this.isMesh&&0!==this.drawMode&&(e.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){e.geometry=r(t.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes)if(s=s.shapes,Array.isArray(s))for(var p=0,l=s.length;p<l;p++)r(t.shapes,s[p]);else r(t.shapes,s)}if(void 0!==this.material)if(Array.isArray(this.material)){for(s=[],p=0,l=this.material.length;p<l;p++)s.push(r(t.materials,this.material[p]));e.material=s}else e.material=r(t.materials,this.material);if(0<this.children.length)for(e.children=[],p=0;p<this.children.length;p++)e.children.push(this.children[p].toJSON(t).object);if(n){n=o(t.geometries),p=o(t.materials),l=o(t.textures);var c=o(t.images);s=o(t.shapes),0<n.length&&(i.geometries=n),0<p.length&&(i.materials=p),0<l.length&&(i.textures=l),0<c.length&&(i.images=c),0<s.length&&(i.shapes=s)}return i.object=e,i},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}}),h.prototype=Object.assign(Object.create(y.prototype),{constructor:h,isScene:!0,copy:function(e,t){return y.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=y.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(g.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(t){for(var r=1/0,a=1/0,o=1/0,n=-Infinity,i=-Infinity,s=-Infinity,u=0,y=t.length;u<y;u+=3){var v=t[u],m=t[u+1],l=t[u+2];v<r&&(r=v),m<a&&(a=m),l<o&&(o=l),v>n&&(n=v),m>i&&(i=m),l>s&&(s=l)}return this.min.set(r,a,o),this.max.set(n,i,s),this},setFromBufferAttribute:function(t){for(var r=1/0,a=1/0,o=1/0,n=-Infinity,i=-Infinity,s=-Infinity,u=0,y=t.count;u<y;u++){var v=t.getX(u),m=t.getY(u),l=t.getZ(u);v<r&&(r=v),m<a&&(a=m),l<o&&(o=l),v>n&&(n=v),m>i&&(i=m),l>s&&(s=l)}return this.min.set(r,a,o),this.max.set(n,i,s),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new s;return function(t,r){return r=e.copy(r).multiplyScalar(.5),this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("COCO.Box3: .getCenter() target is now required"),e=new s),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("COCO.Box3: .getSize() target is now required"),e=new s),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){function t(t){var a=t.geometry;if(void 0!==a)if(a.isGeometry)for(a=a.vertices,o=0,n=a.length;o<n;o++)r.copy(a[o]),r.applyMatrix4(t.matrixWorld),e.expandByPoint(r);else if(a.isBufferGeometry&&(a=a.attributes.position,void 0!==a))for(o=0,n=a.count;o<n;o++)r.fromBufferAttribute(a,o).applyMatrix4(t.matrixWorld),e.expandByPoint(r)}var r=new s,e,o,n;return function(r){return e=this,r.updateMatrixWorld(!0),r.traverse(t),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("COCO.Box3: .getParameter() target is now required"),t=new s),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new s;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){if(0<e.normal.x)var t=e.normal.x*this.min.x,r=e.normal.x*this.max.x;else t=e.normal.x*this.max.x,r=e.normal.x*this.min.x;return 0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(){function t(t){var a=0,s;for(s=t.length-3;a<=s;a+=3){d.fromArray(t,a);var p=c.x*Math.abs(d.x)+c.y*Math.abs(d.y)+c.z*Math.abs(d.z),m=o.dot(d),u=n.dot(d),l=i.dot(d);if(Math.max(-Math.max(m,u,l),Math.min(m,u,l))>p)return!1}return!0}var o=new s,n=new s,i=new s,r=new s,e=new s,a=new s,d=new s,p=new s,c=new s,m=new s;return function(s){return!this.isEmpty()&&(this.getCenter(p),c.subVectors(this.max,p),o.subVectors(s.a,p),n.subVectors(s.b,p),i.subVectors(s.c,p),r.subVectors(n,o),e.subVectors(i,n),a.subVectors(o,i),s=[0,-r.z,r.y,0,-e.z,e.y,0,-a.z,a.y,r.z,0,-r.x,e.z,0,-e.x,a.z,0,-a.x,-r.y,r.x,0,-e.y,e.x,0,-a.y,a.x,0],!!t(s))&&(s=[1,0,0,0,1,0,0,0,1],!!t(s))&&(m.crossVectors(r,e),s=[m.x,m.y,m.z],t(s))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("COCO.Box3: .clampPoint() target is now required"),t=new s),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new s;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new s;return function(t){return void 0===t&&console.error("COCO.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new s,new s,new s,new s,new s,new s,new s,new s];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Yn;Object.assign(T.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(t,r){void 0===Yn&&(Yn=new g);var a=this.center;void 0===r?Yn.setFromPoints(t).getCenter(a):a.copy(r);for(var o=r=0,n=t.length;o<n;o++)r=Math.max(r,a.distanceToSquared(t[o]));return this.radius=Math.sqrt(r),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("COCO.Sphere: .clampPoint() target is now required"),t=new s),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("COCO.Sphere: .getBoundingBox() target is now required"),e=new g),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(L.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("COCO.Ray: .at() target is now required"),t=new s),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new s;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){return void 0===t&&(console.warn("COCO.Ray: .closestPointToPoint() target is now required"),t=new s),t.subVectors(e,this.origin),e=t.dot(this.direction),0>e?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new s;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var r=new s,a=new s,o=new s;return function(i,s,c,u){r.copy(i).add(s).multiplyScalar(.5),a.copy(s).sub(i).normalize(),o.copy(this.origin).sub(r);var g=.5*i.distanceTo(s),f=-this.direction.dot(a),y=o.dot(this.direction),m=-o.dot(a),l=o.lengthSq(),p=Math.abs(1-f*f);if(0<p){i=f*m-y,s=f*y-m;var n=g*p;0<=i?s>=-n?s<=n?(g=1/p,i*=g,s*=g,f=i*(i+f*s+2*y)+s*(f*i+s+2*m)+l):(s=g,i=Math.max(0,-(f*s+y)),f=-i*i+s*(s+2*m)+l):(s=-g,i=Math.max(0,-(f*s+y)),f=-i*i+s*(s+2*m)+l):s<=-n?(i=Math.max(0,-(-f*g+y)),s=0<i?-g:Math.min(Math.max(-g,-m),g),f=-i*i+s*(s+2*m)+l):s<=n?(i=0,s=Math.min(Math.max(-g,-m),g),f=s*(s+2*m)+l):(i=Math.max(0,-(f*g+y)),s=0<i?g:Math.min(Math.max(-g,-m),g),f=-i*i+s*(s+2*m)+l)}else s=0<f?-g:g,i=Math.max(0,-(f*s+y)),f=-i*i+s*(s+2*m)+l;return c&&c.copy(this.direction).multiplyScalar(i).add(this.origin),u&&u.copy(a).multiplyScalar(s).add(r),f}}(),intersectSphere:function(){var t=new s;return function(r,a){t.subVectors(r.center,this.origin);var o=t.dot(this.direction),n=t.dot(t)-o*o;return(r=r.radius*r.radius,n>r)?null:(r=Math.sqrt(r-n),n=o-r,o+=r,0>n&&0>o?null:0>n?this.at(o,a):this.at(n,a))}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:(e=-(this.origin.dot(e.normal)+e.constant)/t,0<=e?e:null)},intersectPlane:function(e,t){return e=this.distanceToPlane(e),null===e?null:this.at(e,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return!!(0===t||0>e.normal.dot(this.direction)*t)},intersectBox:function(t,r){var o=1/this.direction.x,n=1/this.direction.y,i=1/this.direction.z,e=this.origin;if(0<=o){var s=(t.min.x-e.x)*o;o*=t.max.x-e.x}else s=(t.max.x-e.x)*o,o*=t.min.x-e.x;if(0<=n){var p=(t.min.y-e.y)*n;n*=t.max.y-e.y}else p=(t.max.y-e.y)*n,n*=t.min.y-e.y;return s>n||p>o?null:((p>s||s!==s)&&(s=p),(n<o||o!==o)&&(o=n),0<=i?(p=(t.min.z-e.z)*i,t=(t.max.z-e.z)*i):(p=(t.max.z-e.z)*i,t=(t.min.z-e.z)*i),s>t||p>o)?null:((p>s||s!==s)&&(s=p),(t<o||o!==o)&&(o=t),0>o?null:this.at(0<=s?s:o,r))},intersectsBox:function(){var e=new s;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var t=new s,r=new s,a=new s,o=new s;return function(n,i,s,d,p){if(r.subVectors(i,n),a.subVectors(s,n),o.crossVectors(r,a),i=this.direction.dot(o),0<i){if(d)return null;d=1}else if(0>i)d=-1,i=-i;else return null;return(t.subVectors(this.origin,n),n=d*this.direction.dot(a.crossVectors(t,a)),0>n)?null:(s=d*this.direction.dot(r.cross(t)),0>s||n+s>i)?null:(n=-d*t.dot(o),0>n?null:this.at(n/i,p))}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(D,{getNormal:function(){var t=new s;return function(r,a,o,n){return void 0===n&&(console.warn("COCO.Triangle: .getNormal() target is now required"),n=new s),n.subVectors(o,a),t.subVectors(r,a),n.cross(t),r=n.lengthSq(),0<r?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}}(),getBarycoord:function(){var t=new s,r=new s,a=new s;return function(o,n,i,p,l){t.subVectors(p,n),r.subVectors(i,n),a.subVectors(o,n),o=t.dot(t),n=t.dot(r),i=t.dot(a);var c=r.dot(r);p=r.dot(a);var u=o*c-n*n;return(void 0===l&&(console.warn("COCO.Triangle: .getBarycoord() target is now required"),l=new s),0==u)?l.set(-2,-1,-1):(u=1/u,c=(c*i-n*p)*u,o=(o*p-n*i)*u,l.set(1-c-o,o,c))}}(),containsPoint:function(){var t=new s;return function(r,a,o,n){return D.getBarycoord(r,a,o,n,t),0<=t.x&&0<=t.y&&1>=t.x+t.y}}(),getUV:function(){var t=new s;return function(r,a,o,n,e,i,s,d){return this.getBarycoord(r,a,o,n,t),d.set(0,0),d.addScaledVector(e,t.x),d.addScaledVector(i,t.y),d.addScaledVector(s,t.z),d}}(),isFrontFacing:function(){var t=new s,r=new s;return function(a,o,n,e){return t.subVectors(n,o),r.subVectors(a,o),!!(0>t.cross(r).dot(e))}}()}),Object.assign(D.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,a){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[a]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new s,t=new s;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("COCO.Triangle: .getMidpoint() target is now required"),e=new s),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return D.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("COCO.Triangle: .getPlane() target is now required"),e=new s),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return D.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(t,r,a,o,n){return D.getUV(t,this.a,this.b,this.c,r,a,o,n)},containsPoint:function(e){return D.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return D.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var r=new s,a=new s,o=new s,n=new s,i=new s,e=new s;return function(d,c){void 0===c&&(console.warn("COCO.Triangle: .closestPointToPoint() target is now required"),c=new s);var f=this.a,y=this.b,_=this.c;r.subVectors(y,f),a.subVectors(_,f),n.subVectors(d,f);var b=r.dot(n),T=a.dot(n);if(0>=b&&0>=T)return c.copy(f);i.subVectors(d,y);var S=r.dot(i),t=a.dot(i);if(0<=S&&t<=S)return c.copy(y);var E=b*t-S*T;if(0>=E&&0<=b&&0>=S)return y=b/(b-S),c.copy(f).addScaledVector(r,y);e.subVectors(d,_),d=r.dot(e);var M=a.dot(e);return 0<=M&&d<=M?c.copy(_):(b=d*T-b*M,0>=b&&0<=T&&0>=M)?(E=T/(T-M),c.copy(f).addScaledVector(a,E)):(T=S*M-d*t,0>=T&&0<=t-S&&0<=d-M)?(o.subVectors(_,y),E=(t-S)/(t-S+(d-M)),c.copy(y).addScaledVector(o,E)):(_=1/(T+b+E),y=b*_,E*=_,c.copy(f).addScaledVector(r,y).addScaledVector(a,E))}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Zn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(v.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.b=this.g=this.r=e,this},setHex:function(e){return e=Math.floor(e),this.r=(255&e>>16)/255,this.g=(255&e>>8)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){return e=Ze.euclideanModulo(e,1),t=Ze.clamp(t,0,1),r=Ze.clamp(r,0,1),0===t?this.r=this.g=this.b=r:(t=.5>=r?r*(1+t):r+t-r*t,r=2*r-t,this.r=d(r,t,e+1/3),this.g=d(r,t,e),this.b=d(r,t,e-1/3)),this},setStyle:function(t){function r(e){void 0!==e&&1>parseFloat(e)&&console.warn("COCO.Color: Alpha component of "+t+" will be ignored.")}var a;if(a=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var o=a[2];switch(a[1]){case"rgb":case"rgba":if(a=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,r(a[5]),this;if(a=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,r(a[5]),this;break;case"hsl":case"hsla":if(a=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){o=parseFloat(a[1])/360;var n=parseInt(a[2],10)/100,e=parseInt(a[3],10)/100;return r(a[5]),this.setHSL(o,n,e)}}}else if(a=/^#([A-Fa-f0-9]+)$/.exec(t)){if(a=a[1],o=a.length,3===o)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,this;if(6===o)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,this}return t&&0<t.length&&(a=Zn[t],void 0===a?console.warn("COCO.Color: Unknown color "+t):this.setHex(a)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){return void 0===t&&(t=2),t=0<t?1/t:1,this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=c(e.r),this.g=c(e.g),this.b=c(e.b),this},copyLinearToSRGB:function(e){return this.r=f(e.r),this.g=f(e.g),this.b=f(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("COCO.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var r=this.r,o=this.g,n=this.b,i=Math.max(r,o,n),e=Math.min(r,o,n),s=(e+i)/2,d;if(e===i)e=d=0;else{var p=i-e;e=.5>=s?p/(i+e):p/(2-i-e),i===r?d=(o-n)/p+(o<n?6:0):i===o?d=(n-r)/p+2:i===n?d=(r-o)/p+4:void 0,d/=6}return t.h=d,t.s=e,t.l=s,t},getStyle:function(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"},offsetHSL:function(){var e={};return function(t,r,a){return this.getHSL(e),e.h+=t,e.s+=r,e.l+=a,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(){var t={h:0,s:0,l:0},r={h:0,s:0,l:0};return function(a,o){this.getHSL(t),a.getHSL(r),a=Ze.lerp(t.h,r.h,o);var n=Ze.lerp(t.s,r.s,o);return o=Ze.lerp(t.l,r.l,o),this.setHSL(a,n,o),this}}(),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(V.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Jn=0;x.prototype=Object.assign(Object.create(t.prototype),{constructor:x,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0===r)console.warn("COCO.Material: '"+t+"' parameter is undefined.");else if("shading"===t)console.warn("COCO."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=!(1!==r);else{var a=this[t];void 0===a?console.warn("COCO."+this.type+": '"+t+"' is not a property of this material."):a&&a.isColor?a.set(r):a&&a.isVector3&&r&&r.isVector3?a.copy(r):this[t]=r}}},toJSON:function(e){function t(e){var t=[],r;for(r in e){var a=e[r];delete a.metadata,t.push(a)}return t}var r=void 0===e||"string"==typeof e;r&&(e={textures:{},images:{}});var o={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};return o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),this.color&&this.color.isColor&&(o.color=this.color.getHex()),void 0!==this.roughness&&(o.roughness=this.roughness),void 0!==this.metalness&&(o.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(o.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(o.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(o.specular=this.specular.getHex()),void 0!==this.shininess&&(o.shininess=this.shininess),void 0!==this.clearCoat&&(o.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(o.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(o.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(o.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(o.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(o.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(o.aoMap=this.aoMap.toJSON(e).uuid,o.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(o.bumpMap=this.bumpMap.toJSON(e).uuid,o.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(o.normalMap=this.normalMap.toJSON(e).uuid,o.normalMapType=this.normalMapType,o.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(o.displacementMap=this.displacementMap.toJSON(e).uuid,o.displacementScale=this.displacementScale,o.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(o.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(o.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(o.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(o.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(o.envMap=this.envMap.toJSON(e).uuid,o.reflectivity=this.reflectivity,o.refractionRatio=this.refractionRatio,void 0!==this.combine&&(o.combine=this.combine),void 0!==this.envMapIntensity&&(o.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(o.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(o.size=this.size),void 0!==this.sizeAttenuation&&(o.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(o.blending=this.blending),!0===this.flatShading&&(o.flatShading=this.flatShading),0!==this.side&&(o.side=this.side),0!==this.vertexColors&&(o.vertexColors=this.vertexColors),1>this.opacity&&(o.opacity=this.opacity),!0===this.transparent&&(o.transparent=this.transparent),o.depthFunc=this.depthFunc,o.depthTest=this.depthTest,o.depthWrite=this.depthWrite,o.stencilWrite=this.stencilWrite,o.stencilFunc=this.stencilFunc,o.stencilRef=this.stencilRef,o.stencilMask=this.stencilMask,o.stencilFail=this.stencilFail,o.stencilZFail=this.stencilZFail,o.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(o.rotation=this.rotation),!0===this.polygonOffset&&(o.polygonOffset=!0),0!==this.polygonOffsetFactor&&(o.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(o.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(o.linewidth=this.linewidth),void 0!==this.dashSize&&(o.dashSize=this.dashSize),void 0!==this.gapSize&&(o.gapSize=this.gapSize),void 0!==this.scale&&(o.scale=this.scale),!0===this.dithering&&(o.dithering=!0),0<this.alphaTest&&(o.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(o.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(o.wireframe=this.wireframe),1<this.wireframeLinewidth&&(o.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(o.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(o.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(o.morphTargets=!0),!0===this.morphNormals&&(o.morphNormals=!0),!0===this.skinning&&(o.skinning=!0),!1===this.visible&&(o.visible=!1),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),r&&(r=t(e.textures),e=t(e.images),0<r.length&&(o.textures=r),0<e.length&&(o.images=e)),o},clone:function(){return new this.constructor().copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWrite=t.stencilWrite,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilMask=t.stencilMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var r=t.clippingPlanes,a=null;if(null!==r){var o=r.length;a=Array(o);for(var n=0;n!==o;++n)a[n]=r[n].clone()}return this.clippingPlanes=a,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),S.prototype=Object.create(x.prototype),S.prototype.constructor=S,S.prototype.isMeshBasicMaterial=!0,S.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.defineProperty(C.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(C.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("COCO.BufferAttribute: array should be a Typed Array.");return this.count=void 0===e?0:e.length/this.itemSize,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(t,r,o){t*=this.itemSize,o*=r.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=r.array[o+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(t){for(var r=this.array,a=0,o=0,n=t.length,e;o<n;o++)e=t[o],void 0===e&&(console.warn("COCO.BufferAttribute.copyColorsArray(): color is undefined",o),e=new v),r[a++]=e.r,r[a++]=e.g,r[a++]=e.b;return this},copyVector2sArray:function(t){for(var r=this.array,a=0,n=0,i=t.length,e;n<i;n++)e=t[n],void 0===e&&(console.warn("COCO.BufferAttribute.copyVector2sArray(): vector is undefined",n),e=new o),r[a++]=e.x,r[a++]=e.y;return this},copyVector3sArray:function(t){for(var r=this.array,a=0,o=0,n=t.length,e;o<n;o++)e=t[o],void 0===e&&(console.warn("COCO.BufferAttribute.copyVector3sArray(): vector is undefined",o),e=new s),r[a++]=e.x,r[a++]=e.y,r[a++]=e.z;return this},copyVector4sArray:function(t){for(var r=this.array,a=0,o=0,n=t.length,e;o<n;o++)e=t[o],void 0===e&&(console.warn("COCO.BufferAttribute.copyVector4sArray(): vector is undefined",o),e=new u),r[a++]=e.x,r[a++]=e.y,r[a++]=e.z,r[a++]=e.w;return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=o,this},setXYZW:function(t,r,o,n,i){return t*=this.itemSize,this.array[t+0]=r,this.array[t+1]=o,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),M.prototype=Object.create(C.prototype),M.prototype.constructor=M,w.prototype=Object.create(C.prototype),w.prototype.constructor=w,A.prototype=Object.create(C.prototype),A.prototype.constructor=A,z.prototype=Object.create(C.prototype),z.prototype.constructor=z,k.prototype=Object.create(C.prototype),k.prototype.constructor=k,G.prototype=Object.create(C.prototype),G.prototype.constructor=G,F.prototype=Object.create(C.prototype),F.prototype.constructor=F,j.prototype=Object.create(C.prototype),j.prototype.constructor=j,E.prototype=Object.create(C.prototype),E.prototype.constructor=E,Object.assign(b.prototype,{computeGroups:function(t){var r=[],o;t=t.faces;for(var n=0,i;n<t.length;n++)if(i=t[n],i.materialIndex!==o){o=i.materialIndex,void 0!==s&&(s.count=3*n-s.start,r.push(s));var s={start:3*n,materialIndex:o}}void 0!==s&&(s.count=3*n-s.start,r.push(s)),this.groups=r},fromGeometry:function(r){var a=r.faces,i=r.vertices,s=r.faceVertexUvs,d=s[0]&&0<s[0].length,e=s[1]&&0<s[1].length,c=r.morphTargets,u=c.length;if(0<u){for(var g=[],f=0;f<u;f++)g[f]={name:c[f].name,data:[]};this.morphTargets.position=g}var h=r.morphNormals,l=h.length;if(0<l){var p=[];for(f=0;f<l;f++)p[f]={name:h[f].name,data:[]};this.morphTargets.normal=p}var n=r.skinIndices,t=r.skinWeights,_=n.length===i.length,v=t.length===i.length;for(0<i.length&&0===a.length&&console.error("COCO.DirectGeometry: Faceless geometries are not supported."),f=0;f<a.length;f++){var x=a[f];this.vertices.push(i[x.a],i[x.b],i[x.c]);var b=x.vertexNormals;for(3===b.length?this.normals.push(b[0],b[1],b[2]):(b=x.normal,this.normals.push(b,b,b)),b=x.vertexColors,3===b.length?this.colors.push(b[0],b[1],b[2]):(b=x.color,this.colors.push(b,b,b)),!0===d&&(b=s[0][f],void 0===b?(console.warn("COCO.DirectGeometry.fromGeometry(): Undefined vertexUv ",f),this.uvs.push(new o,new o,new o)):this.uvs.push(b[0],b[1],b[2])),!0===e&&(b=s[1][f],void 0===b?(console.warn("COCO.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",f),this.uvs2.push(new o,new o,new o)):this.uvs2.push(b[0],b[1],b[2])),b=0;b<u;b++){var T=c[b].vertices;g[b].data.push(T[x.a],T[x.b],T[x.c])}for(b=0;b<l;b++)T=h[b].vertexNormals[f],p[b].data.push(T.a,T.b,T.c);_&&this.skinIndices.push(n[x.a],n[x.b],n[x.c]),v&&this.skinWeights.push(t[x.a],t[x.b],t[x.c])}return this.computeGroups(r),this.verticesNeedUpdate=r.verticesNeedUpdate,this.normalsNeedUpdate=r.normalsNeedUpdate,this.colorsNeedUpdate=r.colorsNeedUpdate,this.uvsNeedUpdate=r.uvsNeedUpdate,this.groupsNeedUpdate=r.groupsNeedUpdate,null!==r.boundingSphere&&(this.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(this.boundingBox=r.boundingBox.clone()),this}});var Qn=1;Y.prototype=Object.assign(Object.create(t.prototype),{constructor:Y,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){this.index=Array.isArray(e)?new(65535<H(e)?F:k)(e,1):e},addAttribute:function(e,t,r){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("COCO.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("COCO.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new C(t,r)))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0===r?0:r})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var a=this.attributes.normal;return void 0!==a&&(t=new r().getNormalMatrix(e),t.applyToBufferAttribute(a),a.needsUpdate=!0),a=this.attributes.tangent,void 0!==a&&(t=new r().getNormalMatrix(e),t.applyToBufferAttribute(a),a.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new _;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new _;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new _;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new _;return function(t,r,a){return e.makeTranslation(t,r,a),this.applyMatrix(e),this}}(),scale:function(){var e=new _;return function(t,r,a){return e.makeScale(t,r,a),this.applyMatrix(e),this}}(),lookAt:function(){var e=new y;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new s;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){e=new j(3*t.vertices.length,3);var r=new j(3*t.colors.length,3);this.addAttribute("position",e.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length&&(e=new j(t.lineDistances.length,1),this.addAttribute("lineDistance",e.copyArray(t.lineDistances))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(t){for(var r=[],a=0,o=t.length,n;a<o;a++)n=t[a],r.push(n.x,n.y,n.z||0);return this.addAttribute("position",new j(r,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var r=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(r=void 0,t.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}return!0===t.verticesNeedUpdate&&(r=this.attributes.position,void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(r=this.attributes.normal,void 0!==r&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(r=this.attributes.color,void 0!==r&&(r.copyColorsArray(t.colors),r.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(r=this.attributes.uv,void 0!==r&&(r.copyVector2sArray(t.uvs),r.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(r=this.attributes.lineDistance,void 0!==r&&(r.copyArray(t.lineDistances),r.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new b().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(t){var r=new Float32Array(3*t.vertices.length);for(var a in this.addAttribute("position",new C(r,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(r=new Float32Array(3*t.normals.length),this.addAttribute("normal",new C(r,3).copyVector3sArray(t.normals))),0<t.colors.length&&(r=new Float32Array(3*t.colors.length),this.addAttribute("color",new C(r,3).copyColorsArray(t.colors))),0<t.uvs.length&&(r=new Float32Array(2*t.uvs.length),this.addAttribute("uv",new C(r,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(r=new Float32Array(2*t.uvs2.length),this.addAttribute("uv2",new C(r,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){r=[];for(var o=t.morphTargets[a],n=0,i=o.length;n<i;n++){var s=o[n],d=new j(3*s.data.length,3);d.name=s.name,r.push(d.copyVector3sArray(s.data))}this.morphAttributes[a]=r}return 0<t.skinIndices.length&&(a=new j(4*t.skinIndices.length,4),this.addAttribute("skinIndex",a.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(a=new j(4*t.skinWeights.length,4),this.addAttribute("skinWeight",a.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){var e=new g;return function(){null===this.boundingBox&&(this.boundingBox=new g);var t=this.attributes.position,r=this.morphAttributes.position;if(!(void 0!==t))this.boundingBox.makeEmpty();else if(this.boundingBox.setFromBufferAttribute(t),r){t=0;for(var a=r.length;t<a;t++)e.setFromBufferAttribute(r[t]),this.boundingBox.expandByPoint(e.min),this.boundingBox.expandByPoint(e.max)}(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error("COCO.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)}}(),computeBoundingSphere:function(){var t=new g,r=new g,e=new s;return function(){null===this.boundingSphere&&(this.boundingSphere=new T);var a=this.attributes.position,o=this.morphAttributes.position;if(a){var n=this.boundingSphere.center;if(t.setFromBufferAttribute(a),o)for(var i=0,s=o.length,p;i<s;i++)p=o[i],r.setFromBufferAttribute(p),t.expandByPoint(r.min),t.expandByPoint(r.max);t.getCenter(n);var c=0;for(i=0,s=a.count;i<s;i++)e.fromBufferAttribute(a,i),c=Math.max(c,n.distanceToSquared(e));if(o)for(i=0,s=o.length;i<s;i++){p=o[i],a=0;for(var u=p.count;a<u;a++)e.fromBufferAttribute(p,a),c=Math.max(c,n.distanceToSquared(e))}this.boundingSphere.radius=Math.sqrt(c),isNaN(this.boundingSphere.radius)&&console.error("COCO.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var r=this.index,o=this.attributes;if(o.position){var n=o.position.array;if(void 0===o.normal)this.addAttribute("normal",new C(new Float32Array(n.length),3));else for(var i=o.normal.array,c=0,y=i.length;c<y;c++)i[c]=0;i=o.normal.array;var v=new s,g=new s,h=new s,x=new s,m=new s;if(r){var l=r.array;for(c=0,y=r.count;c<y;c+=3){r=3*l[c+0];var p=3*l[c+1],u=3*l[c+2];v.fromArray(n,r),g.fromArray(n,p),h.fromArray(n,u),x.subVectors(h,g),m.subVectors(v,g),x.cross(m),i[r]+=x.x,i[r+1]+=x.y,i[r+2]+=x.z,i[p]+=x.x,i[p+1]+=x.y,i[p+2]+=x.z,i[u]+=x.x,i[u+1]+=x.y,i[u+2]+=x.z}}else for(c=0,y=n.length;c<y;c+=9)v.fromArray(n,c),g.fromArray(n,c+3),h.fromArray(n,c+6),x.subVectors(h,g),m.subVectors(v,g),x.cross(m),i[c]=x.x,i[c+1]=x.y,i[c+2]=x.z,i[c+3]=x.x,i[c+4]=x.y,i[c+5]=x.z,i[c+6]=x.x,i[c+7]=x.y,i[c+8]=x.z;this.normalizeNormals(),o.normal.needsUpdate=!0}},merge:function(t,r){if(t&&t.isBufferGeometry){void 0===r&&(r=0,console.warn("COCO.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var a=this.attributes,o;for(o in a)if(void 0!==t.attributes[o]){var n=a[o].array,e=t.attributes[o],i=e.array,s=e.itemSize*r;e=Math.min(i.length,n.length-s);for(var p=0;p<e;p++,s++)n[s]=i[p]}return this}console.error("COCO.BufferGeometry.merge(): geometry not an instance of COCO.BufferGeometry.",t)},normalizeNormals:function(){var e=new s;return function(){for(var t=this.attributes.normal,r=0,a=t.count;r<a;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){function t(t,r){var o=t.array;t=t.itemSize;for(var n=new o.constructor(r.length*t),i=0,s=0,d=r.length,p;s<d;s++){p=r[s]*t;for(var l=0;l<t;l++)n[i++]=o[p++]}return new C(n,t)}if(null===this.index)return console.warn("COCO.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var r=new Y,a=this.index.array,o=this.attributes,n;for(n in o){var i=o[n];i=t(i,a),r.addAttribute(n,i)}var s=this.morphAttributes;for(n in s){var p=[],l=s[n];o=0;for(var u=l.length;o<u;o++)i=l[o],i=t(i,a),p.push(i);r.morphAttributes[n]=p}for(a=this.groups,o=0,n=a.length;o<n;o++)i=a[o],r.addGroup(i.start,i.count,i.materialIndex);return r},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),0<Object.keys(this.userData).length&&(t.userData=this.userData),void 0!==this.parameters){var r=this.parameters;for(u in r)void 0!==r[u]&&(t[u]=r[u]);return t}t.data={attributes:{}},r=this.index,null!==r&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var a=this.attributes;for(u in a){r=a[u];var o=r.toJSON();""!==r.name&&(o.name=r.name),t.data.attributes[u]=o}a={};var n=!1;for(u in this.morphAttributes){for(var i=this.morphAttributes[u],s=[],p=0,l=i.length;p<l;p++)r=i[p],o=r.toJSON(),""!==r.name&&(o.name=r.name),s.push(o);0<s.length&&(a[u]=s,n=!0)}n&&(t.data.morphAttributes=a);var u=this.groups;return 0<u.length&&(t.data.groups=JSON.parse(JSON.stringify(u))),u=this.boundingSphere,null!==u&&(t.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),t},clone:function(){return new Y().copy(this)},copy:function(t){var r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var a=t.index;for(i in null!==a&&this.setIndex(a.clone()),a=t.attributes,a)this.addAttribute(i,a[i].clone());var o=t.morphAttributes;for(i in o){var n=[],e=o[i];for(a=0,r=e.length;a<r;a++)n.push(e[a].clone());this.morphAttributes[i]=n}var i=t.groups;for(a=0,r=i.length;a<r;a++)o=i[a],this.addGroup(o.start,o.count,o.materialIndex);return i=t.boundingBox,null!==i&&(this.boundingBox=i.clone()),i=t.boundingSphere,null!==i&&(this.boundingSphere=i.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),B.prototype=Object.assign(Object.create(y.prototype),{constructor:B,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return y.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var r=e[t[0]];if(void 0!==r)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=r.length;e<t;e++){var o=r[e].name||e+"";this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=e}}}else e=e.morphTargets,void 0!==e&&0<e.length&&console.error("COCO.Mesh.updateMorphTargets() no longer supports COCO.Geometry. Use COCO.BufferGeometry instead.")},raycast:function(){function i(r,a,o,n,i,e,s,d){return null===(1===a.side?n.intersectTriangle(s,e,i,!0,d):n.intersectTriangle(i,e,s,2!==a.side,d))?null:(t.copy(d),t.applyMatrix4(r.matrixWorld),a=o.ray.origin.distanceTo(t),a<o.near||a>o.far?null:{distance:a,point:t.clone(),object:r})}function a(t,a,s,d,c,_,n,T,R,E,C){if(S.fromBufferAttribute(c,R),f.fromBufferAttribute(c,E),g.fromBufferAttribute(c,C),c=t.morphTargetInfluences,a.morphTargets&&_&&c){l.set(0,0,0),p.set(0,0,0),u.set(0,0,0);for(var L=0,A=_.length;L<A;L++){var y=c[L],I=_[L];0!==y&&(e.fromBufferAttribute(I,R),h.fromBufferAttribute(I,E),m.fromBufferAttribute(I,C),l.addScaledVector(e.sub(S),y),p.addScaledVector(h.sub(f),y),u.addScaledVector(m.sub(g),y))}S.add(l),f.add(p),g.add(u)}return(t=i(t,a,s,d,S,f,g,x))&&(n&&(M.fromBufferAttribute(n,R),P.fromBufferAttribute(n,E),v.fromBufferAttribute(n,C),t.uv=D.getUV(x,S,f,g,M,P,v,new o)),T&&(M.fromBufferAttribute(T,R),P.fromBufferAttribute(T,E),v.fromBufferAttribute(T,C),t.uv2=D.getUV(x,S,f,g,M,P,v,new o)),n=new V(R,E,C),D.getNormal(S,f,g,n.normal),t.face=n),t}var b=new _,c=new L,d=new T,S=new s,f=new s,g=new s,e=new s,h=new s,m=new s,l=new s,p=new s,u=new s,M=new o,P=new o,v=new o,x=new s,t=new s;return function(e,s){var g=this.geometry,f=this.material,_=this.matrixWorld;if(void 0!==f&&(null===g.boundingSphere&&g.computeBoundingSphere(),d.copy(g.boundingSphere),d.applyMatrix4(_),!1!==e.ray.intersectsSphere(d)&&(b.getInverse(_),c.copy(e.ray).applyMatrix4(b),null===g.boundingBox||!1!==c.intersectsBox(g.boundingBox))))if(g.isBufferGeometry){var T=g.index;_=g.attributes.position;var S=g.morphAttributes.position,R=g.attributes.uv,L=g.attributes.uv2,A=g.groups,N=g.drawRange,O,k;if(null!==T){if(Array.isArray(f)){var U=0;for(O=A.length;U<O;U++){var F=A[U],H=f[F.materialIndex],V=Math.max(F.start,N.start);for(k=g=Math.min(F.start+F.count,N.start+N.count);V<k;V+=3){g=T.getX(V);var W=T.getX(V+1),j=T.getX(V+2);(g=a(this,H,e,c,_,S,R,L,g,W,j))&&(g.faceIndex=Math.floor(V/3),g.face.materialIndex=F.materialIndex,s.push(g))}}}else for(V=Math.max(0,N.start),g=Math.min(T.count,N.start+N.count),U=V,O=g;U<O;U+=3)(g=T.getX(U),W=T.getX(U+1),j=T.getX(U+2),g=a(this,f,e,c,_,S,R,L,g,W,j))&&(g.faceIndex=Math.floor(U/3),s.push(g));}else if(void 0!==_)if(Array.isArray(f))for(U=0,O=A.length;U<O;U++)for(F=A[U],H=f[F.materialIndex],V=Math.max(F.start,N.start),k=g=Math.min(F.start+F.count,N.start+N.count);V<k;V+=3)(g=V,W=V+1,j=V+2,g=a(this,H,e,c,_,S,R,L,g,W,j))&&(g.faceIndex=Math.floor(V/3),g.face.materialIndex=F.materialIndex,s.push(g));else for(V=Math.max(0,N.start),g=Math.min(_.count,N.start+N.count),U=V,O=g;U<O;U+=3)(g=U,W=U+1,j=U+2,g=a(this,f,e,c,_,S,R,L,g,W,j))&&(g.faceIndex=Math.floor(U/3),s.push(g))}else if(g.isGeometry)for(_=Array.isArray(f),S=g.vertices,R=g.faces,g=g.faceVertexUvs[0],0<g.length&&(T=g),U=0,O=R.length;U<O;U++)(F=R[U],g=_?f[F.materialIndex]:f,void 0!==g&&(L=S[F.a],A=S[F.b],N=S[F.c],g=i(this,g,e,c,L,A,N,x)))&&(T&&T[U]&&(H=T[U],M.copy(H[0]),P.copy(H[1]),v.copy(H[2]),g.uv=D.getUV(x,L,A,N,M,P,v,new o)),g.face=F,g.faceIndex=U,s.push(g))}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Kn=0;q.prototype=Object.assign(Object.create(t.prototype),{constructor:q,isGeometry:!0,applyMatrix:function(t){for(var o=new r().getNormalMatrix(t),n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(t);for(n=0,i=this.faces.length;n<i;n++){t=this.faces[n],t.normal.applyMatrix3(o).normalize();for(var s=0,p=t.vertexNormals.length;s<p;s++)t.vertexNormals[s].applyMatrix3(o).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:function(){var e=new _;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new _;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new _;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new _;return function(t,r,a){return e.makeTranslation(t,r,a),this.applyMatrix(e),this}}(),scale:function(){var e=new _;return function(t,r,a){return e.makeScale(t,r,a),this.applyMatrix(e),this}}(),lookAt:function(){var e=new y;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(t){function r(t,r,a,i){var d=void 0===g?[]:[n.colors[t].clone(),n.colors[r].clone(),n.colors[a].clone()],p=void 0===c?[]:[new s().fromArray(c,3*t),new s().fromArray(c,3*r),new s().fromArray(c,3*a)];i=new V(t,r,a,p,d,i),n.faces.push(i),void 0!==h&&n.faceVertexUvs[0].push([new o().fromArray(h,2*t),new o().fromArray(h,2*r),new o().fromArray(h,2*a)]),void 0!==y&&n.faceVertexUvs[1].push([new o().fromArray(y,2*t),new o().fromArray(y,2*r),new o().fromArray(y,2*a)])}var n=this,a=null===t.index?void 0:t.index.array,i=t.attributes,d=i.position.array,c=void 0===i.normal?void 0:i.normal.array,g=void 0===i.color?void 0:i.color.array,h=void 0===i.uv?void 0:i.uv.array,y=void 0===i.uv2?void 0:i.uv2.array;for(void 0!==y&&(this.faceVertexUvs[1]=[]),i=0;i<d.length;i+=3)n.vertices.push(new s().fromArray(d,i)),void 0!==g&&n.colors.push(new v().fromArray(g,i));var m=t.groups;if(0<m.length)for(i=0;i<m.length;i++){d=m[i];var l=d.start,x=l;for(l+=d.count;x<l;x+=3)void 0===a?r(x,x+1,x+2,d.materialIndex):r(a[x],a[x+1],a[x+2],d.materialIndex)}else if(void 0!==a)for(i=0;i<a.length;i+=3)r(a[i],a[i+1],a[i+2]);else for(i=0;i<d.length/3;i+=3)r(i,i+1,i+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){var e=new s;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius;t=0===t?1:1/t;var r=new _;return r.set(t,0,0,-t*e.x,0,t,0,-t*e.y,0,0,t,-t*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new s,r=new s,a=0,o=this.faces.length;a<o;a++){var n=this.faces[a],e=this.vertices[n.a],i=this.vertices[n.b];t.subVectors(this.vertices[n.c],i),r.subVectors(e,i),t.cross(r),t.normalize(),n.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);var r=Array(this.vertices.length),o=0,n;for(n=this.vertices.length;o<n;o++)r[o]=new s;if(t){var i=new s,e=new s;for(t=0,o=this.faces.length;t<o;t++){n=this.faces[t];var p=this.vertices[n.a],l=this.vertices[n.b],c=this.vertices[n.c];i.subVectors(c,l),e.subVectors(p,l),i.cross(e),r[n.a].add(i),r[n.b].add(i),r[n.c].add(i)}}else for(this.computeFaceNormals(),t=0,o=this.faces.length;t<o;t++)n=this.faces[t],r[n.a].add(n.normal),r[n.b].add(n.normal),r[n.c].add(n.normal);for(o=0,n=this.vertices.length;o<n;o++)r[o].normalize();for(t=0,o=this.faces.length;t<o;t++)n=this.faces[t],p=n.vertexNormals,3===p.length?(p[0].copy(r[n.a]),p[1].copy(r[n.b]),p[2].copy(r[n.c])):(p[0]=r[n.a].clone(),p[1]=r[n.b].clone(),p[2]=r[n.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e;this.computeFaceNormals();var t=0;for(e=this.faces.length;t<e;t++){var r=this.faces[t],o=r.vertexNormals;3===o.length?(o[0].copy(r.normal),o[1].copy(r.normal),o[2].copy(r.normal)):(o[0]=r.normal.clone(),o[1]=r.normal.clone(),o[2]=r.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t=0,r,o;for(o=this.faces.length;t<o;t++){var n=this.faces[t];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);var i=0;for(r=n.vertexNormals.length;i<r;i++)n.__originalVertexNormals[i]?n.__originalVertexNormals[i].copy(n.vertexNormals[i]):n.__originalVertexNormals[i]=n.vertexNormals[i].clone()}var p=new q;for(p.faces=this.faces,i=0,r=this.morphTargets.length;i<r;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[],n=this.morphNormals[i].faceNormals;var l=this.morphNormals[i].vertexNormals;for(t=0,o=this.faces.length;t<o;t++){var m=new s,u={a:new s,b:new s,c:new s};n.push(m),l.push(u)}}for(l=this.morphNormals[i],p.vertices=this.morphTargets[i].vertices,p.computeFaceNormals(),p.computeVertexNormals(),t=0,o=this.faces.length;t<o;t++)n=this.faces[t],m=l.faceNormals[t],u=l.vertexNormals[t],m.copy(n.normal),u.a.copy(n.vertexNormals[0]),u.b.copy(n.vertexNormals[1]),u.c.copy(n.vertexNormals[2])}for(t=0,o=this.faces.length;t<o;t++)n=this.faces[t],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new g),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new T),this.boundingSphere.setFromPoints(this.vertices)},merge:function(o,a,i){if(o&&o.isGeometry){var s=this.vertices.length,u=this.vertices,y=o.vertices,v=this.faces,x=o.faces,_=this.colors,T=o.colors,S;void 0===i&&(i=0),void 0!==a&&(S=new r().getNormalMatrix(a));for(var E=0,M=y.length,C;E<M;E++)C=y[E].clone(),void 0!==a&&C.applyMatrix4(a),u.push(C);for(E=0,M=T.length;E<M;E++)_.push(T[E].clone());for(E=0,M=x.length;E<M;E++){y=x[E];var w=y.vertexNormals;for(T=y.vertexColors,_=new V(y.a+s,y.b+s,y.c+s),_.normal.copy(y.normal),void 0!==S&&_.normal.applyMatrix3(S).normalize(),a=0,u=w.length;a<u;a++)C=w[a].clone(),void 0!==S&&C.applyMatrix3(S).normalize(),_.vertexNormals.push(C);for(_.color.copy(y.color),a=0,u=T.length;a<u;a++)C=T[a],_.vertexColors.push(C.clone());_.materialIndex=y.materialIndex+i,v.push(_)}for(E=0,M=o.faceVertexUvs.length;E<M;E++)for(i=o.faceVertexUvs[E],void 0===this.faceVertexUvs[E]&&(this.faceVertexUvs[E]=[]),a=0,u=i.length;a<u;a++){for(S=i[a],s=[],v=0,x=S.length;v<x;v++)s.push(S[v].clone());this.faceVertexUvs[E].push(s)}}else console.error("COCO.Geometry.merge(): geometry not an instance of COCO.Geometry.",o)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("COCO.Geometry.mergeMesh(): mesh not an instance of COCO.Mesh.",e)},mergeVertices:function(){var t={},r=[],o=[],n=Math.pow(10,4),i=0,s;for(s=this.vertices.length;i<s;i++){var p=this.vertices[i];p=Math.round(p.x*n)+"_"+Math.round(p.y*n)+"_"+Math.round(p.z*n),void 0===t[p]?(t[p]=i,r.push(this.vertices[i]),o[i]=r.length-1):o[i]=o[t[p]]}for(t=[],i=0,s=this.faces.length;i<s;i++)for(n=this.faces[i],n.a=o[n.a],n.b=o[n.b],n.c=o[n.c],n=[n.a,n.b,n.c],p=0;3>p;p++)if(n[p]===n[(p+1)%3]){t.push(i);break}for(i=t.length-1;0<=i;i--)for(n=t[i],this.faces.splice(n,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(n,1);return i=this.vertices.length-r.length,this.vertices=r,i},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length,a;t<r;t++)a=e[t],this.vertices.push(new s(a.x,a.y,a.z||0));return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,r=t.length,a=0;a<r;a++)t[a]._id=a;t.sort(function(e,t){return e.materialIndex-t.materialIndex});var o=this.faceVertexUvs[0],n=this.faceVertexUvs[1],e,i;for(o&&o.length===r&&(e=[]),n&&n.length===r&&(i=[]),a=0;a<r;a++){var s=t[a]._id;e&&e.push(o[s]),i&&i.push(n[s])}e&&(this.faceVertexUvs[0]=e),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){function r(e,t,r){return r?e|1<<t:e&~(1<<t)}function a(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0===_[t]?(_[t]=u.length/3,u.push(e.x,e.y,e.z),_[t]):_[t]}function o(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0===l[t]?(l[t]=m.length,m.push(e.getHex()),l[t]):l[t]}function i(e){var t=e.x.toString()+e.y.toString();return void 0===n[t]?(n[t]=p.length/2,p.push(e.x,e.y),n[t]):n[t]}var s={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),void 0!==this.parameters){var e=this.parameters,d;for(d in e)void 0!==e[d]&&(s[d]=e[d]);return s}for(e=[],d=0;d<this.vertices.length;d++){var c=this.vertices[d];e.push(c.x,c.y,c.z)}c=[];var u=[],_={},m=[],l={},p=[],n={};for(d=0;d<this.faces.length;d++){var t=this.faces[d],b=void 0!==this.faceVertexUvs[0][d],T=0<t.normal.length(),S=0<t.vertexNormals.length,E=1!==t.color.r||1!==t.color.g||1!==t.color.b,M=0<t.vertexColors.length,y=0;y=r(y,0,0),y=r(y,1,!0),y=r(y,2,!1),y=r(y,3,b),y=r(y,4,T),y=r(y,5,S),y=r(y,6,E),y=r(y,7,M),c.push(y),c.push(t.a,t.b,t.c),c.push(t.materialIndex),b&&(b=this.faceVertexUvs[0][d],c.push(i(b[0]),i(b[1]),i(b[2]))),T&&c.push(a(t.normal)),S&&(T=t.vertexNormals,c.push(a(T[0]),a(T[1]),a(T[2]))),E&&c.push(o(t.color)),M&&(t=t.vertexColors,c.push(o(t[0]),o(t[1]),o(t[2])))}return s.data={},s.data.vertices=e,s.data.normals=u,0<m.length&&(s.data.colors=m),0<p.length&&(s.data.uvs=[p]),s.data.faces=c,s},clone:function(){return new q().copy(this)},copy:function(t){var r,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var n=t.vertices,i=0;for(r=n.length;i<r;i++)this.vertices.push(n[i].clone());for(n=t.colors,i=0,r=n.length;i<r;i++)this.colors.push(n[i].clone());for(n=t.faces,i=0,r=n.length;i<r;i++)this.faces.push(n[i].clone());for(i=0,r=t.faceVertexUvs.length;i<r;i++){var s=t.faceVertexUvs[i];for(void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]),n=0,a=s.length;n<a;n++){var p=s[n],l=[],u=0;for(o=p.length;u<o;u++)l.push(p[u].clone());this.faceVertexUvs[i].push(l)}}for(u=t.morphTargets,i=0,r=u.length;i<r;i++){if(o={},o.name=u[i].name,void 0!==u[i].vertices)for(o.vertices=[],n=0,a=u[i].vertices.length;n<a;n++)o.vertices.push(u[i].vertices[n].clone());if(void 0!==u[i].normals)for(o.normals=[],n=0,a=u[i].normals.length;n<a;n++)o.normals.push(u[i].normals[n].clone());this.morphTargets.push(o)}for(u=t.morphNormals,i=0,r=u.length;i<r;i++){if(o={},void 0!==u[i].vertexNormals)for(o.vertexNormals=[],n=0,a=u[i].vertexNormals.length;n<a;n++)s=u[i].vertexNormals[n],p={},p.a=s.a.clone(),p.b=s.b.clone(),p.c=s.c.clone(),o.vertexNormals.push(p);if(void 0!==u[i].faceNormals)for(o.faceNormals=[],n=0,a=u[i].faceNormals.length;n<a;n++)o.faceNormals.push(u[i].faceNormals[n].clone());this.morphNormals.push(o)}for(n=t.skinWeights,i=0,r=n.length;i<r;i++)this.skinWeights.push(n[i].clone());for(n=t.skinIndices,i=0,r=n.length;i<r;i++)this.skinIndices.push(n[i].clone());for(n=t.lineDistances,i=0,r=n.length;i<r;i++)this.lineDistances.push(n[i]);return i=t.boundingBox,null!==i&&(this.boundingBox=i.clone()),i=t.boundingSphere,null!==i&&(this.boundingSphere=i.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),N.prototype=Object.create(q.prototype),N.prototype.constructor=N,Z.prototype=Object.create(Y.prototype),Z.prototype.constructor=Z;$.prototype=Object.create(x.prototype),$.prototype.constructor=$,$.prototype.isShaderMaterial=!0,$.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Q(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},$.prototype.toJSON=function(t){var r=x.prototype.toJSON.call(this,t);for(var o in r.uniforms={},this.uniforms){var n=this.uniforms[o].value;r.uniforms[o]=n&&n.isTexture?{type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?{type:"c",value:n.getHex()}:n&&n.isVector2?{type:"v2",value:n.toArray()}:n&&n.isVector3?{type:"v3",value:n.toArray()}:n&&n.isVector4?{type:"v4",value:n.toArray()}:n&&n.isMatrix3?{type:"m3",value:n.toArray()}:n&&n.isMatrix4?{type:"m4",value:n.toArray()}:{value:n}}for(var i in 0<Object.keys(this.defines).length&&(r.defines=this.defines),r.vertexShader=this.vertexShader,r.fragmentShader=this.fragmentShader,t={},this.extensions)!0===this.extensions[i]&&(t[i]=!0);return 0<Object.keys(t).length&&(r.extensions=t),r},re.prototype=Object.assign(Object.create(y.prototype),{constructor:re,isCamera:!0,copy:function(e,t){return y.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("COCO.Camera: .getWorldDirection() target is now required"),e=new s),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){y.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),oe.prototype=Object.assign(Object.create(re.prototype),{constructor:oe,isPerspectiveCamera:!0,copy:function(e,t){return re.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){e=.5*this.getFilmHeight()/e,this.fov=2*Ze.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Ze.DEG2RAD*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Ze.RAD2DEG*Math.atan(Math.tan(.5*Ze.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,r,a,o,n,e){this.aspect=t/r,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=r,this.view.offsetX=a,this.view.offsetY=o,this.view.width=n,this.view.height=e,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,r=t*Math.tan(.5*Ze.DEG2RAD*this.fov)/this.zoom,a=2*r,o=this.aspect*a,n=-.5*o,i=this.view;if(null!==this.view&&this.view.enabled){var s=i.fullWidth,p=i.fullHeight;n+=i.offsetX*o/s,r-=i.offsetY*a/p,o*=i.width/s,a*=i.height/p}i=this.filmOffset,0!==i&&(n+=t*i/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+o,r,r-a,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){return e=y.prototype.toJSON.call(this,e),e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),ne.prototype=Object.create(y.prototype),ne.prototype.constructor=ne,pe.prototype=Object.create(p.prototype),pe.prototype.constructor=pe,pe.prototype.isWebGLRenderTargetCube=!0,pe.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new h,a=new $({type:"CubemapFromEquirect",uniforms:Q({tEquirect:{value:null}}),vertexShader:"varying vec3 vWorldDirection;\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragmentShader:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}",side:1,blending:0});return a.uniforms.tEquirect.value=t,t=new B(new Z(5,5,5),a),r.add(t),a=new ne(1,10,1),a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(e,r),t.geometry.dispose(),t.material.dispose(),this},_e.prototype=Object.create(n.prototype),_e.prototype.constructor=_e,_e.prototype.isDataTexture=!0,Object.assign(qe.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,a){return this.normal.set(e,t,r),this.constant=a,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new s,r=new s;return function(a,o,n){return o=t.subVectors(n,o).cross(r.subVectors(a,o)).normalize(),this.setFromNormalAndCoplanarPoint(o,a),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("COCO.Plane: .projectPoint() target is now required"),t=new s),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var t=new s;return function(r,a){void 0===a&&(console.warn("COCO.Plane: .intersectLine() target is now required"),a=new s);var o=r.delta(t),n=this.normal.dot(o);if(0===n){if(0===this.distanceToPoint(r.start))return a.copy(r.start);}else if(n=-(r.start.dot(this.normal)+this.constant)/n,!(0>n||1<n))return a.copy(o).multiplyScalar(n).add(r.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&0<e||0>e&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("COCO.Plane: .coplanarPoint() target is now required"),e=new s),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new s,t=new r;return function(r,a){return a=a||t.getNormalMatrix(r),r=this.coplanarPoint(e).applyMatrix4(r),a=this.normal.applyMatrix3(a).normalize(),this.constant=-r.dot(a),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(et.prototype,{set:function(t,r,a,o,n,e){var i=this.planes;return i[0].copy(t),i[1].copy(r),i[2].copy(a),i[3].copy(o),i[4].copy(n),i[5].copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(r){var o=this.planes,i=r.elements;r=i[0];var s=i[1],d=i[2],e=i[3],u=i[4],g=i[5],f=i[6],h=i[7],m=i[8],l=i[9],p=i[10],n=i[11],t=i[12],y=i[13],v=i[14];return i=i[15],o[0].setComponents(e-r,h-u,n-m,i-t).normalize(),o[1].setComponents(e+r,h+u,n+m,i+t).normalize(),o[2].setComponents(e+s,h+g,n+l,i+y).normalize(),o[3].setComponents(e-s,h-g,n-l,i-y).normalize(),o[4].setComponents(e-d,h-f,n-p,i-v).normalize(),o[5].setComponents(e+d,h+f,n+p,i+v).normalize(),this},intersectsObject:function(){var e=new T;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new T;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,r=e.center;e=-e.radius;for(var o=0;6>o;o++)if(t[o].distanceToPoint(r)<e)return!1;return!0},intersectsBox:function(){var t=new s;return function(r){for(var a=this.planes,o=0,n;6>o;o++)if(n=a[o],t.x=0<n.normal.x?r.max.x:r.min.x,t.y=0<n.normal.y?r.max.y:r.min.y,t.z=0<n.normal.z?r.max.z:r.min.z,0>n.distanceToPoint(t))return!1;return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(0>t[r].distanceToPoint(e))return!1;return!0}});var $n={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\t#ifdef USE_TANGENT\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy = normalScale * mapN.xy;\n\t\t\tnormal = normalize( vTBN * mapN );\n\t\t#else\n\t\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t\t#endif\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},P={common:{diffuse:{value:new v(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new r},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new o(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new v(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new v(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new r}},sprite:{diffuse:{value:new v(15658734)},opacity:{value:1},center:{value:new o(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new r}}},I={basic:{uniforms:K([P.common,P.specularmap,P.envmap,P.aomap,P.lightmap,P.fog]),vertexShader:$n.meshbasic_vert,fragmentShader:$n.meshbasic_frag},lambert:{uniforms:K([P.common,P.specularmap,P.envmap,P.aomap,P.lightmap,P.emissivemap,P.fog,P.lights,{emissive:{value:new v(0)}}]),vertexShader:$n.meshlambert_vert,fragmentShader:$n.meshlambert_frag},phong:{uniforms:K([P.common,P.specularmap,P.envmap,P.aomap,P.lightmap,P.emissivemap,P.bumpmap,P.normalmap,P.displacementmap,P.gradientmap,P.fog,P.lights,{emissive:{value:new v(0)},specular:{value:new v(1118481)},shininess:{value:30}}]),vertexShader:$n.meshphong_vert,fragmentShader:$n.meshphong_frag},standard:{uniforms:K([P.common,P.envmap,P.aomap,P.lightmap,P.emissivemap,P.bumpmap,P.normalmap,P.displacementmap,P.roughnessmap,P.metalnessmap,P.fog,P.lights,{emissive:{value:new v(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:$n.meshphysical_vert,fragmentShader:$n.meshphysical_frag},matcap:{uniforms:K([P.common,P.bumpmap,P.normalmap,P.displacementmap,P.fog,{matcap:{value:null}}]),vertexShader:$n.meshmatcap_vert,fragmentShader:$n.meshmatcap_frag},points:{uniforms:K([P.points,P.fog]),vertexShader:$n.points_vert,fragmentShader:$n.points_frag},dashed:{uniforms:K([P.common,P.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:$n.linedashed_vert,fragmentShader:$n.linedashed_frag},depth:{uniforms:K([P.common,P.displacementmap]),vertexShader:$n.depth_vert,fragmentShader:$n.depth_frag},normal:{uniforms:K([P.common,P.bumpmap,P.normalmap,P.displacementmap,{opacity:{value:1}}]),vertexShader:$n.normal_vert,fragmentShader:$n.normal_frag},sprite:{uniforms:K([P.sprite,P.fog]),vertexShader:$n.sprite_vert,fragmentShader:$n.sprite_frag},background:{uniforms:{uvTransform:{value:new r},t2D:{value:null}},vertexShader:$n.background_vert,fragmentShader:$n.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:$n.cube_vert,fragmentShader:$n.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:$n.equirect_vert,fragmentShader:$n.equirect_frag},distanceRGBA:{uniforms:K([P.common,P.displacementmap,{referencePosition:{value:new s},nearDistance:{value:1},farDistance:{value:1E3}}]),vertexShader:$n.distanceRGBA_vert,fragmentShader:$n.distanceRGBA_frag},shadow:{uniforms:K([P.lights,P.fog,{color:{value:new v(0)},opacity:{value:1}}]),vertexShader:$n.shadow_vert,fragmentShader:$n.shadow_frag}};I.physical={uniforms:K([I.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:$n.meshphysical_vert,fragmentShader:$n.meshphysical_frag},rt.prototype=Object.create(q.prototype),rt.prototype.constructor=rt,at.prototype=Object.create(Y.prototype),at.prototype.constructor=at,ft.prototype=Object.create(n.prototype),ft.prototype.constructor=ft,ft.prototype.isCubeTexture=!0,Object.defineProperty(ft.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),ht.prototype=Object.create(n.prototype),ht.prototype.constructor=ht,ht.prototype.isDataTexture2DArray=!0,yt.prototype=Object.create(n.prototype),yt.prototype.constructor=yt,yt.prototype.isDataTexture3D=!0;var Za=new n,ei=new ht,ti=new yt,ri=new ft,ai=[],oi=[],ni=new Float32Array(16),ii=new Float32Array(9),si=new Float32Array(4);$t.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),_t(t,e)},er.prototype.setValue=function(t,r,a){for(var o=this.seq,n=0,i=o.length,s;n!==i;++n)s=o[n],s.setValue(t,r[s.id],a)};var di=/([\w\d_]+)(\])?(\[|\.)?/g;tr.prototype.setValue=function(e,t,r,a){t=this.map[t],void 0!==t&&t.setValue(e,r,a)},tr.prototype.setOptional=function(e,t,r){t=t[r],void 0!==t&&this.setValue(e,r,t)},tr.upload=function(t,r,a,o){for(var n=0,i=r.length;n!==i;++n){var s=r[n],d=a[s.id];!1!==d.needsUpdate&&s.setValue(t,d.value,o)}},tr.seqWithValue=function(t,r){for(var a=[],o=0,n=t.length,e;o!==n;++o)e=t[o],e.id in r&&a.push(e);return a};var te=0,pi=0;Mr.prototype=Object.create(x.prototype),Mr.prototype.constructor=Mr,Mr.prototype.isMeshDepthMaterial=!0,Mr.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Cr.prototype=Object.create(x.prototype),Cr.prototype.constructor=Cr,Cr.prototype.isMeshDistanceMaterial=!0,Cr.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Ar.prototype=Object.assign(Object.create(y.prototype),{constructor:Ar,isGroup:!0}),Dr.prototype=Object.assign(Object.create(oe.prototype),{constructor:Dr,isArrayCamera:!0});var li=new s,ci=new s;Object.assign(Br.prototype,t.prototype),Object.assign(ve.prototype,t.prototype),Object.assign(we.prototype,{isFogExp2:!0,clone:function(){return new we(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Nr.prototype,{isFog:!0,clone:function(){return new Nr(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Or.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Or.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("COCO.BufferAttribute: array should be a Typed Array.");return this.count=void 0===e?0:e.length/this.stride,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(t,r,o){t*=this.stride,o*=r.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=r.array[o+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(kr.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(kr.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=o,this},setXYZW:function(t,r,o,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=r,this.data.array[t+1]=o,this.data.array[t+2]=n,this.data.array[t+3]=i,this}}),Ur.prototype=Object.create(x.prototype),Ur.prototype.constructor=Ur,Ur.prototype.isSpriteMaterial=!0,Ur.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var mi;Gr.prototype=Object.assign(Object.create(y.prototype),{constructor:Gr,isSprite:!0,raycast:function(){function i(r,a,o,n,i,s){t.subVectors(r,o).addScalar(.5).multiply(n),void 0===i?e.copy(t):(e.x=s*t.x-i*t.y,e.y=i*t.x+s*t.y),r.copy(a),r.x+=e.x,r.y+=e.y,r.applyMatrix4(v)}var a=new s,y=new s,c=new s,t=new o,e=new o,v=new _,d=new s,g=new s,h=new s,m=new o,l=new o,p=new o;return function(s,e){y.setFromMatrixScale(this.matrixWorld),v.copy(s._camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(s._camera.matrixWorldInverse,this.matrixWorld),c.setFromMatrixPosition(this.modelViewMatrix),s._camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&y.multiplyScalar(-c.z);var u=this.material.rotation;if(0!==u)var f=Math.cos(u),r=Math.sin(u);u=this.center,i(d.set(-.5,-.5,0),c,u,y,r,f),i(g.set(.5,-.5,0),c,u,y,r,f),i(h.set(.5,.5,0),c,u,y,r,f),m.set(0,0),l.set(1,0),p.set(1,1);var x=s.ray.intersectTriangle(d,g,h,!1,a);null===x&&(i(g.set(-.5,.5,0),c,u,y,r,f),l.set(0,1),x=s.ray.intersectTriangle(d,h,g,!1,a),null===x)||(r=s.ray.origin.distanceTo(a),r<s.near||r>s.far||e.push({distance:r,point:a.clone(),uv:D.getUV(a,d,g,h,m,l,p,new o),face:null,object:this}))}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return y.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),Fr.prototype=Object.assign(Object.create(y.prototype),{constructor:Fr,isLOD:!0,copy:function(e){y.prototype.copy.call(this,e,!1),e=e.levels;for(var t=0,r=e.length,o;t<r;t++)o=e[t],this.addLevel(o.object.clone(),o.distance);return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,a=0;a<r.length&&!(t<r[a].distance);a++);return r.splice(a,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){for(var t=this.levels,r=1,a=t.length;r<a&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(){var e=new s;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var a=t.ray.origin.distanceTo(e);this.getObjectForDistance(a).raycast(t,r)}}(),update:function(){var t=new s,r=new s;return function(a){var o=this.levels;if(1<o.length){t.setFromMatrixPosition(a.matrixWorld),r.setFromMatrixPosition(this.matrixWorld),a=t.distanceTo(r),o[0].object.visible=!0;for(var n=1,i=o.length;n<i&&a>=o[n].distance;n++)o[n-1].object.visible=!1,o[n].object.visible=!0;for(;n<i;n++)o[n].object.visible=!1}}}(),toJSON:function(t){t=y.prototype.toJSON.call(this,t),t.object.levels=[];for(var r=this.levels,o=0,n=r.length,i;o<n;o++)i=r[o],t.object.levels.push({object:i.object.uuid,distance:i.distance});return t}}),Hr.prototype=Object.assign(Object.create(B.prototype),{constructor:Hr,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new u,r=this.geometry.attributes.skinWeight,a=0,o=r.count;a<o;a++){t.x=r.getX(a),t.y=r.getY(a),t.z=r.getZ(a),t.w=r.getW(a);var n=1/t.manhattanLength();1/0==n?t.set(1,0,0,0):t.multiplyScalar(n),r.setXYZW(a,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(e){B.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("COCO.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Vr.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length,r;e<t;e++)r=new _,this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)},pose:function(){var e=0,t,r;for(r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var t=new _,r=new _;return function(){for(var a=this.bones,o=this.boneInverses,n=this.boneMatrices,e=this.boneTexture,i=0,s=a.length;i<s;i++)t.multiplyMatrices(a[i]?a[i].matrixWorld:r,o[i]),t.toArray(n,16*i);void 0!==e&&(e.needsUpdate=!0)}}(),clone:function(){return new Vr(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length,a;t<r;t++)if(a=this.bones[t],a.name===e)return a}}),Wr.prototype=Object.assign(Object.create(y.prototype),{constructor:Wr,isBone:!0}),xe.prototype=Object.create(x.prototype),xe.prototype.constructor=xe,xe.prototype.isLineBasicMaterial=!0,xe.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},W.prototype=Object.assign(Object.create(y.prototype),{constructor:W,isLine:!0,computeLineDistances:function(){var t=new s,r=new s;return function(){var a=this.geometry;if(a.isBufferGeometry){if(null===a.index){for(var o=a.attributes.position,n=[0],i=1,s=o.count;i<s;i++)t.fromBufferAttribute(o,i-1),r.fromBufferAttribute(o,i),n[i]=n[i-1],n[i]+=t.distanceTo(r);a.addAttribute("lineDistance",new j(n,1))}else console.warn("COCO.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");}else if(a.isGeometry)for(o=a.vertices,n=a.lineDistances,n[0]=0,i=1,s=o.length;i<s;i++)n[i]=n[i-1],n[i]+=o[i-1].distanceTo(o[i]);return this}}(),raycast:function(){var r=new _,a=new L,o=new T;return function(n,i){var e=n.linePrecision,d=this.geometry,c=this.matrixWorld;if(null===d.boundingSphere&&d.computeBoundingSphere(),o.copy(d.boundingSphere),o.applyMatrix4(c),o.radius+=e,!1!==n.ray.intersectsSphere(o)){r.getInverse(c),a.copy(n.ray).applyMatrix4(r),e/=(this.scale.x+this.scale.y+this.scale.z)/3,e*=e;var y=new s,x=new s;c=new s;var _=new s,l=this&&this.isLineSegments?2:1;if(d.isBufferGeometry){var p=d.index,b=d.attributes.position.array;if(null!==p){p=p.array,d=0;for(var t=p.length-1,T;d<t;d+=l)T=p[d+1],y.fromArray(b,3*p[d]),x.fromArray(b,3*T),T=a.distanceSqToSegment(y,x,_,c),T>e||(_.applyMatrix4(this.matrixWorld),T=n.ray.origin.distanceTo(_),T<n.near||T>n.far||i.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this}))}else for(d=0,t=b.length/3-1;d<t;d+=l)y.fromArray(b,3*d),x.fromArray(b,3*d+3),T=a.distanceSqToSegment(y,x,_,c),T>e||(_.applyMatrix4(this.matrixWorld),T=n.ray.origin.distanceTo(_),T<n.near||T>n.far||i.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this}))}else if(d.isGeometry)for(y=d.vertices,x=y.length,d=0;d<x-1;d+=l)T=a.distanceSqToSegment(y[d],y[d+1],_,c),T>e||(_.applyMatrix4(this.matrixWorld),T=n.ray.origin.distanceTo(_),T<n.near||T>n.far||i.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),X.prototype=Object.assign(Object.create(W.prototype),{constructor:X,isLineSegments:!0,computeLineDistances:function(){var t=new s,r=new s;return function(){var a=this.geometry;if(a.isBufferGeometry){if(null===a.index){for(var o=a.attributes.position,n=[],i=0,s=o.count;i<s;i+=2)t.fromBufferAttribute(o,i),r.fromBufferAttribute(o,i+1),n[i]=0==i?0:n[i-1],n[i+1]=n[i]+t.distanceTo(r);a.addAttribute("lineDistance",new j(n,1))}else console.warn("COCO.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");}else if(a.isGeometry)for(o=a.vertices,n=a.lineDistances,i=0,s=o.length;i<s;i+=2)t.copy(o[i]),r.copy(o[i+1]),n[i]=0==i?0:n[i-1],n[i+1]=n[i]+t.distanceTo(r);return this}}()}),U.prototype=Object.assign(Object.create(W.prototype),{constructor:U,isLineLoop:!0}),jr.prototype=Object.create(x.prototype),jr.prototype.constructor=jr,jr.prototype.isPointsMaterial=!0,jr.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},qr.prototype=Object.assign(Object.create(y.prototype),{constructor:qr,isPoints:!0,raycast:function(){var e=new _,r=new L,a=new T;return function(o,n){function i(e,t){var i=r.distanceSqToPoint(e);i<y&&(r.closestPointToPoint(e,l),l.applyMatrix4(g),e=o.ray.origin.distanceTo(l),e<o.near||e>o.far||n.push({distance:e,distanceToRay:Math.sqrt(i),point:l.clone(),index:t,face:null,object:d}))}var d=this,c=this.geometry,g=this.matrixWorld,f=o.params.Points.threshold;if(null===c.boundingSphere&&c.computeBoundingSphere(),a.copy(c.boundingSphere),a.applyMatrix4(g),a.radius+=f,!1!==o.ray.intersectsSphere(a)){e.getInverse(g),r.copy(o.ray).applyMatrix4(e),f/=(this.scale.x+this.scale.y+this.scale.z)/3;var y=f*f;f=new s;var l=new s;if(c.isBufferGeometry){var p=c.index;if(c=c.attributes.position.array,null!==p){var x=p.array;p=0;for(var _=x.length,b;p<_;p++)b=x[p],f.fromArray(c,3*b),i(f,b)}else for(p=0,x=c.length/3;p<x;p++)f.fromArray(c,3*p),i(f,p)}else for(f=c.vertices,p=0,x=f.length;p<x;p++)i(f[p],p)}}}(),updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var r=e[t[0]];if(void 0!==r)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=r.length;e<t;e++){var o=r[e].name||e+"";this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=e}}}else e=e.morphTargets,void 0!==e&&0<e.length&&console.error("COCO.Points.updateMorphTargets() does not support COCO.Geometry. Use COCO.BufferGeometry instead.")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Xr.prototype=Object.assign(Object.create(n.prototype),{constructor:Xr,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),ye.prototype=Object.create(n.prototype),ye.prototype.constructor=ye,ye.prototype.isCompressedTexture=!0,Yr.prototype=Object.create(n.prototype),Yr.prototype.constructor=Yr,Yr.prototype.isCanvasTexture=!0,Zr.prototype=Object.create(n.prototype),Zr.prototype.constructor=Zr,Zr.prototype.isDepthTexture=!0,Jr.prototype=Object.create(Y.prototype),Jr.prototype.constructor=Jr,Qr.prototype=Object.create(q.prototype),Qr.prototype.constructor=Qr,Kr.prototype=Object.create(Y.prototype),Kr.prototype.constructor=Kr,$r.prototype=Object.create(q.prototype),$r.prototype.constructor=$r,ea.prototype=Object.create(Y.prototype),ea.prototype.constructor=ea,ra.prototype=Object.create(q.prototype),ra.prototype.constructor=ra,oa.prototype=Object.create(ea.prototype),oa.prototype.constructor=oa,na.prototype=Object.create(q.prototype),na.prototype.constructor=na,ia.prototype=Object.create(ea.prototype),ia.prototype.constructor=ia,sa.prototype=Object.create(q.prototype),sa.prototype.constructor=sa,da.prototype=Object.create(ea.prototype),da.prototype.constructor=da,pa.prototype=Object.create(q.prototype),pa.prototype.constructor=pa,la.prototype=Object.create(ea.prototype),la.prototype.constructor=la,ca.prototype=Object.create(q.prototype),ca.prototype.constructor=ca,ma.prototype=Object.create(Y.prototype),ma.prototype.constructor=ma,ma.prototype.toJSON=function(){var e=Y.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},ga.prototype=Object.create(q.prototype),ga.prototype.constructor=ga,ha.prototype=Object.create(Y.prototype),ha.prototype.constructor=ha,ya.prototype=Object.create(q.prototype),ya.prototype.constructor=ya,va.prototype=Object.create(Y.prototype),va.prototype.constructor=va;var ui={triangulate:function(r,a,o){o=o||2;var i=a&&a.length,s=i?a[0]*o:r.length,e=xa(r,0,s,o,!0),p=[];if(!e||e.next===e.prev)return p;var g;if(i){var y=o;i=[];var v=0,x;for(x=a.length;v<x;v++){var _=a[v]*y,T=v<x-1?a[v+1]*y:r.length;_=xa(r,_,T,y,!1),_===_.next&&(_.steiner=!0),i.push(ze(_))}for(i.sort(Aa),v=0;v<i.length;v++)a=i[v],y=e,(y=za(a,y))&&(a=Wa(y,a),_a(a,a.next)),e=_a(e,e.next)}if(r.length>80*o){var u=g=r[0],S=i=r[1];for(y=o;y<s;y+=o)v=r[y],a=r[y+1],v<u&&(u=v),a<S&&(S=a),v>g&&(g=v),a>i&&(i=a);g=Math.max(g-u,i-S),g=0===g?0:1/g}return ba(e,p,o,u,S,g),p}},gi={area:function(t){for(var r=t.length,a=0,o=r-1,n=0;n<r;o=n++)a+=t[o].x*t[n].y-t[n].x*t[o].y;return .5*a},isClockWise:function(e){return 0>gi.area(e)},triangulateShape:function(t,r){var o=[],n=[],i=[];Ae(t),Ja(o,t);var e=t.length;for(r.forEach(Ae),t=0;t<r.length;t++)n.push(e),e+=r[t].length,Ja(o,r[t]);for(r=ui.triangulate(o,n),t=0;t<r.length;t+=3)i.push(r.slice(t,t+3));return i}};Ka.prototype=Object.create(q.prototype),Ka.prototype.constructor=Ka,Ka.prototype.toJSON=function(){var e=q.prototype.toJSON.call(this);return $a(this.parameters.shapes,this.parameters.options,e)},eo.prototype=Object.create(Y.prototype),eo.prototype.constructor=eo,eo.prototype.toJSON=function(){var e=Y.prototype.toJSON.call(this);return $a(this.parameters.shapes,this.parameters.options,e)};var fi={generateTopUV:function(t,r,n,i,s){t=r[3*i],i=r[3*i+1];var p=r[3*s];return s=r[3*s+1],[new o(r[3*n],r[3*n+1]),new o(t,i),new o(p,s)]},generateSideWallUV:function(t,r,i,s,p,y){t=r[3*i];var f=r[3*i+1];i=r[3*i+2];var g=r[3*s],h=r[3*s+1];s=r[3*s+2];var v=r[3*p],m=r[3*p+1];p=r[3*p+2];var l=r[3*y],n=r[3*y+1];return r=r[3*y+2],.01>Math.abs(f-h)?[new o(t,1-i),new o(g,1-s),new o(v,1-p),new o(l,1-r)]:[new o(f,1-i),new o(h,1-s),new o(m,1-p),new o(n,1-r)]}};to.prototype=Object.create(q.prototype),to.prototype.constructor=to,ro.prototype=Object.create(eo.prototype),ro.prototype.constructor=ro,ao.prototype=Object.create(q.prototype),ao.prototype.constructor=ao,oo.prototype=Object.create(Y.prototype),oo.prototype.constructor=oo,no.prototype=Object.create(q.prototype),no.prototype.constructor=no,io.prototype=Object.create(Y.prototype),io.prototype.constructor=io,so.prototype=Object.create(q.prototype),so.prototype.constructor=so,po.prototype=Object.create(Y.prototype),po.prototype.constructor=po,lo.prototype=Object.create(q.prototype),lo.prototype.constructor=lo,lo.prototype.toJSON=function(){var e=q.prototype.toJSON.call(this);return mo(this.parameters.shapes,e)},co.prototype=Object.create(Y.prototype),co.prototype.constructor=co,co.prototype.toJSON=function(){var e=Y.prototype.toJSON.call(this);return mo(this.parameters.shapes,e)},uo.prototype=Object.create(Y.prototype),uo.prototype.constructor=uo,go.prototype=Object.create(q.prototype),go.prototype.constructor=go,fo.prototype=Object.create(Y.prototype),fo.prototype.constructor=fo,ho.prototype=Object.create(go.prototype),ho.prototype.constructor=ho,yo.prototype=Object.create(fo.prototype),yo.prototype.constructor=yo,vo.prototype=Object.create(q.prototype),vo.prototype.constructor=vo,xo.prototype=Object.create(Y.prototype),xo.prototype.constructor=xo;var hi=Object.freeze({WireframeGeometry:Jr,ParametricGeometry:Qr,ParametricBufferGeometry:Kr,TetrahedronGeometry:ra,TetrahedronBufferGeometry:oa,OctahedronGeometry:na,OctahedronBufferGeometry:ia,IcosahedronGeometry:sa,IcosahedronBufferGeometry:da,DodecahedronGeometry:pa,DodecahedronBufferGeometry:la,PolyhedronGeometry:$r,PolyhedronBufferGeometry:ea,TubeGeometry:ca,TubeBufferGeometry:ma,TorusKnotGeometry:ga,TorusKnotBufferGeometry:ha,TorusGeometry:ya,TorusBufferGeometry:va,TextGeometry:to,TextBufferGeometry:ro,SphereGeometry:ao,SphereBufferGeometry:oo,RingGeometry:no,RingBufferGeometry:io,PlaneGeometry:rt,PlaneBufferGeometry:at,LatheGeometry:so,LatheBufferGeometry:po,ShapeGeometry:lo,ShapeBufferGeometry:co,ExtrudeGeometry:Ka,ExtrudeBufferGeometry:eo,EdgesGeometry:uo,ConeGeometry:ho,ConeBufferGeometry:yo,CylinderGeometry:go,CylinderBufferGeometry:fo,CircleGeometry:vo,CircleBufferGeometry:xo,BoxGeometry:N,BoxBufferGeometry:Z});_o.prototype=Object.create(x.prototype),_o.prototype.constructor=_o,_o.prototype.isShadowMaterial=!0,_o.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.color.copy(e.color),this},bo.prototype=Object.create($.prototype),bo.prototype.constructor=bo,bo.prototype.isRawShaderMaterial=!0,To.prototype=Object.create(x.prototype),To.prototype.constructor=To,To.prototype.isMeshStandardMaterial=!0,To.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},So.prototype=Object.create(To.prototype),So.prototype.constructor=So,So.prototype.isMeshPhysicalMaterial=!0,So.prototype.copy=function(e){return To.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Eo.prototype=Object.create(x.prototype),Eo.prototype.constructor=Eo,Eo.prototype.isMeshPhongMaterial=!0,Eo.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ma.prototype=Object.create(Eo.prototype),Ma.prototype.constructor=Ma,Ma.prototype.isMeshToonMaterial=!0,Ma.prototype.copy=function(e){return Eo.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},Mo.prototype=Object.create(x.prototype),Mo.prototype.constructor=Mo,Mo.prototype.isMeshNormalMaterial=!0,Mo.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Co.prototype=Object.create(x.prototype),Co.prototype.constructor=Co,Co.prototype.isMeshLambertMaterial=!0,Co.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},wo.prototype=Object.create(x.prototype),wo.prototype.constructor=wo,wo.prototype.isMeshMatcapMaterial=!0,wo.prototype.copy=function(e){return x.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Po.prototype=Object.create(xe.prototype),Po.prototype.constructor=Po,Po.prototype.isLineDashedMaterial=!0,Po.prototype.copy=function(e){return xe.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var ua=Object.freeze({ShadowMaterial:_o,SpriteMaterial:Ur,RawShaderMaterial:bo,ShaderMaterial:$,PointsMaterial:jr,MeshPhysicalMaterial:So,MeshStandardMaterial:To,MeshPhongMaterial:Eo,MeshToonMaterial:Ma,MeshNormalMaterial:Mo,MeshLambertMaterial:Co,MeshDepthMaterial:Mr,MeshDistanceMaterial:Cr,MeshBasicMaterial:S,MeshMatcapMaterial:wo,LineDashedMaterial:Po,LineBasicMaterial:xe,Material:x}),yi={arraySlice:function(e,t,r){return yi.isTypedArray(e)?new e.constructor(e.subarray(t,void 0===r?e.length:r)):e.slice(t,r)},convertArray:function(e,t,r){return e&&(r||e.constructor!==t)?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=Array(t),a=0;a!==t;++a)r[a]=a;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(t,r,a){for(var o=t.length,n=new t.constructor(o),e=0,i=0;i!==o;++e)for(var s=a[e]*r,d=0;d!==r;++d)n[i++]=t[s+d];return n},flattenJSON:function(t,r,a,o){for(var n=1,i=t[0];void 0!==i&&void 0===i[o];)i=t[n++];if(void 0!==i){var s=i[o];if(void 0!==s)if(Array.isArray(s))do s=i[o],void 0!==s&&(r.push(i.time),a.push.apply(a,s)),i=t[n++];while(void 0!==i);else if(void 0!==s.toArray)do s=i[o],void 0!==s&&(r.push(i.time),s.toArray(a,a.length)),i=t[n++];while(void 0!==i);else do s=i[o],void 0!==s&&(r.push(i.time),a.push(s)),i=t[n++];while(void 0!==i)}}};Object.assign(Ro.prototype,{evaluate:function(t){var r=this.parameterPositions,a=this._cachedIndex,o=r[a],n=r[a-1];a:{b:{c:{d:if(!(t<o)){for(var i=a+2;;){if(void 0===o){if(t<n)break d;return this._cachedIndex=a=r.length,this.afterEnd_(a-1,t,n)}if(a===i)break;if(n=o,o=r[++a],t<o)break b}o=r.length;break c}if(t>=n)break a;else{for(i=r[1],t<i&&(a=2,n=i),i=a-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,t,o);if(a===i)break;if(o=n,n=r[--a-1],t>=n)break b}o=a,a=0}}for(;a<o;)n=a+o>>>1,t<r[n]?o=n:a=n+1;if(o=r[a],n=r[a-1],void 0===n)return this._cachedIndex=0,this.beforeStart_(0,t,o);if(void 0===o)return this._cachedIndex=a=r.length,this.afterEnd_(a-1,n,t)}this._cachedIndex=a,this.intervalChanged_(a,n,o)}return this.interpolate_(a,n,t,o)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){var r=this.resultBuffer,o=this.sampleValues,n=this.valueSize;t*=n;for(var i=0;i!==n;++i)r[i]=o[t+i];return r},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ro.prototype,{beforeStart_:Ro.prototype.copySampleValue_,afterEnd_:Ro.prototype.copySampleValue_}),Ea.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Ea,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,r,o){var n=this.parameterPositions,i=t-2,s=t+1,p=n[i],l=n[s];if(void 0===p)switch(this.getSettings_().endingStart){case 2401:i=t,p=2*r-o;break;case 2402:i=n.length-2,p=r+n[i]-n[i+1];break;default:i=t,p=o;}if(void 0===l)switch(this.getSettings_().endingEnd){case 2401:s=t,l=2*o-r;break;case 2402:s=1,l=o+n[1]-n[0];break;default:s=t-1,l=r;}t=.5*(o-r),n=this.valueSize,this._weightPrev=t/(r-p),this._weightNext=t/(l-o),this._offsetPrev=i*n,this._offsetNext=s*n},interpolate_:function(t,r,o,i){var s=this.resultBuffer,e=this.sampleValues,p=this.valueSize;t*=p;var g=t-p,f=this._offsetPrev,h=this._offsetNext,m=this._weightPrev,y=this._weightNext,v=(o-r)/(i-r);for(o=v*v,i=o*v,r=-m*i+2*m*o-m*v,m=(1+m)*i+(-1.5-2*m)*o+(-.5+m)*v+1,v=(-1-y)*i+(1.5+y)*o+.5*v,y=y*i-y*o,o=0;o!==p;++o)s[o]=r*e[f+o]+m*e[g+o]+v*e[t+o]+y*e[h+o];return s}}),Lo.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Lo,interpolate_:function(t,r,o,n){var i=this.resultBuffer,e=this.sampleValues,s=this.valueSize;t*=s;var p=t-s;for(r=(o-r)/(n-r),o=1-r,n=0;n!==s;++n)i[n]=e[p+n]*o+e[t+n]*r;return i}}),Ao.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Ao,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Do,{toJSON:function(e){var t=e.constructor;if(void 0!==t.toJSON)t=t.toJSON(e);else{t={name:e.name,times:yi.convertArray(e.times,Array),values:yi.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(Do.prototype,{constructor:Do,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new Ao(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Lo(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Ea(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){switch(e){case 2300:var t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth;}if(void 0===t){if(t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name,void 0===this.createInterpolant)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(t);return console.warn("COCO.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302;}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,a=t.length;r!==a;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,a=t.length;r!==a;++r)t[r]*=e;return this},trim:function(t,r){for(var o=this.times,n=o.length,i=0,s=n-1;i!==n&&o[i]<t;)++i;for(;-1!==s&&o[s]>r;)--s;return++s,(0!=i||s!==n)&&(i>=s&&(s=Math.max(s,1),i=s-1),t=this.getValueSize(),this.times=yi.arraySlice(o,i,s),this.values=yi.arraySlice(this.values,i*t,s*t)),this},validate:function(){var t=!0,r=this.getValueSize();0!=r-Math.floor(r)&&(console.error("COCO.KeyframeTrack: Invalid value size in track.",this),t=!1);var o=this.times;r=this.values;var n=o.length;0===n&&(console.error("COCO.KeyframeTrack: Track is empty.",this),t=!1);for(var i=null,s=0,p;s!==n;s++){if(p=o[s],"number"==typeof p&&isNaN(p)){console.error("COCO.KeyframeTrack: Time is not a valid number.",this,s,p),t=!1;break}if(null!==i&&i>p){console.error("COCO.KeyframeTrack: Out of order keys.",this,s,p,i),t=!1;break}i=p}if(void 0!==r&&yi.isTypedArray(r))for(s=0,o=r.length;s!==o;++s)if(n=r[s],isNaN(n)){console.error("COCO.KeyframeTrack: Value is not a valid number.",this,s,n),t=!1;break}return t},optimize:function(){for(var t=this.times,r=this.values,a=this.getValueSize(),o=2302===this.getInterpolation(),i=1,s=t.length-1,d=1;d<s;++d){var p=!1,c=t[d];if(c!==t[d+1]&&(1!==d||c!==c[0]))if(o)p=!0;else{var f=d*a,y=f-a,l=f+a;for(c=0;c!==a;++c){var n=r[f+c];if(n!==r[y+c]||n!==r[l+c]){p=!0;break}}}if(p){if(d!==i)for(t[i]=t[d],p=d*a,f=i*a,c=0;c!==a;++c)r[f+c]=r[p+c];++i}}if(0<s){for(t[i]=t[s],p=s*a,f=i*a,c=0;c!==a;++c)r[f+c]=r[p+c];++i}return i!==t.length&&(this.times=yi.arraySlice(t,0,i),this.values=yi.arraySlice(r,0,i*a)),this},clone:function(){var e=yi.arraySlice(this.times,0),t=yi.arraySlice(this.values,0);return e=new this.constructor(this.name,e,t),e.createInterpolant=this.createInterpolant,e}}),ta.prototype=Object.assign(Object.create(Do.prototype),{constructor:ta,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Io.prototype=Object.assign(Object.create(Do.prototype),{constructor:Io,ValueTypeName:"color"}),Bo.prototype=Object.assign(Object.create(Do.prototype),{constructor:Bo,ValueTypeName:"number"}),zo.prototype=Object.assign(Object.create(Ro.prototype),{constructor:zo,interpolate_:function(t,r,o,n){var s=this.resultBuffer,e=this.sampleValues,d=this.valueSize;for(t*=d,r=(o-r)/(n-r),o=t+d;t!==o;t+=4)i.slerpFlat(s,0,e,t-d,e,t,r);return s}}),No.prototype=Object.assign(Object.create(Do.prototype),{constructor:No,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new zo(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Oo.prototype=Object.assign(Object.create(Do.prototype),{constructor:Oo,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ko.prototype=Object.assign(Object.create(Do.prototype),{constructor:ko,ValueTypeName:"vector"}),Object.assign(Uo,{parse:function(t){for(var r=[],a=t.tracks,o=1/(t.fps||1),n=0,i=a.length;n!==i;++n)r.push(Go(a[n]).scale(o));return new Uo(t.name,t.duration,r)},toJSON:function(t){var r=[],o=t.tracks;t={name:t.name,duration:t.duration,tracks:r,uuid:t.uuid};for(var n=0,i=o.length;n!==i;++n)r.push(Do.toJSON(o[n]));return t},CreateFromMorphTargetSequence:function(t,r,a,o){for(var n=r.length,e=[],i=0;i<n;i++){var s=[],d=[];s.push((i+n-1)%n,i,(i+1)%n),d.push(0,1,0);var p=yi.getKeyframeOrder(s);s=yi.sortedArray(s,1,p),d=yi.sortedArray(d,1,p),o||0!==s[0]||(s.push(n),d.push(d[0])),e.push(new Bo(".morphTargetInfluences["+r[i].name+"]",s,d).scale(1/a))}return new Uo(t,-1,e)},findByName:function(e,t){var r=e;for(Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations),e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var o={},n=0,i=e.length;n<i;n++){var s=e[n],d=s.name.match(/^([\w-]*?)([\d]+)$/);if(d&&1<d.length){var p=d[1];(d=o[p])||(o[p]=d=[]),d.push(s)}}for(p in e=[],o)e.push(Uo.CreateFromMorphTargetSequence(p,o[p],t,r));return e},parseAnimation:function(r,o){if(!r)return console.error("COCO.AnimationClip: No animation in JSONLoader data."),null;var i=function(t,r,a,o,n){if(0!==a.length){var e=[],i=[];yi.flattenJSON(a,e,i,o),0!==e.length&&n.push(new t(r,e,i))}},s=[],d=r.name||"default",e=r.length||-1,p=r.fps||30;r=r.hierarchy||[];for(var c=0,g;c<r.length;c++)if(g=r[c].keys,g&&0!==g.length)if(g[0].morphTargets){e={};for(var y=0;y<g.length;y++)if(g[y].morphTargets)for(var v=0;v<g[y].morphTargets.length;v++)e[g[y].morphTargets[v]]=-1;for(var x in e){var n=[],u=[];for(v=0;v!==g[y].morphTargets.length;++v){var t=g[y];n.push(t.time),u.push(t.morphTarget===x?1:0)}s.push(new Bo(".morphTargetInfluence["+x+"]",n,u))}e=e.length*(p||1)}else y=".bones["+o[c].name+"]",i(ko,y+".position",g,"pos",s),i(No,y+".quaternion",g,"rot",s),i(ko,y+".scale",g,"scl",s);return 0===s.length?null:new Uo(d,e,s)}}),Object.assign(Uo.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length,o;t!==r;++t)o=this.tracks[t],e=Math.max(e,o.times[o.times.length-1]);return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Uo(this.name,this.duration,e)}});var aa={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},vi=new Fo,Ba={};Object.assign(Be.prototype,{load:function(t,r,o,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var s=this,e=aa.get(t);if(void 0!==e)return s.manager.itemStart(t),setTimeout(function(){r&&r(e),s.manager.itemEnd(t)},0),e;if(void 0!==Ba[t])Ba[t].push({onLoad:r,onProgress:o,onError:i});else{var d=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(d){o=d[1];var p=!!d[2];d=d[3],d=decodeURIComponent(d),p&&(d=atob(d));try{var u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":var f=new Uint8Array(d.length);for(p=0;p<d.length;p++)f[p]=d.charCodeAt(p);var m="blob"===u?new Blob([f.buffer],{type:o}):f.buffer;break;case"document":m=new DOMParser().parseFromString(d,o);break;case"json":m=JSON.parse(d);break;default:m=d;}setTimeout(function(){r&&r(m),s.manager.itemEnd(t)},0)}catch(e){setTimeout(function(){i&&i(e),s.manager.itemError(t),s.manager.itemEnd(t)},0)}}else{Ba[t]=[],Ba[t].push({onLoad:r,onProgress:o,onError:i});var y=new XMLHttpRequest;for(p in y.open("GET",t,!0),y.addEventListener("load",function(e){var r=this.response;aa.add(t,r);var a=Ba[t];if(delete Ba[t],200===this.status||0===this.status){0===this.status&&console.warn("COCO.FileLoader: HTTP Status 0 received.");for(var o=0,n=a.length,i;o<n;o++)i=a[o],i.onLoad&&i.onLoad(r)}else{for(o=0,n=a.length;o<n;o++)(i=a[o],i.onError)&&i.onError(e);s.manager.itemError(t)}s.manager.itemEnd(t)},!1),y.addEventListener("progress",function(r){for(var a=Ba[t],o=0,n=a.length,e;o<n;o++)e=a[o],e.onProgress&&e.onProgress(r)},!1),y.addEventListener("error",function(e){var r=Ba[t];delete Ba[t];for(var a=0,o=r.length,n;a<o;a++)n=r[a],n.onError&&n.onError(e);s.manager.itemError(t),s.manager.itemEnd(t)},!1),y.addEventListener("abort",function(e){var r=Ba[t];delete Ba[t];for(var a=0,o=r.length,n;a<o;a++)n=r[a],n.onError&&n.onError(e);s.manager.itemError(t),s.manager.itemEnd(t)},!1),void 0!==this.responseType&&(y.responseType=this.responseType),void 0!==this.withCredentials&&(y.withCredentials=this.withCredentials),y.overrideMimeType&&y.overrideMimeType(void 0===this.mimeType?"text/plain":this.mimeType),this.requestHeader)y.setRequestHeader(p,this.requestHeader[p]);y.send(null)}return s.manager.itemStart(t),y}},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(Na.prototype,{load:function(t,r,a,o){var n=this,e=new Be(n.manager);e.setPath(n.path),e.load(t,function(e){r(n.parse(JSON.parse(e)))},a,o)},parse:function(e){for(var t=[],r=0,a;r<e.length;r++)a=Uo.parse(e[r]),t.push(a);return t},setPath:function(e){return this.path=e,this}}),Object.assign(Ho.prototype,{load:function(t,r,a,o){function i(n){d.load(t[n],function(e){e=s._parser(e,!0),p[n]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},c+=1,6===c&&(1===e.mipmapCount&&(u.minFilter=1006),u.format=e.format,u.needsUpdate=!0,r&&r(u))},a,o)}var s=this,p=[],u=new ye;u.image=p;var d=new Be(this.manager);if(d.setPath(this.path),d.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,e=0,g=t.length;e<g;++e)i(e);else d.load(t,function(t){if(t=s._parser(t,!0),t.isCubemap)for(var o=t.mipmaps.length/t.mipmapCount,n=0;n<o;n++){p[n]={mipmaps:[]};for(var i=0;i<t.mipmapCount;i++)p[n].mipmaps.push(t.mipmaps[n*t.mipmapCount+i]),p[n].format=t.format,p[n].width=t.width,p[n].height=t.height}else u.image.width=t.width,u.image.height=t.height,u.mipmaps=t.mipmaps;1===t.mipmapCount&&(u.minFilter=1006),u.format=t.format,u.needsUpdate=!0,r&&r(u)},a,o);return u},setPath:function(e){return this.path=e,this}}),Object.assign(Vo.prototype,{load:function(t,r,a,o){var n=this,e=new _e,i=new Be(this.manager);return i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(t,function(t){(t=n._parser(t))&&(void 0===t.image?void 0!==t.data&&(e.image.width=t.width,e.image.height=t.height,e.image.data=t.data):e.image=t.image,e.wrapS=void 0===t.wrapS?1001:t.wrapS,e.wrapT=void 0===t.wrapT?1001:t.wrapT,e.magFilter=void 0===t.magFilter?1006:t.magFilter,e.minFilter=void 0===t.minFilter?1008:t.minFilter,e.anisotropy=void 0===t.anisotropy?1:t.anisotropy,void 0!==t.format&&(e.format=t.format),void 0!==t.type&&(e.type=t.type),void 0!==t.mipmaps&&(e.mipmaps=t.mipmaps),1===t.mipmapCount&&(e.minFilter=1006),e.needsUpdate=!0,r&&r(e,t))},a,o),e},setPath:function(e){return this.path=e,this}}),Object.assign(Ce.prototype,{crossOrigin:"anonymous",load:function(t,r,o,n){function i(){p.removeEventListener("load",i,!1),p.removeEventListener("error",e,!1),aa.add(t,this),r&&r(this),s.manager.itemEnd(t)}function e(r){p.removeEventListener("load",i,!1),p.removeEventListener("error",e,!1),n&&n(r),s.manager.itemError(t),s.manager.itemEnd(t)}void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var s=this,d=aa.get(t);if(void 0!==d)return s.manager.itemStart(t),setTimeout(function(){r&&r(d),s.manager.itemEnd(t)},0),d;var p=document.createElementNS("http://www.w3.org/1999/xhtml","img");return p.addEventListener("load",i,!1),p.addEventListener("error",e,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(p.crossOrigin=this.crossOrigin),s.manager.itemStart(t),p.src=t,p},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Wo.prototype,{crossOrigin:"anonymous",load:function(t,r,a,o){function n(n){i.load(t[n],function(t){e.images[n]=t,s++,6===s&&(e.needsUpdate=!0,r&&r(e))},void 0,o)}var e=new ft,i=new Ce(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);var s=0;for(a=0;a<t.length;++a)n(a);return e},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(De.prototype,{crossOrigin:"anonymous",load:function(t,r,a,o){var i=new n,e=new Ce(this.manager);return e.setCrossOrigin(this.crossOrigin),e.setPath(this.path),e.load(t,function(e){i.image=e,e=0<t.search(/\.jpe?g($|\?)/i)||0===t.search(/^data:image\/jpeg/),i.format=e?1022:1023,i.needsUpdate=!0,void 0!==r&&r(i)},a,o),i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(jo.prototype,{getPoint:function(){return console.warn("COCO.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){return e=this.getUtoTmapping(e),this.getPoint(e,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var r=[],o=this.getPoint(0),n=0,i;for(r.push(0),i=1;i<=t;i++){var s=this.getPoint(i/t);n+=s.distanceTo(o),r.push(n),o=s}return this.cacheArcLengths=r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,r){var o=this.getLengths(),n=o.length;r=r?r:t*o[n-1];for(var i=0,s=n-1,d;i<=s;)if(t=Math.floor(i+(s-i)/2),d=o[t]-r,0>d)i=t+1;else if(0<d)s=t-1;else{s=t;break}return(t=s,o[t]===r)?t/(n-1):(i=o[t],(t+(r-i)/(o[t+1]-i))/(n-1))},getTangent:function(e){var t=e-1E-4;return e+=1E-4,0>t&&(t=0),1<e&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},getTangentAt:function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},computeFrenetFrames:function(t,r){var a=new s,o=[],n=[],e=[],i=new s,d=new _,u;for(u=0;u<=t;u++){var g=u/t;o[u]=this.getTangentAt(g),o[u].normalize()}n[0]=new s,e[0]=new s,u=Number.MAX_VALUE,g=Math.abs(o[0].x);var f=Math.abs(o[0].y),l=Math.abs(o[0].z);for(g<=u&&(u=g,a.set(1,0,0)),f<=u&&(u=f,a.set(0,1,0)),l<=u&&a.set(0,0,1),i.crossVectors(o[0],a).normalize(),n[0].crossVectors(o[0],i),e[0].crossVectors(o[0],n[0]),u=1;u<=t;u++)n[u]=n[u-1].clone(),e[u]=e[u-1].clone(),i.crossVectors(o[u-1],o[u]),i.length()>Number.EPSILON&&(i.normalize(),a=Math.acos(Ze.clamp(o[u-1].dot(o[u]),-1,1)),n[u].applyMatrix4(d.makeRotationAxis(i,a))),e[u].crossVectors(o[u],n[u]);if(!0===r)for(a=Math.acos(Ze.clamp(n[0].dot(n[t]),-1,1)),a/=t,0<o[0].dot(i.crossVectors(n[0],n[t]))&&(a=-a),u=1;u<=t;u++)n[u].applyMatrix4(d.makeRotationAxis(o[u],a*u)),e[u].crossVectors(o[u],n[u]);return{tangents:o,normals:n,binormals:e}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"},arcLengthDivisions:this.arcLengthDivisions,type:this.type};return e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),J.prototype=Object.create(jo.prototype),J.prototype.constructor=J,J.prototype.isEllipseCurve=!0,J.prototype.getPoint=function(t,r){r=r||new o;for(var n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,s=Math.abs(i)<Number.EPSILON;0>i;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=s?0:n),!0!==this.aClockwise||s||(i=i===n?-n:i-n),n=this.aStartAngle+t*i,t=this.aX+this.xRadius*Math.cos(n);var p=this.aY+this.yRadius*Math.sin(n);return 0!==this.aRotation&&(n=Math.cos(this.aRotation),i=Math.sin(this.aRotation),s=t-this.aX,p-=this.aY,t=s*n-p*i+this.aX,p=s*i+p*n+this.aY),r.set(t,p)},J.prototype.copy=function(e){return jo.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},J.prototype.toJSON=function(){var e=jo.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},J.prototype.fromJSON=function(e){return jo.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ca.prototype=Object.create(J.prototype),Ca.prototype.constructor=Ca,Ca.prototype.isArcCurve=!0;var Ua=new s,ke=new qo,xi=new qo,_i=new qo;Ee.prototype=Object.create(jo.prototype),Ee.prototype.constructor=Ee,Ee.prototype.isCatmullRomCurve3=!0,Ee.prototype.getPoint=function(t,r){r=r||new s;var o=this.points,n=o.length;t*=n-(this.closed?0:1);var i=Math.floor(t);if(t-=i,this.closed?i+=0<i?0:(Math.floor(Math.abs(i)/n)+1)*n:0===t&&i===n-1&&(i=n-2,t=1),this.closed||0<i)var p=o[(i-1)%n];else Ua.subVectors(o[0],o[1]).add(o[0]),p=Ua;var l=o[i%n],m=o[(i+1)%n];if(this.closed||i+2<n?o=o[(i+2)%n]:(Ua.subVectors(o[n-1],o[n-2]).add(o[n-1]),o=Ua),"centripetal"===this.curveType||"chordal"===this.curveType){var u="chordal"===this.curveType?.5:.25;n=Math.pow(p.distanceToSquared(l),u),i=Math.pow(l.distanceToSquared(m),u),u=Math.pow(m.distanceToSquared(o),u),1E-4>i&&(i=1),1E-4>n&&(n=i),1E-4>u&&(u=i),ke.initNonuniformCatmullRom(p.x,l.x,m.x,o.x,n,i,u),xi.initNonuniformCatmullRom(p.y,l.y,m.y,o.y,n,i,u),_i.initNonuniformCatmullRom(p.z,l.z,m.z,o.z,n,i,u)}else"catmullrom"===this.curveType&&(ke.initCatmullRom(p.x,l.x,m.x,o.x,this.tension),xi.initCatmullRom(p.y,l.y,m.y,o.y,this.tension),_i.initCatmullRom(p.z,l.z,m.z,o.z,this.tension));return r.set(ke.calc(t),xi.calc(t),_i.calc(t)),r},Ee.prototype.copy=function(e){jo.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ee.prototype.toJSON=function(){var e=jo.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Ee.prototype.fromJSON=function(e){jo.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length,a;t<r;t++)a=e.points[t],this.points.push(new s().fromArray(a));return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Zo.prototype=Object.create(jo.prototype),Zo.prototype.constructor=Zo,Zo.prototype.isCubicBezierCurve=!0,Zo.prototype.getPoint=function(t,r){r=r||new o;var a=this.v0,n=this.v1,i=this.v2,e=this.v3;return r.set(Yo(t,a.x,n.x,i.x,e.x),Yo(t,a.y,n.y,i.y,e.y)),r},Zo.prototype.copy=function(e){return jo.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Zo.prototype.toJSON=function(){var e=jo.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Zo.prototype.fromJSON=function(e){return jo.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Oa.prototype=Object.create(jo.prototype),Oa.prototype.constructor=Oa,Oa.prototype.isCubicBezierCurve3=!0,Oa.prototype.getPoint=function(t,r){r=r||new s;var a=this.v0,o=this.v1,n=this.v2,e=this.v3;return r.set(Yo(t,a.x,o.x,n.x,e.x),Yo(t,a.y,o.y,n.y,e.y),Yo(t,a.z,o.z,n.z,e.z)),r},Oa.prototype.copy=function(e){return jo.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Oa.prototype.toJSON=function(){var e=jo.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Oa.prototype.fromJSON=function(e){return jo.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Jo.prototype=Object.create(jo.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isLineCurve=!0,Jo.prototype.getPoint=function(e,t){return t=t||new o,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Jo.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Jo.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Jo.prototype.copy=function(e){return jo.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Jo.prototype.toJSON=function(){var e=jo.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Jo.prototype.fromJSON=function(e){return jo.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Da.prototype=Object.create(jo.prototype),Da.prototype.constructor=Da,Da.prototype.isLineCurve3=!0,Da.prototype.getPoint=function(e,t){return t=t||new s,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Da.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Da.prototype.copy=function(e){return jo.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Da.prototype.toJSON=function(){var e=jo.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Da.prototype.fromJSON=function(e){return jo.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Pa.prototype=Object.create(jo.prototype),Pa.prototype.constructor=Pa,Pa.prototype.isQuadraticBezierCurve=!0,Pa.prototype.getPoint=function(t,r){r=r||new o;var a=this.v0,n=this.v1,i=this.v2;return r.set(Xo(t,a.x,n.x,i.x),Xo(t,a.y,n.y,i.y)),r},Pa.prototype.copy=function(e){return jo.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Pa.prototype.toJSON=function(){var e=jo.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Pa.prototype.fromJSON=function(e){return jo.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Qa.prototype=Object.create(jo.prototype),Qa.prototype.constructor=Qa,Qa.prototype.isQuadraticBezierCurve3=!0,Qa.prototype.getPoint=function(t,r){r=r||new s;var a=this.v0,o=this.v1,n=this.v2;return r.set(Xo(t,a.x,o.x,n.x),Xo(t,a.y,o.y,n.y),Xo(t,a.z,o.z,n.z)),r},Qa.prototype.copy=function(e){return jo.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Qa.prototype.toJSON=function(){var e=jo.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Qa.prototype.fromJSON=function(e){return jo.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Qo.prototype=Object.create(jo.prototype),Qo.prototype.constructor=Qo,Qo.prototype.isSplineCurve=!0,Qo.prototype.getPoint=function(t,r){r=r||new o;var n=this.points,i=(n.length-1)*t;t=Math.floor(i),i-=t;var s=n[0===t?t:t-1],e=n[t],p=n[t>n.length-2?n.length-1:t+1];return n=n[t>n.length-3?n.length-1:t+2],r.set(wa(i,s.x,e.x,p.x,n.x),wa(i,s.y,e.y,p.y,n.y)),r},Qo.prototype.copy=function(e){jo.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());return this},Qo.prototype.toJSON=function(){var e=jo.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());return e},Qo.prototype.fromJSON=function(e){jo.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length,a;t<r;t++)a=e.points[t],this.points.push(new o().fromArray(a));return this};var bi=Object.freeze({ArcCurve:Ca,CatmullRomCurve3:Ee,CubicBezierCurve:Zo,CubicBezierCurve3:Oa,EllipseCurve:J,LineCurve:Jo,LineCurve3:Da,QuadraticBezierCurve:Pa,QuadraticBezierCurve3:Qa,SplineCurve:Qo});Ra.prototype=Object.assign(Object.create(jo.prototype),{constructor:Ra,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Jo(t,e))},getPoint:function(e){var t=e*this.getLength(),r=this.getCurveLengths();for(e=0;e<r.length;){if(r[e]>=t)return t=r[e]-t,e=this.curves[e],r=e.getLength(),e.getPointAt(0===r?0:1-t/r);e++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,a=this.curves.length;r<a;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(t){t=t||12;for(var r=[],o=0,n=this.curves,e,i;o<n.length;o++){i=n[o],i=i.getPoints(i&&i.isEllipseCurve?2*t:i&&(i.isLineCurve||i.isLineCurve3)?1:i&&i.isSplineCurve?t*i.points.length:t);for(var s=0,p;s<i.length;s++)p=i[s],e&&e.equals(p)||(r.push(p),e=p)}return this.autoClose&&1<r.length&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){jo.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this},toJSON:function(){var e=jo.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++)e.curves.push(this.curves[t].toJSON());return e},fromJSON:function(e){jo.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length,a;t<r;t++)a=e.curves[t],this.curves.push(new bi[a.type]().fromJSON(a));return this}}),Ko.prototype=Object.assign(Object.create(Ra.prototype),{constructor:Ko,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new Jo(this.currentPoint.clone(),new o(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,n){e=new Pa(this.currentPoint.clone(),new o(e,t),new o(r,n)),this.curves.push(e),this.currentPoint.set(r,n)},bezierCurveTo:function(t,r,n,i,s,e){t=new Zo(this.currentPoint.clone(),new o(t,r),new o(n,i),new o(s,e)),this.curves.push(t),this.currentPoint.set(s,e)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e);t=new Qo(t),this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(t,r,a,o,n,e){this.absarc(t+this.currentPoint.x,r+this.currentPoint.y,a,o,n,e)},absarc:function(t,r,a,o,n,e){this.absellipse(t,r,a,a,o,n,e)},ellipse:function(t,r,a,o,n,e,i,s){this.absellipse(t+this.currentPoint.x,r+this.currentPoint.y,a,o,n,e,i,s)},absellipse:function(t,r,o,n,i,e,s,d){t=new J(t,r,o,n,i,e,s,d),0<this.curves.length&&(r=t.getPoint(0),r.equals(this.currentPoint)||this.lineTo(r.x,r.y)),this.curves.push(t),t=t.getPoint(1),this.currentPoint.copy(t)},copy:function(e){return Ra.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Ra.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Ra.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Sa.prototype=Object.assign(Object.create(Ko.prototype),{constructor:Sa,getPointsHoles:function(e){for(var t=[],r=0,a=this.holes.length;r<a;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ko.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++)this.holes.push(e.holes[t].clone());return this},toJSON:function(){var e=Ko.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++)e.holes.push(this.holes[t].toJSON());return e},fromJSON:function(e){Ko.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length,a;t<r;t++)a=e.holes[t],this.holes.push(new Ko().fromJSON(a));return this}}),$o.prototype=Object.assign(Object.create(y.prototype),{constructor:$o,isLight:!0,copy:function(e){return y.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){return e=y.prototype.toJSON.call(this,e),e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),R.prototype=Object.assign(Object.create($o.prototype),{constructor:R,isHemisphereLight:!0,copy:function(e){return $o.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(en.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),tn.prototype=Object.assign(Object.create(en.prototype),{constructor:tn,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*Ze.RAD2DEG*e.angle,o=this.mapSize.width/this.mapSize.height;e=e.distance||t.far,(r!==t.fov||o!==t.aspect||e!==t.far)&&(t.fov=r,t.aspect=o,t.far=e,t.updateProjectionMatrix())}}),rn.prototype=Object.assign(Object.create($o.prototype),{constructor:rn,isSpotLight:!0,copy:function(e){return $o.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),an.prototype=Object.assign(Object.create($o.prototype),{constructor:an,isPointLight:!0,copy:function(e){return $o.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),on.prototype=Object.assign(Object.create(re.prototype),{constructor:on,isOrthographicCamera:!0,copy:function(e,t){return re.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(t,r,a,o,n,e){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=r,this.view.offsetX=a,this.view.offsetY=o,this.view.width=n,this.view.height=e,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),r=(this.top-this.bottom)/(2*this.zoom),o=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=o-t;if(o+=t,t=n+r,r=n-r,null!==this.view&&this.view.enabled){o=this.zoom/(this.view.width/this.view.fullWidth),r=this.zoom/(this.view.height/this.view.fullHeight);var s=(this.right-this.left)/this.view.width;n=(this.top-this.bottom)/this.view.height,i+=this.view.offsetX/o*s,o=i+this.view.width/o*s,t-=this.view.offsetY/r*n,r=t-this.view.height/r*n}this.projectionMatrix.makeOrthographic(i,o,t,r,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){return e=y.prototype.toJSON.call(this,e),e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),nn.prototype=Object.assign(Object.create(en.prototype),{constructor:nn}),sn.prototype=Object.assign(Object.create($o.prototype),{constructor:sn,isDirectionalLight:!0,copy:function(e){return $o.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),dn.prototype=Object.assign(Object.create($o.prototype),{constructor:dn,isAmbientLight:!0}),pn.prototype=Object.assign(Object.create($o.prototype),{constructor:pn,isRectAreaLight:!0,copy:function(e){return $o.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){return e=$o.prototype.toJSON.call(this,e),e.object.width=this.width,e.object.height=this.height,e}}),Object.assign(ln.prototype,{load:function(t,r,a,o){var n=this,e=new Be(n.manager);e.setPath(n.path),e.load(t,function(e){r(n.parse(JSON.parse(e)))},a,o)},parse:function(t){function a(e){return void 0===n[e]&&console.warn("COCO.MaterialLoader: Undefined texture",e),n[e]}var n=this.textures,i=new ua[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearCoat&&(i.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(i.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.vertexColors&&(i.vertexColors=t.vertexColors),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(i.morphNormals=t.morphNormals),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.uniforms)for(var d in t.uniforms){var p=t.uniforms[d];switch(i.uniforms[d]={},p.type){case"t":i.uniforms[d].value=a(p.value);break;case"c":i.uniforms[d].value=new v().setHex(p.value);break;case"v2":i.uniforms[d].value=new o().fromArray(p.value);break;case"v3":i.uniforms[d].value=new s().fromArray(p.value);break;case"v4":i.uniforms[d].value=new u().fromArray(p.value);break;case"m3":i.uniforms[d].value=new r().fromArray(p.value);case"m4":i.uniforms[d].value=new _().fromArray(p.value);break;default:i.uniforms[d].value=p.value;}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var l in t.extensions)i.extensions[l]=t.extensions[l];return void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=a(t.map)),void 0!==t.matcap&&(i.matcap=a(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=a(t.alphaMap),i.transparent=!0),void 0!==t.bumpMap&&(i.bumpMap=a(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=a(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale&&(d=t.normalScale,!1===Array.isArray(d)&&(d=[d,d]),i.normalScale=new o().fromArray(d)),void 0!==t.displacementMap&&(i.displacementMap=a(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=a(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=a(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=a(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=a(t.specularMap)),void 0!==t.envMap&&(i.envMap=a(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=a(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=a(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=a(t.gradientMap)),i},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var Ti={decodeText:function(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);for(var t="",r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(r){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};ae.prototype=Object.assign(Object.create(Y.prototype),{constructor:ae,isInstancedBufferGeometry:!0,copy:function(e){return Y.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e=Y.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),be.prototype=Object.assign(Object.create(C.prototype),{constructor:be,isInstancedBufferAttribute:!0,copy:function(e){return C.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=C.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Object.assign(ce.prototype,{load:function(t,r,a,o){var n=this,e=new Be(n.manager);e.setPath(n.path),e.load(t,function(e){r(n.parse(JSON.parse(e)))},a,o)},parse:function(t){var r=t.isInstancedBufferGeometry?new ae:new Y,a=t.data.index;if(void 0!==a){var o=new Si[a.type](a.array);r.setIndex(new C(o,1))}for(var n in a=t.data.attributes,a){var i=a[n];o=new Si[i.type](i.array),o=new(i.isInstancedBufferAttribute?be:C)(o,i.itemSize,i.normalized),void 0!==i.name&&(o.name=i.name),r.addAttribute(n,o)}var p=t.data.morphAttributes;if(p)for(n in p){var l=p[n],u=[];a=0;for(var g=l.length;a<g;a++)i=l[a],o=new Si[i.type](i.array),o=new C(o,i.itemSize,i.normalized),void 0!==i.name&&(o.name=i.name),u.push(o);r.morphAttributes[n]=u}if(n=t.data.groups||t.data.drawcalls||t.data.offsets,void 0!==n)for(a=0,i=n.length;a!==i;++a)o=n[a],r.addGroup(o.start,o.count,o.materialIndex);return a=t.data.boundingSphere,void 0!==a&&(n=new s,void 0!==a.center&&n.fromArray(a.center),r.boundingSphere=new T(n,a.radius)),t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r},setPath:function(e){return this.path=e,this}});var Si={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"==typeof Uint8ClampedArray?Uint8Array:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Object.assign(Fe.prototype,{crossOrigin:"anonymous",load:function(t,r,a,o){var n=this,e=void 0===this.path?Ti.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||e,e=new Be(n.manager),e.setPath(this.path),e.load(t,function(e){var a=null;try{a=JSON.parse(e)}catch(e){return void 0!==o&&o(e),void console.error("COCO:ObjectLoader: Can't parse "+t+".",e.message)}e=a.metadata,void 0===e||void 0===e.type||"geometry"===e.type.toLowerCase()?console.error("COCO.ObjectLoader: Can't load "+t):n.parse(a,r)},a,o)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,r){var a=this.parseShape(t.shapes);a=this.parseGeometries(t.geometries,a);var o=this.parseImages(t.images,function(){void 0!==r&&r(n)});o=this.parseTextures(t.textures,o),o=this.parseMaterials(t.materials,o);var n=this.parseObject(t.object,a,o);return t.animations&&(n.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0===r||r(n),n},parseShape:function(t){var r={};if(void 0!==t)for(var a=0,o=t.length,n;a<o;a++)n=new Sa().fromJSON(t[a]),r[n.uuid]=n;return r},parseGeometries:function(t,r){var a={};if(void 0!==t)for(var o=new ce,n=0,i=t.length,s;n<i;n++){switch(s=t[n],s.type){case"PlaneGeometry":case"PlaneBufferGeometry":var d=new hi[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":d=new hi[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":d=new hi[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":d=new hi[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":d=new hi[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":d=new hi[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":d=new hi[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":d=new hi[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":d=new hi[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":d=new hi[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":d=new hi[s.type](new bi[s.path.type]().fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":d=new hi[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":d=new hi[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":d=[];for(var p=0,c=s.shapes.length,u;p<c;p++)u=r[s.shapes[p]],d.push(u);d=new hi[s.type](d,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(d=[],p=0,c=s.shapes.length;p<c;p++)u=r[s.shapes[p]],d.push(u);p=s.options.extrudePath,void 0!==p&&(s.options.extrudePath=new bi[p.type]().fromJSON(p)),d=new hi[s.type](d,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":d=o.parse(s);break;case"Geometry":"COCO"in window&&"LegacyJSONLoader"in COCO?d=new COCO.LegacyJSONLoader().parse(s,this.resourcePath).geometry:console.error("COCO.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type \"Geometry\".");break;default:console.warn("COCO.ObjectLoader: Unsupported geometry type \""+s.type+"\"");continue;}d.uuid=s.uuid,void 0!==s.name&&(d.name=s.name),!0===d.isBufferGeometry&&void 0!==s.userData&&(d.userData=s.userData),a[s.uuid]=d}return a},parseMaterials:function(t,r){var a={},o={};if(void 0!==t){var n=new ln;n.setTextures(r),r=0;for(var e=t.length,i;r<e;r++)if(i=t[r],"MultiMaterial"===i.type){for(var s=[],d=0,p;d<i.materials.length;d++)p=i.materials[d],void 0===a[p.uuid]&&(a[p.uuid]=n.parse(p)),s.push(a[p.uuid]);o[i.uuid]=s}else void 0===a[i.uuid]&&(a[i.uuid]=n.parse(i)),o[i.uuid]=a[i.uuid]}return o},parseAnimations:function(t){for(var r=[],a=0;a<t.length;a++){var o=t[a],n=Uo.parse(o);void 0!==o.uuid&&(n.uuid=o.uuid),r.push(n)}return r},parseImages:function(t,r){function a(t){return o.manager.itemStart(t),e.load(t,function(){o.manager.itemEnd(t)},void 0,function(){o.manager.itemError(t),o.manager.itemEnd(t)})}var o=this,i={};if(void 0!==t&&0<t.length){r=new Fo(r);var e=new Ce(r);e.setCrossOrigin(this.crossOrigin),r=0;for(var s=t.length;r<s;r++){var d=t[r],p=d.url;if(Array.isArray(p)){i[d.uuid]=[];for(var c=0,u=p.length,l;c<u;c++)l=p[c],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:o.resourcePath+l,i[d.uuid].push(a(l))}else l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d.url)?d.url:o.resourcePath+d.url,i[d.uuid]=a(l)}}return i},parseTextures:function(t,r){function a(e,t){return"number"==typeof e?e:(console.warn("COCO.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var o={};if(void 0!==t)for(var i=0,s=t.length,d;i<s;i++){d=t[i],void 0===d.image&&console.warn("COCO.ObjectLoader: No \"image\" specified for",d.uuid),void 0===r[d.image]&&console.warn("COCO.ObjectLoader: Undefined image",d.image);var p=Array.isArray(r[d.image])?new ft(r[d.image]):new n(r[d.image]);p.needsUpdate=!0,p.uuid=d.uuid,void 0!==d.name&&(p.name=d.name),void 0!==d.mapping&&(p.mapping=a(d.mapping,Ei)),void 0!==d.offset&&p.offset.fromArray(d.offset),void 0!==d.repeat&&p.repeat.fromArray(d.repeat),void 0!==d.center&&p.center.fromArray(d.center),void 0!==d.rotation&&(p.rotation=d.rotation),void 0!==d.wrap&&(p.wrapS=a(d.wrap[0],Mi),p.wrapT=a(d.wrap[1],Mi)),void 0!==d.format&&(p.format=d.format),void 0!==d.type&&(p.type=d.type),void 0!==d.encoding&&(p.encoding=d.encoding),void 0!==d.minFilter&&(p.minFilter=a(d.minFilter,Ci)),void 0!==d.magFilter&&(p.magFilter=a(d.magFilter,Ci)),void 0!==d.anisotropy&&(p.anisotropy=d.anisotropy),void 0!==d.flipY&&(p.flipY=d.flipY),void 0!==d.premultiplyAlpha&&(p.premultiplyAlpha=d.premultiplyAlpha),void 0!==d.unpackAlignment&&(p.unpackAlignment=d.unpackAlignment),o[d.uuid]=p}return o},parseObject:function(t,r,o){function n(e){return void 0===r[e]&&console.warn("COCO.ObjectLoader: Undefined geometry",e),r[e]}function i(t){if(void 0!==t){if(Array.isArray(t)){for(var r=[],a=0,n=t.length,e;a<n;a++)e=t[a],void 0===o[e]&&console.warn("COCO.ObjectLoader: Undefined material",e),r.push(o[e]);return r}return void 0===o[t]&&console.warn("COCO.ObjectLoader: Undefined material",t),o[t]}}switch(t.type){case"Scene":var e=new h;void 0!==t.background&&Number.isInteger(t.background)&&(e.background=new v(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?e.fog=new Nr(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(e.fog=new we(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":e=new oe(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(e.focus=t.focus),void 0!==t.zoom&&(e.zoom=t.zoom),void 0!==t.filmGauge&&(e.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(e.filmOffset=t.filmOffset),void 0!==t.view&&(e.view=Object.assign({},t.view));break;case"OrthographicCamera":e=new on(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(e.zoom=t.zoom),void 0!==t.view&&(e.view=Object.assign({},t.view));break;case"AmbientLight":e=new dn(t.color,t.intensity);break;case"DirectionalLight":e=new sn(t.color,t.intensity);break;case"PointLight":e=new an(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":e=new pn(t.color,t.intensity,t.width,t.height);break;case"SpotLight":e=new rn(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":e=new R(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("COCO.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":e=n(t.geometry);var s=i(t.material);e=e.bones&&0<e.bones.length?new Hr(e,s):new B(e,s),void 0!==t.drawMode&&e.setDrawMode(t.drawMode);break;case"LOD":e=new Fr;break;case"Line":e=new W(n(t.geometry),i(t.material),t.mode);break;case"LineLoop":e=new U(n(t.geometry),i(t.material));break;case"LineSegments":e=new X(n(t.geometry),i(t.material));break;case"PointCloud":case"Points":e=new qr(n(t.geometry),i(t.material));break;case"Sprite":e=new Gr(i(t.material));break;case"Group":e=new Ar;break;default:e=new y;}if(e.uuid=t.uuid,void 0!==t.name&&(e.name=t.name),void 0===t.matrix?(void 0!==t.position&&e.position.fromArray(t.position),void 0!==t.rotation&&e.rotation.fromArray(t.rotation),void 0!==t.quaternion&&e.quaternion.fromArray(t.quaternion),void 0!==t.scale&&e.scale.fromArray(t.scale)):(e.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(e.matrixAutoUpdate=t.matrixAutoUpdate),e.matrixAutoUpdate&&e.matrix.decompose(e.position,e.quaternion,e.scale)),void 0!==t.castShadow&&(e.castShadow=t.castShadow),void 0!==t.receiveShadow&&(e.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(e.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(e.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&e.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(e.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(e.visible=t.visible),void 0!==t.frustumCulled&&(e.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(e.renderOrder=t.renderOrder),void 0!==t.userData&&(e.userData=t.userData),void 0!==t.layers&&(e.layers.mask=t.layers),void 0!==t.children){s=t.children;for(var d=0;d<s.length;d++)e.add(this.parseObject(s[d],r,o))}if("LOD"===t.type)for(t=t.levels,s=0;s<t.length;s++){d=t[s];var p=e.getObjectByProperty("uuid",d.object);void 0!==p&&e.addLevel(p,d.distance)}return e}});var Ei={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Mi={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Ci={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};Ge.prototype={constructor:Ge,setOptions:function(e){return this.options=e,this},load:function(t,r,o,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,e=aa.get(t);return void 0===e?void(fetch(t).then(function(e){return e.blob()}).then(function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)}).then(function(e){aa.add(t,e),r&&r(e),i.manager.itemEnd(t)}).catch(function(e){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}),i.manager.itemStart(t)):(i.manager.itemStart(t),setTimeout(function(){r&&r(e),i.manager.itemEnd(t)},0),e)},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(He.prototype,{moveTo:function(e,t){this.currentPath=new Ko,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,a){this.currentPath.quadraticCurveTo(e,t,r,a)},bezierCurveTo:function(t,r,a,o,n,e){this.currentPath.bezierCurveTo(t,r,a,o,n,e)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(r,o){function i(t){for(var r=[],a=0,o=t.length;a<o;a++){var n=t[a],e=new Sa;e.curves=n.curves,r.push(e)}return r}function s(t,r){for(var a=r.length,o=!1,n=a-1,i=0;i<a;n=i++){var s=r[n],p=r[i],l=p.x-s.x,c=p.y-s.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(s=r[i],l=-l,p=r[n],c=-c),!(t.y<s.y||t.y>p.y))if(t.y!==s.y){if(n=c*(t.x-s.x)-l*(t.y-s.y),0===n)return!0;0>n||(o=!o)}else if(t.x===s.x)return!0;}else if(t.y===s.y&&(p.x<=t.x&&t.x<=s.x||s.x<=t.x&&t.x<=p.x))return!0}return o}var d=gi.isClockWise,p=this.subPaths;if(0===p.length)return[];if(!0===o)return i(p);if(o=[],1===p.length){var c=p[0],y=new Sa;return y.curves=c.curves,o.push(y),o}var x=!d(p[0].getPoints());x=r?!x:x,y=[];var _=[],m=[],T=0;_[T]=void 0,m[T]=[];for(var S=0,E=p.length;S<E;S++){c=p[S];var t=c.getPoints(),M=d(t);(M=r?!M:M)?(!x&&_[T]&&T++,_[T]={s:new Sa,p:t},_[T].s.curves=c.curves,x&&T++,m[T]=[]):m[T].push({h:c,p:t[0]})}if(!_[0])return i(p);if(1<_.length){for(S=!1,r=[],d=0,p=_.length;d<p;d++)y[d]=[];for(d=0,p=_.length;d<p;d++)for(c=m[d],M=0;M<c.length;M++){for(x=c[M],T=!0,t=0;t<_.length;t++)s(x.p,_[t].p)&&(d!==t&&r.push({froms:d,tos:t,hole:M}),T?(T=!1,y[t].push(x)):S=!0);T&&y[d].push(x)}0<r.length&&(S||(m=y))}for(S=0,d=_.length;S<d;S++)for(y=_[S].s,o.push(y),r=m[S],p=0,c=r.length;p<c;p++)y.holes.push(r[p].h);return o}}),Object.assign(Ie.prototype,{isFont:!0,generateShapes:function(r,o){void 0===o&&(o=100);var i=[],s=o;o=this.data;var p=Array.from?Array.from(r):(r+"").split("");s/=o.resolution;var c=(o.boundingBox.yMax-o.boundingBox.yMin+o.underlineThickness)*s;r=[];for(var f=0,_=0,T=0,S;T<p.length;T++)if(S=p[T],"\n"===S)f=0,_-=c;else{var E=S;S=s;var M=f,n=_,u=o,P=u.glyphs[E]||u.glyphs["?"];if(P){if(E=new He,P.o){u=P._cachedOutline||(P._cachedOutline=P.o.split(" "));for(var R=0,L=u.length;R<L;)switch(u[R++]){case"m":var x=u[R++]*S+M,D=u[R++]*S+n;E.moveTo(x,D);break;case"l":x=u[R++]*S+M,D=u[R++]*S+n,E.lineTo(x,D);break;case"q":var I=u[R++]*S+M,N=u[R++]*S+n,O=u[R++]*S+M,U=u[R++]*S+n;E.quadraticCurveTo(O,U,I,N);break;case"b":I=u[R++]*S+M,N=u[R++]*S+n,O=u[R++]*S+M,U=u[R++]*S+n,x=u[R++]*S+M,D=u[R++]*S+n,E.bezierCurveTo(O,U,x,D,I,N);}}S={offsetX:P.ha*S,path:E}}else console.error("COCO.Font: character \""+E+"\" does not exists in font family "+u.familyName+"."),S=void 0;f+=S.offsetX,r.push(S.path)}for(o=0,p=r.length;o<p;o++)Array.prototype.push.apply(i,r[o].toShapes());return i}}),Object.assign(Je.prototype,{load:function(t,r,a,o){var n=this,e=new Be(this.manager);e.setPath(this.path),e.load(t,function(e){try{var t=JSON.parse(e)}catch(r){console.warn("COCO.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),t=JSON.parse(e.substring(65,e.length-2))}e=n.parse(t),r&&r(e)},a,o)},parse:function(e){return new Ie(e)},setPath:function(e){return this.path=e,this}}),cn.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(t){for(var r=this.handlers,a=0,o=r.length,n;a<o;a+=2)if(n=r[a+1],r[a].test(t))return n;return null}},Object.assign(cn.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,r,a){for(var o=[],n=0;n<t.length;++n)o[n]=this.createMaterial(t[n],r,a);return o},createMaterial:function(){var t={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},r=new v,o=new De,a=new ln;return function(i,s,c){function e(t,r,n,i,e){t=s+t;var d=cn.Handlers.get(t);return null===d?(o.setCrossOrigin(c),t=o.load(t)):t=d.load(t),void 0!==r&&(t.repeat.fromArray(r),1!==r[0]&&(t.wrapS=1E3),1!==r[1]&&(t.wrapT=1E3)),void 0!==n&&t.offset.fromArray(n),void 0!==i&&("repeat"===i[0]&&(t.wrapS=1E3),"mirror"===i[0]&&(t.wrapS=1002),"repeat"===i[1]&&(t.wrapT=1E3),"mirror"===i[1]&&(t.wrapT=1002)),void 0!==e&&(t.anisotropy=e),r=Ze.generateUUID(),m[r]=t,r}var m={},d={uuid:Ze.generateUUID(),type:"MeshLambertMaterial"},l;for(l in i){var u=i[l];switch(l){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":d.name=u;break;case"blending":d.blending=t[u];break;case"colorAmbient":case"mapAmbient":console.warn("COCO.Loader.createMaterial:",l,"is no longer supported.");break;case"colorDiffuse":d.color=r.fromArray(u).getHex();break;case"colorSpecular":d.specular=r.fromArray(u).getHex();break;case"colorEmissive":d.emissive=r.fromArray(u).getHex();break;case"specularCoef":d.shininess=u;break;case"shading":"basic"===u.toLowerCase()&&(d.type="MeshBasicMaterial"),"phong"===u.toLowerCase()&&(d.type="MeshPhongMaterial"),"standard"===u.toLowerCase()&&(d.type="MeshStandardMaterial");break;case"mapDiffuse":d.map=e(u,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":d.emissiveMap=e(u,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":d.lightMap=e(u,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":d.aoMap=e(u,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":d.bumpMap=e(u,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":d.bumpScale=u;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":d.normalMap=e(u,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":d.normalScale=u;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":d.specularMap=e(u,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":d.metalnessMap=e(u,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":d.roughnessMap=e(u,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":d.alphaMap=e(u,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":d.side=1;break;case"doubleSided":d.side=2;break;case"transparency":console.warn("COCO.Loader.createMaterial: transparency has been renamed to opacity"),d.opacity=u;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":d[l]=u;break;case"vertexColors":!0===u&&(d.vertexColors=2),"face"===u&&(d.vertexColors=1);break;default:console.error("COCO.Loader.createMaterial: Unsupported",l,u);}}return"MeshBasicMaterial"===d.type&&delete d.emissive,"MeshPhongMaterial"!==d.type&&delete d.specular,1>d.opacity&&(d.transparent=!0),a.setTextures(m),a.parse(d)}}()});var wi={getContext:function(){return void 0===Pe&&(Pe=new(window.AudioContext||window.webkitAudioContext)),Pe},setContext:function(e){Pe=e}},Pe;Object.assign(mn.prototype,{load:function(t,r,a,o){var n=new Be(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(t,function(e){e=e.slice(0),wi.getContext().decodeAudioData(e,function(e){r(e)})},a,o)},setPath:function(e){return this.path=e,this}}),Object.assign(Ke.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;9>t;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;9>e;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(t,r){var o=t.x,n=t.y;t=t.z;var i=this.coefficients;return r.copy(i[0]).multiplyScalar(.282095),r.addScale(i[1],.488603*n),r.addScale(i[2],.488603*t),r.addScale(i[3],.488603*o),r.addScale(i[4],1.092548*o*n),r.addScale(i[5],1.092548*n*t),r.addScale(i[6],.315392*(3*t*t-1)),r.addScale(i[7],1.092548*o*t),r.addScale(i[8],.546274*(o*o-n*n)),r},getIrradianceAt:function(t,r){var o=t.x,n=t.y;t=t.z;var i=this.coefficients;return r.copy(i[0]).multiplyScalar(.886227),r.addScale(i[1],1.023328*n),r.addScale(i[2],1.023328*t),r.addScale(i[3],1.023328*o),r.addScale(i[4],.858086*o*n),r.addScale(i[5],.858086*n*t),r.addScale(i[6],.743125*t*t-.247708),r.addScale(i[7],.858086*o*t),r.addScale(i[8],.429043*(o*o-n*n)),r},add:function(e){for(var t=0;9>t;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;9>t;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var r=0;9>r;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this},equals:function(e){for(var t=0;9>t;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(e){for(var t=this.coefficients,r=0;9>r;r++)t[r].fromArray(e,3*r);return this},toArray:function(){for(var e=[],t=this.coefficients,r=0;9>r;r++)t[r].toArray(e,3*r);return e}}),Object.assign(Ke,{getBasisAt:function(e,t){var r=e.x,o=e.y;e=e.z,t[0]=.282095,t[1]=.488603*o,t[2]=.488603*e,t[3]=.488603*r,t[4]=1.092548*r*o,t[5]=1.092548*o*e,t[6]=.315392*(3*e*e-1),t[7]=1.092548*r*e,t[8]=.546274*(r*r-o*o)}}),de.prototype=Object.assign(Object.create($o.prototype),{constructor:de,isLightProbe:!0,copy:function(e){return $o.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return $o.prototype.toJSON.call(this,e)}}),Ta.prototype=Object.assign(Object.create(de.prototype),{constructor:Ta,isHemisphereLightProbe:!0,copy:function(e){return de.prototype.copy.call(this,e),this},toJSON:function(e){return de.prototype.toJSON.call(this,e)}}),Le.prototype=Object.assign(Object.create(de.prototype),{constructor:Le,isAmbientLightProbe:!0,copy:function(e){return de.prototype.copy.call(this,e),this},toJSON:function(e){return de.prototype.toJSON.call(this,e)}}),Object.assign(Me.prototype,{update:function(){var o=new _,i=new _,s,p,l,u,y,x,T,S;return function(e){if(s!==this||p!==e.focus||l!==e.fov||u!==e.aspect*this.aspect||y!==e.near||x!==e.far||T!==e.zoom||S!==this.eyeSep){s=this,p=e.focus,l=e.fov,u=e.aspect*this.aspect,y=e.near,x=e.far,T=e.zoom;var a=e.projectionMatrix.clone();S=this.eyeSep/2;var n=S*y/p,r=y*Math.tan(.5*(Ze.DEG2RAD*l))/T;i.elements[12]=-S,o.elements[12]=S;var t=-r*u+n,d=r*u+n;a.elements[0]=2*y/(d-t),a.elements[8]=(d+t)/(d-t),this.cameraL.projectionMatrix.copy(a),t=-r*u-n,d=r*u-n,a.elements[0]=2*y/(d-t),a.elements[8]=(d+t)/(d-t),this.cameraR.projectionMatrix.copy(a)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(i),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(o)}}()}),Object.assign(un.prototype,{start:function(){this.oldTime=this.startTime=("undefined"==typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1E3,this.oldTime=t,this.elapsedTime+=e}return e}}),Ne.prototype=Object.assign(Object.create(y.prototype),{constructor:Ne,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null===this.filter?this.gain.disconnect(this.context.destination):(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var t=new s,r=new i,a=new s,o=new s,n=new un;return function(e){y.prototype.updateMatrixWorld.call(this,e),e=this.context.listener;var i=this.up;if(this.timeDelta=n.getDelta(),this.matrixWorld.decompose(t,r,a),o.set(0,0,-1).applyQuaternion(r),e.positionX){var s=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(t.x,s),e.positionY.linearRampToValueAtTime(t.y,s),e.positionZ.linearRampToValueAtTime(t.z,s),e.forwardX.linearRampToValueAtTime(o.x,s),e.forwardY.linearRampToValueAtTime(o.y,s),e.forwardZ.linearRampToValueAtTime(o.z,s),e.upX.linearRampToValueAtTime(i.x,s),e.upY.linearRampToValueAtTime(i.y,s),e.upZ.linearRampToValueAtTime(i.z,s)}else e.setPosition(t.x,t.y,t.z),e.setOrientation(o.x,o.y,o.z,i.x,i.y,i.z)}}()}),Oe.prototype=Object.assign(Object.create(y.prototype),{constructor:Oe,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0===this.isPlaying)console.warn("COCO.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("COCO.Audio: this Audio has no playback control.");else{var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}},pause:function(){return!1===this.hasPlaybackControl?void console.warn("COCO.Audio: this Audio has no playback control."):(!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this)},stop:function(){return!1===this.hasPlaybackControl?void console.warn("COCO.Audio: this Audio has no playback control."):(this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this)},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){return!1===this.hasPlaybackControl?void console.warn("COCO.Audio: this Audio has no playback control."):(this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("COCO.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){return!1===this.hasPlaybackControl?void console.warn("COCO.Audio: this Audio has no playback control."):(this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this)},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),gn.prototype=Object.assign(Object.create(Oe.prototype),{constructor:gn,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(){var t=new s,r=new i,a=new s,o=new s;return function(n){if(y.prototype.updateMatrixWorld.call(this,n),!0!==this.hasPlaybackControl||!1!==this.isPlaying)if(this.matrixWorld.decompose(t,r,a),o.set(0,0,1).applyQuaternion(r),n=this.panner,n.positionX){var i=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(t.x,i),n.positionY.linearRampToValueAtTime(t.y,i),n.positionZ.linearRampToValueAtTime(t.z,i),n.orientationX.linearRampToValueAtTime(o.x,i),n.orientationY.linearRampToValueAtTime(o.y,i),n.orientationZ.linearRampToValueAtTime(o.z,i)}else n.setPosition(t.x,t.y,t.z),n.setOrientation(o.x,o.y,o.z)}}()}),Object.assign(Qe.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(Re.prototype,{accumulate:function(t,r){var o=this.buffer,n=this.valueSize;t=t*n+n;var i=this.cumulativeWeight;if(0===i){for(i=0;i!==n;++i)o[t+i]=o[i];i=r}else i+=r,this._mixBufferRegion(o,t,0,r/i,n);this.cumulativeWeight=i},apply:function(t){var r=this.valueSize,o=this.buffer;t=t*r+r;var n=this.cumulativeWeight,i=this.binding;this.cumulativeWeight=0,1>n&&this._mixBufferRegion(o,t,3*r,1-n,r),n=r;for(;n!==r+r;++n)if(o[n]!==o[n+r]){i.setValue(o,t);break}},saveOriginalState:function(){var e=this.buffer,t=this.valueSize,r=3*t;this.binding.getValue(e,r);for(var a=t;a!==r;++a)e[a]=e[r+a%t];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,r,a,o,n){if(.5<=o)for(o=0;o!==n;++o)t[r+o]=t[a+o]},_slerp:function(e,t,r,a){i.slerpFlat(e,t,e,t,e,r,a)},_lerp:function(t,r,a,o,n){for(var e=0,i;e!==n;++e)i=r+e,t[i]=t[i]*(1-o)+t[a+e]*o}}),Object.assign(Se.prototype,{getValue:function(e,t){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)},setValue:function(t,r){for(var a=this._bindings,o=this._targetGroup.nCachedObjects_,n=a.length;o!==n;++o)a[o].setValue(t,r)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(fn,{Composite:Se,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new fn.Composite(e,t,r):new fn(e,t,r)},sanitizeNodeName:function(){return function(e){return e.replace(/\s/g,"_").replace(/[\[\]\.:\/]/g,"")}}(),parseTrackName:function(){var t="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]");t=/(WCOD+)?/.source.replace("WCOD",t);var o=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),n=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),i=new RegExp("^"+r+t+o+n+"$"),e=["material","materials","bones"];return function(t){var r=i.exec(t);if(!r)throw Error("PropertyBinding: Cannot parse trackName: "+t);r={nodeName:r[2],objectName:r[3],objectIndex:r[4],propertyName:r[5],propertyIndex:r[6]};var a=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==a&&-1!==a){var o=r.nodeName.substring(a+1);-1!==e.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,a),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var o=function(r){for(var a=0,n;a<r.length;a++)if(n=r[a],n.name===t||n.uuid===t||(n=o(n.children)))return n;return null};if(e=o(e.children))return e}return null}}),Object.assign(fn.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(t,r){for(var a=this.resolvedProperty,o=0,n=a.length;o!==n;++o)t[r++]=a[o]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){for(var a=this.resolvedProperty,o=0,n=a.length;o!==n;++o)a[o]=t[r++]},function(t,r){for(var a=this.resolvedProperty,o=0,n=a.length;o!==n;++o)a[o]=t[r++];this.targetObject.needsUpdate=!0},function(t,r){for(var a=this.resolvedProperty,o=0,n=a.length;o!==n;++o)a[o]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var t=this.node,r=this.parsedPath,o=r.objectName,n=r.propertyName,i=r.propertyIndex;if(t||(this.node=t=fn.findNode(this.rootNode,r.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(o){var s=r.objectIndex;switch(o){case"materials":if(!t.material)return void console.error("COCO.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("COCO.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("COCO.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(t=t.skeleton.bones,o=0;o<t.length;o++)if(t[o].name===s){s=o;break}break;default:if(void 0===t[o])return void console.error("COCO.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[o];}if(void 0!==s){if(void 0===t[s])return void console.error("COCO.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[s]}}if(s=t[n],void 0===s)console.error("COCO.PropertyBinding: Trying to update property for track: "+r.nodeName+"."+n+" but it wasn't found.",t);else{if(r=this.Versioning.None,this.targetObject=t,void 0===t.needsUpdate?void 0!==t.matrixWorldNeedsUpdate&&(r=this.Versioning.MatrixWorldNeedsUpdate):r=this.Versioning.NeedsUpdate,o=this.BindingType.Direct,void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("COCO.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("COCO.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(t.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!t.geometry.morphTargets)return void console.error("COCO.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(t.geometry.morphTargets[o].name===i){i=o;break}}}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][r]}}else console.error("COCO.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(fn.prototype,{_getValue_unbound:fn.prototype.getValue,_setValue_unbound:fn.prototype.setValue}),Object.assign(qa.prototype,{isAnimationObjectGroup:!0,add:function(){for(var r=this._objects,a=r.length,o=this.nCachedObjects_,i=this._indicesByUUID,s=this._paths,e=this._parsedPaths,d=this._bindings,m=d.length,g=void 0,f=0,h=arguments.length;f!==h;++f){var n=arguments[f],p=n.uuid,y=i[p];if(void 0===y){y=a++,i[p]=y,r.push(n),p=0;for(var _=m;p!==_;++p)d[p].push(new fn(n,s[p],e[p]))}else if(y<o){g=r[y];var T=--o;for(_=r[T],i[_.uuid]=y,r[y]=_,i[p]=T,r[T]=n,p=0,_=m;p!==_;++p){var v=d[p],x=v[y];v[y]=v[T],void 0===x&&(x=new fn(n,s[p],e[p])),v[T]=x}}else r[y]!==g&&console.error("COCO.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=o},remove:function(){for(var t=this._objects,r=this.nCachedObjects_,a=this._indicesByUUID,o=this._bindings,i=o.length,e=0,s=arguments.length;e!==s;++e){var d=arguments[e],c=d.uuid,m=a[c];if(void 0!==m&&m>=r){var l=r++,n=t[l];for(a[n.uuid]=m,t[m]=n,a[c]=l,t[l]=d,d=0,c=i;d!==c;++d){n=o[d];var g=n[m];n[m]=n[l],n[l]=g}}}this.nCachedObjects_=r},uncache:function(){for(var r=this._objects,a=r.length,o=this.nCachedObjects_,i=this._indicesByUUID,s=this._bindings,e=s.length,d=0,m=arguments.length;d!==m;++d){var f=arguments[d].uuid,h=i[f];if(void 0!==h)if(delete i[f],h<o){f=--o;var l=r[f],y=--a,v=r[y];for(i[l.uuid]=h,r[h]=l,i[v.uuid]=f,r[f]=v,r.pop(),l=0,v=e;l!==v;++l){var x=s[l],_=x[y];x[h]=x[f],x[f]=_,x.pop()}}else for(y=--a,v=r[y],i[v.uuid]=h,r[h]=v,r.pop(),l=0,v=e;l!==v;++l)x=s[l],x[h]=x[y],x.pop()}this.nCachedObjects_=o},subscribe_:function(t,r){var a=this._bindingsIndicesByPath,o=a[t],n=this._bindings;if(void 0!==o)return n[o];var e=this._paths,i=this._parsedPaths,s=this._objects,p=this.nCachedObjects_,m=Array(s.length);for(o=n.length,a[t]=o,e.push(t),i.push(r),n.push(m),a=p,o=s.length;a!==o;++a)m[a]=new fn(s[a],t,r);return m},unsubscribe_:function(t){var r=this._bindingsIndicesByPath,a=r[t];if(void 0!==a){var o=this._paths,n=this._parsedPaths,e=this._bindings,i=e.length-1,s=e[i];r[t[i]]=a,e[a]=s,e.pop(),n[a]=n[i],n.pop(),o[a]=o[i],o.pop()}}}),Object.assign(hn.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(t,r,a){if(t.fadeOut(r),this.fadeIn(r),a){a=this._clip.duration;var o=t._clip.duration,n=a/o;t.warp(1,o/a,r),this.warp(n,1,r)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(t,r,a){var o=this._mixer,n=o.time,e=this._timeScaleInterpolant,i=this.timeScale;return null===e&&(this._timeScaleInterpolant=e=o._lendControlInterpolant()),o=e.parameterPositions,e=e.sampleValues,o[0]=n,o[1]=n+a,e[0]=t/i,e[1]=r/i,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,r,o,n){if(this.enabled){var i=this._startTime;if(null!==i){if(r=(t-i)*o,0>r||0===o)return;this._startTime=null,r*=o}if(r*=this._updateTimeScale(t),o=this._updateTime(r),t=this._updateWeight(t),0<t){r=this._interpolants,i=this._propertyBindings;for(var s=0,d=r.length;s!==d;++s)r[s].evaluate(o),i[s].accumulate(n,t)}}else this._updateWeight(t)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var a=r.evaluate(e)[0];t*=a,e>r.parameterPositions[1]&&(this.stopFading(),0===a&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r){var a=r.evaluate(e)[0];t*=a,e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t},_updateTime:function(t){var r=this.time+t,o=this._clip.duration,n=this.loop,i=this._loopCount,s=2202===n;if(0===t)return-1===i?r:s&&1==(1&i)?o-r:r;if(2200===n)a:{if(-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1)),r>=o)r=o;else if(0>r)r=0;else{this.time=r;break a}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>t?-1:1})}else{if(-1===i&&(0<=t?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=o||0>r){n=Math.floor(r/o),r-=o*n,i+=Math.abs(n);var p=this.repetitions-i;0>=p?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r=0<t?o:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(1===p?(t=0>t,this._setEndings(t,!t,s)):this._setEndings(!1,!1,s),this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n}))}else this.time=r;if(s&&1==(1&i))return o-r}return r},_setEndings:function(e,t,r){var a=this._interpolantSettings;r?(a.endingStart=2401,a.endingEnd=2401):(a.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,a.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,r,a){var o=this._mixer,n=o.time,e=this._weightInterpolant;return null===e&&(this._weightInterpolant=e=o._lendControlInterpolant()),o=e.parameterPositions,e=e.sampleValues,o[0]=n,e[0]=r,o[1]=n+t,e[1]=a,this}}),yn.prototype=Object.assign(Object.create(t.prototype),{constructor:yn,_bindAction:function(t,r){var o=t._localRoot||this._root,i=t._clip.tracks,s=i.length,e=t._propertyBindings;t=t._interpolants;var d=o.uuid,c=this._bindingsByRootAndName,m=c[d];for(void 0===m&&(m={},c[d]=m),c=0;c!==s;++c){var u=i[c],l=u.name,n=m[l];if(void 0===n){if(n=e[c],void 0!==n){null===n._cacheIndex&&(++n.referenceCount,this._addInactiveBinding(n,d,l));continue}n=new Re(fn.create(o,l,r&&r._propertyBindings[c].binding.parsedPath),u.ValueTypeName,u.getValueSize()),++n.referenceCount,this._addInactiveBinding(n,d,l)}e[c]=n,t[c].resultBuffer=n.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var r=(t._localRoot||this._root).uuid,a=t._clip.uuid,o=this._actionsByClip[a];this._bindAction(t,o&&o.knownActions[0]),this._addInactiveAction(t,a,r)}for(r=t._propertyBindings,a=0,o=r.length;a!==o;++a){var n=r[a];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var r=t._propertyBindings,a=0,o=r.length,n;a!==o;++a)n=r[a],0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n));this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){return e=e._cacheIndex,null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,r,a){var o=this._actions,n=this._actionsByClip,e=n[r];void 0===e?(e={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[r]=e):(r=e.knownActions,t._byClipCacheIndex=r.length,r.push(t)),t._cacheIndex=o.length,o.push(t),e.actionByRoot[a]=t},_removeInactiveAction:function(t){var r=this._actions,a=r[r.length-1],o=t._cacheIndex;a._cacheIndex=o,r[o]=a,r.pop(),t._cacheIndex=null,r=t._clip.uuid,a=this._actionsByClip,o=a[r];var n=o.knownActions,e=n[n.length-1],i=t._byClipCacheIndex;e._byClipCacheIndex=i,n[i]=e,n.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===n.length&&delete a[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(e){e=e._propertyBindings;for(var t=0,r=e.length,o;t!==r;++t)o=e[t],0==--o.referenceCount&&this._removeInactiveBinding(o)},_lendAction:function(t){var r=this._actions,a=t._cacheIndex,o=this._nActiveActions++,n=r[o];t._cacheIndex=o,r[o]=t,n._cacheIndex=a,r[a]=n},_takeBackAction:function(t){var r=this._actions,a=t._cacheIndex,o=--this._nActiveActions,n=r[o];t._cacheIndex=o,r[o]=t,n._cacheIndex=a,r[a]=n},_addInactiveBinding:function(t,r,a){var o=this._bindingsByRootAndName,n=o[r],i=this._bindings;void 0===n&&(n={},o[r]=n),n[a]=t,t._cacheIndex=i.length,i.push(t)},_removeInactiveBinding:function(t){var r=this._bindings,o=t.binding,n=o.rootNode.uuid;o=o.path;var i=this._bindingsByRootAndName,e=i[n],s=r[r.length-1];t=t._cacheIndex,s._cacheIndex=t,r[t]=s,r.pop(),delete e[o],0===Object.keys(e).length&&delete i[n]},_lendBinding:function(t){var r=this._bindings,a=t._cacheIndex,o=this._nActiveBindings++,n=r[o];t._cacheIndex=o,r[o]=t,n._cacheIndex=a,r[a]=n},_takeBackBinding:function(t){var r=this._bindings,a=t._cacheIndex,o=--this._nActiveBindings,n=r[o];t._cacheIndex=o,r[o]=t,n._cacheIndex=a,r[a]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&(r=new Lo(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(t){var r=this._controlInterpolants,a=t.__cacheIndex,o=--this._nActiveControlInterpolants,n=r[o];t.__cacheIndex=o,r[o]=t,n.__cacheIndex=a,r[a]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,r){var o=r||this._root,n=o.uuid;o="string"==typeof t?Uo.findByName(o,t):t,t=null===o?t:o.uuid;var i=this._actionsByClip[t],e=null;if(void 0!==i){if(e=i.actionByRoot[n],void 0!==e)return e;e=i.knownActions[0],null===o&&(o=e._clip)}return null===o?null:(r=new hn(this,o,r),this._bindAction(r,e),this._addInactiveAction(r,t,n),r)},existingAction:function(e,t){var r=t||this._root;return t=r.uuid,r="string"==typeof e?Uo.findByName(r,e):e,e=this._actionsByClip[r?r.uuid:e],void 0===e?null:e.actionByRoot[t]||null},stopAllAction:function(){for(var t=this._actions,r=this._nActiveActions,a=this._bindings,o=this._nActiveBindings,n=this._nActiveBindings=this._nActiveActions=0;n!==r;++n)t[n].reset();for(n=0;n!==o;++n)a[n].useCount=0;return this},update:function(t){t*=this.timeScale;for(var r=this._actions,o=this._nActiveActions,n=this.time+=t,i=Math.sign(t),e=this._accuIndex^=1,s=0;s!==o;++s)r[s]._update(n,t,i,e);for(t=this._bindings,r=this._nActiveBindings,s=0;s!==r;++s)t[s].apply(e);return this},getRoot:function(){return this._root},uncacheClip:function(t){var r=this._actions;t=t.uuid;var o=this._actionsByClip,n=o[t];if(void 0!==n){n=n.knownActions;for(var i=0,s=n.length,p;i!==s;++i){p=n[i],this._deactivateAction(p);var l=p._cacheIndex,c=r[r.length-1];p._cacheIndex=null,p._byClipCacheIndex=null,c._cacheIndex=l,r[l]=c,r.pop(),this._removeInactiveBindingsForAction(p)}delete o[t]}},uncacheRoot:function(t){t=t.uuid;var r=this._actionsByClip;for(n in r){var o=r[n].actionByRoot[t];void 0!==o&&(this._deactivateAction(o),this._removeInactiveAction(o))}var n=this._bindingsByRootAndName[t];if(void 0!==n)for(var i in n)t=n[i],t.restoreOriginalState(),this._removeInactiveBinding(t)},uncacheAction:function(e,t){e=this.existingAction(e,t),null!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}}),Te.prototype.clone=function(){return new Te(void 0===this.value.clone?this.value:this.value.clone())},ee.prototype=Object.assign(Object.create(Or.prototype),{constructor:ee,isInstancedInterleavedBuffer:!0,copy:function(e){return Or.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Ue.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this._camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this._camera=t):console.error("COCO.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){return r=r||[],xn(e,this,r,t),r.sort(vn),r},intersectObjects:function(t,r,a){if(a=a||[],!1===Array.isArray(t))return console.warn("COCO.Raycaster.intersectObjects: objects is not an Array."),a;for(var o=0,n=t.length;o<n;o++)xn(t[o],this,a,r);return a.sort(vn),a}}),Object.assign(Ve.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(e,r),this.phi=Math.acos(Ze.clamp(t/this.radius,-1,1))),this}}),Object.assign(_n.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}}),Object.assign(bn.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o;return function(t,r){return r=e.copy(r).multiplyScalar(.5),this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("COCO.Box2: .getCenter() target is now required"),e=new o),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("COCO.Box2: .getSize() target is now required"),e=new o),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("COCO.Box2: .getParameter() target is now required"),t=new o),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("COCO.Box2: .clampPoint() target is now required"),t=new o),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Pi,Ri;Object.assign(We.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("COCO.Line3: .getCenter() target is now required"),e=new s),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("COCO.Line3: .delta() target is now required"),e=new s),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("COCO.Line3: .at() target is now required"),t=new s),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){return void 0===Pi&&(Pi=new s,Ri=new s),Pi.subVectors(e,this.start),Ri.subVectors(this.end,this.start),e=Ri.dot(Ri),e=Ri.dot(Pi)/e,t&&(e=Ze.clamp(e,0,1)),e},closestPointToPoint:function(e,t,r){return e=this.closestPointToPointParameter(e,t),void 0===r&&(console.warn("COCO.Line3: .closestPointToPoint() target is now required"),r=new s),this.delta(r).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Xe.prototype=Object.create(y.prototype),Xe.prototype.constructor=Xe,Xe.prototype.isImmediateRenderObject=!0,Tn.prototype=Object.create(X.prototype),Tn.prototype.constructor=Tn,Tn.prototype.update=function(){var o=new s,a=new s,i=new r;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var s=this.object.matrixWorld,e=this.geometry.attributes.position,c=this.object.geometry;if(c&&c.isGeometry)for(var m=c.vertices,f=c.faces,y=c=0,v=f.length;y<v;y++)for(var n=f[y],p=0,x=n.vertexNormals.length,_;p<x;p++)_=n.vertexNormals[p],o.copy(m[n[r[p]]]).applyMatrix4(s),a.copy(_).applyMatrix3(i).normalize().multiplyScalar(this.size).add(o),e.setXYZ(c,o.x,o.y,o.z),c+=1,e.setXYZ(c,a.x,a.y,a.z),c+=1;else if(c&&c.isBufferGeometry)for(r=c.attributes.position,m=c.attributes.normal,p=c=0,x=r.count;p<x;p++)o.set(r.getX(p),r.getY(p),r.getZ(p)).applyMatrix4(s),a.set(m.getX(p),m.getY(p),m.getZ(p)),a.applyMatrix3(i).normalize().multiplyScalar(this.size).add(o),e.setXYZ(c,o.x,o.y,o.z),c+=1,e.setXYZ(c,a.x,a.y,a.z),c+=1;e.needsUpdate=!0}}(),Sn.prototype=Object.create(y.prototype),Sn.prototype.constructor=Sn,Sn.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Sn.prototype.update=function(){var e=new s;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1E3,r=t*Math.tan(this.light.angle);this.cone.scale.set(r,r,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0===this.color?this.cone.material.color.copy(this.light.color):this.cone.material.color.set(this.color)}}(),Mn.prototype=Object.create(X.prototype),Mn.prototype.constructor=Mn,Mn.prototype.updateMatrixWorld=function(){var t=new s,r=new _,a=new _;return function(o){var n=this.bones,e=this.geometry,i=e.getAttribute("position");a.getInverse(this.root.matrixWorld);for(var s=0,d=0,p;s<n.length;s++)p=n[s],p.parent&&p.parent.isBone&&(r.multiplyMatrices(a,p.matrixWorld),t.setFromMatrixPosition(r),i.setXYZ(d,t.x,t.y,t.z),r.multiplyMatrices(a,p.parent.matrixWorld),t.setFromMatrixPosition(r),i.setXYZ(d+1,t.x,t.y,t.z),d+=2);e.getAttribute("position").needsUpdate=!0,y.prototype.updateMatrixWorld.call(this,o)}}(),Cn.prototype=Object.create(B.prototype),Cn.prototype.constructor=Cn,Cn.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Cn.prototype.update=function(){void 0===this.color?this.material.color.copy(this.light.color):this.material.color.set(this.color)},wn.prototype=Object.create(W.prototype),wn.prototype.constructor=wn,wn.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);1<t&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},wn.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},Pn.prototype=Object.create(y.prototype),Pn.prototype.constructor=Pn,Pn.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Pn.prototype.update=function(){var t=new s,r=new v,a=new v;return function(){var o=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var n=o.geometry.getAttribute("color");r.copy(this.light.color),a.copy(this.light.groundColor);for(var e=0,i=n.count,s;e<i;e++)s=e<i/2?r:a,n.setXYZ(e,s.r,s.g,s.b);n.needsUpdate=!0}o.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),Rn.prototype=Object.create(B.prototype),Rn.prototype.constructor=Rn,Rn.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Rn.prototype.onBeforeRender=function(){return function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity}}(),Ln.prototype=Object.assign(Object.create(X.prototype),{constructor:Ln,copy:function(e){return X.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return new this.constructor().copy(this)}}),fe.prototype=Object.create(X.prototype),fe.prototype.constructor=fe,ge.prototype=Object.create(W.prototype),ge.prototype.constructor=ge,ge.prototype.update=function(){function r(r,a,n,i){for(n=(a-r)/n,u.setXYZ(m,0,0,0),g++,t=r;t<a;t+=n)h=m+g,u.setXYZ(h,Math.sin(t)*o,0,Math.cos(t)*o),u.setXYZ(h+1,Math.sin(Math.min(t+n,a))*o,0,Math.cos(Math.min(t+n,a))*o),u.setXYZ(h+2,0,0,0),g+=3;f.addGroup(m,g,i),m+=g,g=0}var a=this.audio,o=this.range,i=this.divisionsInnerAngle,s=this.divisionsOuterAngle,e=Ze.degToRad(a.panner.coneInnerAngle);a=Ze.degToRad(a.panner.coneOuterAngle);var d=e/2,c=a/2,m=0,g=0,f=this.geometry,u=f.attributes.position,t,h;f.clearGroups(),r(-c,-d,s,0),r(-d,d,i,1),r(d,c,s,0),u.needsUpdate=!0,e===a&&(this.material[0].visible=!1)},ge.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},An.prototype=Object.create(X.prototype),An.prototype.constructor=An,An.prototype.update=function(){var t=new s,a=new s,o=new r;return function(){this.object.updateMatrixWorld(!0),o.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,i=this.geometry.attributes.position,e=this.object.geometry,s=e.vertices;e=e.faces;for(var d=0,c=0,m=e.length;c<m;c++){var l=e[c],n=l.normal;t.copy(s[l.a]).add(s[l.b]).add(s[l.c]).divideScalar(3).applyMatrix4(r),a.copy(n).applyMatrix3(o).normalize().multiplyScalar(this.size).add(t),i.setXYZ(d,t.x,t.y,t.z),d+=1,i.setXYZ(d,a.x,a.y,a.z),d+=1}i.needsUpdate=!0}}(),Dn.prototype=Object.create(y.prototype),Dn.prototype.constructor=Dn,Dn.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Dn.prototype.update=function(){var e=new s,t=new s,r=new s;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(t),void 0===this.color?(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)):(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=r.length()}}(),In.prototype=Object.create(X.prototype),In.prototype.constructor=In,In.prototype.update=function(){function t(t,i,s,d){if(r.set(i,s,d).unproject(o),t=n[t],void 0!==t)for(i=e.getAttribute("position"),s=0,d=t.length;s<d;s++)i.setXYZ(t[s],r.x,r.y,r.z)}var r=new s,o=new re,e,n;return function(){e=this.geometry,n=this.pointMap,o.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),t("c",0,0,-1),t("t",0,0,1),t("n1",-1,-1,-1),t("n2",1,-1,-1),t("n3",-1,1,-1),t("n4",1,1,-1),t("f1",-1,-1,1),t("f2",1,-1,1),t("f3",-1,1,1),t("f4",1,1,1),t("u1",.7,1.1,-1),t("u2",-.7,1.1,-1),t("u3",0,2,-1),t("cf1",-1,0,1),t("cf2",1,0,1),t("cf3",0,-1,1),t("cf4",0,1,1),t("cn1",-1,0,-1),t("cn2",1,0,-1),t("cn3",0,-1,-1),t("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),Bn.prototype=Object.create(X.prototype),Bn.prototype.constructor=Bn,Bn.prototype.update=function(){var t=new g;return function(r){if(void 0!==r&&console.warn("COCO.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){r=t.min;var a=t.max,o=this.geometry.attributes.position,n=o.array;n[0]=a.x,n[1]=a.y,n[2]=a.z,n[3]=r.x,n[4]=a.y,n[5]=a.z,n[6]=r.x,n[7]=r.y,n[8]=a.z,n[9]=a.x,n[10]=r.y,n[11]=a.z,n[12]=a.x,n[13]=a.y,n[14]=r.z,n[15]=r.x,n[16]=a.y,n[17]=r.z,n[18]=r.x,n[19]=r.y,n[20]=r.z,n[21]=a.x,n[22]=r.y,n[23]=r.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Bn.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Bn.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.object=e.object,this},Bn.prototype.clone=function(){return new this.constructor().copy(this)},zn.prototype=Object.create(X.prototype),zn.prototype.constructor=zn,zn.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),y.prototype.updateMatrixWorld.call(this,e))},Nn.prototype=Object.create(W.prototype),Nn.prototype.constructor=Nn,Nn.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;1e-8>Math.abs(t)&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=0>t?1:0,this.lookAt(this.plane.normal),y.prototype.updateMatrixWorld.call(this,e)};var Li,Ai;On.prototype=Object.create(y.prototype),On.prototype.constructor=On,On.prototype.setDirection=function(){var e=new s,t;return function(r){.99999<r.y?this.quaternion.set(0,0,0,1):-.99999>r.y?this.quaternion.set(1,0,0,0):(e.set(r.z,0,-r.x).normalize(),t=Math.acos(r.y),this.quaternion.setFromAxisAngle(e,t))}}(),On.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},On.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},On.prototype.copy=function(e){return y.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},On.prototype.clone=function(){return new this.constructor().copy(this)},kn.prototype=Object.create(X.prototype),kn.prototype.constructor=kn,jo.create=function(e,t){return console.log("COCO.Curve.create() has been deprecated"),e.prototype=Object.create(jo.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Ra.prototype,{createPointsGeometry:function(e){return console.warn("COCO.CurvePath: .createPointsGeometry() has been removed. Use new COCO.Geometry().setFromPoints( points ) instead."),e=this.getPoints(e),this.createGeometry(e)},createSpacedPointsGeometry:function(e){return console.warn("COCO.CurvePath: .createSpacedPointsGeometry() has been removed. Use new COCO.Geometry().setFromPoints( points ) instead."),e=this.getSpacedPoints(e),this.createGeometry(e)},createGeometry:function(t){console.warn("COCO.CurvePath: .createGeometry() has been removed. Use new COCO.Geometry().setFromPoints( points ) instead.");for(var r=new q,a=0,o=t.length,n;a<o;a++)n=t[a],r.vertices.push(new s(n.x,n.y,n.z||0));return r}}),Object.assign(Ko.prototype,{fromPoints:function(e){console.warn("COCO.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Un.prototype=Object.create(Ee.prototype),Gn.prototype=Object.create(Ee.prototype),Fn.prototype=Object.create(Ee.prototype),Object.assign(Fn.prototype,{initFromArray:function(){console.error("COCO.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("COCO.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("COCO.Spline: .reparametrizeByArcLength() has been removed.")}}),Ln.prototype.setColors=function(){console.error("COCO.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Mn.prototype.update=function(){console.error("COCO.SkeletonHelper: update() no longer needs to be called.")},Object.assign(cn.prototype,{extractUrlBase:function(e){return console.warn("COCO.Loader: .extractUrlBase() has been deprecated. Use COCO.LoaderUtils.extractUrlBase() instead."),Ti.extractUrlBase(e)}}),Object.assign(Fe.prototype,{setTexturePath:function(e){return console.warn("COCO.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(bn.prototype,{center:function(e){return console.warn("COCO.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("COCO.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("COCO.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("COCO.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(g.prototype,{center:function(e){return console.warn("COCO.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("COCO.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("COCO.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("COCO.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("COCO.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),We.prototype.center=function(e){return console.warn("COCO.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Ze,{random16:function(){return console.warn("COCO.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("COCO.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Ze.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("COCO.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Ze.ceilPowerOfTwo(e)}}),Object.assign(r.prototype,{flattenToArrayOffset:function(e,t){return console.warn("COCO.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("COCO.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("COCO.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("COCO.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("COCO.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(_.prototype,{extractPosition:function(e){return console.warn("COCO.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("COCO.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new s),console.warn("COCO.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("COCO.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("COCO.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("COCO.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("COCO.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("COCO.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("COCO.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("COCO.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("COCO.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("COCO.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("COCO.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("COCO.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("COCO.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("COCO.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("COCO.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,r,a,o,n,e){return console.warn("COCO.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,r,o,a,n,e)}}),qe.prototype.isIntersectionLine=function(e){return console.warn("COCO.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},i.prototype.multiplyVector3=function(e){return console.warn("COCO.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(L.prototype,{isIntersectionBox:function(e){return console.warn("COCO.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("COCO.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("COCO.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(D.prototype,{area:function(){return console.warn("COCO.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("COCO.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("COCO.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("COCO.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("COCO.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(D,{barycoordFromPoint:function(t,r,a,o,n){return console.warn("COCO.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),D.getBarycoord(t,r,a,o,n)},normal:function(e,t,r,a){return console.warn("COCO.Triangle: .normal() has been renamed to .getNormal()."),D.getNormal(e,t,r,a)}}),Object.assign(Sa.prototype,{extractAllPoints:function(e){return console.warn("COCO.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("COCO.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ka(this,e)},makeGeometry:function(e){return console.warn("COCO.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new lo(this,e)}}),Object.assign(o.prototype,{fromAttribute:function(e,t,r){return console.warn("COCO.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("COCO.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("COCO.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(s.prototype,{setEulerFromRotationMatrix:function(){console.error("COCO.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("COCO.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("COCO.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("COCO.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("COCO.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("COCO.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("COCO.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("COCO.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("COCO.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(u.prototype,{fromAttribute:function(e,t,r){return console.warn("COCO.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("COCO.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(q.prototype,{computeTangents:function(){console.error("COCO.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("COCO.Geometry: .computeLineDistances() has been removed. Use COCO.Line.computeLineDistances() instead.")}}),Object.assign(y.prototype,{getChildByName:function(e){return console.warn("COCO.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("COCO.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("COCO.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("COCO.Object3D: .getWorldRotation() has been removed. Use COCO.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(y.prototype,{eulerOrder:{get:function(){return console.warn("COCO.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("COCO.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("COCO.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("COCO.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Fr.prototype,{objects:{get:function(){return console.warn("COCO.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Vr.prototype,"useVertexTexture",{get:function(){console.warn("COCO.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("COCO.Skeleton: useVertexTexture has been removed.")}}),Hr.prototype.initBones=function(){console.error("COCO.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(jo.prototype,"__arcLengthDivisions",{get:function(){return console.warn("COCO.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("COCO.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),oe.prototype.setLens=function(e,t){console.warn("COCO.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties($o.prototype,{onlyShadow:{set:function(){console.warn("COCO.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("COCO.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("COCO.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("COCO.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("COCO.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("COCO.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("COCO.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("COCO.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("COCO.Light: .shadowCameraVisible has been removed. Use new COCO.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("COCO.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("COCO.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("COCO.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("COCO.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(C.prototype,{length:{get:function(){return console.warn("COCO.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("COCO.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Y.prototype,{addIndex:function(e){console.warn("COCO.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("COCO.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("COCO.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("COCO.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("COCO.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("COCO.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Y.prototype,{drawcalls:{get:function(){return console.error("COCO.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("COCO.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(eo.prototype,{getArrays:function(){console.error("COCO.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("COCO.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("COCO.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Te.prototype,{dynamic:{set:function(){console.warn("COCO.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("COCO.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(x.prototype,{wrapAround:{get:function(){console.warn("COCO.Material: .wrapAround has been removed.")},set:function(){console.warn("COCO.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("COCO.Material: .overdraw has been removed.")},set:function(){console.warn("COCO.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("COCO.Material: .wrapRGB has been removed."),new v}},shading:{get:function(){console.error("COCO."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("COCO."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(Eo.prototype,{metal:{get:function(){return console.warn("COCO.MeshPhongMaterial: .metal has been removed. Use COCO.MeshStandardMaterial instead."),!1},set:function(){console.warn("COCO.MeshPhongMaterial: .metal has been removed. Use COCO.MeshStandardMaterial instead")}}}),Object.defineProperties($.prototype,{derivatives:{get:function(){return console.warn("COCO.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("COCO. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(zr.prototype,{clearTarget:function(e,t,r,a){console.warn("COCO.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,a)},animate:function(e){console.warn("COCO.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("COCO.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("COCO.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("COCO.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("COCO.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("COCO.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("COCO.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("COCO.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("COCO.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("COCO.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("COCO.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("COCO.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("COCO.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("COCO.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("COCO.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("COCO.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("COCO.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("COCO.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("COCO.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("COCO.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("COCO.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("COCO.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("COCO.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("COCO.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(zr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("COCO.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("COCO.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("COCO.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("COCO.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("COCO.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}}}),Object.defineProperties(wr.prototype,{cullFace:{get:function(){console.warn("COCO.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("COCO.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("COCO.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("COCO.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("COCO.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("COCO.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(pe.prototype,{activeCubeFace:{set:function(){console.warn("COCO.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("COCO.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(p.prototype,{wrapS:{get:function(){return console.warn("COCO.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("COCO.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("COCO.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("COCO.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("COCO.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("COCO.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("COCO.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("COCO.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("COCO.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("COCO.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("COCO.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("COCO.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("COCO.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("COCO.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("COCO.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("COCO.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("COCO.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("COCO.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("COCO.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("COCO.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Br.prototype,{standing:{set:function(){console.warn("COCO.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("COCO.WebVRManager: .userHeight has been removed.")}}}),Oe.prototype.load=function(e){console.warn("COCO.Audio: .load has been deprecated. Use COCO.AudioLoader instead.");var t=this;return new mn().load(e,function(e){t.setBuffer(e)}),this},Qe.prototype.getData=function(){return console.warn("COCO.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ne.prototype.updateCubeMap=function(e,t){return console.warn("COCO.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Hn.crossOrigin=void 0,Hn.loadTexture=function(t,r,o,n){console.warn("COCO.ImageUtils.loadTexture has been deprecated. Use COCO.TextureLoader() instead.");var i=new De;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,o,void 0,n),r&&(t.mapping=r),t},Hn.loadTextureCube=function(t,r,o,n){console.warn("COCO.ImageUtils.loadTextureCube has been deprecated. Use COCO.CubeTextureLoader() instead.");var i=new Wo;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,o,void 0,n),r&&(t.mapping=r),t},Hn.loadCompressedTexture=function(){console.error("COCO.ImageUtils.loadCompressedTexture has been removed. Use COCO.DDSLoader instead.")},Hn.loadCompressedTextureCube=function(){console.error("COCO.ImageUtils.loadCompressedTextureCube has been removed. Use COCO.DDSLoader instead.")},e.ACESFilmicToneMapping=5,e.AddEquation=100,e.AddOperation=2,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=dn,e.AmbientLightProbe=Le,e.AnimationClip=Uo,e.AnimationLoader=Na,e.AnimationMixer=yn,e.AnimationObjectGroup=qa,e.AnimationUtils=yi,e.ArcCurve=Ca,e.ArrayCamera=Dr,e.ArrowHelper=On,e.Audio=Oe,e.AudioAnalyser=Qe,e.AudioContext=wi,e.AudioListener=Ne,e.AudioLoader=mn,e.AxesHelper=kn,e.AxisHelper=function(e){return console.warn("COCO.AxisHelper has been renamed to COCO.AxesHelper."),new kn(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("COCO.BinaryTextureLoader has been renamed to COCO.DataTextureLoader."),new Vo(e)},e.Bone=Wr,e.BooleanKeyframeTrack=ta,e.BoundingBoxHelper=function(e,t){return console.warn("COCO.BoundingBoxHelper has been deprecated. Creating a COCO.BoxHelper instead."),new Bn(e,t)},e.Box2=bn,e.Box3=g,e.Box3Helper=zn,e.BoxBufferGeometry=Z,e.BoxGeometry=N,e.BoxHelper=Bn,e.BufferAttribute=C,e.BufferGeometry=Y,e.BufferGeometryLoader=ce,e.ByteType=1010,e.Cache=aa,e.Camera=re,e.CameraHelper=In,e.CanvasRenderer=function(){console.error("COCO.CanvasRenderer has been removed")},e.CanvasTexture=Yr,e.CatmullRomCurve3=Ee,e.CineonToneMapping=4,e.CircleBufferGeometry=xo,e.CircleGeometry=vo,e.ClampToEdgeWrapping=1001,e.Clock=un,e.ClosedSplineCurve3=Un,e.Color=v,e.ColorKeyframeTrack=Io,e.CompressedTexture=ye,e.CompressedTextureLoader=Ho,e.ConeBufferGeometry=yo,e.ConeGeometry=ho,e.CubeCamera=ne,e.CubeGeometry=N,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.CubeTexture=ft,e.CubeTextureLoader=Wo,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.CubicBezierCurve=Zo,e.CubicBezierCurve3=Oa,e.CubicInterpolant=Ea,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=jo,e.CurvePath=Ra,e.CustomBlending=5,e.CylinderBufferGeometry=fo,e.CylinderGeometry=go,e.Cylindrical=_n,e.DataTexture=_e,e.DataTexture2DArray=ht,e.DataTexture3D=yt,e.DataTextureLoader=Vo,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=vi,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.DepthTexture=Zr,e.DirectionalLight=sn,e.DirectionalLightHelper=Dn,e.DirectionalLightShadow=nn,e.DiscreteInterpolant=Ao,e.DodecahedronBufferGeometry=la,e.DodecahedronGeometry=pa,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(e,t){return console.warn("COCO.DynamicBufferAttribute has been removed. Use new COCO.BufferAttribute().setDynamic( true ) instead."),new C(e,t).setDynamic(!0)},e.EdgesGeometry=uo,e.EdgesHelper=function(e,t){return console.warn("COCO.EdgesHelper has been removed. Use COCO.EdgesGeometry instead."),new X(new uo(e.geometry),new xe({color:void 0===t?16777215:t}))},e.EllipseCurve=J,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.Euler=l,e.EventDispatcher=t,e.ExtrudeBufferGeometry=eo,e.ExtrudeGeometry=Ka,e.Face3=V,e.Face4=function(t,r,a,o,n,e,i){return console.warn("COCO.Face4 has been removed. A COCO.Face3 will be created instead."),new V(t,r,a,n,e,i)},e.FaceColors=1,e.FaceNormalsHelper=An,e.FileLoader=Be,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("COCO.Float32Attribute has been removed. Use new COCO.Float32BufferAttribute() instead."),new j(e,t)},e.Float32BufferAttribute=j,e.Float64Attribute=function(e,t){return console.warn("COCO.Float64Attribute has been removed. Use new COCO.Float64BufferAttribute() instead."),new E(e,t)},e.Float64BufferAttribute=E,e.FloatType=1015,e.Fog=Nr,e.FogExp2=we,e.Font=Ie,e.FontLoader=Je,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=0,e.Frustum=et,e.GammaEncoding=3007,e.Geometry=q,e.GeometryUtils={merge:function(e,t,r){if(console.warn("COCO.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh){t.matrixAutoUpdate&&t.updateMatrix();var a=t.matrix;t=t.geometry}e.merge(t,a,r)},center:function(e){return console.warn("COCO.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=Ln,e.Group=Ar,e.HalfFloatType=1016,e.HemisphereLight=R,e.HemisphereLightHelper=Pn,e.HemisphereLightProbe=Ta,e.IcosahedronBufferGeometry=da,e.IcosahedronGeometry=sa,e.ImageBitmapLoader=Ge,e.ImageLoader=Ce,e.ImageUtils=Hn,e.ImmediateRenderObject=Xe,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=be,e.InstancedBufferGeometry=ae,e.InstancedInterleavedBuffer=ee,e.Int16Attribute=function(e,t){return console.warn("COCO.Int16Attribute has been removed. Use new COCO.Int16BufferAttribute() instead."),new z(e,t)},e.Int16BufferAttribute=z,e.Int32Attribute=function(e,t){return console.warn("COCO.Int32Attribute has been removed. Use new COCO.Int32BufferAttribute() instead."),new G(e,t)},e.Int32BufferAttribute=G,e.Int8Attribute=function(e,t){return console.warn("COCO.Int8Attribute has been removed. Use new COCO.Int8BufferAttribute() instead."),new M(e,t)},e.Int8BufferAttribute=M,e.IntType=1013,e.InterleavedBuffer=Or,e.InterleavedBufferAttribute=kr,e.Interpolant=Ro,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("COCO.JSONLoader has been removed.")},e.KeepStencilOp=7680,e.KeyframeTrack=Do,e.LOD=Fr,e.LatheBufferGeometry=po,e.LatheGeometry=so,e.Layers=m,e.LensFlare=function(){console.error("COCO.LensFlare has been moved to /examples/js/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=$o,e.LightProbe=de,e.LightProbeHelper=Rn,e.LightShadow=en,e.Line=W,e.Line3=We,e.LineBasicMaterial=xe,e.LineCurve=Jo,e.LineCurve3=Da,e.LineDashedMaterial=Po,e.LineLoop=U,e.LinePieces=1,e.LineSegments=X,e.LineStrip=0,e.LinearEncoding=3E3,e.LinearFilter=1006,e.LinearInterpolant=Lo,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=1008,e.LinearMipmapNearestFilter=1007,e.LinearToneMapping=1,e.Loader=cn,e.LoaderUtils=Ti,e.LoadingManager=Fo,e.LogLuvEncoding=3003,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=x,e.MaterialLoader=ln,e.Math=Ze,e.Matrix3=r,e.Matrix4=_,e.MaxEquation=104,e.Mesh=B,e.MeshBasicMaterial=S,e.MeshDepthMaterial=Mr,e.MeshDistanceMaterial=Cr,e.MeshFaceMaterial=function(e){return console.warn("COCO.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=Co,e.MeshMatcapMaterial=wo,e.MeshNormalMaterial=Mo,e.MeshPhongMaterial=Eo,e.MeshPhysicalMaterial=So,e.MeshStandardMaterial=To,e.MeshToonMaterial=Ma,e.MinEquation=103,e.MirroredRepeatWrapping=1002,e.MixOperation=1,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("COCO.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=1003,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=1005,e.NearestMipmapNearestFilter=1004,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=Bo,e.Object3D=y,e.ObjectLoader=Fe,e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=ia,e.OctahedronGeometry=na,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=on,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.ParametricBufferGeometry=Kr,e.ParametricGeometry=Qr,e.Particle=function(e){return console.warn("COCO.Particle has been renamed to COCO.Sprite."),new Gr(e)},e.ParticleBasicMaterial=function(e){return console.warn("COCO.ParticleBasicMaterial has been renamed to COCO.PointsMaterial."),new jr(e)},e.ParticleSystem=function(e,t){return console.warn("COCO.ParticleSystem has been renamed to COCO.Points."),new qr(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("COCO.ParticleSystemMaterial has been renamed to COCO.PointsMaterial."),new jr(e)},e.Path=Ko,e.PerspectiveCamera=oe,e.Plane=qe,e.PlaneBufferGeometry=at,e.PlaneGeometry=rt,e.PlaneHelper=Nn,e.PointCloud=function(e,t){return console.warn("COCO.PointCloud has been renamed to COCO.Points."),new qr(e,t)},e.PointCloudMaterial=function(e){return console.warn("COCO.PointCloudMaterial has been renamed to COCO.PointsMaterial."),new jr(e)},e.PointLight=an,e.PointLightHelper=Cn,e.Points=qr,e.PointsMaterial=jr,e.PolarGridHelper=fe,e.PolyhedronBufferGeometry=ea,e.PolyhedronGeometry=$r,e.PositionalAudio=gn,e.PositionalAudioHelper=ge,e.PropertyBinding=fn,e.PropertyMixer=Re,e.QuadraticBezierCurve=Pa,e.QuadraticBezierCurve3=Qa,e.Quaternion=i,e.QuaternionKeyframeTrack=No,e.QuaternionLinearInterpolant=zo,e.REVISION="107",e.RGBADepthPacking=3201,e.RGBAFormat=1023,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGBDEncoding=3006,e.RGBEEncoding=3002,e.RGBEFormat=1023,e.RGBFormat=1022,e.RGBM16Encoding=3005,e.RGBM7Encoding=3004,e.RGB_ETC1_Format=36196,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_S3TC_DXT1_Format=33776,e.RawShaderMaterial=bo,e.Ray=L,e.Raycaster=Ue,e.RectAreaLight=pn,e.RectAreaLightHelper=wn,e.RedFormat=1028,e.ReinhardToneMapping=2,e.RepeatWrapping=1E3,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=io,e.RingGeometry=no,e.Scene=h,e.SceneUtils={createMultiMaterialObject:function(){console.error("COCO.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("COCO.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("COCO.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}},e.ShaderChunk=$n,e.ShaderLib=I,e.ShaderMaterial=$,e.ShadowMaterial=_o,e.Shape=Sa,e.ShapeBufferGeometry=co,e.ShapeGeometry=lo,e.ShapePath=He,e.ShapeUtils=gi,e.ShortType=1011,e.Skeleton=Vr,e.SkeletonHelper=Mn,e.SkinnedMesh=Hr,e.SmoothShading=2,e.Sphere=T,e.SphereBufferGeometry=oo,e.SphereGeometry=ao,e.Spherical=Ve,e.SphericalHarmonics3=Ke,e.SphericalReflectionMapping=305,e.Spline=Fn,e.SplineCurve=Qo,e.SplineCurve3=Gn,e.SpotLight=rn,e.SpotLightHelper=Sn,e.SpotLightShadow=tn,e.Sprite=Gr,e.SpriteMaterial=Ur,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StereoCamera=Me,e.StringKeyframeTrack=Oo,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=oa,e.TetrahedronGeometry=ra,e.TextBufferGeometry=ro,e.TextGeometry=to,e.Texture=n,e.TextureLoader=De,e.TorusBufferGeometry=va,e.TorusGeometry=ya,e.TorusKnotBufferGeometry=ha,e.TorusKnotGeometry=ga,e.Triangle=D,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=ma,e.TubeGeometry=ca,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("COCO.Uint16Attribute has been removed. Use new COCO.Uint16BufferAttribute() instead."),new k(e,t)},e.Uint16BufferAttribute=k,e.Uint32Attribute=function(e,t){return console.warn("COCO.Uint32Attribute has been removed. Use new COCO.Uint32BufferAttribute() instead."),new F(e,t)},e.Uint32BufferAttribute=F,e.Uint8Attribute=function(e,t){return console.warn("COCO.Uint8Attribute has been removed. Use new COCO.Uint8BufferAttribute() instead."),new w(e,t)},e.Uint8BufferAttribute=w,e.Uint8ClampedAttribute=function(e,t){return console.warn("COCO.Uint8ClampedAttribute has been removed. Use new COCO.Uint8ClampedBufferAttribute() instead."),new A(e,t)},e.Uint8ClampedBufferAttribute=A,e.Uncharted2ToneMapping=3,e.Uniform=Te,e.UniformsLib=P,e.UniformsUtils={clone:Q,merge:K},e.UnsignedByteType=1009,e.UnsignedInt248Type=1020,e.UnsignedIntType=1014,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedShortType=1012,e.Vector2=o,e.Vector3=s,e.Vector4=u,e.VectorKeyframeTrack=ko,e.Vertex=function(e,t,r){return console.warn("COCO.Vertex has been removed. Use COCO.Vector3 instead."),new s(e,t,r)},e.VertexColors=2,e.VertexNormalsHelper=Tn,e.VideoTexture=Xr,e.WebGLMultisampleRenderTarget=a,e.WebGLRenderTarget=p,e.WebGLRenderTargetCube=pe,e.WebGLRenderer=zr,e.WebGLUtils=Lr,e.WireframeGeometry=Jr,e.WireframeHelper=function(e,t){return console.warn("COCO.WireframeHelper has been removed. Use COCO.WireframeGeometry instead."),new X(new Jr(e.geometry),new xe({color:void 0===t?16777215:t}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("COCO.XHRLoader has been renamed to COCO.FileLoader."),new Be(e)},e.ZeroCurvatureEnding=2400,e.ZeroFactor=200,e.ZeroSlopeEnding=2401,e.ZeroStencilOp=0,e.sRGBEncoding=3001,Object.defineProperty(e,"__esModule",{value:!0})});var COOLObject=function(e){COCO.Object3D.call(this),this.element=e||document.createElement("div"),this.element.style.position="absolute",this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})};COOLObject.prototype=Object.assign(Object.create(COCO.Object3D.prototype),{constructor:COOLObject,copy:function(e,t){return COCO.Object3D.prototype.copy.call(this,e,t),this.element=e.element.cloneNode(!0),this}});var COOLRenderer=function(){var e=this,t=new COCO.Vector3,r=new COCO.Matrix4,a=new COCO.Matrix4,o={objects:new WeakMap},n=document.createElement("div"),i,s,d,p;n.style.overflow="hidden",this.domElement=n,this.getSize=function(){return{width:i,height:s}},this.setSize=function(e,t){i=e,s=t,d=i/2,p=s/2,n.style.width=e+"px",n.style.height=t+"px"};var c=function(r,s,u){if(r instanceof COOLObject){r.onBeforeRender(e,s,u),t.setFromMatrixPosition(r.matrixWorld),t.applyMatrix4(a);var g=r.element,f="translate(-50%,-50%) translate("+(t.x*d+d)+"px,"+(-t.y*p+p)+"px)";g.style.WebkitTransform=f,g.style.MozTransform=f,g.style.oTransform=f,g.style.transform=f,g.style.display=r.visible&&-1<=t.z&&1>=t.z?"":"none";var h={distanceToCameraSquared:m(u,r)};o.objects.set(r,h),g.parentNode!==n&&n.appendChild(g),r.onAfterRender(e,s,u)}for(var y=0,v=r.children.length;y<v;y++)c(r.children[y],s,u)},m=function(){var e=new COCO.Vector3,t=new COCO.Vector3;return function(r,a){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(a.matrixWorld),e.distanceToSquared(t)}}(),u=function(e){var t=[];return e.traverse(function(e){e instanceof COOLObject&&t.push(e)}),t},g=function(e){for(var t=u(e).sort(function(e,t){var r=o.objects.get(e).distanceToCameraSquared,a=o.objects.get(t).distanceToCameraSquared;return r-a}),r=t.length,a=0,n=t.length;a<n;a++)t[a].element.style.zIndex=r-a};this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),r.copy(t.matrixWorldInverse),a.multiplyMatrices(t.projectionMatrix,r),c(e,e,t),g(e)}};let Peer=window.Peer,messagesEl=document.querySelector(".messages"),videoEl=document.querySelector(".remote-video"),myVideoEl=document.querySelector(".my-video"),button=document.querySelector(".button"),navigation=document.querySelectorAll(".navigation"),loaderSVG="<svg class=\"loader2\" width=\"32\" height=\"32\" viewBox=\"0 0 100 100\"><rect fill=\"white\" height=\"6\" opacity=\"0\" rx=\"3\" ry=\"3\" transform=\"rotate(-90 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.08333333333333333\" rx=\"3\" ry=\"3\" transform=\"rotate(-60 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.16666666666666666\" rx=\"3\" ry=\"3\" transform=\"rotate(-30 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.25\" rx=\"3\" ry=\"3\" transform=\"rotate(0 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.3333333333333333\" rx=\"3\" ry=\"3\" transform=\"rotate(30 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.4166666666666667\" rx=\"3\" ry=\"3\" transform=\"rotate(60 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.5\" rx=\"3\" ry=\"3\" transform=\"rotate(90 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.5833333333333334\" rx=\"3\" ry=\"3\" transform=\"rotate(120 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.6666666666666666\" rx=\"3\" ry=\"3\" transform=\"rotate(150 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.75\" rx=\"3\" ry=\"3\" transform=\"rotate(180 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.8333333333333334\" rx=\"3\" ry=\"3\" transform=\"rotate(210 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect><rect fill=\"white\" height=\"6\" opacity=\"0.9166666666666666\" rx=\"3\" ry=\"3\" transform=\"rotate(240 50 50)\" width=\"25\" x=\"72\" y=\"47\"></rect></svg>",logMessage=e=>{messagesEl.innerHTML="<div>"+e+"</div>"},removeConnectionMessage=()=>{messagesEl.innerHTML=""},renderVideo=e=>{videoEl.srcObject=e,videoEl.onloadedmetadata=()=>{videoEl.play(),removeConnectionMessage()}},renderMyVideo=e=>{myVideoEl.srcObject=e,myVideoEl.onloadedmetadata=()=>{myVideoEl.play()}},peer=new Peer({config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:54.93.214.159:3478?transport=tcp",credential:"limor1",username:"user"}]}});logMessage(loaderSVG+"Connecting");let peerConn;peer.on("open",e=>{if(null==peerId)button.style.display="block",button.id=e,removeConnectionMessage();else{let e=peer.connect(peerId);peerConn=e,e.on("open",()=>{removeConnectionMessage()}),e.on("data",e=>{15>Math.sqrt(Math.pow(last_rot_data.alpha,2)-Math.pow(e.alpha,2))?rotateCamera(e):rotateCamera(last_rot_data),last_rot_data.alpha=e.alpha,last_rot_data.beta=e.beta,last_rot_data.gamma=e.gamma})}});var retryCount=0;peer.on("error",e=>{logMessage(loaderSVG+"Connecting"),3>retryCount?(retryCount++,peer.reconnect()):(peer.destroy(),logMessage("Meeting ended: "+e))}),peer.on("disconnected",function(){logMessage(loaderSVG+"Connecting"),3>retryCount?(retryCount++,peer.reconnect()):(peer.destroy(),logMessage("Meeting ended."))});let last_rot_data={alpha:0,beta:0,gamma:0},theadminConn;peer.on("connection",e=>{theadminConn=e,e.on("open",()=>{logMessage("Established connection with room participant"),removeConnectionMessage()}),e.on("data",e=>{if(null!=e.x){let t={x:e.x,y:e.y,z:e.z};createPoint(t)}else navigation[e].classList.add("visible"),window.setTimeout(()=>{navigation[e].classList.remove("visible")},2e3)})}),peer.on("call",e=>{logMessage(loaderSVG+"Connecting"),e.answer(myVideoStream),e.on("stream",e=>{renderMyVideo(e),removeConnectionMessage()}),e.on("error",e=>{logMessage(loaderSVG+"Connecting"),3>retryCount?(retryCount++,peer.reconnect()):(peer.destroy(),logMessage("Meeting ended: "+e))})});var url=new URL(window.location.href),peerId=url.searchParams.get("room"),myVideoStream;null==peerId?(logMessage(loaderSVG+"Connecting"),document.title="Doorstep - Create Meeting",navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!0}).then(e=>{myVideoStream=e,renderVideo(myVideoStream),videoEl.muted="muted",removeConnectionMessage()}).catch(()=>{removeConnectionMessage(),logMessage("Allow camera access for video chat.")})):(logMessage(loaderSVG+"Connecting"),myVideoEl.classList.add("big"),document.title="Doorstep - Join Meeting",navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(e=>{let t=peer.call(peerId,e);t.on("stream",t=>{removeConnectionMessage(),renderMyVideo(e),renderVideo(t),myVideoEl.muted="muted",myVideoEl.classList.remove("big")}),t.on("error",e=>{myVideoEl.classList.add("big"),logMessage(loaderSVG+"Connecting"),3>retryCount?(retryCount++,peer.reconnect()):(peer.destroy(),logMessage("Meeting ended: "+e))})}).catch(()=>{removeConnectionMessage(),logMessage("Allow camera access for video chat.")}));let sendDataPacket=e=>{theadminConn&&theadminConn.send(e)},sendMarker=e=>{peerConn&&peerConn.send(e)},sendNav=e=>{navigation[e].classList.add("visible"),window.setTimeout(()=>{navigation[e].classList.remove("visible")},2e3),peerConn&&peerConn.send(e)},isMobile=window.matchMedia("only screen and (max-width: 760px)").matches;var url=new URL(window.location.href),peerId=url.searchParams.get("room"),DeviceOrientationController=function(e,t){this.object=e,this.element=t||document,this.freeze=!0,this.enableManualDrag=!0,this.enableManualZoom=!0,this.useQuaternions=!0,this.deviceOrientation={},this.screenOrientation=window.orientation||0;var r=0,a=0,o=0,n=0,i=new COCO.Quaternion,s=1,d=1,p=new COCO.Vector2,l=new COCO.Vector2,c={AUTO:0,MANUAL_ROTATE:1,MANUAL_ZOOM:2},m=c.AUTO,u={CALIBRATE_COMPASS:"compassneedscalibration",SCREEN_ORIENTATION:"orientationchange",MANUAL_CONTROL:"userinteraction",ZOOM_CONTROL:"zoom",ROTATE_CONTROL:"rotate"},g=window.innerHeight,f=2e3*Math.tan(COCO.Math.degToRad((this.object.fov||75)/2)),h=new COCO.Quaternion,y=function(){var e;return function(t){e=arguments||{},e.type=t,e.target=this,this.dispatchEvent(e)}.bind(this)}.bind(this)(),v,x,_,b,T;this.constrainObjectFOV=function(){b=f*(window.innerHeight/g),T=COCO.Math.radToDeg(2*Math.atan(b/2e3)),this.object.fov=T}.bind(this),this.onDeviceOrientationChange=function(e){this.deviceOrientation=e}.bind(this),this.onScreenOrientationChange=function(){this.screenOrientation=window.orientation||0,y(u.SCREEN_ORIENTATION)}.bind(this),this.onCompassNeedsCalibration=function(e){e.preventDefault(),y(u.CALIBRATE_COMPASS)}.bind(this),this.onDocumentMouseDown=function(e){!0!==this.enableManualDrag||(e.preventDefault(),m=c.MANUAL_ROTATE,this.freeze=!0,i.copy(this.object.quaternion),r=o=e.pageX,a=n=e.pageY,v=.2*(1200/window.innerWidth),x=.2*(800/window.innerHeight),this.element.addEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.addEventListener("mouseup",this.onDocumentMouseUp,!1),y(u.MANUAL_CONTROL+"start"),y(u.ROTATE_CONTROL+"start"))}.bind(this),this.onDocumentMouseMove=function(e){o=e.pageX,n=e.pageY}.bind(this),this.onDocumentMouseUp=function(){this.element.removeEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.removeEventListener("mouseup",this.onDocumentMouseUp,!1),m=c.AUTO,this.freeze=!1,y(u.MANUAL_CONTROL+"end"),y(u.ROTATE_CONTROL+"end")}.bind(this),this.onDocumentTouchStart=function(e){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!0!==this.enableManualDrag)return;m=c.MANUAL_ROTATE,this.freeze=!0,i.copy(this.object.quaternion),r=o=e.touches[0].pageX,a=n=e.touches[0].pageY,v=.1*(1200/window.innerWidth),x=.1*(800/window.innerHeight),this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),y(u.MANUAL_CONTROL+"start"),y(u.ROTATE_CONTROL+"start");break;case 2:if(!0!==this.enableManualZoom)return;m=c.MANUAL_ZOOM,this.freeze=!0,_=this.object.fov,p.set(e.touches[0].pageX,e.touches[0].pageY),l.set(e.touches[1].pageX,e.touches[1].pageY),s=d=p.distanceTo(l),this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),y(u.MANUAL_CONTROL+"start"),y(u.ZOOM_CONTROL+"start");}}.bind(this),this.onDocumentTouchMove=function(e){switch(e.touches.length){case 1:o=e.touches[0].pageX,n=e.touches[0].pageY;break;case 2:p.set(e.touches[0].pageX,e.touches[0].pageY),l.set(e.touches[1].pageX,e.touches[1].pageY);}}.bind(this),this.onDocumentTouchEnd=function(){this.element.removeEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.removeEventListener("touchend",this.onDocumentTouchEnd,!1),m===c.MANUAL_ROTATE?(m=c.AUTO,this.freeze=!1,y(u.MANUAL_CONTROL+"end"),y(u.ROTATE_CONTROL+"end")):m===c.MANUAL_ZOOM&&(this.constrainObjectFOV(),m=c.AUTO,this.freeze=!1,y(u.MANUAL_CONTROL+"end"),y(u.ZOOM_CONTROL+"end"))}.bind(this);var S=function(){var e=new COCO.Quaternion,t=new COCO.Euler,r=new COCO.Quaternion,a=new COCO.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),o=0;return function(n,i,s,d){return t.set(i,n,-s,"YXZ"),e.setFromEuler(t),o=-d/2,r.set(0,Math.sin(o),0,Math.cos(o)),e.multiply(r),e.multiply(a),e}}(),E=function(){var e=new COCO.Matrix4,t=new COCO.Euler,r=new COCO.Euler,a=new COCO.Euler(-Math.PI/2,0,0,"YXZ"),o=new COCO.Matrix4,n=new COCO.Matrix4;return n.makeRotationFromEuler(a),function(a,i,s,d){return t.set(i,a,-s,"YXZ"),e.identity(),e.makeRotationFromEuler(t),r.set(0,-d,0,"YXZ"),o.identity(),o.makeRotationFromEuler(r),e.multiply(o),e.multiply(n),e}}();this.updateManualMove=function(){var e=new COCO.Euler(0,0,0,"YXZ"),t=new COCO.Quaternion,u=new COCO.Quaternion,g,f,y,b,T,S,E,M;return function(){u.copy(i),m===c.MANUAL_ROTATE?(g=(a-n)*x,f=(r-o)*v,y=COCO.Math.degToRad(g),b=COCO.Math.degToRad(f),t.set(0,Math.sin(b/2),0,Math.cos(b/2)),u.multiply(t),t.set(Math.sin(y/2),0,0,Math.cos(y/2)),u.multiply(t),T=e.setFromQuaternion(i,"YXZ").z,S=e.setFromQuaternion(u,"YXZ").z,E=e.setFromQuaternion(h||i,"YXZ").z,t.set(0,0,Math.sin((E-T)/2),Math.cos((E-T)/2)),i.multiply(t),t.set(0,0,Math.sin((E-S)/2),Math.cos((E-S)/2)),u.multiply(t),this.object.quaternion.copy(u)):m===c.MANUAL_ZOOM&&(d=p.distanceTo(l),M=s/d,M<=1&&(this.object.fov=_*M,this.object.updateProjectionMatrix()),h&&(T=e.setFromQuaternion(i,"YXZ").z,E=e.setFromQuaternion(h,"YXZ").z,t.set(0,0,Math.sin((E-T)/2),Math.cos((E-T)/2)),i.multiply(t),this.object.quaternion.copy(i)))}}(),this.UpdateRotFromNet=function(t){window.removeEventListener("resize",this.onDocumentMouseDown,!1),window.removeEventListener("resize",this.onDocumentTouchStart,!1),this.deviceOrientation.alpha=t.detail.alpha,this.deviceOrientation.beta=t.detail.beta,this.deviceOrientation.gamma=t.detail.gamma,this.updateDeviceMove()}.bind(this),this.updateDeviceMove=function(){var e,t,r,a,o;return function(){if(e=COCO.Math.degToRad(this.deviceOrientation.alpha||0),t=COCO.Math.degToRad(this.deviceOrientation.beta||0),r=COCO.Math.degToRad(this.deviceOrientation.gamma||0),a=COCO.Math.degToRad(this.screenOrientation||0),0!==e&&0!==t&&0!==r){if(this.useQuaternions?h=S(e,t,r,a):(o=E(e,t,r,a),h.setFromRotationMatrix(o)),this.freeze)return;this.object.quaternion.copy(h)}}}(),this.update=function(){this.updateDeviceMove(),m!==c.AUTO&&this.updateManualMove()},this.connect=function(){window.addEventListener("resize",this.constrainObjectFOV,!1),isMobile&&null==peerId&&(window.addEventListener("orientationchange",this.onScreenOrientationChange,!1),window.addEventListener("deviceorientation",this.onDeviceOrientationChange,!1)),window.addEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1),window.addEventListener("rotation-net-set",this.UpdateRotFromNet,!1),this.freeze=!1},this.disconnect=function(){this.freeze=!0,window.removeEventListener("resize",this.constrainObjectFOV,!1),window.removeEventListener("orientationchange",this.onScreenOrientationChange,!1),window.removeEventListener("deviceorientation",this.onDeviceOrientationChange,!1),window.removeEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1),this.element.removeEventListener("mousedown",this.onDocumentMouseDown,!1),this.element.removeEventListener("touchstart",this.onDocumentTouchStart,!1)}};DeviceOrientationController.prototype=Object.create(COCO.EventDispatcher.prototype);function updateRotationTo(t){window.dispatchEvent(new CustomEvent("rotation-net-set",{detail:{alpha:t.alpha,beta:t.beta,gamma:t.gamma}}))}var gwidth=375,gheight=375,scene=new COCO.Scene,camera=new COCO.PerspectiveCamera(60,375/gheight,.1,1e3);camera.position.set(0,0,.1);var renderer=new COCO.WebGLRenderer({alpha:!0});renderer.setSize(375,gheight),document.body.appendChild(renderer.domElement),renderer.domElement.style.position="fixed",renderer.domElement.style.top=0,renderer.domElement.style.left=0,renderer.domElement.style.zIndex=2;const scene2=new COCO.Scene;scene2.add(camera);var coolRenderer=new COOLRenderer;coolRenderer.setSize(375,gheight),coolRenderer.domElement.style.position="fixed",coolRenderer.domElement.style.top=0,coolRenderer.domElement.style.left=0,coolRenderer.domElement.style.cursor="pointer",coolRenderer.domElement.style.zIndex=3,document.body.appendChild(coolRenderer.domElement);var normal=new COCO.Vector3(0,0,-1),center=new COCO.Vector3,plane=new COCO.Plane().setFromNormalAndCoplanarPoint(normal,center),planeGeometry=new COCO.PlaneGeometry(0,0),coplanarPoint=plane.coplanarPoint(),focalPoint=new COCO.Vector3().copy(coplanarPoint).add(plane.normal);planeGeometry.lookAt(focalPoint),planeGeometry.translate(coplanarPoint.x,coplanarPoint.y,coplanarPoint.z);const material1=new COCO.MeshBasicMaterial({color:0,alphaTest:0,visible:!1}),mesh=new COCO.Mesh(new COCO.PlaneGeometry(window.innerWidth,window.innerHeight),material1);mesh.rotation.x=0,mesh.position.y=0,mesh.position.z=-10,mesh.position.x=0;let pivot_=new COCO.Object3D;pivot_.position.z=0,camera.add(mesh),camera.add(pivot_),scene.add(camera);var DevControls=new DeviceOrientationController(camera,coolRenderer.domElement);DevControls.connect(),window.addEventListener("resize",resize);var raycaster=new COCO.Raycaster,mouse=new COCO.Vector2,tempRadius=new COCO.Vector3;function setMouse(e){mouse.x=2*(e.mouseX/gwidth)-1,mouse.y=2*-(e.mouseY/gheight)+1}function setRaycaster(e){setMouse(e),raycaster.setFromCamera(mouse,camera)}function clickedOnScreen(e){setRaycaster(e);var t=raycaster.intersectObjects(scene.children,!0);if(0<t.length){let e={x:t[0].point.x,y:t[0].point.y,z:t[0].point.z};createPoint(e),sendMarker(e)}}function createPoint(e){var t=document.createElement("div");t.classList="marker";var r=new COOLObject(t);scene2.add(r),r.position.x=e.x,r.position.y=e.y,r.position.z=e.z,setTimeout(()=>{scene2.remove(r)},15e3)}var xOffset=0,active=!1,click=!1,swiped=!1,direction=0,currentX,initialX;coolRenderer.domElement.addEventListener("touchstart",dragStart,!1),coolRenderer.domElement.addEventListener("touchend",dragEnd,!1),coolRenderer.domElement.addEventListener("touchmove",drag,!1),coolRenderer.domElement.addEventListener("mousedown",dragStart,!1),coolRenderer.domElement.addEventListener("mouseup",dragEnd,!1),coolRenderer.domElement.addEventListener("mousemove",drag,!1);function dragStart(t){initialX="touchstart"===t.type?t.touches[0].clientX-xOffset:t.clientX-xOffset,active=!0,click=!0,swiped=!1}function dragEnd(t){xOffset=0;var e={};"touchend"===t.type?(e.mouseX=t.touches[0].clientX,e.mouseY=t.touches[0].clientY):(e.mouseX=t.clientX,e.mouseY=t.clientY),!0==click&&clickedOnScreen(e),active=!1}function drag(t){active&&(t.preventDefault(),currentX="touchmove"===t.type?t.touches[0].clientX-initialX:t.clientX-initialX,xOffset=currentX,direction=0>xOffset?-1:1,30>Math.abs(xOffset)&&(direction=0),1==direction&&!1==swiped?(sendNav(0),swiped=!0):-1==direction&&!1==swiped&&(sendNav(1),swiped=!0),click=!1)}function resize(){}function render(){requestAnimationFrame(render),renderer.render(scene,camera),coolRenderer.render(scene2,camera),DevControls.update()}render();function rotateCamera(e){updateRotationTo(e)}var orientationGranted=!1;function requestPermission(){"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&(orientationGranted=!0,window.addEventListener("deviceorientation",()=>{}))}).catch(console.error)}window.addEventListener("deviceorientation",function(e){var t=null!=e&&null!=e.alpha&&null!=e.beta&&null!=e.gamma;if(t){orientationGranted=!0;var r={alpha:e.alpha.toFixed(2),beta:e.beta.toFixed(2),gamma:e.gamma.toFixed(2)};sendDataPacket(r)}});var url=new URL(window.location.href),peerId=url.searchParams.get("room");let promptEl=document.querySelector(".prompt-wrapper");!1==orientationGranted&&null==peerId&&promptEl.classList.add("visible");function copy(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t)}function copyLink(){var e=window.location.href+"?room="+document.querySelector(".button").id;copy("Your package has arrived. Please direct it to your doorstep:\n"+e),document.querySelector(".button").innerHTML="Copied"}document.querySelector(".button").addEventListener("click",()=>{copyLink()}),document.querySelectorAll(".buttons div")[0].addEventListener("click",()=>{promptEl.classList.remove("visible")}),document.querySelectorAll(".buttons div")[1].addEventListener("click",()=>{promptEl.classList.remove("visible"),requestPermission()});
